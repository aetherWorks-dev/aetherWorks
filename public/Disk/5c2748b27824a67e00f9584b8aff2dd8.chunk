92 7 0
(-1184,640) to (-1280,696) : 1 : 0 : 0
    0 (0 : - / - / PIPE6 )
    0 : NUKAGE3 128 : FLOOR5_1 192 7 0
(-1280,696) to (-1280,728) : 1 : 0 : 0
    0 (0 : - / - / PIPE6 )
    0 : NUKAGE3 128 : FLOOR5_1 192 7 0
(-480,320) to (-480,304) : 17 : 0 : 0
    0 (0 : - / - / doortrak )
    24 : MFLR8_2 24 : FLOOR7_1 192 9 11
(-480,304) to (-464,280) : 1 : 0 : 0
    0 (0 : - / - / PIPE6 )
    0 : NUKAGE3 128 : FLOOR5_1 192 7 0
(-464,280) to (-464,240) : 1 : 0 : 0
    0 (0 : - / - / PIPE6 )
    0 : NUKAGE3 128 : FLOOR5_1 192 7 0
(-464,240) to (-488,208) : 1 : 0 : 0
    0 (0 : - / - / PIPE6 )
    0 : NUKAGE3 128 : FLOOR5_1 192 7 0
(-488,208) to (-728,208) : 1 : 0 : 0
    0 (0 : - / - / PIPE6 )
    0 : NUKAGE3 128 : FLOOR5_1 192 7 0
(-728,208) to (-752,232) : 1 : 0 : 0
    0 (0 : - / - / PIPE6 )
    0 : NUKAGE3 128 : FLOOR5_1 192 7 0
(-752,232) to (-752,280) : 1 : 0 : 0
    0 (0 : - / - / PIPE6 )
    0 : NUKAGE3 128 : FLOOR5_1 192 7 0
(-752,280) to (-736,304) : 1 : 0 : 0
    0 (0 : - / - / PIPE6 )
    0 : NUKAGE3 128 : FLOOR5_1 192 7 0
(-736,304) to (-736,320) : 17 : 0 : 0
    0 (0 : - / - / doortrak )
    24 : MFLR8_2 24 : FLOOR7_1 192 9 11
(-736,304) to (-480,304) : 4 : 1 : 0
    0 (0 : BROWNPIP / NUKE24 / - )
    0 : NUKAGE3 128 : FLOOR5_1 192 7 0
    0 (0 : - / - / - )
    24 : MFLR8_2 24 : FLOOR7_1 192 9 11
(-744,664) to (-720,688) : 1 : 0 : 0
    0 (0 : - / - / PIPE6 )
    0 : NUKAGE3 128 : FLOOR5_1 192 7 0
(-720,688) to (-496,688) : 1 : 0 : 0
    0 (0 : - / - / PIPE6 )
    0 : NUKAGE3 128 : FLOOR5_1 192 7 0
(-496,688) to (-472,664) : 1 : 0 : 0
    0 (0 : - / - / PIPE6 )
    0 : NUKAGE3 128 : FLOOR5_1 192 7 0
(-472,664) to (-472,616) : 1 : 0 : 0
    0 (0 : - / - / PIPE6 )
    0 : NUKAGE3 128 : FLOOR5_1 192 7 0
(-472,616) to (-488,592) : 1 : 0 : 0
    0 (0 : - / - / PIPE6 )
    0 : NUKAGE3 128 : FLOOR5_1 192 7 0
(-488,592) to (-720,592) : 20 : 1 : 0
    0 (0 : BROWNPIP / PIPE6 / - )
    0 : NUKAGE3 128 : FLOOR5_1 192 7 0
    0 (0 : - / - / - )
    24 : MFLR8_2 24 : FLOOR7_1 192 9 11
(-720,592) to (-744,616) : 1 : 0 : 0
    0 (0 : - / - / PIPE6 )
    0 : NUKAGE3 128 : FLOOR5_1 192 7 0
(-744,616) to (-744,664) : 1 : 0 : 0
    0 (0 : - / - / PIPE6 )
    0 : NUKAGE3 128 : FLOOR5_1 192 7 0
(120,-768) to (-64,-768) : 4 : 62 : 12
    0 (0 : MODWALL3 / MODWALL3 / - )
    0 : FLOOR0_3 256 : FLAT1 128 0 0
    0 (0 : - / - / - )
    64 : FLAT18 128 : FLAT2 176 9 12
(120,-768) to (120,-896) : 1 : 0 : 0
    0 (0 : - / - / GRAY4 )
    64 : FLAT18 128 : FLAT2 176 9 12
(120,-896) to (-64,-896) : 1 : 0 : 0
    0 (8 : - / - / GRAY4 )
    64 : FLAT18 128 : FLAT2 176 9 12
(-64,-896) to (-64,-768) : 1 : 0 : 0
    0 (0 : - / - / GRAY4 )
    64 : FLAT18 128 : FLAT2 176 9 12
(1696,-128) to (1664,-128) : 4 : 2 : 3
    0 (0 : LITEBLU4 / - / - )
    0 : FLOOR5_4 256 : CEIL3_5 112 0 0
    0 (0 : - / - / - )
    0 : FLOOR5_4 240 : FLAT14 160 0 0
(1696,-160) to (1696,-128) : 4 : 2 : 3
    0 (0 : LITEBLU4 / - / - )
    0 : FLOOR5_4 256 : CEIL3_5 112 0 0
    0 (0 : - / - / - )
    0 : FLOOR5_4 240 : FLAT14 160 0 0
(1664,-160) to (1696,-160) : 4 : 2 : 3
    0 (0 : LITEBLU4 / - / - )
    0 : FLOOR5_4 256 : CEIL3_5 112 0 0
    0 (0 : - / - / - )
    0 : FLOOR5_4 240 : FLAT14 160 0 0
(1664,-128) to (1664,-160) : 4 : 2 : 3
    0 (0 : LITEBLU4 / - / - )
    0 : FLOOR5_4 256 : CEIL3_5 112 0 0
    0 (0 : - / - / - )
    0 : FLOOR5_4 240 : FLAT14 160 0 0
(1472,384) to (1472,376) : 17 : 0 : 0
    0 (0 : - / - / doortrak )
    48 : FLOOR4_8 48 : FLAT20 192 0 13
(1472,376) to (1472,328) : 1 : 0 : 0
    0 (0 : - / - / PIPEWAL2 )
    48 : FLOOR4_8 112 : CEIL3_4 192 0 0
(1472,328) to (1408,328) : 1 : 0 : 0
    0 (0 : - / - / PIPEWAL2 )
    48 : FLOOR4_8 112 : CEIL3_4 192 0 0
(1408,328) to (1408,376) : 1 : 0 : 0
    0 (0 : - / - / PIPEWAL2 )
    48 : FLOOR4_8 112 : CEIL3_4 192 0 0
(1408,376) to (1408,384) : 17 : 0 : 0
    0 (0 : - / - / doortrak )
    48 : FLOOR4_8 48 : FLAT20 192 0 13
(1408,376) to (1472,376) : 4 : 1 : 0
    0 (0 : PIPES / - / - )
    48 : FLOOR4_8 112 : CEIL3_4 192 0 0
    0 (0 : - / - / - )
    48 : FLOOR4_8 48 : FLAT20 192 0 13
(1408,384) to (1344,384) : 1 : 0 : 0
    0 (0 : - / - / PIPES )
    48 : FLOOR4_8 112 : CEIL3_4 192 0 0
(1024,1728) to (1016,1728) : 17 : 0 : 0
    0 (0 : - / - / doorstop )
    8 : FLOOR4_6 8 : CEIL3_4 176 0 19
(1016,1728) to (976,1728) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 176 9 0
(976,1728) to (976,1744) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 176 9 0
(976,1744) to (896,1744) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 176 9 0
(896,1744) to (896,1840) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 176 9 0
(896,1840) to (976,1840) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 176 9 0
(976,1840) to (976,1856) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 176 9 0
(976,1856) to (1016,1856) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 176 9 0
(1016,1856) to (1024,1856) : 17 : 0 : 0
    0 (0 : - / - / doorstop )
    8 : FLOOR4_6 8 : CEIL3_4 176 0 19
(1016,1856) to (1016,1728) : 36 : 0 : 0
    0 (0 : SHAWN1 / - / - )
    8 : FLOOR4_6 80 : CEIL3_4 176 9 0
    0 (0 : - / - / - )
    8 : FLOOR4_6 8 : CEIL3_4 176 0 19
(1344,1408) to (1352,1408) : 17 : 0 : 0
    0 (0 : - / - / doorstop )
    8 : FLOOR4_6 8 : CEIL3_4 176 0 18
(1352,1408) to (1392,1408) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 176 9 0
(1392,1408) to (1392,1392) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 176 9 0
(1392,1392) to (1472,1392) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 176 9 0
(1472,1392) to (1472,1296) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 176 9 0
(1472,1296) to (1392,1296) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 176 9 0
(1392,1296) to (1392,1280) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 176 9 0
(1392,1280) to (1352,1280) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 176 9 0
(1352,1280) to (1344,1280) : 17 : 0 : 0
    0 (0 : - / - / doorstop )
    8 : FLOOR4_6 8 : CEIL3_4 176 0 18
(1352,1280) to (1352,1408) : 36 : 0 : 0
    0 (0 : SHAWN1 / - / - )
    8 : FLOOR4_6 80 : CEIL3_4 176 9 0
    0 (0 : - / - / - )
    8 : FLOOR4_6 8 : CEIL3_4 176 0 18
(1024,1088) to (1016,1088) : 17 : 0 : 0
    0 (0 : - / - / doorstop )
    8 : FLOOR4_6 8 : CEIL3_4 176 0 17
(1016,1088) to (768,1088) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 176 9 0
(768,1088) to (768,1408) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 176 9 0
(768,1408) to (896,1408) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 176 9 0
(896,1408) to (896,1216) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 176 9 0
(896,1216) to (1016,1216) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 176 9 0
(1016,1216) to (1024,1216) : 17 : 0 : 0
    0 (0 : - / - / doorstop )
    8 : FLOOR4_6 8 : CEIL3_4 176 0 17
(1016,1216) to (1016,1088) : 36 : 0 : 0
    0 (0 : SHAWN1 / - / - )
    8 : FLOOR4_6 80 : CEIL3_4 176 9 0
    0 (0 : - / - / - )
    8 : FLOOR4_6 8 : CEIL3_4 176 0 17
(1408,2176) to (1408,2184) : 17 : 0 : 0
    0 (0 : - / - / doorstop )
    8 : FLOOR4_6 8 : CEIL3_4 96 0 20
(1408,2184) to (1408,2304) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 96 9 0
(1408,2304) to (1536,2304) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 96 9 0
(1536,2304) to (1536,2184) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 96 9 0
(1536,2184) to (1536,2176) : 17 : 0 : 0
    0 (0 : - / - / doorstop )
    8 : FLOOR4_6 8 : CEIL3_4 96 0 20
(1536,2184) to (1408,2184) : 36 : 0 : 0
    0 (0 : SHAWN1 / - / - )
    8 : FLOOR4_6 80 : CEIL3_4 96 9 0
    0 (0 : - / - / - )
    8 : FLOOR4_6 8 : CEIL3_4 96 0 20
(1920,1408) to (1928,1408) : 17 : 0 : 0
    0 (0 : - / - / doorstop )
    8 : FLOOR4_6 8 : FLAT20 128 0 16
(1928,1408) to (2112,1408) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : Cobjc_class_name_Menu .objc_class_name_MenuCell .objc_class_name_NXTaggedBrowserCell .objc_class_name_SavePanel .objc_class_name_Speaker _NXAsciiPboardType _NXFileContentsPboardType _NXFilenamePboardType _NXFontPboardType _NXOrderStrings _NXPortNameLookup _NXPostScriptPboardType _NXRTFPboardType _NXRulerPboardType _NXTIFFPboardType _NXTabularTextPboardType _NXTypedFileContentsPboardType _NXTypedFilenamePboardType _NXWorkspaceReplyName __NXLookupAppkitServer __libNeXT_NXCloseMemory __libNeXT_NXCopyStringBuffer __libNeXT_NXCopyStringBufferFromZone __libNeXT_NXCreateHashTableFromZone __libNeXT_NXFreeHashTable __libNeXT_NXHashGet __libNeXT_NXHashInsert __libNeXT_NXInitHashState __libNeXT_NXMapFile __libNeXT_NXNextHashState __libNeXT_NXPtrHash __libNeXT_NXReallyFree __libNeXT_access __libNeXT_close __libNeXT_closedir __libNeXT_dup2 __libNeXT_execl __libNeXT_exit __libNeXT_fclose __libNeXT_fdopen __libNeXT_fread __libNeXT_gettimeofday __libNeXT_memset __libNeXT_opendir __libNeXT_pipe __libNeXT_qsort __libNeXT_readdir __libNeXT_sigblock __libNeXT_signal __libNeXT_sigsetmask __libNeXT_strchr __libNeXT_strcmp __libNeXT_strncmp __libNeXT_strncpy __libNeXT_vfork __libNeXT_vm_allocate __libNeXT_vm_copy __libNeXT_vm_deallocate __libNeXT_vm_page_size __libNeXT_wait .file_definition_libNeXT_s.C.shlib_pbsUser.o .file_definition_libNeXT_s.C.shlib_wordTables.o .file_definition_libNeXT_s.C.shlib_Speaker.o .file_definition_libNeXT_s.C.shlib_SavePanel.o .file_definition_libNeXT_s.C.shlib_PopUpList.o .file_definition_libNeXT_s.C.shlib_NXTaggedBrowserCell.o .file_definition_libNeXT_s.C.shlib_MenuCell.o .file_definition_libNeXT_s.C.shlib_Menu.o .file_definition_libNeXT_s.C.shlib_appServicesMenu.o .objc_category_name_Application_WindowCache .file_definition_libNeXT_s.C.shlib_appCache.o .objc_category_name_Application_WindowsMenu __libNeXT_strncat .file_definition_libNeXT_s.C.shlib_appWindows.o .objc_category_name_List_NXFileRefPrivate .objc_class_name_NXCheapFileRef .objc_class_name_NXFileRef .objc_class_name_NXPath .objc_class_name_NXPathComponent .objc_class_name_NXRelPath .objc_class_name_NXSmartFileRef .objc_class_name_NXSymlinkPathComponent __libNeXT_NXFreeObjectBuffer __libNeXT_NXReadObject __libNeXT_NXReadObjectFromBufferWithZone __libNeXT_NXReadTypes __libNeXT_NXTypedStreamClassVersion __libNeXT_NXWriteObjectReference __libNeXT_NXWriteRootObjectToBuffer __libNeXT_NXWriteTypes __libNeXT_chdir __libNeXT_getwd __libNeXT_lstat __libNeXT_stat .file_definition_libNeXT_s.C.shlib_NXFileRef.o .objc_category_name_List_NXString_Extras .objc_category_name_NXRTFD_Internal .objc_category_name_NXRTFD_TextDocumentPboard .objc_category_name_NXString_NXUniquePart .objc_class_name_NXDirInfo .objc_class_name_NXDirInfoDeserializer .objc_class_name_NXDirInfoSerializer .objc_class_name_NXDocInfo .objc_class_name_NXDocumentDeserializer .objc_class_name_NXDocumentSerializer .objc_class_name_NXLeafProxy .objc_class_name_NXRTFD .objc_class_name_NXConstantString .objc_class_name_NXDeserializer .objc_class_name_NXDeserializerStream .objc_class_name_NXPageString .objc_class_name_NXPropertyList .objc_class_name_NXReadOnlyString .objc_class_name_NXSerializer .objc_class_name_NXSerializerStream .objc_class_name_NXString __libNeXT_NXGetTempFilename __libNeXT_errno __libNeXT_readlink .file_definition_libNeXT_s.C.shlib_docutil.o .file_definition_libNeXT_s.C.shlib_NXSerializer.o .file_definition_libNeXT_s.C.shlib_NXRTFD.o .objc_category_name_Listener_NXApplicationDelegate .objc_category_name_Listener_NXObsolete .objc_category_name_Listener_NXPrivate .objc_category_name_Listener_NXWorkspace _NXCopyInputData _NXFreeMsgVM _NXNextSequence _NXReceiveMessage _NXRemoteMethodFromSel _NXResponsibleDelegate _NXSendAcknowledge _NXValidMessage _NXWaitForMessage __NXSafeReceive __NXSafeSend .objc_class_name_NXDataLinkManager .objc_class_name_NXJournaler _NXGetWindowServerMemory _NXInputMessage _NXInputMethod __DPSGetOrPeekEvent __NXNetTimeout __libNeXT_SNDAlloc __libNeXT_SNDBootDSP __libNeXT_SNDBytesToSamples __libNeXT_SNDCompactSamples __libNeXT_SNDConvertSound __libNeXT_SNDCopySamples __libNeXT_SNDCopySound __libNeXT_SNDDeleteSamples __libNeXT_SNDFree __libNeXT_SNDGetMute __libNeXT_SNDGetVolume __libNeXT_SNDInsertSamples __libNeXT_SNDMulaw __libNeXT_SNDReadDSPfile __libNeXT_SNDReadSoundfile __libNeXT_SNDSampleCount __libNeXT_SNDSamplesProcessed __libNeXT_SNDSetMute __libNeXT_SNDSetVolume __libNeXT_SNDSoundError __libNeXT_SNDStartPlaying __libNeXT_SNDStartRecording __libNeXT_SNDStartRecordingFile __libNeXT_SNDStop __libNeXT_SNDVerifyPlayable __libNeXT_SNDWait __libNeXT_SNDWriteSoundfile __libNeXT_SNDiMulaw __libNeXT_memmove __libNeXT_moncontrol __libNeXT_moninit __libNeXT_monoutput __libNeXT_monreset __libNeXT_name_server_port __libNeXT_netname_check_in __libNeXT_netname_check_out __libNeXT_netname_look_up __libNeXT_port_allocate __libNeXT_port_deallocate __libNeXT_sel_getUid __libNeXT_symlink __libNeXT_unlink .file_definition_libNeXT_s.C.shlib_wsMemoryWraps.o .file_definition_libNeXT_s.C.shlib_NXJournaler.o .file_definition_libNeXT_s.C.shlib_NXDataLinkManager.o .objc_category_name_NXConnection_NXConnectionHelper .objc_class_name_NXConnection .objc_class_name_NXPortPortal .file_definition_libNeXT_s.C.shlib_remoteHelper.o .objc_category_name_NXGraphicCell_TextSupport .objc_category_name_NXPageString_RTFHelp .objc_category_name_NXRTFD_Key .objc_category_name_NXRTFD_TextObject .objc_category_name_Text_DocumentSupport .objc_category_name_Text_RTFD .objc_category_name_Text_RunUtil .objc_category_name_Text_TextDocument .objc_category_name_Text_Workspace_Help .objc_class_name_NXGraphicImport .objc_class_name_NXRTFDImageHandler .objc_class_name_NXGraphicCell .objc_class_name_Text _NXInsetRect __libNeXT_NXFlush __libNeXT_NXGetMemoryBuffer __libNeXT_NXOpenMemory __libNeXT_NXSeek .file_definition_libNeXT_s.C.shlib_Text.o .file_definition_libNeXT_s.C.shlib_NXGraphicCell.o .file_definition_libNeXT_s.C.shlib_textDocument.o .objc_category_name_NXPageString_NXInternal .objc_category_name_NXString_NXUtils .objc_class_name_NXHardLinkInfo .objc_class_name_NXCleanList .objc_class_name_NXSimpleReadOnlyString __libNeXT_NXCreateMapTable __libNeXT_NXMapGet __libNeXT_NXMapInsert __libNeXT_NXMapRemove __libNeXT_NXPtrValueMapPrototype __libNeXT_chmod __libNeXT_fstat __libNeXT_link __libNeXT_map_fd __libNeXT_mkdir __libNeXT_open __libNeXT_printf __libNeXT_read __libNeXT_rename __libNeXT_rmdir __libNeXT_utimes __libNeXT_write .objc_category_name_Object_DelayedPerform _DPSAddTimedEntry _DPSRemoveTimedEntry _DPSSetContext __libNeXT_NXCountHashTable __libNeXT_NXHashRemove .file_definition_libNeXT_s.C.shlib_objectDelayedPerform.o .objc_category_name_Object_IBMethods .objc_class_name_IBConnector .objc_class_name_IBControlConnector .objc_class_name_IBHelpConnector .objc_class_name_IBObjectData .objc_class_name_IBOutletConnector .objc_class_name_CustomView .objc_class_name_MenuTemplate __libNeXT_NXFreeMapTable __libNeXT_NXInitMapState __libNeXT_NXNextMapState __libNeXT_NXReadType __libNeXT__ctype_ __libNeXT_object_setInstanceVariable __libNeXT_sel_registerName .file_definition_libNeXT_s.C.shlib_ScrollView.o .file_definition_libNeXT_s.C.shlib_MenuTemplate.o .file_definition_libNeXT_s.C.shlib_CustomView.o .file_definition_libNeXT_s.C.shlib_IBRuntime.o .objc_category_name_Object__NXZone __NXSetWorkspaceName __NXPBSRendezVous __libNeXT_NXGetStreamOnSection __libNeXT__mh_execute_header __libNeXT_bootstrap_look_up __libNeXT_endpwent __libNeXT_fork __libNeXT_getdtablesize __libNeXT_getenv __libNeXT_geteuid __libNeXT_gethostname __libNeXT_getpwent __libNeXT_getpwnam __libNeXT_getpwuid __libNeXT_getsectdatafromlib __libNeXT_getuid __libNeXT_ioctl __libNeXT_mach_error_string _dup2 __libNeXT_setpwent __libNeXT_task_get_special_port __libNeXT_thread_info __libNeXT_thread_policy __libNeXT_thread_priority __libNeXT_thread_self __libNeXT_thread_switch .objc_category_name_Pasteboard_FileContents .objc_category_name_Pasteboard_FileContents_Private .file_definition_libNeXT_s.C.shlib_pboardFileContents.o .objc_category_name_ScrollView_Ruler .objc_category_name_Text_SelectUtil .objc_class_name_NXRulerView _NXAdjustTextCache _NXHighlightRect _NXIntersectionREIL3_4 128 9 0
(2112,1408) to (2112,1536) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 128 9 0
(2112,1536) to (1952,1536) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 128 9 0
(1952,1536) to (1952,1664) : 4 : 114 : 14
    72 (0 : MARBFAC4 / - / - )
    8 : FLOOR4_6 80 : CEIL3_4 128 9 0
    0 (0 : - / - / - )
    8 : FLOOR4_6 8 : FLAT20 128 0 14
(1952,1664) to (2240,1664) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 128 9 0
(2240,1664) to (2240,1280) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 128 9 0
(2240,1280) to (1928,1280) : 1 : 0 : 0
    0 (0 : - / - / SHAWN2 )
    8 : FLOOR4_6 80 : CEIL3_4 128 9 0
(1928,1280) to (1920,1280) : 17 : 0 : 0
    0 (0 : - / - / doorstop )
    8 : FLOOR4_6 8 : FLAT20 128 0 16
(1928,1280) to (1928,1408) : 100 : 0 : 0
    0 (0 : SHAWN1 / - / - )
    8 : FLOOR4_6 80 : CEIL3_4 128 9 0
    0 (0 : - / - / - )
    8 : FLOOR4_6 8 : FLAT20 128 0 16
(1944,1664) to (1952,1664) : 17 : 0 : 0
    0 (0 : - / - / DOORSTOP )
    8 : FLOOR4_6 8 : FLAT20 128 0 14
(1952,1536) to (1944,1536) : 17 : 0 : 0
    0 (0 : - / - / DOORSTOP )
    8 : FLOOR4_6 8 : FLAT20 128 0 14
(1928,1664) to (1944,1664) : 17 : 0 : 0
    0 (0 : - / - / DOORSTOP )
    8 : FLOOR4_6 80 : CEIL3_4 128 0 0
(1944,1536) to (1928,1536) : 17 : 0 : 0
    0 (0 : - / - / DOORSTOP )
    8 : FLOOR4_6 80 : CEIL3_4 128 0 0
(1920,1664) to (1928,1664) : 17 : 0 : 0
    0 (0 : - / - / DOORSTOP )
    8 : FLOOR4_6 8 : FLAT20 128 0 14
(1928,1536) to (1920,1536) : 17 : 0 : 0
    0 (0 : - / - / DOORSTOP )
    8 : FLOOR4_6 8 : FLAT20 128 0 14
(1928,1536) to (1928,1664) : 4 : 97 : 15
    0 (0 : MARBFAC4 / - / - )
    8 : FLOOR4_6 80 : CEIL3_4 128 0 0
    0 (0 : - / - / - )
    8 : FLOOR4_6 8 : FLAT20 128 0 14
(1944,1664) to (1944,1536) : 4 : 0 : 0
    64 (0 : MARBFAC4 / - / - )
    8 : FLOOR4_6 80 : CEIL3_4 128 0 0
    0 (0 : - / - / - )
    8 : FLOOR4_6 8 : FLAT20 128 0 14
(-1184,-1664) to (-1120,-1664) : 1 : 0 : 0
    0 (16 : - / - / BSTONE1 )
    56 : FLOOR5_4 216 : CEIL4_1 160 0 0
(-1120,-1664) to (-1120,-1728) : 1 : 0 : 0
    0 (16 : - / - / BSTONE1 )
    56 : FLOOR5_4 216 : CEIL4_1 160 0 0
(-1120,-1728) to (-1184,-1728) : 1 : 0 : 0
    0 (16 : - / - / BSTONE1 )
    56 : FLOOR5_4 216 : CEIL4_1 160 0 0
(-1184,-1728) to (-1184,-1824) : 1 : 0 : 0
    0 (16 : - / - / BSTONE1 )
    56 : FLOOR5_4 216 : CEIL4_1 160 0 0
(-1760,-1728) to (-1888,-1728) : 1 : 0 : 0
    0 (45 : - / - / BSTONE1 )
    152 : FLAT5 216 : FLAT5 128 9 15
(-1952,-1856) to (-1952,-1536) : 1 : 0 : 0
    0 (45 : - / - / BSTONE1 )
    152 : FLAT5 216 : FLAT5 128 9 15
(-1888,-1664) to (-1760,-1664) : 1 : 0 : 0
    0 (45 : - / - / BSTONE1 )
    152 : FLAT5 216 : FLAT5 128 9 15
(-1760,-1664) to (-1760,-1264) : 1 : 0 : 0
    0 (45 : - / - / BSTONE1 )
    56 : FLOOR5_4 216 : CEIL4_1 160 0 8
(-1760,-1728) to (-1760,-1664) : 28 : 0 : 0
    0 (45 : BSTONE1 / BSTONE1 / - )
    56 : FLOOR5_4 216 : CEIL4_1 160 0 8
    0 (0 : - / - / - )
    152 : FLAT5 216 : FLAT5 128 9 15
(-1888,-1728) to (-1888,-1856) : 1 : 0 : 0
    0 (45 : - / - / BSTONE1 )
    152 : FLAT5 216 : FLAT5 128 9 15
(-1888,-1856) to (-1952,-1856) : 1 : 0 : 0
    0 (45 : - / - / BSTONE1 )
    152 : FLAT5 216 : FLAT5 128 9 15
(-1952,-1536) to (-1888,-1536) : 1 : 0 : 0
    0 (45 : - / - / BSTONE1 )
    152 : FLAT5 216 : FLAT5 128 9 15
(-1888,-1536) to (-1888,-1664) : 1 : 0 : 0
    0 (45 : - / - / BSTONE1 )
    152 : FLAT5 216 : FLAT5 128 9 15
(712,-1472) to (712,-1536) : 1 : 0 : 0
    0 (64 : - / - / SP_ROCK2 )
    -8 : FLOOR0_5 248 : CEIL4_1 144 0 0
(712,-1536) to (768,-1568) : 1 : 0 : 0
    0 (0 : - / - / SP_ROCK2 )
    -8 : FLOOR0_5 248 : CEIL4_1 144 0 0
(768,-1568) to (832,-1568) : 1 : 0 : 0
    0 (64 : - / - / SP_ROCK2 )
    -8 : FLOOR0_5 248 : CEIL4_1 144 0 0
(832,-1568) to (888,-1536) : 1 : 0 : 0
    0 (0 : - / - / SP_ROCK2 )
    -8 : FLOOR0_5 248 : CEIL4_1 144 0 0
(888,-1536) to (888,-1472) : 1 : 0 : 0
    0 (64 : - / - / SP_ROCK2 )
    -8 : FLOOR0_5 248 : CEIL4_1 144 0 0
(888,-1472) to (832,-1440) : 1 : 0 : 0
    0 (0 : - / - / SP_ROCK2 )
    -8 : FLOOR0_5 248 : CEIL4_1 144 0 0
(832,-1440) to (768,-1440) : 1 : 0 : 0
    0 (64 : - / - / SP_ROCK2 )
    -8 : FLOOR0_5 248 : CEIL4_1 144 0 0
(768,-1440) to (712,-1472) : 1 : 0 : 0
    0 (0 : - / - / SP_ROCK2 )
    -8 : FLOOR0_5 248 : CEIL4_1 144 0 0
(1344,896) to (1472,784) : 4 : 0 : 0
    0 (0 : - / step3 / - )
    0 : FLOOR5_4 112 : CEIL5_2 112 0 0
    0 (0 : - / - / - )
    8 : FLOOR5_4 112 : CEIL5_2 112 9 0
(1840,784) to (1744,896) : 4 : 0 : 0
    0 (0 : - / step3 / - )
    0 : MFLR8_1 112 : CEIL5_2 112 0 0
    0 (0 : - / - / - )
    8 : FLOOR5_4 112 : CEIL5_2 112 9 0
(-736,576) to (-720,592) : 17 : 0 : 0
    0 (0 : - / - / doortrak )
    24 : MFLR8_2 24 : FLOOR7_1 192 9 11
(-488,592) to (-480,576) : 17 : 0 : 0
    0 (0 : - / - / doortrak )
    24 : MFLR8_2 24 : FLOOR7_1 192 9 11
(-1024,728) to (-1024,736) : 17 : 0 : 0
    0 (0 : - / - / doorstop )
    24 : MFLR8_2 24 : FLOOR7_1 192 9 10
(-1024,544) to (-1024,552) : 17 : 0 : 0
    0 (0 : - / - / doorstop )
    24 : MFLR8_2 24 : FLOOR7_1 192 9 10
(-168,736) to (-168,728) : 17 : 0 : 0
    0 (0 : - / - / doorstop )
    24 : MFLR8_2 24 : FLOOR7_1 192 9 9
(-192,552) to (-192,544) : 17 : 0 : 0
    0 (0 : - / - / doorstop )
    24 : MFLR8_2 24 : FLOOR7_1 192 9 9

things:568
(-1360,2176, 0) :2, 7
(-1376,2080, 0) :3, 7
(-1296,2160, 0) :4, 7
(-1312,2080, 0) :1, 7
(-704,-800, 90) :3001, 7
(-592,-1136, 90) :3001, 4
(-448,-1232, 90) :3001, 7
(-320,-912, 90) :3001, 7
(-304,-640, 90) :3001, 7
(-1024,-688, 90) :3001, 4
(-464,-992, 90) :3001, 7
(-944,-1264, 0) :3002, 4
(-688,-1440, 0) :3002, 7
(-1136,-608, 180) :3002, 7
(-160,-640, 180) :3002, 6
(-304,-1248, 135) :3002, 6
(-1232,288, 90) :3001, 7
(1216,416, 0) :2006, 7
(1568,368, 0) :2046, 7
(1216,368, 0) :2012, 7
(1632,368, 0) :2048, 7
(1184,416, 0) :3002, 7
(1632,416, 270) :3002, 7
(1568,416, 270) :3002, 7
(1248,416, 0) :3002, 7
(1184,-32, 225) :3002, 7
(1472,-672, 180) :68, 7
(1808,144, 225) :3001, 7
(1840,-368, 180) :3001, 7
(1168,544, 180) :3001, 7
(1648,544, 0) :3001, 7
(-384,-1536, 0) :2013, 7
(-384,-1472, 0) :2004, 7
(-1584,1824, 0) :2047, 7
(-1632,-224, 90) :3001, 4
(-1424,-272, 90) :3001, 7
(-1776,-304, 90) :3001, 7
(-864,2000, 0) :2014, 7
(-800,1952, 0) :2014, 7
(-864,1904, 0) :2014, 7
(-928,1952, 0) :2008, 7
(1600,-1280, 180) :3001, 4
(1712,-1328, 135) :3001, 7
(1472,-1472, 90) :3001, 15
(1712,-1200, 0) :2007, 7
(1648,-1376, 0) :2014, 7
(896,-1280, 135) :3001, 7
(624,-752, 180) :3001, 15
(1216,-1168, 180) :3001, 4
(240,-1440, 45) :3001, 12
(-32,-1440, 0) :3001, 12
(96,-320, 270) :3001, 7
(-16,-544, 315) :3001, 4
(1440,352, 0) :5, 7
(1376,-960, 0) :2014, 7
(1376,-912, 0) :2014, 7
(1440,-912, 0) :2014, 7
(1376,-1024, 0) :2014, 7
(1472,-1040, 0) :2014, 7
(1440,-992, 0) :2015, 7
(-32,-1376, 0) :2007, 7
(-1184,1808, 0) :2012, 7
(-1344,1664, 270) :3002, 7
(-1152,1536, 270) :3002, 7
(-1216,1344, 225) :3002, 7
(-1600,1472, 315) :3002, 7
(-896,752, 90) :3004, 7
(-816,608, 90) :9, 6
(-992,400, 90) :3004, 7
(-656,96, 90) :3004, 7
(-544,512, 90) :9, 4
(-560,992, 90) :3004, 7
(512,368, 90) :9, 6
(512,208, 90) :3004, 7
(512,848, 270) :3004, 7
(544,1280, 270) :3004, 7
(560,1616, 270) :9, 6
(480,1840, 270) :3004, 7
(592,1984, 270) :3004, 7
(1376,2000, 180) :3004, 7
(1792,1776, 180) :3004, 7
(1056,1344, 0) :3004, 15
(1280,992, 90) :3004, 15
(1312,1344, 180) :3004, 15
(1632,1344, 0) :3004, 15
(1888,1152, 180) :3004, 15
(-1488,1536, 270) :3006, 7
(-1312,1408, 270) :3006, 7
(16,-128, 270) :3001, 4
(208,-224, 270) :3001, 4
(160,-432, 270) :3001, 4
(16,-368, 270) :3001, 7
(48,-720, 0) :3001, 7
(-32,-656, 0) :3001, 7
(-32,1312, 90) :3004, 7
(32,1280, 90) :9, 6
(-160,1504, 90) :3004, 7
(-224,1568, 90) :3004, 7
(128,1856, 270) :9, 4
(-224,2112, 270) :3004, 7
(-192,2176, 270) :9, 6
(192,2176, 225) :3004, 7
(-864,1952, 0) :2001, 7
(-608,480, 0) :2008, 7
(-160,1888, 0) :2008, 7
(160,1888, 0) :2008, 7
(192,672, 0) :2008, 7
(-1600,704, 0) :2008, 7
(-1184,-608, 0) :2008, 7
(-192,-608, 0) :2012, 7
(-352,-1088, 0) :2007, 7
(640,-1472, 0) :2048, 7
(2016,-160, 180) :2048, 7
(2016,-224, 180) :2049, 7
(1024,128, 180) :2007, 7
(960,-128, 180) :2011ect _PSflushgraphics .file_definition_libNeXT_s.C.shlib_textUtil.o .file_definition_libNeXT_s.C.shlib_PSwindow.o .file_definition_libNeXT_s.C.shlib_textPublic.o .file_definition_libNeXT_s.C.shlib_NXRulerView.o .file_definition_libNeXT_s.C.shlib_textSelectUtil.o .objc_category_name_Speaker_NXObsolete .objc_category_name_Speaker_NXPrivate .objc_category_name_Speaker_NXWorkspace _NXCopyOutputData _NXMustFreeRPCVM _NXParamTypes _NXRPCMessage __NXSetLastOpenFileTime .file_definition_libNeXT_s.C.shlib_packagesWraps.o .objc_category_name_Text_Drawing .objc_category_name_Text_FrameRect .objc_category_name_Text_Layout .objc_category_name_Text_LinePosition _NXChunkRealloc _NXEnglishCharCatTable _NXEnglishClickTable _NXEnglishNoBreakTable _NXFlushTextCache _NXScreenDump _PSrectclip _PSsetwindowtype .file_definition_libNeXT_s.C.shlib_textScanDraw.o .file_definition_libNeXT_s.C.shlib_textLayout.o .objc_category_name_Text_Edit _NXChunkGrow _NXSetTextCache __libNeXT_memcmp .file_definition_libNeXT_s.C.shlib_textEdit.o .objc_category_name_Text_Event .objc_class_name_Font .objc_class_name_NXSpellChecker _NXFontPboard _NXRulerPboard _PSobscurecursor _PSrevealcursor .file_definition_libNeXT_s.C.shlib_timer.o .file_definition_libNeXT_s.C.shlib_NXSpellChecker.o .file_definition_libNeXT_s.C.shlib_Font.o .file_definition_libNeXT_s.C.shlib_textEvent.o .objc_category_name_Text_Find __libNeXT_NXCreateHashTable __libNeXT_NXPtrStructKeyPrototype __libNeXT_NXToLower __libNeXT__NXStreamChangeBuffer __libNeXT__NXStreamFillBuffer .file_definition_libNeXT_s.C.shlib_textFind.o .objc_category_name_Text_Font .objc_category_name_Text_Selection .objc_class_name_FontManager _NXGrayComponent .file_definition_libNeXT_s.C.shlib_textWraps.o .file_definition_libNeXT_s.C.shlib_FontManager.o .file_definition_libNeXT_s.C.shlib_textSelect.o .objc_category_name_Text_Graphics .objc_category_name_Text_GraphicsSupport .objc_category_name_Text_Tabs .objc_class_name_NXTabStopList .objc_class_name_NXUniqueTabs .objc_class_name_NXViewFrameCell .objc_class_name_Cell __libNeXT_NXPtrIsEqual __libNeXT_NXStrHash __libNeXT_NXStrIsEqual .file_definition_libNeXT_s.C.shlib_Cell.o .file_definition_libNeXT_s.C.shlib_textTabs.o .objc_category_name_Text_LoadRTFD .objc_class_name_NXHelpText .objc_class_name_Responder _NXArrow _NXUserAborted __libNeXT_NXCloseEventStatus __libNeXT_NXCreateMapTableFromZone __libNeXT_NXEventSystemInfo __libNeXT_NXOpenEventStatus __libNeXT_calloc __libNeXT_cthread_detach __libNeXT_cthread_fork __libNeXT_execv __libNeXT_sscanf __libNeXT_valloc __libNeXT_wait4 .file_definition_libNeXT_s.C.shlib_Responder.o .file_definition_libNeXT_s.C.shlib_NXHelpText.o .objc_category_name_Text_MarkerCell .objc_class_name_NXMarkerCell __libNeXT_NXIsAlpha __libNeXT_NXPrintf __libNeXT_NXUngetc __libNeXT__NXStreamFlushBuffer .file_definition_libNeXT_s.C.shlib_NXMarkerCell.o .objc_category_name_Text_RTF _NXChunkZoneGrow _NXChunkZoneMalloc __NXHexDigits __libNeXT_NXCloseTypedStream __libNeXT_NXOpenSmallMemory __libNeXT_NXOpenTypedStream __libNeXT_NXTell __libNeXT__iob __libNeXT_fprintf .file_definition_libNeXT_s.C.shlib_image.o .file_definition_libNeXT_s.C.shlib_textRTF.o .objc_category_name_Text_Replace .file_definition_libNeXT_s.C.shlib_textReplace.o .objc_category_name_Text_ReplaceUtil .file_definition_libNeXT_s.C.shlib_textReplaceUtil.o .objc_category_name_Text_ScanDraw _NXDrawALine _NXScanALine _PScurrentpoint _PSrmoveto __libNeXT_abs .objc_category_name_Text_SpellChecking .objc_category_name_Text_VerifyStream .file_definition_libNeXT_s.C.shlib_textSpell.o .objc_category_name_Text_Stream __libNeXT_NXDefaultRead __libNeXT_NXDefaultWrite __libNeXT_NXStreamCreateFromZone .file_definition_libNeXT_s.C.shlib_textStream.o .objc_category_name_Text_Util _NXChunkMalloc .objc_category_name_View_IconDragging .objc_class_name_NXFileDragSource .file_definition_libNeXT_s.C.shlib_viewDrag.o .objc_category_name_View_Printing .objc_class_name_NXFaxPanel .objc_class_name_NXPrinter .objc_class_name_PrintPanel _DPSCreateStreamContext _NXFindPaperSize _PSscale _PSshowpage __libNeXT_NXArgv __libNeXT_NXClose __libNeXT_NXOpenFile __libNeXT_NXToAscii __libNeXT_objc_lookUpClass __libNeXT_sleep __libNeXT_system .file_definition_libNeXT_s.C.shlib_epsUtil.o .file_definition_libNeXT_s.C.shlib_PageLayout.o .file_definition_libNeXT_s.C.shlib_streamContext.o .file_definition_libNeXT_s.C.shlib_PrintPanel.o .file_definition_libNeXT_s.C.shlib_NXPrinter.o .file_definition_libNeXT_s.C.shlib_NXFaxPanel.o .file_definition_libNeXT_s.C.shlib_viewPrinting.o .objc_category_name_Window_InputManager __NXCreateRealWindow .objc_class_name_ButtonCell .objc_class_name_Control .objc_class_name_FrameView _DPSDiscardEvents _DPSUndefineUserObject _NXChunkZoneRealloc _NXColorSpaceFromDepth _NXCopyCurrentGState _NXFieldFilter _NXGetOrPeekEvent _NXNumberOfColorComponents _NXReadSize _NXSetGState _NXSystemFont _NXWriteSize _PScleartrackingrect _PScomposite _PScurrentdefaultdepthlimit _PScurrentwindowbounds _PSorderwindow _PSrectstroke _PSsetautofill _PSsetgstate _PSsettrackingrect _PSsetwindowdepthlimit _PSsetwindowlevel __NXActivateNextApp __NXAllWindowsRetained __NXDefaultScreenRect __NXDoDragWindow __NXGetIconFrame __NXSetIcon __NXShowAllWindows __NXTraceEvents __libNeXT_NXRemoveDefault __libNeXT_NXUpdateDefault __libNeXT_NXWriteType __libNeXT_strstr .file_definition_libNeXT_s.C.shlib_utils.o .file_definition_libNeXT_s.C.shlib_screenUtil.o .file_definition_libNeXT_s.C.shlib_graphicArchiving.o .file_definition_libNeXT_s.C.shlib_queues.o .file_definition_libNeXT_s.C.shlib_FrameView.o .file_definition_libNeXT_s.C.shlib_Control.o .file_definition_libNeXT_s.C.shlib_ButtonCell.o .objc_class_name_ActionCell __libNeXT_NXWriteObject .file_definition_libNeXT_s.C.shlib_ActionCell.o .objc_class_name_Alert _NXOldAlert _NXRunLocalizedAlertPanel _NXTitledAlert _NXReportError __libNeXT_NXCreateChildZone __libNeXT_NXMergeZone __libNeXT_NXVPrintf _NXGetNamedObject _NXGetObjectName _NXNameObject _NXResetUserAbort _NXUnnameObject .objc_class_name_NXCursor .objc_class_name_NXPort .objc_class_name_NXStringTable .objc_class_name_NXWorkspaceRequestProxy .objc_class_name_NameTable .objc_class_name_PageLayout .objc_class_name_PrintInfo _DPSAddNotifyPortProc _DPSChainContext _DPSCreateContextWithTimeoutFromZone _DPSSynchronizeContext _DPSTraceContext _DPSTraceEvents _NXBPSFromDepth _NXCountWindows _NXNullObject _NXProcessID _NXRegisterErrorReporter _NXWindowList _PScountframebuffers _PScurrentcontext _PSnull _PSsetalpha _PSshowcursor __DPSCMYKAdjust __DPSDo10Compatibility __DPSDoNSC __NXInitOtherOwner __NXLoadWindowPackages __NXTopLevelErrorHandler __NXUpdateCMYKAdjustParamsFromPostScript __libNeXT_NXAllocErrorData __libNeXT_NXOpenTypedStreamForFile __libNeXT_NXResetErrorData __libNeXT_NXScanf __libNeXT_NXSetTypedStreamZone __libNeXT__NXAddAltHandler __libNeXT__NXRegisterDefaultsNoCopy __libNeXT__NXRemoveAltHandler __libNeXT__NXUncaughtExceptionHandler __libNeXT_getpid __libNeXT_getsectdatafromheader __libNeXT_malloc_debug __libNeXT_malloc_error __libNeXT_openlog __libNeXT_setlocale .file_definition_libNeXT_s.C.shlib_imageWraps.o .file_definition_libNeXT_s.C.shlib_NXImageRep.o .file_definition_libNeXT_s.C.shlib_globals.o .file_definition_libNeXT_s.C.shlib_psdataops.o .file_definition_libNeXT_s.C.shlib_psctxtops.o .file_definition_libNeXT_s.C.shlib_PSmisc.o .file_definition_libNeXT_s.C.shlib_outputContext.o .file_definition_libNeXT_s.C.shlib_machContext.o .file_definition_libNeXT_s.C.shlib_Sound.o .file_definition_libNeXT_s.C.shlib_PrintInfo.o .file_definition_libNeXT_s.C.shlib_NameTable.o .file_definition_libNeXT_s.C.shlib_NXWorkspaceRequestProxy.o .file_definition_libNeXT_s.C.shlib_Cursor.o __NXReadBitmapBits .objc_class_name_Bitmap __NXWriteBitmapBits _NXEraseRect _NXGetTIFFInfo _NXImageBitmap _NXReadBitmap _NXReadTIFF _NXSizeBitmap _NXWriteTIFF __libNeXT_NXReadArray __libNeXT_NXWriteArray .file_definition_libNeXT_s.C.shlib_tiffNeXT.o .file_definition_libNeXT_s.C.shlib_Bitmap.o _NXContainsRect _NXDrawGroove _NXRectClip _NXRectClipList .objc_class_name_Button .file_definition_libNeXT_s.C.shlib_Button.o __NXDrawTextCell __libNeXT_NXSystemVersion __NXCalcTextSizeInRect __NXEdit, 7
(960,-576, 180) :2011, 7
(704,-288, 180) :2011, 7
(1984,-1232, 180) :2011, 7
(1472,0, 180) :2011, 7
(-608,160, 90) :2008, 7
(-32,2176, 225) :3001, 4
(32,2176, 225) :3001, 4
(48,1472, 135) :3001, 4
(128,1536, 135) :3001, 4
(-832,1280, 0) :3001, 12
(-384,1280, 180) :3001, 12
(-704,768, 90) :3001, 4
(-608,768, 90) :3001, 4
(-512,768, 90) :3001, 4
(-288,160, 135) :3001, 4
(-256,256, 135) :3001, 4
(-128,320, 135) :3001, 4
(-144,192, 135) :3001, 6
(-80,448, 135) :3004, 7
(-256,384, 135) :3004, 7
(-64,256, 135) :3004, 7
(96,608, 225) :3004, 7
(256,704, 225) :3004, 7
(-1312,608, 315) :9, 6
(-608,1376, 90) :9, 1
(-960,1248, 0) :3001, 12
(-256,1248, 180) :3001, 12
(-1296,800, 45) :3004, 7
(-1232,960, 45) :3004, 7
(64,800, 135) :3004, 7
(16,960, 135) :3004, 7
(-1104,496, 0) :3004, 6
(-112,496, 180) :3004, 6
(-1120,-1120, 45) :3002, 4
(-1056,-1056, 45) :3002, 4
(-992,-1120, 45) :3002, 4
(-1056,-1184, 45) :3002, 4
(-576,-640, 90) :3001, 4
(-512,-576, 90) :3001, 4
(-448,-640, 90) :3001, 4
(224,1712, 90) :71, 4
(0,1952, 90) :58, 4
(64,1888, 0) :58, 6
(0,1824, 270) :58, 4
(-64,1888, 180) :58, 6
(0,1888, 180) :2002, 6
(-64,1952, 180) :2011, 6
(64,1952, 180) :2011, 6
(64,1824, 180) :2011, 6
(-64,1824, 180) :2011, 6
(-352,864, 90) :2011, 7
(-864,864, 90) :2011, 7
(-1024,496, 90) :2011, 7
(-144,496, 90) :2011, 7
(160,992, 90) :2011, 7
(608,992, 90) :2011, 7
(-608,1888, 90) :2011, 7
(-1648,704, 90) :2012, 7
(672,-96, 90) :2011, 7
(-608,880, 90) :2018, 7
(288,1440, 90) :2014, 7
(-32,1248, 90) :2014, 7
(-224,1504, 90) :2014, 7
(-224,2208, 90) :2014, 7
(224,2208, 90) :2014, 7
(-288,2016, 90) :2015, 7
(-288,1760, 90) :2015, 7
(-544,2144, 90) :2014, 7
(-480,2080, 90) :2014, 7
(288,992, 90) :2014, 7
(-1056,992, 90) :2014, 7
(-1008,928, 90) :2014, 7
(-928,864, 90) :2014, 7
(-304,864, 90) :2015, 7
(-240,928, 90) :2015, 7
(-160,992, 90) :2015, 7
(-1344,-64, 135) :3001, 7
(-1344,-160, 135) :3001, 7
(-1536,-288, 90) :66, 4
(-1600,-288, 90) :66, 6
(-1248,-160, 135) :71, 4
(-1728,-192, 90) :71, 4
(-928,1792, 0) :2010, 7
(-1824,1312, 0) :2023, 7
(-1904,1328, 0) :2014, 7
(-1872,1328, 0) :2014, 7
(-1872,1296, 0) :2014, 7
(-1904,1296, 0) :2014, 7
(-1904,1264, 0) :2014, 7
(-1872,1264, 0) :2014, 7
(-1872,1232, 0) :2014, 7
(-1904,1232, 0) :2014, 7
(-1904,1200, 0) :2014, 7
(-1872,1200, 0) :2014, 7
(-1872,1168, 0) :2014, 7
(-1904,1168, 0) :2014, 7
(-1904,1136, 0) :2014, 7
(-1872,1136, 0) :2014, 7
(-1872,1104, 0) :2014, 7
(-1904,1104, 0) :2014, 7
(-1840,1136, 0) :2014, 7
(-1840,1168, 0) :2014, 7
(-1840,1200, 0) :2014, 7
(-1840,1232, 0) :2014, 7
(-1840,1264, 0) :2014, 7
(-1808,1200, 0) :2014, 7
(-1808,1136, 0) :2014, 7
(-1808,1264, 0) :2014, 7
(-1808,1232, 0) :2014, 7
(-1808,1168, 0) :2014, 7
(-1840,1104, 0) :2014, 7
(-1808,1104, 0) :2014, 7
(-1744,1104, 0) :2014, 7
(-1712,1104, 0) :2014, 7
(-1680,1104, 0) :2014, 7
(-1680,1136, 0) :2014, 7
(-1712,1136, 0) :2014, 7
(-1744,1136, 0) :2014, 7
(-1776,1136, 0) :2014, 7
(-1776,1168, 0) :2014, 7
(-1744,1168, 0) :2014, 7
(-1712,1168, 0) :2014, 7
(-1680,1168, 0) :2014, 7
(-1680,1200, 0) :2014, 7
(-1680,1232, 0) :2014, 7
(-1680,1264, 0) :2014, 7
(-1680,1296, 0) :2014, 7
(-1680,1328, 0) :2014, 7
(-1712,1328, 0) :2014, 7
(-1712,1296, 0) :2014, 7
(-1712,1264, 0) :2014, 7
(-1712,1232, 0) :2014, 7
(-1712,1200, 0) :2014, 7
(-1744,1200, 0) :2014, 7
(-1776,1200, 0) :2014, 7
(-1776,1232, 0) :2014, 7
(-1744,1232, 0) :2014, 7
(-1744,1264, 0) :2014, 7
(-1776,1264, 0) :2014, 7
(-1776,1296, 0) :2014, 7
(-1744,1296, 0) :2014, 7
(-1744,1328, 0) :2014, 7
(-1776,1328, 0) :2014, 7
(-1632,2144, 0) :9, 14
(-1760,2016, 90) :9, 14
(-1824,1760, 90) :9, 14
(-560,-1552, 135) :3001, 6
(-560,-1616, 135) :3001, 4
(-624,-1552, 135) :3001, 4
(-624,-1616, 135) :3001, 4
(-1696,-1840, 135) :2047, 7
(-1504,-1840, 135) :2047, 7
(-1312,-1840, 135) :2047, 7
(-1568,-1840, 135) :2047, 6
(-1376,-1840, 135) :2047, 7
(-1248,-1840, 135) :2047, 7
(-1440,-1840, 135) :2047, 7
(-1632,-1840, 135) :2047, 6
(-1376,-1696, 45) :16, 6
(-1664,-928, 315) :14, 7
(-1408,-864, 315) :14, 7
(-1664,-1408, 315) :14, 7
(-160,672, 225) :71, 6
(-96,608, 225) :71, 4
(-160,608, 225) :3006, 1
(-96,672, 225) :3001, 4
(0,688, 225) :3001, 4
(-224,640, 225) :3001, 4
(-48,688, 225) :3001, 4
(-1056,672, 0) :71, 7
(-1120,608, 0) :71, 4
(-1056,608, 0) :3001, 4
(-1120,672, 0) :3001, 4
(-1008,640, 0) :3001, 4
(-1216,704, 0) :3001, 4
(-1168,688, 0) :3001, 4
(-704,272, 90) :9, 6
(-512,272, 90) :9, 6
(-656,272, 90) :3004, 7
(-608,272, 90) :3004, 7
(-560,272, 90) :3004, 7
(-656,224, 90) :3004, 7
(-608,224, 90) :3004, 7
(-560,224, 90) :3004, 7
(-704,224, 90) :3001, 4
(-512,224, 90) :3001, 4
(-704,608, 225) :3004, 7
(-656,608, 225) :3004, 7
(-608,608, 225) :3004, 7
(-560,608, 225) :3004, 7
(-512,608, 225) :3004, 7
(-656,656, 225) :9, 6
(-560,656, 225) :9, 6
(-608,656, 225) :3004, 7
(-512,656, 225) :3001, 4
(-704,656, 225) :3001, 4
(-608,256, 225) :2025, 7
(-704,256, 225) :2014, 7
(-656,256, 225) :2014, 7
(-560,256, 225) :2014, 7
(-512,256, 225) :2014, 7
(-688,640, 225) :2014, 7
(-640,640, 225) :2014, 7
(-592,640, 225) :2014, 7
(-544,640, 225) :2014, 7
(-192,672, 225) :2014, 7
(-192,608, 225) :2014, 7
(-1024,672, 225) :2014, 7
(-1024,608, 225) :2014, 7
(-128,640, 225) :2048, 7
(-64,640, 225) :2048, 7
(-1088,640, 225) :2048, 7
(-1152,640, 225) :2048, 7
(-128,688, 225) :2008, 7
(-1088,688, 225) :2008, 7
(-1088,592, 225) :2008, 7
(-128,592, 225) :2008, 7
(-720,640, 225) :2011, 7
(-496,640, 225) :2011, 7
(-544,256, 225) :2011, 7
(-688,256, 225) :2011, 7
(-1200,672, 225) :2011, 7
(-32,672, 225) :2011, 7
(0,32, 270) :3001, 6
(192,32, 270) :3001, 6
(64,32, 270) :3001, 6
(128,32, 270) :3001, 6
(160,-128, 270) :3006, 4
(96,-224, 270) :3006, 4
(224,-160, 270) :3006, 4
(-32,-160, 270) :3006, 4
(-32,-224, 270) :3006, 4
(-32,-800, 90) :3006, 4
(32,-800, 90) :3006, 4
(96,-800, 90) :3006, 4
(-32,-864, 90) :3001, 6
(32,-864, 90) :3001, 6
(96,-864, 90) :3001, 6
(96,-96, 90) :2003, 7
(-1056,640, 90) :2025, 23
(-608,640, 90) :2025, 23
(-192,640, 90) :2025, 23
(0,-880, 0) :2046, 7
(64,-880, 0) :2046, 7
(-16,32, 0) :2012, 7
(208,32, 0) :2012, 7
(1056,1152, 0) :3004, 15
(1056,1792, 0) :3004, 15
(352,1792, 0) :3004, 15
(352,1600, 0) :3004, 15
(1472,992, 90) :3004, 15
(1664,2144, 270) :3004, 15
(1280,2144, 270) :3004, 15
(896,2144, 270) :3004, 15
(512,2144, 270) :3004, 15
(1696,-32, 225) :68, 4
(1168,672, 180) :3001, 6
(1648,672, 0) :3001, 6
(1024,-704, 135) :3001, 12
(1024,-640, 135) :3001, 12
(1024,-576, 135) :3001, 12
(1088,-576, 135) :3001, 12
(1152,-576, 135) :3001, 12
(1216,-576, 135) :3001, 12
(1024,-768, 135) :3001, 12
(1088,-704, 135) :3001, 12
(1088,-640, 135) :3001, 12
(1152,-640, 135) :3001, 12
(1152,-704, 135) :3001, 12
(992,160, 270) :68, 4
(352,1984, 0) :9, 14
(1632,1792, 0) :9, 14
(1888,1792, 180) :3004, 15
(1888,1984, 180) :3004, 15
(1888,1344, 180) :3004, 15
(1088,2144, 270) :3004, 15
(1472,1696, 270) :3004, 15
(1472,1248, 270) :3004, 15
(1472,1888, 90) :3004, 15
(896,1888, 90) :3004, 15
(736,1792, 180) :3004, 15
(1472,2144, 270) :9, 14
(704,2144, 270) :3004, 15
(896,1696, 270) :9, 14
(1312,1792, 180) :9, 14
(1472,1440, 90) :9, 14
(896,1504, 90) :9, 14
(1664,992, 90) :9, 14
(1888,1600, 180) :9, 14
(432,1888, 180) :9, 6
(1632,1568, 180) :3004, 4
(1760,1632, 180) :3004, 4
(1184,1632, 180) :3004, 4
(1184,2016, 180) :3004, 4
(1184,1120, 180) :3004, 4
(1760,1120, 180) :3004, 4
(864,2016, 180) :3004, 4
(1760,2016, 180) :3004, 4
(1440,1568, 180) :9, 4
(1184,1504, 180) :9, 4
(864,1568, 180) :9, 4
(1248,2016, 180) :9, 4
(1760,1248, 180) :9, 4
(1440,1120, 180) :9, 4
(1616,1792, 180) :2011, 7
(1904,1152, 180) :2011, 7
(1280,976, 180) :2011, 7
(896,1488, 180) :2011, 7
(1472,2240, 180) :2013, 7
(2144,1504, 270) :3002, 7
(2208,1504, 270) :3002, 7
(2144,1568, 270) :3002, 6
(2208,1568, 270) :3002, 6
(2144,1632, 270) :3002, 4
(2208,1632, 270) :3002, 4
(2080,1568, 0) :3002, 4
(2080,1632, 0) :3002, 4
(1984,1600, 270) :8, 7
(2016,1376, 270) :2014, 7
(2080,1312, 270) :2014, 7
(2144,1376, 270) :2014, 7
(2080,1376, 270) :2015, 7
(2016,1312, 270) :2015, 7
(2144,1312, 270) :2015, 7
(1440,1344, 270) :17, 7
(864,1312, 270) :65, 14
(800,1312, 270) :65, 14
(928,1184, 0) :65, 14
(928,1120, 0) :65, 14
(864,1184, 0) :58, 4
(864,1120, 0) :58, 4
(800,1376, 0) :TextCell .objc_class_name_ClipView _NXFrameRect _NXIBeam _NXTextFontInfo __libNeXT_localeconv __libNeXT_pow __libNeXT_realloc .file_definition_libNeXT_s.C.shlib_ClipView.o .objc_class_name_ChoosePrinter .objc_class_name_ColumnCell .objc_class_name_Matrix __libNeXT_prdb_end __libNeXT_prdb_get __libNeXT_prdb_getbyname __libNeXT_prdb_set .file_definition_libNeXT_s.C.shlib_Matrix.o .file_definition_libNeXT_s.C.shlib_ColumnCell.o .file_definition_libNeXT_s.C.shlib_ChoosePrinter.o _NXContainRect _NXDrawGrayBezel .objc_class_name_Cursor _NXWait _PSsetcursor .objc_class_name_CustomObject .file_definition_libNeXT_s.C.shlib_CustomObject.o .objc_class_name_FocusState .objc_class_name_PSMatrix .file_definition_libNeXT_s.C.shlib_PSMatrix.o .file_definition_libNeXT_s.C.shlib_FocusState.o _NXBoldSystemFont _PSsetfont __libNeXT_NXUniqueStringNoCopy __libNeXT_vm_protect .file_definition_libNeXT_s.C.shlib_psfontops.o .objc_class_name_FontFile .file_definition_libNeXT_s.C.shlib_FontFile.o .objc_class_name_FontPanel .file_definition_libNeXT_s.C.shlib_FontPanel.o .objc_class_name_TaggedCell __libNeXT_log10 __libNeXT_rint .file_definition_libNeXT_s.C.shlib_TaggedCell.o .objc_class_name_Form .objc_class_name_FormCell .file_definition_libNeXT_s.C.shlib_FormCell.o .file_definition_libNeXT_s.C.shlib_Form.o .objc_class_name_NXDocumentDragButton .objc_class_name_NXXYShow .objc_class_name_TextFieldCell __NXHideOtherApps .file_definition_libNeXT_s.C.shlib_TextFieldCell.o .file_definition_libNeXT_s.C.shlib_NXXYShow.o .objc_class_name_NXBrowser .file_definition_libNeXT_s.C.shlib_NXBrowser.o __NXResetOtherWindows __NXSetOtherWindows .objc_class_name_NXAcceptsColorBrowser .objc_class_name_NXColorListOpenPanel .objc_class_name_NXColorPickerList .objc_class_name_NXNoBranchIconBrowserCell .objc_class_name_NXBrowserCell .objc_class_name_NXColorHolder .objc_class_name_NXColorList .objc_class_name_NXColorPicker .objc_class_name_NXPanelController _NXColorListName .file_definition_libNeXT_s.C.shlib_OpenPanel.o .file_definition_libNeXT_s.C.shlib_NXColorPicker.o .file_definition_libNeXT_s.C.shlib_NXColorList.o .file_definition_libNeXT_s.C.shlib_NXColorHolder.o .file_definition_libNeXT_s.C.shlib_NXBrowserCell.o .file_definition_libNeXT_s.C.shlib_NXColorPickerList.o __NXTIFFClose __NXTIFFNumDirectories __NXTIFFOpenStream __NXTIFFOpenStreamWithMode __NXTIFFReadFromZone __NXTIFFScanlineSize __NXTIFFSetDirectory __NXTIFFWrite .file_definition_libNeXT_s.C.shlib_tif_dir.o .file_definition_libNeXT_s.C.shlib_tif_open.o .file_definition_libNeXT_s.C.shlib_tif_close.o .objc_class_name_NXLazyBrowserCell .objc_class_name_NXLazyBrowserList .objc_class_name_Scroller _NXDrawButton .file_definition_libNeXT_s.C.shlib_Scroller.o .file_definition_libNeXT_s.C.shlib_NXLazyBrowserCell.o .objc_class_name_NXCMYKSliders .objc_class_name_NXColorPickerSliders .objc_class_name_NXGreySliders .objc_class_name_NXHSBSliders .objc_class_name_NXRGBSliders _NXConvertCMYKAToColor _NXConvertColorToCMYKA .file_definition_libNeXT_s.C.shlib_NXColorPickerSliders.o .objc_class_name_NXColorListFrozenNameTable .objc_class_name_NXColorListNameTable __libNeXT_NXCountMapTable __libNeXT_NXStrValueMapPrototype .objc_class_name_NXColorPaletteOpenPanel .objc_class_name_NXColorPickerUser __libNeXT_NXSaveToFile .file_definition_libNeXT_s.C.shlib_NXColorPickerUser.o .objc_class_name_NXColorPickerUserView .file_definition_libNeXT_s.C.shlib_NXColorPickerUserView.o .objc_class_name_NXColorPickerWheel _NXChangeBrightnessComponent .file_definition_libNeXT_s.C.shlib_NXColorPickerWheel.o .objc_class_name_NXColorPickerWheelView _PSarc _PSclippath _PSeofill __libNeXT_atan __libNeXT_cos __libNeXT_sin __libNeXT_sqrt .file_definition_libNeXT_s.C.shlib_NXColorPickerWheelView.o .objc_class_name_NXColorSwatch __libNeXT_fopen .file_definition_libNeXT_s.C.shlib_NXColorSwatch.o _NXDrawTiledRects .objc_class_name_NXCustomImageRep .file_definition_libNeXT_s.C.shlib_NXCustomImageRep.o .objc_class_name_NXDataLink .objc_class_name_NXLinkOpenPanel .objc_class_name_NXPasteboardFilter _NXDataLinkFilenameExtension _NXDataLinkPboardType __NXDocSvr __libNeXT_NXWriteRootObject .file_definition_libNeXT_s.C.shlib_NXPasteboardFilter.o .file_definition_libNeXT_s.C.shlib_NXDataLink.o .objc_class_name_NXNonFactoryKludgeObj _NXFrameLinkRect _NXLinkFrameThickness .objc_class_name_NXPasteboardProxy __libNeXT_NXMapMember .objc_class_name_NXEPSImageRep _DPSCreateNonsecureContext __DPSCreateEncapsulatedContext .file_definition_libNeXT_s.C.shlib_NXEPSImageRep.o .objc_class_name_NXFaxCoverView .objc_class_name_TextField .file_definition_libNeXT_s.C.shlib_TextField.o .file_definition_libNeXT_s.C.shlib_NXFaxCoverView.o .objc_class_name_NXFaxPropertyList .objc_class_name_NXFaxTimeCtl _NXEditorFilter __libNeXT_NXHashMember __libNeXT_NXStrPrototype __libNeXT_NXToUpper __libNeXT_ni_entrylist_free __libNeXT_ni_free __libNeXT_ni_list __libNeXT_ni_open __libNeXT_ni_pathsearch __libNeXT_ni_proplist_free __libNeXT_ni_pwdomain __libNeXT_ni_read __libNeXT_ni_root .file_definition_libNeXT_s.C.shlib_NXFaxTimeCtl.o .file_definition_libNeXT_s.C.shlib_NXFaxFile.o .objc_class_name_NXFaxPaperBox .file_definition_libNeXT_s.C.shlib_NXFaxPaperBox.o .objc_class_name_NXHelpLinkInspector .objc_class_name_NXHelpMarkerInspector .file_definition_libNeXT_s.C.shlib_NXHelpMarkerInspector.o .file_definition_libNeXT_s.C.shlib_NXHelpLinkInspector.o .objc_class_name_NXLinkCell _NXEmptyRect .file_definition_libNeXT_s.C.shlib_NXLinkCell.o _NXCreateFilenamePboardType _PSdissolve __libNeXT_getsectdata _NXGetFileType _NXGetFileTypes __libNeXT_NXGetStreamOnSectionForBestArchitecture .objc_class_name_NXJournalListener .file_definition_libNeXT_s.C.shlib_NXJournalListener.o .objc_class_name_NXJournalSpeaker .file_definition_libNeXT_s.C.shlib_NXJournalSpeaker.o _NXJournalMouse _DPSSetEventFunc _PSfindwindow __libNeXT_cond_signal __libNeXT_condition_wait __libNeXT_mutex_try_lock __libNeXT_mutex_wait_lock .file_definition_libNeXT_s.C.shlib_PSNotSingleOps.o .objc_class_name_NXListByValue .objc_class_name_NXSimpleHash .objc_class_name_NXSpellServer .objc_class_name_NXData __libNeXT_NXCreateZone .file_definition_libNeXT_s.C.shlib_NXSpellServer.o .objc_class_name_NXPPDParse .file_definition_libNeXT_s.C.shlib_NXPPDParse.o .objc_class_name_NXPlayStream .objc_class_name_NXSoundDevice .objc_class_name_NXSoundStream .file_definition_libNeXT_s.C.shlib_audioUser.o .file_definition_libNeXT_s.C.shlib_NXSoundStream.o .file_definition_libNeXT_s.C.shlib_NXSoundDevice.o .file_definition_libNeXT_s.C.shlib_NXPlayStream.o __libNeXT_NXIsDigit __libNeXT_NXIsSpace __libNeXT_NXIsXDigit .objc_class_name_NXPrinterFeatures _NXAttachPopUpList .file_definition_libNeXT_s.C.shlib_NXPrinterFeatures.o .objc_class_name_NXRecordStream .file_definition_libNeXT_s.C.shlib_NXRecordStream.o .objc_class_name_NXRulerToken _PShidecursor __libNeXT_fabs .objc_class_name_NXSelection _NXSelectionPboardType .file_definition_libNeXT_s.C.shlib_NXSelection.o _SNDConvertDecibelsToLinear _SNDConvertLinearToDecibels .objc_class_name_NXSoundParameters __libNeXT_objc_setMultithreaded .file_definition_libNeXT_s.C.shlib_audioReplyHandler.o .file_definition_libNeXT_s.C.shlib_NXSoundParameters.o .objc_class_name_NXSoundIn .file_definition_libNeXT_s.C.shlib_audioLookup.o .file_definition_libNeXT_s.C.shlib_NXSoundIn.o .objc_class_name_NXSoundOut .file_definition_libNeXT_s.C.shlib_NXSoundOut.o .objc_class_name_NXSpellBrowserCell __libNeXT_fflush __libNeXT_fsync __libNeXT_fwrite _NXApplicationFileType _NXDirectoryFileType _NXFilesystemFileType _NXPlainFileType _NXShellCommandFileType .objc_class_name_NibData .file_definition_libNeXT_s.C.shlib_NibData.o _PSconcat __libNeXT_NXNameZone .objc_class_name_PaperView __NXSetData .file_definition_libNeXT_s.C.shlib_PaperView.o _NXCreateFileContentsPboardType _NXFindPboard _NXGeneralPboard _NXSoundPboardType __NXBlockingGetData __NXGetSession __NXGetTypes __NXSetTypes .file_definition_libNeXT_s.C.shlib_appServer.o .file_definition_libNeXT_s.C.shlib_soundkit_globals.o .objc_class_name_QueryCell .objc_class_name_SelectionCell .file_definition_libNeXT_s.C.shlib_SelectionCell.o .file_definition_libNeXT_s.C.shlib_QueryCell.o .objc_class_name_QueryText _58, 4
(864,1376, 0) :58, 4
(800,1184, 0) :58, 4
(800,1120, 0) :58, 4
(800,1248, 0) :2010, 7
(864,1248, 0) :2010, 7
(784,1392, 0) :2015, 7
(816,1392, 0) :2015, 7
(848,1392, 0) :2015, 7
(880,1392, 0) :2015, 7
(832,1344, 0) :2023, 7
(2016,-1120, 0) :2045, 7
(928,1824, 180) :2045, 7
(928,1760, 90) :2019, 7
(-1152,-1696, 180) :2022, 7
(-1920,-1696, 0) :14, 7
(-1920,-1552, 0) :2022, 7
(-1920,-1840, 0) :2048, 7
(96,32, 0) :2018, 7
(992,-1120, 180) :3001, 4
(480,-1248, 180) :3001, 6
(1376,-1248, 180) :3001, 6
(1568,-1376, 180) :3001, 12
(416,-608, 225) :3001, 6
(224,-928, 225) :3001, 6
(96,-1504, 45) :3001, 14
(800,-1120, 180) :68, 4
(736,-1312, 135) :68, 6
(1280,624, 180) :68, 6
(1536,624, 0) :68, 4
(1664,832, 90) :2015, 7
(1664,864, 90) :2015, 7
(1696,864, 90) :2015, 7
(1696,832, 90) :2015, 7
(1696,800, 90) :2015, 7
(1664,800, 90) :2015, 7
(1632,800, 90) :2015, 7
(1632,832, 90) :2015, 7
(1632,864, 90) :2015, 7
(1600,864, 90) :2015, 7
(1600,832, 90) :2015, 7
(1600,800, 90) :2015, 7
(1728,800, 90) :2015, 7
(1728,832, 90) :2015, 7
(1728,864, 90) :2015, 7
(1568,800, 90) :2015, 7
(1568,832, 90) :2015, 7
(1568,864, 90) :2015, 7
(1536,864, 90) :2015, 7
(1536,832, 90) :2015, 7
(1536,800, 90) :2015, 7
(1792,960, 90) :2010, 7
(1472,832, 90) :2047, 7
(1760,-1184, 270) :30, 7
(1760,-1376, 270) :30, 7
(1504,-928, 270) :30, 7
(1504,-1120, 270) :30, 7
(1776,-992, 90) :2047, 7
(1776,-1056, 90) :2046, 7
(1680,-1024, 90) :2023, 7
(1600,-976, 90) :2015, 7
(1632,-976, 90) :2015, 7
(1664,-976, 90) :2015, 7
(1664,-1072, 90) :2015, 7
(1600,-1008, 90) :2015, 7
(1632,-1008, 90) :2015, 7
(1632,-1040, 90) :2015, 7
(1600,-1040, 90) :2015, 7
(1600,-1072, 90) :2015, 7
(1632,-1072, 90) :2015, 7
(1568,-1072, 90) :2015, 7
(1568,-1040, 90) :2015, 7
(1568,-1008, 90) :2015, 7
(1568,-976, 90) :2015, 7
(1696,-976, 90) :2015, 7
(1728,-976, 90) :2015, 7
(1728,-1008, 90) :2015, 7
(1728,-1040, 90) :2015, 7
(1728,-1072, 90) :2015, 7
(1696,-1072, 90) :2015, 7
(960,-1600, 135) :3001, 14
(864,-1632, 135) :3001, 6
(800,-1696, 135) :3001, 4
(736,-1760, 135) :3001, 12
(640,-1792, 135) :3001, 12
(832,-1792, 135) :3001, 12
(784,-1856, 0) :2010, 7
(704,-1856, 0) :2010, 7
(800,-1632, 0) :2024, 7
(864,-1696, 0) :2045, 7
(-1776,1104, 0) :2025, 7
(-1408,1904, 0) :2005, 7
(1616,1344, 0) :6, 7
(-1248,1696, 270) :3002, 6
(-1056,1568, 270) :3002, 4
(-1312,1568, 270) :3002, 4
(-1376,1504, 270) :3002, 4
(-1504,1376, 270) :3002, 4
(-1440,1312, 270) :3002, 4
(-1120,1696, 270) :3006, 4
(-992,1568, 270) :3006, 4
(-1056,1504, 270) :3006, 4
(-1120,1440, 270) :3006, 4
(-1440,1248, 270) :3006, 6
(-1376,1312, 270) :3006, 4
(-1440,1440, 270) :3006, 6
(-1440,1632, 270) :3006, 4
(-1600,1536, 315) :11, 7
(-1248,2112, 0) :11, 7
(224,1120, 90) :11, 7
(1824,2080, 225) :11, 7
(1440,-224, 180) :11, 7
(928,-1760, 90) :11, 7
(-736,-1312, 90) :11, 7
(-672,416, 180) :11, 7
(-544,416, 0) :11, 7
(-704,2112, 90) :2049, 7
(0,2208, 90) :2008, 7
(224,992, 90) :2008, 7
(-80,688, 180) :3006, 1
(-1136,688, 0) :3006, 1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 NXCompleteFilename _NXExpandFilename __libNeXT_seekdir .file_definition_libNeXT_s.C.shlib_QueryText.o __libNeXT_NXEmptyHashTable __libNeXT_NXIsLower __libNeXT_NXNoEffectFree __libNeXT_getdirentries .objc_class_name_Slider .objc_class_name_SliderCell .file_definition_libNeXT_s.C.shlib_SliderCell.o .file_definition_libNeXT_s.C.shlib_Slider.o __libNeXT_kern_timestamp .objc_class_name_SoundMeter .file_definition_libNeXT_s.C.shlib_SoundMeter.o .objc_class_name_SoundView _PSrlineto .file_definition_libNeXT_s.C.shlib_SoundView.o _NXClick _NXCBreakTable _NXCCharCatTable _NXCClickTable _NXCSmartLeftChars _NXCSmartRightChars _NXChunkCopy _NXEnglishBreakTable _NXEnglishSmartLeftChars _NXEnglishSmartRightChars _NXReadWordTable _NXCopyBits _PSgstate __libNeXT_sel_getName .objc_class_name_WindowTemplate .file_definition_libNeXT_s.C.shlib_WindowTemplate.o _NXCopyBitmapFromGState _DPSSendPort _DPSSendTaggedMsg _PSsendboolean _PSsendfloatarray _PSsizeimage .file_definition_libNeXT_s.C.shlib_stream.o _NXCBreakTableSize _NXCClickTableSize _NXEnglishBreakTableSize _NXEnglishClickTableSize _NXEnglishNoBreakTableSize _NXFindPboardType __NXAppkitUnused3 __NXAppkitUnused6 __NXAppkitUnused7 __NXAppkitUnused8 __NXLaunchTiming __NXProfileString __NXTimeBuffers _garbageFiller _NXDefaultTopLevelErrorHandler _PSarcn _PSarct _PSarcto _PScharpath _PSclip _PScurveto _PSeoclip _PSeoviewclip _PSflattenpath _PSinitclip _PSinitviewclip _PSpathbbox _PSpathforall _PSrcurveto _PSrectviewclip _PSreversepath _PSsetbbox _PSsetucacheparams _PSuappend _PSucache _PSucachestatus _PSupath _PSviewclip _PSviewclippath _PScurrentdash _PScurrentflat _PScurrentgray _PScurrentgstate _PScurrenthalftone _PScurrenthalftonephase _PScurrenthsbcolor _PScurrentlinecap _PScurrentlinejoin _PScurrentlinewidth _PScurrentmatrix _PScurrentmiterlimit _PScurrentrgbcolor _PScurrentscreen _PScurrentstrokeadjust _PScurrenttransfer _PSdefaultmatrix _PSgrestoreall _PSinitgraphics _PSinitmatrix _PSsetdash _PSsetflat _PSsethalftone _PSsethalftonephase _PSsethsbcolor _PSsetlinecap _PSsetlinejoin _PSsetmatrix _PSsetmiterlimit _PSsetscreen _PSsetstrokeadjust _PSsettransfer _PSashow _PSawidthshow _PScopypage _PSerasepage _PSimage _PSimagemask _PSkshow _PSstrokepath _PSueofill _PSufill _PSustroke _PSustrokepath _PSwidthshow _PSxshow _PSxyshow _PSyshow _PSFontDirectory _PSISOLatin1Encoding _PSSharedFontDirectory _PSStandardEncoding _PScachestatus _PScurrentcacheparams _PScurrentfont _PSdefinefont _PSfindfont _PSmakefont _PSscalefont _PSsetcachedevice _PSsetcachelimit _PSsetcacheparams _PSsetcharwidth _PSundefinefont _NXBlackComponent _NXChangeBlackComponent _NXChangeBlueComponent _NXChangeCyanComponent _NXChangeGrayComponent _NXChangeGreenComponent _NXChangeHueComponent _NXChangeMagentaComponent _NXChangeRedComponent _NXChangeSaturationComponent _NXChangeYellowComponent _NXConvertColorToHSBA _NXCyanComponent _NXFindColorNamed _NXMagentaComponent _NXYellowComponent _PSsetcmykcolor .file_definition_libNeXT_s.C.shlib_colorCMYKAdjust.o .file_definition_libNeXT_s.C.shlib_pscolorops.o _NXDrawRidge _NXDrawWhiteBezel _NXGetBestDepth _PScurrenttoscreen _PSscreentocurrent _PSalphaimage _PScurrentalpha _PShideinstance _PSreadimage _PSineofill _PSinfill _PSinueofill _PSinufill _PSinustroke _PSwtranslation .file_definition_libNeXT_s.C.shlib_pswinops.o _PSbind _PScountdictstack _PScountexecstack _PScurrentdict _PScurrentpacking _PScurrentshared _PSdeviceinfo _PSerrordict _PSexec _PSprompt _PSquit _PSrand _PSrealtime _PSrestore _PSrrand _PSrun _PSsave _PSsetpacking _PSsetshared _PSsrand _PSstart _PStype _PSundef _PSversion _PSvmreclaim _PSvmstatus .file_definition_libNeXT_s.C.shlib_pssysops.o _NXRemoveErrorReporter _DPSPrintErrorToStream __libNeXT_fputc __libNeXT_syslog __libNeXT_vsprintf _DPSDoUserPathWithMatrix _DPSPrintError _DPSNameFromTypeAndIndex _PSarray _PSbegin _PSend _PSmark _PSpop _PSsystemdict _DPSDefaultErrorProc _DPSGetCurrentErrorBackstop _DPSGetCurrentTextBackstop _DPSSetErrorBackstop _DPSSetTextBackstop _DPSUnchainContext _PSadjustcursor _PSrightbuttondown _PSrightstilldown _PSsetmouse _PSbasetocurrent _PSbasetoscreen _PScountscreenlist _PScountwindowlist _PScurrentdeviceinfo _PScurrenteventmask _PScurrentowner _PScurrentshowpageprocedure _PScurrenttobase _PScurrentwindowalpha _PScurrentwindowdepth _PScurrentwindowdepthlimit _PScurrentwindowdict _PScurrentwindowlevel _PSdumpwindow _PSdumpwindows _PSfrontwindow _PSmovewindow _PSplacewindow _PSscreenlist _PSscreentobase _PSsetdefaultdepthlimit _PSseteventmask _PSsetexposurecolor _PSsetowner _PSsetsendexposed _PSsetshowpageprocedure _PSsetwindowdict _PStermwindow _PSwindow _PSwindowdevice _PSwindowdeviceround _PSwindowlist _DPSRemoveNotifyPortProc __DPSEventQ __DPSLastEvent __DPSMachContexts __DPSMsgSize __DPSNotifyPort __DPSOutputContexts __DPSTracking __libNeXT_fcntl __libNeXT_port_set_add __libNeXT_port_set_allocate __libNeXT_port_set_remove __libNeXT_select __libNeXT_task_notify __libNeXT_task_set_special_port .file_definition_libNeXT_s.C.shlib_list.o _DPSNameFromIndex _PSdefineuserobject _PSexch _PSundefineuserobject __DPSLastNameIndex _PSgetboolean _PSgetchararray _PSgetfloat _PSgetfloatarray _PSgetint _PSgetintarray _PSgetstring _PSsendchararray _PSsendfloat _PSsendintarray _PSsendstring _PScurrentactiveapp _PScurrentwaitcursorenabled _PSiniteventtimes _PSposteventbycontext _PSprinteventtimes _PSsetactiveapp _PSsetflushexposures __libNeXT_FORMER_alloca __libNeXT_NXArgc __libNeXT_NXCopyHashTable __libNeXT_NXEndOfTypedStream __libNeXT_NXFilePathSearch __libNeXT_NXFlushTypedStream __libNeXT_NXObjectMapPrototype __libNeXT_NXReadClass __libNeXT_NXReadDefault __libNeXT_NXReadObjectFromBuffer __libNeXT_NXRegisterDefaults __libNeXT_NXResetMapTable __libNeXT_NXSetDefault __libNeXT_NXSetDefaultsUser __libNeXT_NXStreamCreate __libNeXT_NXUniqueStringWithLength __libNeXT_NXUpdateDefaults __libNeXT_NXWriteClass __libNeXT_NXWriteDefaults __libNeXT_NXZonePtrInfo __libNeXT__alloc __libNeXT__cvtToId __libNeXT__cvtToSel __libNeXT__error __libNeXT__filbuf __libNeXT__fixdfsi __libNeXT__fixunsdfdi __libNeXT__fixunsdfsi __libNeXT__flsbuf __libNeXT__longjmp __libNeXT__strhash __libNeXT__unusedNXArchiveData __libNeXT__unusedNXIgnore __libNeXT__unusedNXReadObject __libNeXT__unusedNXReadSelf __libNeXT__unusedNXUnarchiveData __libNeXT__unusedNXWriteObject __libNeXT__unusedNXWriteSelf __libNeXT__zoneAlloc __libNeXT_abort __libNeXT_alarm __libNeXT_alphasort __libNeXT_bcopy __libNeXT_bootstrap_port __libNeXT_bsearch __libNeXT_chown __libNeXT_class_getInstanceMethod __libNeXT_connect __libNeXT_cthread_init __libNeXT_cthread_name __libNeXT_cthread_set_name __libNeXT_dbClose __libNeXT_dbCreate __libNeXT_dbDelete __libNeXT_dbExists __libNeXT_dbFetch __libNeXT_dbInit __libNeXT_dbOpen __libNeXT_dbStore __libNeXT_dbUnlock __libNeXT_dbWaitLock __libNeXT_fgets __libNeXT_fscanf __libNeXT_fseek __libNeXT_ftruncate __libNeXT_getegid __libNeXT_getgid __libNeXT_gethostbyname __libNeXT_getlogin __libNeXT_getpgrp __libNeXT_getppid __libNeXT_getrusage __libNeXT_getsectbyname __libNeXT_getsectbynamefromheader __libNeXT_isinf __libNeXT_isnan __libNeXT_longjmp __libNeXT_lseek __libNeXT_mach_error __libNeXT_malloc_size __libNeXT_memcpy __libNeXT_method_getArgumentInfo __libNeXT_method_getNumberOfArguments __libNeXT_method_getSizeOfArguments __libNeXT_mig_dealloc_reply_port __libNeXT_mig_get_reply_port __libNeXT_modf __libNeXT_monstartup __libNeXT_mstats __libNeXT_objc_getClass __libNeXT_objc_getMetaClass __libNeXT_objc_msgSend __libNeXT_objc_msgSendSuper __libNeXT_objc_msgSendv __libNeXT_object_getClassName __libNeXT_pclose __libNeXT_popen __libNeXT_port_set_deallocate __libNeXT_port_set_status __libNeXT_port_status __libNeXT_port_type _fsync __libNeXT_sel_isMapped __libNeXT_setegid __libNeXT_seteuid __libNeXT_setgid __libNeXT_setpgrp __libNeXT_setuid __libNeXT_sigvec __libNeXT_snddriver_dsp_protocol __libNeXT_snddriver_dsp_write __libNeXT_snddriver_get_dsp_cmd_port __libNeXT_snddriver_reply_handler __libNeXT_snddriver_set_dsp_owner_port __libNeXT_snddriver_set_sndin_owner_port __libNeXT_snddriver_stream_control __libNeXT_snddriver_stream_setup __libNeXT_snddriver_stream_start_reading __libNeXT_socket __libNeXT_#import "MapWindow.h"
#import "MapView.h"
#import "PopScrollView.h"
#import "EditWorld.h"

NXSize	minsize = {256, 256};
NXSize	newsize = {400, 400};

static	int	cornerx = 128, cornery = 64;

@implementation MapWindow

- free
{
	return [super free];
}


- initFromEditWorld
{
	id		oldobj_i;
	NXSize	screensize;
	NXRect	wframe;
	NXPoint	origin;
	NXRect	mapbounds;

//
// set up the window
//		
	[NXApp getScreenSize: &screensize];
	if (cornerx + newsize.width > screensize.width - 70)
		cornerx = 128;
	if (cornery + newsize.height > screensize.height - 70)
		cornery = 64;
	wframe.origin.x = cornerx;
	wframe.origin.y = screensize.height - newsize.height - cornery;
	wframe.size = newsize;

#if 0
	cornerx += 32;
	cornery += 32;
#endif
	[self
		initContent:		&wframe
		style:			NX_RESIZEBARSTYLE
		backing:			NX_BUFFERED
		buttonMask:		NX_CLOSEBUTTONMASK | NX_MINIATURIZEBUTTONMASK
		defer:			NO
	];
	
	[self	setMinSize:	&minsize];

// initialize the map view 
	mapview_i = [[MapView alloc] initFromEditWorld];
	[scrollview_i setAutosizing: NX_WIDTHSIZABLE | NX_HEIGHTSIZABLE];
	
//		
// initialize the pop up menus
//
	scalemenu_i = [[PopUpList alloc] init];
	[scalemenu_i setTarget: mapview_i];
	[scalemenu_i setAction: @selector(scaleMenuTarget:)];

	[scalemenu_i addItem: "3.125%"];
	[scalemenu_i addItem: "6.25%"];
	[scalemenu_i addItem: "12.5%"];
	[scalemenu_i addItem: "25%"];
	[scalemenu_i addItem: "50%"];
	[scalemenu_i addItem: "100%"];
	[scalemenu_i addItem: "200%"];
	[scalemenu_i addItem: "400%"];
	[[scalemenu_i itemList] selectCellAt: 5 : 0];
	
	scalebutton_i = NXCreatePopUpListButton(scalemenu_i);


	gridmenu_i = [[PopUpList alloc] init];
	[gridmenu_i setTarget: mapview_i];
	[gridmenu_i setAction: @selector(gridMenuTarget:)];

	[gridmenu_i addItem: "grid 1"];
	[gridmenu_i addItem: "grid 2"];
	[gridmenu_i addItem: "grid 4"];
	[gridmenu_i addItem: "grid 8"];
	[gridmenu_i addItem: "grid 16"];
	[gridmenu_i addItem: "grid 32"];
	[gridmenu_i addItem: "grid 64"];
	
	[[gridmenu_i itemList] selectCellAt: 3 : 0];
	
	gridbutton_i = NXCreatePopUpListButton(gridmenu_i);

// initialize the scroll view
	wframe.origin.x = wframe.origin.y = 0;
	scrollview_i = [[PopScrollView alloc] 
		initFrame: 	&wframe 
		button1: 		scalebutton_i
		button2:		gridbutton_i
	];
	[scrollview_i setAutosizing: NX_WIDTHSIZABLE | NX_HEIGHTSIZABLE];
	
// link objects together
	[self setDelegate: self];
	
	oldobj_i = [scrollview_i setDocView: mapview_i];
	if (oldobj_i)
		[oldobj_i free];
	oldobj_i = [self  setContentView: scrollview_i];
	if (oldobj_i)
		[oldobj_i free];
	
// scroll to the middle
	[editworld_i getBounds: &mapbounds];
	origin.x = mapbounds.origin.x + mapbounds.size.width / 2 - newsize.width /2;
	origin.y = mapbounds.origin.y + mapbounds.size.height / 2 - newsize.width /2;
	[mapview_i setOrigin: &origin scale:1];

	return self;
}

- mapView
{
	return mapview_i;
}

- scalemenu
{
	return scalemenu_i;
}

- scalebutton
{
	return scalebutton_i;
}


- gridmenu
{
	return gridmenu_i;
}

- gridbutton
{
	return gridbutton_i;
}


- reDisplay: (NXRect *)dirty
{
	[mapview_i displayDirty: dirty];
	return self;
}

/*
=============================================================================

					DELEGATE METHODS

=============================================================================
*/

/*
=================
=
= windowWillResize: toSize:
=
= note the origin of the window on the screen so that windowDidResize can change the
= MapView origin if the origin corner of the window is moved.
=
= This will be called continuosly during resizing, even though it only needs to be called once.
=
==================
*/

- windowWillResize:sender toSize:(NXSize *)frameSize
{
	oldscreenorg.x = oldscreenorg.y = 0;
	[self convertBaseToScreen: &oldscreenorg];
	[mapview_i getCurrentOrigin: &presizeorigin];
	return self;
}

/*
======================
=
= windowDidResize:
=
= expand / shrink bounds
= When this is called all the views have allready been resized and possible scrolled (sigh)
=
======================
*/

- windowDidResize:sender
{
	NXRect	wincont, scrollcont;
	float		scale;
	NXPoint	newscreenorg;

//
// change frame if needed
//	
	newscreenorg.x = newscreenorg.y = 0;
	[self convertBaseToScreen: &newscreenorg];

	scale = [mapview_i currentScale];
	presizeorigin.x += (newscreenorg.x - oldscreenorg.x)/scale;
	presizeorigin.y += (newscreenorg.y - oldscreenorg.y)/scale;
	[mapview_i setOrigin: &presizeorigin];

//
// resize drag image
//
	[Window
		getContentRect:	&wincont 
		forFrameRect:		&frame
		style:			NX_RESIZEBARSTYLE
	];

	[ScrollView
		getContentSize:	&scrollcont.size
		forFrameSize:		&wincont.size
		horizScroller:		YES
		vertScroller:		YES
		borderType:		NX_NOBORDER
	];

	return self;
}


@end
                                                                                                                                                                                                                                                                                                                                                                                                    #import "wadfiles.h"
#import "Coordinator.h"
#import "PatchPalette.h"
#import "PlanePalette.h"
#import "PlanePalView.h"

@implementation PlanePaletteView

- initFrame:(const NXRect *)theFrame
{
	[super	initFrame:theFrame];
	planePalView_i = self;
	selectedPlane = 0;
	return self;
}

- (int)currentViewSelection
{
	return selectedPlane;
}

- drawSelf:(const NXRect *)rects :(int)rectCount
{
	int planenum;
	apatch_t *plane;

	planenum = 0;
	while ((plane = [planePalette_i	getPlane:planenum++]) != NULL)
		if (NXIntersectsRect(&plane->r,&rects[0]))
			[plane->image		composite:NX_COPY toPoint:&plane->r.origin];
	
	if (selectedPlane >= 0)
	{
		NXRect	clipview,r;

		[self	getFrame:&clipview];
		plane = [planePalette_i	getPlane:selectedPlane];
		r = plane->r;
		r.origin.x -= 5;
		r.origin.y -= 5;
		r.size.width += 10;
		r.size.height += 10;
		NXDrawGroove(&r,&clipview);
		[plane->image		composite:NX_COPY toPoint:&plane->r.origin];
	}
	
	return self;
}

- mouseDown:(NXEvent *)theEvent
{
	NXPoint	loc;
	int		planenum;
	apatch_t *plane;
	
	loc = theEvent->location;
	[self convertPoint:&loc	fromView:NULL];
	
	planenum = 0;
	while ((plane = [planePalette_i	getPlane:planenum++]) != NULL)
		if ([self	mouse:&loc	inRect:&plane->r] == YES)
		{
			if (selectedPlane == planenum -1)
				[coordinator_i	playPop];
			else
			{
				selectedPlane = planenum - 1;
				[coordinator_i	playDrip];
			}
			[superview	display];
			break;
		}

	return self;
}




@end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
#import <appkit/appkit.h>

#define	SPACING				10
#define	PLANEWINDOWX			100
#define	PLANEWINDOWY			0
#define	PLANEWINDOWWIDTH	(64 + SPACING)*3 + SPACING
#define	PLANEWINDOWHEIGHT	400

@interface PlaneWindow:Window
{
	id	planeScrollView_i;
	id	planeDocView_i;
	NXRect	curWindowRect;
}

- (int)currentViewSelection;
- computePlaneDocView: (NXRect *)frame;

@end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       strcspn __libNeXT_strtok __libNeXT_thread_abort __libNeXT_umask __libNeXT_unusedNXArchiveBitFields __libNeXT_unusedNXArchiveChar __libNeXT_unusedNXArchiveDouble __libNeXT_unusedNXArchiveFloat __libNeXT_unusedNXArchiveInt __libNeXT_unusedNXArchiveLong __libNeXT_unusedNXArchiveShort __libNeXT_unusedNXSYSTEMVERSION __libNeXT_unusedNXUnarchiveBitFields __libNeXT_unusedNXUnarchiveChar __libNeXT_unusedNXUnarchiveDouble __libNeXT_unusedNXUnarchiveFloat __libNeXT_unusedNXUnarchiveInt __libNeXT_unusedNXUnarchiveLong __libNeXT_unusedNXUnarchiveShort __libNeXT_unused_mach_ports_lookup __libNeXT_unused_mach_ports_register __libNeXT_ur_cthread_self __libNeXT_usleep __libNeXT_vfprintf __libNeXT_wait3 _NXCloseEventStatus _NXEventSystemInfo _NXOpenEventStatus _localeconv _NXLoadLocalStringFromTableInBundle _utimes _NXPtrValueMapPrototype _malloc_size _rmdir _NXStrValueMapPrototype _sigsetmask _sigblock _symlink _readlink _getppid _getpgrp _setpgrp _setgid _setegid _setuid _seteuid _NXNextMapState _NXInitMapState _NXResetMapTable _NXMapRemove _NXMapInsert _NXMapGet _NXMapMember _NXCountMapTable _NXFreeMapTable _NXCreateMapTableFromZone _NXCreateMapTable _NXObjectMapPrototype _ni_pwdomain _ni_entrylist_free _ni_list _method_getSizeOfArguments _method_getArgumentInfo _method_getNumberOfArguments _class_getInstanceMethod _NXIsSpace _NXIsXDigit _NXIsAlpha _NXToAscii _NXIsDigit _NXIsLower _NXToUpper _NXToLower _NXFilePathSearch _NXSetDefaultsUser _NXUpdateDefault _NXUpdateDefaults _NXReadDefault _NXRemoveDefault _NXWriteDefaults _NXSetDefault __NXRegisterDefaultsNoCopy _cond_signal _condition_wait _usleep _setlocale _NXNameZone __zoneAlloc _NXStreamCreateFromZone _NXZonePtrInfo _NXZoneFromPtr _NXZoneCalloc _NXMergeZone _NXCreateChildZone _NXCreateZone _NXSetTypedStreamZone _NXCreateHashTableFromZone _fabs _getdirentries _SNDStartRecordingFile _snddriver_dsp_protocol _snddriver_get_dsp_cmd_port _snddriver_set_dsp_owner_port _SNDReadDSPfile _snddriver_dsp_write _SNDBootDSP _snddriver_set_sndin_owner_port _snddriver_stream_control _snddriver_reply_handler _snddriver_stream_setup _snddriver_stream_start_reading _dbCreate _dbInit _dbExists _chown _getegid _getgid _NXTypedStreamClassVersion _object_getClassName _sel_registerName _sel_getUid _sel_getName _sel_isMapped _NXPtrStructKeyPrototype _NXStrPrototype _NXUniqueStringWithLength _NXUniqueString _NXReallyFree _NXNoEffectFree _NXStrIsEqual _NXPtrIsEqual _NXStrHash _NXPtrHash _NXNextHashState _NXInitHashState _NXHashRemove _NXHashInsert _NXHashGet _NXHashMember _NXCountHashTable _NXCopyHashTable _NXEmptyHashTable _NXFreeHashTable _NXCreateHashTable _wait4 _wait3 _wait _vm_protect _vm_page_size _vm_copy _vm_allocate _vfprintf _vfork _valloc _umask _thread_switch _thread_self _thread_priority _thread_policy _thread_info _thread_abort _task_set_special_port _task_notify _syslog _strstr _strftime _strcspn _stat _sigvec _setpwent _seekdir _scandir _rint _rename _readdir _qsort _prdb_set _prdb_getbyname _prdb_get _prdb_end _pow _port_type _port_set_status _port_status _port_set_remove _port_set_deallocate _port_set_backlog _port_set_allocate _port_set_add _popen _pipe _pclose _opendir _openlog _objc_setMultithreaded _object_setInstanceVariable _objc_lookUpClass _netname_check_out _netname_check_in _mutex_wait_lock _mutex_try_lock _mstats _monreset _monoutput _moninit _moncontrol _mkdir _mig_get_reply_port _mig_dealloc_reply_port _memcmp _map_fd _malloc_debug _malloc_error _mach_error_string _lstat _log10 _longjmp _localtime _kern_timestamp _ioctl _isnan _isinf _getwd _getuid _getsectdatafromlib _getsectdatafromheader _getsectdata _getsectbynamefromheader _getsectbyname _getpwuid _getpwnam _getpwent _getlogin _gethostbyname _geteuid _ftruncate _fread _fork _fcntl _execv _execl _endpwent _dbWaitLock _dbUnlock _dbStore _dbOpen _dbFetch _dbDelete _dbClose _ctime _cthread_set_name _cthread_name _cthread_init _cthread_fork _cthread_detach _connect _closedir _bsearch _alphasort _abs __strhash __mh_execute_header __longjmp __error __cvtToSel __cvtToId __alloc __NXUncaughtExceptionHandler __NXStreamFlushBuffer __NXStreamFillBuffer __NXStreamChangeBuffer __NXRemoveAltHandler __NXAddAltHandler _SNDVerifyPlayable _SNDiMulaw _SNDWriteSoundfile _SNDWait _SNDStop _SNDStartRecording _SNDStartPlaying _SNDSetVolume _SNDSetMute _SNDSamplesProcessed _SNDSampleCount _SNDReadSoundfile _SNDMulaw _SNDGetVolume _SNDGetMute _SNDInsertSamples _SNDFree _SNDSoundError _SNDDeleteSamples _SNDCopySound _SNDCopySamples _SNDConvertSound _SNDCompactSamples _SNDBytesToSamples _SNDAlloc _NXWriteRootObjectToBuffer _NXVPrintf _NXUngetc _NXSystemVersion _NXScanf _NXReadObjectFromBufferWithZone _NXReadObjectFromBuffer _NXOpenTypedStreamForFile _NXOpenTypedStream _NXOpenSmallMemory _NXOpenFile _NXGetStreamOnSectionForBestArchitecture _NXGetStreamOnSection _NXFreeObjectBuffer _NXFlushTypedStream _NXEndOfTypedStream _NXDefaultRead _NXCloseTypedStream _NXResetErrorData _NXAllocErrorData __fixunsdfdi _NXArgv _NXArgc _NXDefaultStringOrderTable _NXWriteWordTable __NXOrderStrings __NXOrderStringsWithLength __NXGetDetailedWindowServerMemory _NXChunkZoneCopy _NXFrontWindow __NXConcludeReloadingPackages __NXDeactivateApp __NXPrepareToReloadPackages __NXPrepareToRestoreNextdict __NXSetWindowLevel __NXStashPackageProcs __DPSSyncAllCtxts _DPSSetTracking _DPSAsynchronousWaitContext _DPSCreateContext _DPSSetDeadKeysEnabled __DPSCheckContext _PSsetobjectformat .file_definition_libNeXT_s.C.shlib_scanner.o _PScleardictstack _PScurrentframebuffertransfer _PScurrentrusage _PScurrentuser _PScurrentwriteblock _PSframebuffer _PSmachportdevice _PSnextrelease _PSosname _PSostype _PSplaysound _PSsetframebuffertransfer _PSsetwriteblock _PScondition _PScurrentobjectformat _PSdefineusername _PSdetach _PSexecuserobject _PSfork _PSjoin _PSlock _PSmonitor _PSnotify _PSsetvmthreshold _PSuserobject _PSwait _PSyield _PSaload _PSanchorsearch _PSastore _PSclear _PScleartomark _PScopy _PScount _PScounttomark _PScvi _PScvlit _PScvn _PScvr _PScvrs _PScvs _PScvx _PSdef _PSdict _PSdictstack _PSdup _PSexecstack _PSexecuteonly _PSget _PSgetinterval _PSindex _PSknown _PSlength _PSload _PSmatrix _PSmaxlength _PSnoaccess _PSpackedarray _PSput _PSputinterval _PSrcheck _PSreadonly _PSroll _PSscheck _PSsearch _PSshareddict _PSstatusdict _PSstore _PSstring _PSstringwidth _PSuserdict _PSwcheck _PSwhere _PSxcheck __DPSMsgTracingOn __DPSPmonFiller __DPSUnused1 __DPSZapCheck __NXTIFFSize __NXTIFFReadScanline __NXTIFFSetField __NXTIFFWriteScanline .file_definition_libNeXT_s.C.shlib_tif_tile.o .file_definition_libNeXT_s.C.shlib_tif_swab.o .file_definition_libNeXT_s.C.shlib_imageClient.o .file_definition_libNeXT_s.C.shlib_tif_write.o .file_definition_libNeXT_s.C.shlib_tif_read.o __NXTIFFFreeDirectory .file_definition_libNeXT_s.C.shlib_tif_flush.o __NXTIFFDefaultDirectory __NXTIFFReadDirectory .file_definition_libNeXT_s.C.shlib_tif_error.o .file_definition_libNeXT_s.C.shlib_tif_dirread.o __NXTIFFGetField .file_definition_libNeXT_s.C.shlib_tif_warning.o .file_definition_libNeXT_s.C.shlib_tif_compress.o .file_definition_libNeXT_s.C.shlib_tif_dirinfo.o _DPSStartWaitCursorTimer _PSadjustmouse _PSresetwait _PSsetwaitcursor _PSsetwaitenabled _PSsetwaittime __PSOBSOLETEsetpattern _DPSSendEOF _PScolorimage _PScurrentblackgeneration _PScurrentcmykcolor _PScurrentcolorscreen _PScurrentcolortransfer _PScurrentundercolorremoval _PSsetblackgeneration _PSsetcolorscreen _PSsetcolortransfer _PSsetundercolorremoval __NXTIFFReadRawStrip .file_definition_libNeXT_s.C.shlib_tif_strip.o __NXTIFFWriteRawStrip __NXTIFFBitRevTable __NXTIFFNoBitRevTable __NXTIFFWriteDirectory .file_definition_libNeXT_s.C.shlib_tif_dirwrite.o __NXTIFFDataWidth __NXTIFFFieldInfo _IXQuickSort .file_definition_libNeXT_s.C.shlib_tif_packbits.o .file_definition_libNeXT_s.C.shlib_tif_next.o .file_definition_libNeXT_s.C.shlib_tif_lzw.o .file_definition_libNeXT_s.C.shlib_tif_jpeg.o .file_definition_libNeXT_s.C.shlib_tif_dumpmode.o .file_definition_libNeXT_s.C.shlib_tif_ccittrle.o .file_definition_libNeXT_s.C.shlib_tif_fax4.o .file_definition_libNeXT_s.C.shlib_tif_fax3.o _TIFFFaxBlackCodes _TIFFFaxWhiteCodes .objc_category_name_IXAttributeParser_Configuration .objc_cate#import "lbmfunctions.h"
#import "wadfiles.h"
#import "PatchPalView.h"
#import "PatchWindow.h"
#import "PatchPalette.h"
#import "EditWorld.h"
#import "DoomProject.h"

 id	patchPalette_i;


@implementation PatchPalette
- init
{
	window_i = NULL;
	patchPalette_i = self;
	return self;
}

- (int)currentSelection
{
	return [window_i	currentViewSelection];
}

- free
{
	int	i;
	apatch_t	*patch;
	
	i = 0;
	while ((patch = [patchImages	getPatch:i++]) != NULL)
		[patch->image	free];
	[patchImages	free];
	[super	free];
	return self;
}

- (apatch_t *) getPatch:(int)which
{
	return [patchImages	elementAt:which];
}

//
// load in all the patches and init storage array
//
- initPatches
{
	int	patchStart, patchEnd, i;
	patch_t *patch;
	byte const *palLBM;
	apatch_t	p;
	NXSize	s;

	W_InitFile([doomproject_i wadfile]);
	palLBM = W_GetName("playpal");
	
	//
	// get inclusive lump #'s for patches
	//
	patchStart = W_CheckNumForName("p_start") + 1;
	patchEnd = W_CheckNumForName("p_end");

	if (patchStart == -1)
	{
		NXRunAlertPanel(	"OOPS!",
						"There are NO PATCHES in the current .WAD file!",
						"Abort Patch Palette",NULL,NULL,NULL);
		W_FreeLump(W_CheckNumForName("playpal"));
		W_CloseFiles();
		return self;
	}
	
	patchImages = [[Storage	alloc]
						initCount:		0
						elementSize:	sizeof(apatch_t)
						description:	"{ffff}@"];
	
	NXSetRect(&p.r,0,0,0,0);
	for (i = patchStart; i < patchEnd; i++)
	{
		NXSize	theSize;
		//
		// load vertically compressed patch and convert to an NXImage
		//
		patch = W_GetLump(i);
		p.image = patchToImage(patch,palLBM,&s);
		//
		// make a copy that's 2 times the size
		//
		p.image_x2 = [p.image	copyFromZone:NXDefaultMallocZone()];
		theSize = s;
		theSize.width *= 2;
		theSize.height *= 2;
		[p.image_x2	setScalable:YES];
		[p.image_x2	setSize:&theSize];
		
		p.r.size = s;
		[patchImages	addElement:&p];
		W_FreeLump(i);
	}
	
	W_CloseFiles();
	return self;
}

- menuTarget:sender
{
	if (![editworld_i laoded])
	{
		NXRunAlertPanel("Oops!",
						"There must be a world loaded to select patches!",
						"OK",NULL,NULL,NULL);
		return self;
	}

	if (!window_i)
		window_i = [[PatchWindow alloc]	init];

	//
	// make sure patches are loaded before window inits
	//	
	[window_i	makeKeyAndOrderFront:self];
	return self;
}


@end

//
// convert a compressed patch to an NXImage with an alpha channel
//
id	patchToImage(patch_t *patchData,byte const *lbmpalette,NXSize *size)
{
	byte			*dest_p;
	NXImageRep *image_i;
	id			fastImage_i;
	unsigned short	shortpal[256];
	int			width,height,count,topdelta;
	byte const	*data;
	int			i,index;

	width = patchData->width;
	height = patchData->height;
	size->width = width;
	size->height = height;
	//
	// make an NXimage to hold the data
	//
	image_i = [[NXBitmapImageRep alloc]
		initData:			NULL 
		pixelsWide:		width 
		pixelsHigh:		height
		bitsPerSample:	4
		samplesPerPixel:	4 
		hasAlpha:		YES
		isPlanar:			NO 
		colorSpace:		NX_RGBColorSpace 
		bytesPerRow:		width*2
		bitsPerPixel: 		16
	];

	if (!image_i)
		return nil;
				
	//
	// translate the picture
	//
	LBMpaletteTo16 (lbmpalette, shortpal);
	dest_p = [(NXBitmapImageRep *)image_i data];
	memset(dest_p,0,width * height * 2);
	
	for (i = 0;i < width; i++)
	{
		data = (byte *)patchData + ShortSwap(patchData->collumnofs[i]);
		while (1)
		{
			topdelta = *data++;
			if (topdelta == (byte)-1)
				break;
			count = *data++;
			index = (topdelta*width+i)*2;
			while (count--)
			{
				*((unsigned short *)(dest_p + index)) = shortpal[*data++];
				index += width * 2;
			}
		}
	}

	fastImage_i = [[NXImage	alloc]
							init];
	[fastImage_i	useRepresentation:(NXImageRep *)image_i];	
	return fastImage_i;
}

/*
================
=
= IO_Error
=
================
*/

void IO_Error (char *error, ...)
{
	va_list	argptr;
	char		string[1024];

	va_start (argptr,error);
	vsprintf (string,error,argptr);
	va_end (argptr);
	NXRunAlertPanel ("Error",string,NULL,NULL,NULL);
	[NXApp terminate: NULL];
}                                                                                                                                        #import "lbmfunctions.h"
#import "wadfiles.h"
#import "PatchPalette.h"
#import "PatchWindow.h"
#import "PatchPalView.h"

@implementation PatchWindow

- (int)currentViewSelection
{
	return [patchDocView_i	currentSelection];
}

- init
{
	NXRect	contentframe,docframe;
	NXPoint	startPoint;

	//
	// initialize the window
	//
	NXSetRect(&contentframe,
			PATCHWINDOWX,
			PATCHWINDOWY,
			PATCHWINDOWWIDTH,
			PATCHWINDOWHEIGHT);

	[self
		initContent:		&contentframe
		style:			NX_RESIZEBARSTYLE
		backing:			NX_BUFFERED
		buttonMask:		NX_CLOSEBUTTONMASK | NX_MINIATURIZEBUTTONMASK
		defer:			NO
	];
	
	//
	// set delegate so I can trap "windowDidResize" messages
	//
	[self	setDelegate:self];
	[self setTitle: "Patch Palette"];
	
	//
	// setup scrollview
	//
	[[self		contentView]	getFrame:&contentframe];
	patchScrollView_i = [[[ScrollView	alloc]
					initFrame:	&contentframe]
					setVertScrollerRequired: YES];

	//
	// setup docview that's in the scrollview	
	//
	NXSetRect(&curWindowRect,0,0,0,0);
	[patchScrollView_i		getContentSize:&curWindowRect.size];
	[ self		computePatchDocView:&docframe];
	//
	// if only a couple patches, don't make window default size
	//
	if (curWindowRect.size.height > docframe.size.height)
	{
		curWindowRect.size.height = docframe.size.height;
		[self	sizeWindow:curWindowRect.size.width :curWindowRect.size.height];
	}

	patchDocView_i	=
			[[PatchPaletteView	alloc]
				initFrame:	&docframe];
	[patchScrollView_i		setDocView:patchDocView_i];
	//
	// start patch palette at top of docview
	//
	startPoint = docframe.origin;
	startPoint.y = docframe.size.height - curWindowRect.size.height;
	[patchDocView_i		scrollPoint:&startPoint];
	
	[self		setContentView:patchScrollView_i];
	[self display];

	return self;
}

- (BOOL)canBecomeMainWindow
{
	return NO;
}

//
// compute the size of the docView and set the origin of all the patches
// within the docView.
//
- computePatchDocView: (NXRect *)theframe
{
	int	x, y, patchnum, maxheight;
	apatch_t		*patch;
	
	x = y =  SPACING;
	maxheight = patchnum = 0;
	while ((patch = [patchPalette_i getPatch:patchnum++]) != NULL)
	{
		if (x + patch->r.size.width > curWindowRect.size.width && x != SPACING)
		{
			x = SPACING;
			y += maxheight + SPACING;
			maxheight = 0;
		}
		
		patch->r.origin.x = x;
		patch->r.origin.y = y;
		
		if (patch->r.size.height > maxheight)
			maxheight = patch->r.size.height;

		if (x + patch->r.size.width > curWindowRect.size.width && x == SPACING)
		{
			y += maxheight + SPACING;
			maxheight = 0;
		}			
		else
			x += patch->r.size.width + SPACING;
	}
	y += maxheight + SPACING;
	NXSetRect(theframe,0,0,curWindowRect.size.width + SPACING,y);
	
	//
	// now go through all the patches and reassign the coords so they
	// stack from top to bottom...
	//
	maxheight = patchnum = 0;
	x = theframe->origin.x + SPACING;
	y = theframe->origin.y + theframe->size.height - SPACING;
	while ((patch = [patchPalette_i	getPatch:patchnum++]) != NULL)
	{
		if (x + patch->r.size.width > curWindowRect.size.width && x != SPACING)
		{
			x = SPACING;
			y -= maxheight + SPACING;
			maxheight = 0;
		}
		
		patch->r.origin.x = x;
		patch->r.origin.y = y - patch->r.size.height;

		if (patch->r.size.height > maxheight)
			maxheight = patch->r.size.height;

		if (x + patch->r.size.width > curWindowRect.size.width && x == SPACING)
		{
			y -= maxheight + SPACING;
			maxheight = 0;
		}			
		else
			x += patch->r.size.width + SPACING;
	}	

	return self;
}

- windowDidResize:sender
{
	NXRect	theFrame;
	
	NXSetRect(&curWindowRect,0,0,0,0);
	[patchScrollView_i		getContentSize:&curWindowRect.size];
	[self		computePatchDocView:&theFrame];
	[patchDocView_i	sizeTo:theFrame.size.width :theFrame.size.height];

	return self;
}

@end

                                                                                                                                                                                                                                                                                                                                                                                gory_name_IXAttributeParser_Parsing .objc_category_name_IXAttributeParser_Private .objc_class_name_IXAttributeParser .objc_class_name_IXAttribute .objc_class_name_IXAttributeBinder .objc_class_name_IXAttributeTable .objc_class_name_IXAttributeValue .objc_class_name_IXFileConverter .objc_class_name_IXLanguageReader .objc_class_name_IXWeightingDomain _IXAttributeReaderPboardType _IXCloseRichTextStream _IXCreateRichTextStream _IXReadRichTextToken __libIndexing_NXCloseMemory __libIndexing_NXCountHashTable __libIndexing_NXCreateHashTableFromZone __libIndexing_NXFreeHashTable __libIndexing_NXHashInsert __libIndexing_NXHashMember __libIndexing_NXHashRemove __libIndexing_NXInitHashState __libIndexing_NXNextHashState __libIndexing_NXReadObject __libIndexing_NXReadTypes __libIndexing_NXStrPrototype __libIndexing_NXTypedStreamClassVersion __libIndexing_NXWriteObject __libIndexing_NXWriteType __libIndexing_NXWriteTypes __libIndexing_NXZoneFromPtr __libIndexing__NXAddHandler __libIndexing__NXRemoveHandler __libIndexing__setjmp __libIndexing_memmove __libIndexing_memset __libIndexing_msg_receive __libIndexing_msg_rpc __libIndexing_msg_send __libIndexing_object_dispose __libIndexing_strcmp .file_definition_libIndexing_s.A.shlib_alias.o .file_definition_libIndexing_s.A.shlib_pointers.o .file_definition_libIndexing_s.A.shlib_IXQuickSort.o .file_definition_libIndexing_s.A.shlib_IXRichTextReader.o .file_definition_libIndexing_s.A.shlib_IndexingGlobals.o .file_definition_libIndexing_s.A.shlib_IXWeightingDomain.o .file_definition_libIndexing_s.A.shlib_IXLanguageReader.o .file_definition_libIndexing_s.A.shlib_IXFileConverter.o .file_definition_libIndexing_s.A.shlib_IXAttributeValue.o .file_definition_libIndexing_s.A.shlib_IXAttributeTable.o .file_definition_libIndexing_s.A.shlib_IXAttributeBinder.o .file_definition_libIndexing_s.A.shlib_IXAttribute.o .file_definition_libIndexing_s.A.shlib_IXAttributeParser.o .shared_library_information_libIndexing_s.A.shlib .objc_category_name_IXAttributeReader_Configuration .objc_category_name_IXAttributeReader_Private .objc_class_name_IXAttributeReader _IXControlWordFromToken __libIndexing_NXCopyStringBuffer __libIndexing_NXCopyStringBufferFromZone __libIndexing_NXCreateMapTableFromZone __libIndexing_NXCreateZone __libIndexing_NXDefaultMallocZone __libIndexing_NXGetTypedStreamZone __libIndexing_NXIsAlNum __libIndexing_NXMapFile __libIndexing_NXMapGet __libIndexing_NXMapInsert __libIndexing_NXNameZone __libIndexing_NXOpenMemory __libIndexing_NXPrintf __libIndexing_NXReadType __libIndexing_NXSaveToFile __libIndexing_NXScanf __libIndexing_NXSeek __libIndexing_NXSetTypedStreamZone __libIndexing_NXStrValueMapPrototype __libIndexing_NXZoneCalloc __libIndexing__NXStreamChangeBuffer __libIndexing__NXStreamFillBuffer __libIndexing__NXStreamFlushBuffer __libIndexing__NXToLower __libIndexing_objc_lookUpClass __libIndexing_object_getClassName __libIndexing_sprintf __libIndexing_strcat __libIndexing_strcpy __libIndexing_strlen __libIndexing_vm_page_size .file_definition_libIndexing_s.A.shlib_IXAttributeReader.o .objc_category_name_IXBTreeCursor_IXPostingExchange .objc_category_name_IXBTreeCursor_IXPostingOperations .objc_class_name_IXBTreeCursor .objc_class_name_IXBTree __libIndexing_NXFreeObjectBuffer __libIndexing_NXReadObjectFromBufferWithZone __libIndexing_NXWriteRootObjectToBuffer __libIndexing__NXRaiseError __libIndexing_free __libIndexing_mach_error_string __libIndexing_sel_getName __libIndexing_task_self_ __libIndexing_vm_copy .file_definition_libIndexing_s.A.shlib_BTreePrivate.o .file_definition_libIndexing_s.A.shlib_BTreeSearch.o .file_definition_libIndexing_s.A.shlib_IXBTree.o .file_definition_libIndexing_s.A.shlib_IXBTreeCursor.o .objc_category_name_IXDataDictionary_CustomProtocol .objc_class_name_IXDataDictionary .objc_class_name_IXPostingCursor .objc_class_name_IXPostingList .objc_class_name_IXStore .objc_class_name_IXStoreDirectory _IXCompareStringAndUnsigneds _IXCompareStrings _IXCompareUnsignedLong __libIndexing_NXCreateMapTable __libIndexing_NXFreeMapTable __libIndexing_NXMapRemove __libIndexing_NXPtrValueMapPrototype __libIndexing_NXReallyFree __libIndexing_NXResetMapTable __libIndexing_NXStrHash __libIndexing_NXStrIsEqual __libIndexing_calloc __libIndexing_mutex_try_lock __libIndexing_mutex_wait_lock __libIndexing_objc_getClass __libIndexing_objc_getClasses __libIndexing_objc_msgSend __libIndexing_objc_setClassHandler __objc_addClassVersion __objc_copyMethodList __objc_createClass __objc_createIvarList __objc_defaultClassHandler __objc_getClassVersion __objc_getClassVersions .file_definition_libIndexing_s.A.shlib_objc-support.o .file_definition_libIndexing_s.A.shlib_BTreeCompare.o .file_definition_libIndexing_s.A.shlib_IXStoreDirectory.o .file_definition_libIndexing_s.A.shlib_IXStore.o .file_definition_libIndexing_s.A.shlib_IXPostingList.o .file_definition_libIndexing_s.A.shlib_IXPostingCursor.o .file_definition_libIndexing_s.A.shlib_IXDataDictionary.o .objc_category_name_IXDataRepository_IXBlobNaming .objc_category_name_IXDataRepository_IXRecordNaming .objc_category_name_Object_IXRecordTranscription .objc_class_name_IXDataRepository .objc_class_name_IXPostingSet _IXCompareUnsignedLongs __coerceMethodToDouble __coerceMethodToFloat __coerceMethodToInt __coerceMethodToString __coerceToDouble __coerceToFloat __coerceToInt __coerceToString __libIndexing_NXCloseTypedStream __libIndexing_NXGetMemoryBuffer __libIndexing_NXIsDigit __libIndexing_NXOpenTypedStream __libIndexing_NXTell __libIndexing_NXWriteRootObject __libIndexing_atoi __libIndexing_class_createInstanceFromZone __libIndexing_class_getInstanceMethod __libIndexing_class_getInstanceVariable __libIndexing_method_getSizeOfArguments __libIndexing_sel_registerName __libIndexing_strncpy .file_definition_libIndexing_s.A.shlib_IXRunTimeSupport.o .file_definition_libIndexing_s.A.shlib_IXPostingSet.o .file_definition_libIndexing_s.A.shlib_IXDataRepository.o .objc_category_name_IXFileFinder_Private .objc_category_name_IXFileFinder_Searching .objc_class_name_IXFileFinder .objc_class_name_IXAttributeQuery .objc_class_name_IXFileRecord .objc_class_name_IXRecordManager .objc_class_name_IXStoreFile _IXAbsolutePath _IXCatenatePath _IXCurrentPath _IXEnumeratePath _IXReadObjectFromStore _IXReadRichText _IXRelativePath _IXWriteRootObjectToStore __libIndexing_NXCountMapTable __libIndexing_NXCreateHashTable __libIndexing_NXInitMapState __libIndexing_NXMapMember __libIndexing_NXNextMapState __libIndexing_NXPtrPrototype __libIndexing_cond_signal __libIndexing_condition_wait __libIndexing_cthread_fork __libIndexing_cthread_join __libIndexing_cthread_priority __libIndexing_kern_timestamp __libIndexing_memcmp __libIndexing_strchr __libIndexing_strncmp __libIndexing_strrchr __libIndexing_syslog __libIndexing_ur_cthread_self .file_definition_libIndexing_s.A.shlib_IXStoreBlock.o .file_definition_libIndexing_s.A.shlib_IXPathFunctions.o .file_definition_libIndexing_s.A.shlib_IXStoreFile.o .file_definition_libIndexing_s.A.shlib_IXRecordManager.o .file_definition_libIndexing_s.A.shlib_IXFileRecord.o .file_definition_libIndexing_s.A.shlib_IXAttributeQuery.o .file_definition_libIndexing_s.A.shlib_IXFileFinder.o .objc_category_name_IXFileRecord_Private .objc_class_name_IXMethodAttribute __libIndexing_sel_getUid __libIndexing_stat .objc_category_name_IXRecordManager_IXRepositoryDelegate .objc_category_name_IXRecordManager_Private .objc_category_name_Object_IXRecordManagerDelegate _IXDefaultAttributeParser .objc_class_name_IXAttributeCursor _IXFormatComparator __libIndexing_malloc .file_definition_libIndexing_s.A.shlib_IXAttributeCursor.o .objc_category_name_Object_IXLazyBinding .objc_category_name_Object_IXObjectsAsRelations _y1 __coerceDoubleAsArg __coerceDoubleToType __coerceFloatAsArg __coerceFloatToType __coerceIntAsArg __coerceIntToType __coerceStringAsArg __coerceStringToType __libIndexing_atol __libIndexing_method_getArgumentInfo __libIndexing_objc_addClass __libIndexing_object_getInstanceVariable __libIndexing_object_setInstanceVariable __libIndexing_strtod __objc_sizeOfType .objc_category_name_Protocol_MethodList .objc_class_name_IXIvarAttribute __libIndexing__ctype_ __libIndexing_class_get#import "lbmfunctions.h"
#import "wadfiles.h"
#import "PatchPalette.h"
#import "PlanePalette.h"
#import "PlaneWindow.h"
#import "EditWorld.h"
#import "DoomProject.h"

id	planePalette_i;

@implementation PlanePalette

- (apatch_t *) getPlane:(int)which
{
	return [planeImages	elementAt:which];
}

- (int) currentSelection
{
	return [window_i	currentViewSelection];
}

- init
{
	window_i = NULL;
	planePalette_i = self;
	
	return self;
}

- menuTarget:sender
{
	if (!editworld_i)
	{
		NXRunAlertPanel("Oops!",
						"There must be a world loaded to select planes!",
						"OK",NULL,NULL,NULL);
		return self;
	}
	
	if (!window_i)
	{
		int	planeStart, planeEnd, i;
		byte const *palLBM;
		byte *plane;
		apatch_t	p;
	
		W_InitFile([doomproject_i wadfile]);
		palLBM = W_GetName("playpal");
		
		//
		// get inclusive lump #'s for patches
		//
		planeStart = W_CheckNumForName("f_start") + 1;
		planeEnd = W_CheckNumForName("f_end");
	
		if (planeStart == -1)
		{
			NXRunAlertPanel(	"OOPS!",
							"There are NO FLAT PLANES in the current .WAD file!",
							"Abort Plane Palette",NULL,NULL,NULL);
			W_FreeLump(W_CheckNumForName("playpal"));
			W_CloseFiles();
			return self;
		}
		
		planeImages = [[Storage	alloc]
							initCount:		0
							elementSize:	sizeof(apatch_t)
							description:	"{ffff}@"];
		
		NXSetRect(&p.r,0,0,0,0);
		for (i = planeStart; i < planeEnd; i++)
		{
			//
			// load vertically compressed patch and convert to an NXImage
			//
			plane = W_GetLump(i);
			p.image = planeToImage(plane,palLBM);
			p.r.size.width = 64;
			p.r.size.height = 64;
			[planeImages	addElement:&p];
			W_FreeLump(i);
		}
		
		W_CloseFiles();
		window_i = [[PlaneWindow alloc]	init];
	}
	
	//
	// make sure patches are loaded before window inits
	//	
	[window_i	makeKeyAndOrderFront:self];
	return self;
}

@end

//
// convert a raw 64x64 to an NXImage without an alpha channel
//
id	planeToImage(byte *planeData,byte const *lbmpalette)
{
	short		*dest_p;
	NXImageRep *image_i;
	id			fastImage_i;
	unsigned short	shortpal[256];
	unsigned		i;

	//
	// make an NXimage to hold the data
	//
	image_i = [[NXBitmapImageRep alloc]
		initData:			NULL 
		pixelsWide:		64 
		pixelsHigh:		64
		bitsPerSample:	4
		samplesPerPixel:	3 
		hasAlpha:		NO
		isPlanar:			NO 
		colorSpace:		NX_RGBColorSpace 
		bytesPerRow:		128
		bitsPerPixel: 		16
	];

	if (!image_i)
		return nil;
				
	//
	// translate the picture
	//
	LBMpaletteTo16 (lbmpalette, shortpal);
	 (unsigned char *)dest_p =[(NXBitmapImageRep *)image_i data];
	memset(dest_p,0,64 * 64 * sizeof(short));
	
	for (i = 0;i < 64*64; i++)
		*(dest_p++) = shortpal[*(planeData++)];

	fastImage_i = [[NXImage	alloc]
							init];
	[fastImage_i	useRepresentation:(NXImageRep *)image_i];	
	return fastImage_i;
}
                                                                                                                                                                                                                                                                                                                             #import "wadfiles.h"
#import "PatchPalette.h"
#import "PlanePalette.h"
#import "PlaneWindow.h"
#import "PlanePalView.h"

@implementation PlaneWindow

- (int)currentViewSelection
{
	return [planeDocView_i	currentViewSelection];
}

- init
{
	NXRect	contentframe,docframe;
	NXPoint	startPoint;

	//
	// initialize the window
	//
	NXSetRect(&contentframe,
			PLANEWINDOWX,
			PLANEWINDOWY,
			PLANEWINDOWWIDTH,
			PLANEWINDOWHEIGHT);

	[self
		initContent:		&contentframe
		style:			NX_RESIZEBARSTYLE
		backing:			NX_BUFFERED
		buttonMask:		NX_CLOSEBUTTONMASK | NX_MINIATURIZEBUTTONMASK
		defer:			NO
	];
	
	//
	// set delegate so I can trap "windowDidResize" messages
	//
	[self	setDelegate:self];
	[self setTitle: "Plane Palette"];
	
	//
	// setup scrollview
	//
	[[self		contentView]	getFrame:&contentframe];
	planeScrollView_i = [[[ScrollView	alloc]
					initFrame:	&contentframe]
					setVertScrollerRequired: YES];

	//
	// setup docview that's in the scrollview	
	//
	NXSetRect(&curWindowRect,0,0,0,0);
	[planeScrollView_i		getContentSize:&curWindowRect.size];
	[ self		computePlaneDocView:&docframe];
	//
	// if only a couple planes, don't make window default size
	//
	if (curWindowRect.size.height > docframe.size.height)
	{
		curWindowRect.size.height = docframe.size.height;
		[self	sizeWindow:curWindowRect.size.width :curWindowRect.size.height];
	}

	planeDocView_i	=
			[[PlanePaletteView	alloc]
				initFrame:	&docframe];
	[planeScrollView_i		setDocView:planeDocView_i];
	//
	// start plane palette at top of docview
	//
	startPoint = docframe.origin;
	startPoint.y = docframe.size.height - curWindowRect.size.height;
	[planeDocView_i		scrollPoint:&startPoint];
	
	[self		setContentView:planeScrollView_i];
	[self display];

	return self;
}

- (BOOL)canBecomeMainWindow
{
	return NO;
}

//
// compute the size of the docView and set the origin of all the patches
// within the docView.
//
- computePlaneDocView: (NXRect *)theframe
{
	int	x, y, planenum, maxheight;
	apatch_t		*plane;
	
	x = y =  SPACING;
	maxheight = planenum = 0;
	while ((plane = [planePalette_i getPlane:planenum++]) != NULL)
	{
		if (x + plane->r.size.width > curWindowRect.size.width && x != SPACING)
		{
			x = SPACING;
			y += maxheight + SPACING;
			maxheight = 0;
		}
		
		plane->r.origin.x = x;
		plane->r.origin.y = y;
		
		if (plane->r.size.height > maxheight)
			maxheight = plane->r.size.height;

		if (x + plane->r.size.width > curWindowRect.size.width && x == SPACING)
		{
			y += maxheight + SPACING;
			maxheight = 0;
		}			
		else
			x += plane->r.size.width + SPACING;
	}
	y += maxheight + SPACING;
	NXSetRect(theframe,0,0,curWindowRect.size.width + SPACING,y);
	
	//
	// now go through all the patches and reassign the coords so they
	// stack from top to bottom...
	//
	maxheight = planenum = 0;
	x = theframe->origin.x + SPACING;
	y = theframe->origin.y + theframe->size.height - SPACING;
	while ((plane = [planePalette_i	getPlane:planenum++]) != NULL)
	{
		if (x + plane->r.size.width > curWindowRect.size.width && x != SPACING)
		{
			x = SPACING;
			y -= maxheight + SPACING;
			maxheight = 0;
		}
		
		plane->r.origin.x = x;
		plane->r.origin.y = y - plane->r.size.height;

		if (plane->r.size.height > maxheight)
			maxheight = plane->r.size.height;

		if (x + plane->r.size.width > curWindowRect.size.width && x == SPACING)
		{
			y -= maxheight + SPACING;
			maxheight = 0;
		}			
		else
			x += plane->r.size.width + SPACING;
	}	

	return self;
}

- windowDidResize:sender
{
	NXRect	theFrame;
	
	NXSetRect(&curWindowRect,0,0,0,0);
	[planeScrollView_i		getContentSize:&curWindowRect.size];
	[self		computePlaneDocView:&theFrame];
	[planeDocView_i	sizeTo:theFrame.size.width :theFrame.size.height];

	return self;
}


@end
                                                                                                                                                                                                                                                                                                                                                                             #import <appkit/appkit.h>

@interface PopScrollView : ScrollView
{
	id	button1, button2;
}

- initFrame:(const NXRect *)frameRect button1: b1 button2: b2;
- tile;

@end                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ClassMethod __objc_copyIvarList __objc_createMethodList .objc_category_name_StoreHeap__startRegion .objc_class_name_StoreHeap .objc_class_name_StoreMapping __libIndexing_NXCreateChildZone __libIndexing_malloc_size __libIndexing_vm_deallocate .file_definition_libIndexing_s.A.shlib_StoreMapping.o .file_definition_libIndexing_s.A.shlib_StoreHeap.o .objc_category_name_StoreMapping_SubclassPrivate __libIndexing_NXReadArray __libIndexing_NXWriteArray __libIndexing__longjmp __libIndexing_vm_allocate _IXBMCompile _IXBMMatch _IXRegexMatch _IXRegexMatchExactly __libIndexing_NXResetHashTable __libIndexing_re_compile .file_definition_libIndexing_s.A.shlib_AttributeQueryGrammar.o .file_definition_libIndexing_s.A.shlib_IXRegexSearch.o .file_definition_libIndexing_s.A.shlib_IXBoyerMoore.o __libIndexing_NXReadObjectFromBuffer __btreePostOrderWalk _IXCompareBytes _IXCompareDoubles _IXCompareFloats _IXCompareLongs _IXCompareShorts _IXCompareUnsignedAndStrings _IXCompareUnsignedBytes _IXCompareUnsignedShorts .objc_class_name_IXEnglishReader .file_definition_libIndexing_s.A.shlib_IXEnglishReader.o _IXBMMatchPrefix _IXFileDescriptionPboardType _IXFilenameToRegex __libIndexing_NXIsGraph __libIndexing_NXIsPrint __libIndexing_NXIsPunct __libIndexing_NXIsSpace __libIndexing_NXUniqueString __libIndexing_NXUniqueStringNoCopy __libIndexing_close __libIndexing_getenv __libIndexing_lseek __libIndexing_map_fd __libIndexing_open __libIndexing_port_allocate __libIndexing_port_deallocate __libIndexing_NXGetDefaultValue __libIndexing_NXHashGet __libIndexing_NXStrStructKeyPrototype __libIndexing_access __libIndexing_closedir __libIndexing_opendir __libIndexing_readdir __libIndexing_NXWriteObjectReference _IXStorePboardType __libIndexing_NXToUpper __libIndexing_gettimeofday __libIndexing_strerror .file_definition_libIndexing_s.A.shlib_StoreGlobals.o .objc_class_name_IXStoreBlock .objc_class_name_StoreFileMapping __libIndexing_errno __libIndexing_fcntl __libIndexing_unlink .file_definition_libIndexing_s.A.shlib_StoreFileMapping.o __libIndexing_sqrt __libIndexing_fsync __libIndexing_ftruncate __libIndexing_mktemp __libIndexing_mmap __libIndexing_vm_synchronize _IXAccessTimeAttribute _IXBaseNameAttribute _IXChangeTimeAttribute _IXContentAttribute _IXDefaultAttribute _IXFileDeviceAttribute _IXFileGroupAttribute _IXFileInodeAttribute _IXFileLinksAttribute _IXFileModeAttribute _IXFileNameAttribute _IXFileOwnerAttribute _IXFileSizeAttribute _IXFileTypeAttribute _IXModifyTimeAttribute _IXUnixTypeAttribute __indexing_data_pad _IXControlCharFromToken _IXInitRichText _IXReadRichTextJ _IXTokenFromControlChar _IXTokenFromControlWord __libIndexing_NXUngetc __libIndexing_NXClose __libIndexing_NXFlush __libIndexing_NXIsAlpha __libIndexing_NXIsAscii __libIndexing_NXIsLower __libIndexing_NXIsUpper __libIndexing_NXIsXDigit __libIndexing_NXNoEffectFree __libIndexing_NXPtrHash __libIndexing_NXPtrIsEqual __libIndexing_NXReadDefault __libIndexing_NXToLower __libIndexing__NXToUpper __libIndexing__fixdfsi __libIndexing__fixunsdfsi __libIndexing__iob __libIndexing_abort __libIndexing_bcmp __libIndexing_bcopy __libIndexing_chdir __libIndexing_cthread_detach __libIndexing_cthread_name __libIndexing_flock __libIndexing_fprintf __libIndexing_getsectdata __libIndexing_getwd __libIndexing_lstat __libIndexing_objc_getMetaClass __libIndexing_objc_msgSendSuper __libIndexing_objc_msgSendv __libIndexing_object_copyFromZone __libIndexing_pointers_pad __libIndexing_qsort __libIndexing_re_match __libIndexing_readlink __libIndexing_realloc __libIndexing_rmdir __libIndexing_sscanf __libIndexing_vm_protect __libIndexing_vm_region _vm_synchronize _vm_region _ur_cthread_self _re_match _re_compile _object_getInstanceVariable _object_dispose _object_copyFromZone _objc_setClassHandler _objc_getClasses _objc_addClass _mmap _mktemp _cthread_priority _cthread_join _class_getInstanceVariable _class_getClassMethod _class_createInstanceFromZone _bcmp __NXToUpper __NXToLower _NXStrStructKeyPrototype _NXResetHashTable _NXPtrPrototype _NXIsUpper _NXIsPunct _NXIsPrint _NXIsGraph _NXIsAscii _NXIsAlNum _NXGetTypedStreamZone _IXCompareMonocaseStrings _IXCompareDouble _IXCompareFloat _IXCompareLong _IXCompareShort _IXCompareUnsignedShort __objc_getMetaClassVersion __objc_getMethodListEntry __objc_setMethodListEntry _IXRemovePath _IXBMCompileJ _IXBMMatchExactly _IXBMMatchExactlyJ _IXBMMatchJ _IXBMMatchPrefixJ _IXBMMatchWord _IXBMMatchWordJ _IXRegexCompileJ _IXRegexMatchExactlyJ _IXRegexMatchJ _IXRegexMatchPrefix _IXRegexMatchPrefixJ _IXRegexMatchWord _IXRegexMatchWordJ __store_data_pad .objc_category_name_List_Transport .objc_category_name_Object_GetListOfProtocols .objc_category_name_Object_Object_MakeRemote_Import .objc_category_name_Object_Object_NXMethodSignature .objc_category_name_Object_isRemote .objc_category_name_Protocol_Transport .objc_class_name_NXMethodSignature .objc_class_name_NXProxy .objc_class_name_NXInvalidationNotifier .objc_class_name_NXLock __libsys_NXDefaultMallocZone __libsys__setjmp __libsys_free __cthread_detach __cthread_exit __cthread_fork __objc_msgSend .file_definition_libsys_s.B.shlib_LogFunctions.o .file_definition_libsys_s.B.shlib_objc-sel.o .file_definition_libsys_s.B.shlib_objc-msg.o .file_definition_libsys_s.B.shlib_objc-runtime.o .file_definition_libsys_s.B.shlib_objc-class.o .file_definition_libsys_s.B.shlib_cthreads.o .file_definition_libsys_s.B.shlib_pointers.o .file_definition_libsys_s.B.shlib_except.o .file_definition_libsys_s.B.shlib_objc-globaltext.o .file_definition_libsys_s.B.shlib_hashtable.o .file_definition_libsys_s.B.shlib_maptable.o .file_definition_libsys_s.B.shlib_Protocol.o .file_definition_libsys_s.B.shlib_Object.o .file_definition_libsys_s.B.shlib_NXPortPortal.o .file_definition_libsys_s.B.shlib_NXLock.o .file_definition_libsys_s.B.shlib_NXInvalidationNotifier.o .file_definition_libsys_s.B.shlib_List.o .file_definition_libsys_s.B.shlib_NXProxy.o .shared_library_information_libsys_s.B.shlib .objc_category_name_NXBundle_Compatability .objc_category_name_NXBundle_Private _NXLoadLocalizedStringFromTableInBundle __NXGetDefaultValue __libsys_NXArgv __libsys_malloc __libsys_realloc __access _objc_loadModules .file_definition_libsys_s.B.shlib_objc-errors.o .file_definition_libsys_s.B.shlib_strrchr.o .file_definition_libsys_s.B.shlib_strncpy.o .file_definition_libsys_s.B.shlib_strncmp.o .file_definition_libsys_s.B.shlib_strcpy.o .file_definition_libsys_s.B.shlib_strcmp.o .file_definition_libsys_s.B.shlib_strchr.o .file_definition_libsys_s.B.shlib_strcat.o .file_definition_libsys_s.B.shlib_stat.o .file_definition_libsys_s.B.shlib_sprintf.o .file_definition_libsys_s.B.shlib_readlink.o .file_definition_libsys_s.B.shlib_readdir.o .file_definition_libsys_s.B.shlib_opendir.o .file_definition_libsys_s.B.shlib_objc-load.o .file_definition_libsys_s.B.shlib_getwd.o .file_definition_libsys_s.B.shlib_fopen.o .file_definition_libsys_s.B.shlib_fgets.o .file_definition_libsys_s.B.shlib_flsbuf.o .file_definition_libsys_s.B.shlib_closedir.o .file_definition_libsys_s.B.shlib_atoi.o .file_definition_libsys_s.B.shlib_access.o .file_definition_libsys_s.B.shlib_streams.o .file_definition_libsys_s.B.shlib_defaults.o .file_definition_libsys_s.B.shlib_memory_funcs.o .file_definition_libsys_s.B.shlib_NXStringTable.o .file_definition_libsys_s.B.shlib_HashTable.o .file_definition_libsys_s.B.shlib_NXBundle.o .objc_category_name_NXCleanList_Fancy_IO .objc_category_name_NXMutableString_NX_BS_Extras .objc_category_name_NXPropertyList_Basic_IO .objc_category_name_NXPropertyList_Fancy_IO .objc_category_name_NXReadOnlyString_Fancy_IO .objc_category_name_NXString_Fancy_IO .objc_category_name_Object_Fancy_IO .objc_category_name_Object_NX_BS_Extras __copy .objc_class_name_NXMutableString .objc_class_name_NXReadWriteString .file_definition_libsys_s.B.shlib_rename.o .file_definition_libsys_s.B.shlib_printf.o .file_definition_libsys_s.B.shlib_ctype_.o .file_definition_libsys_s.B.shlib_streams_internal.o .file_definition_libsys_s.B.shlib_NXString.o .file_definition_libsys_s.B.shlib_NXSimpleReadOnlyString.o .file_definition_libsys_s.B.shlib_NXReadWriteString.o .file_definition_libsys_s.B.shlib_NXReadOnlyString.o .file_definition_l#import "PopScrollView.h"

@implementation PopScrollView

/*
====================
=
= initFrame: button:
=
= Initizes a scroll view with a button at it's lower right corner
=
====================
*/

- initFrame:(const NXRect *)frameRect button1:b1 button2:b2
{
	[super  initFrame: frameRect];	
	[self addSubview: b1];
	[self addSubview: b2];

	button1 = b1;
	button2 = b2;

	[self setHorizScrollerRequired: YES];
	[self setVertScrollerRequired: YES];
		
	return self;
}


/*
================
=
= tile
=
= Adjust the size for the pop up scale menu
=
=================
*/

- tile
{
	NXRect	scrollerframe;
	NXRect	buttonframe, buttonframe2;
	NXRect	newframe;
	
	[super tile];
	[button1 getFrame: &buttonframe];
	[button2 getFrame: &buttonframe2];
	[hScroller getFrame: &scrollerframe];

	newframe.origin.y = scrollerframe.origin.y;
	newframe.origin.x = frame.size.width - buttonframe.size.width;
	newframe.size.width = buttonframe.size.width;
	newframe.size.height = scrollerframe.size.height;
	scrollerframe.size.width -= newframe.size.width;
	[button1 setFrame: &newframe];
	newframe.size.width = buttonframe2.size.width;
	newframe.origin.x -= newframe.size.width;
	[button2 setFrame: &newframe];
	scrollerframe.size.width -= newframe.size.width;

	[hScroller setFrame: &scrollerframe];

	return self;
}


@end

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
#import <appkit/appkit.h>

extern	id	prefpanel_i;

#define	APPDEFAULTS	"ID_doomed"
#define NUMCOLORS	9

typedef enum
{
	BACK_C = 0,
	GRID_C,
	TILE_C,
	SELECTED_C,
	POINT_C,
	ONESIDED_C,
	TWOSIDED_C,
	AREA_C,
	THING_C
} ucolor_e;

@interface PreferencePanel:Object
{
    id	backcolor_i;
    id	gridcolor_i;
    id	tilecolor_i;
    id	selectedcolor_i;
    id	pointcolor_i;
    id	onesidedcolor_i;
    id	twosidedcolor_i;
    id	areacolor_i;
    id thingcolor_i;
	
    id	window_i;
	
	id	colorwell[NUMCOLORS];
	NXColor	color[NUMCOLORS];
}

- menuTarget:sender;
- colorChanged:sender;

- appWillTerminate: sender;

- (NXColor)colorFor: (int)ucolor;

@end
                                                                                                                                                                                                                                                                                                                                                                                    
#import "PreferencePanel.h"
#import "MapWindow.h"

id	prefpanel_i;

char		*ucolornames[NUMCOLORS] =
{
	"back_c",
	"grid_c",
	"tile_c",
	"selected_c",
	"point_c",
	"onesided_c",
	"twosided_c",
	"area_c",
	"thing_c",
};
	
@implementation PreferencePanel

+ initialize
{
	static NXDefaultsVector defaults = 
	{
		{"back_c","1:1:1"},
		{"grid_c","0.8:0.8:0.8"},
		{"tile_c","0.5:0.5:0.5"},
		{"selected_c","1:0:0"},

		{"point_c","0:0:0"},
		{"onesided_c","0:0:0"},
		{"twosided_c","0.5:1:0.5"},
		{"area_c","1:0:0"},
		{"thing_c","1:1:0"},
		{NULL}
	};

	NXRegisterDefaults(APPDEFAULTS, defaults);

	return self;
}

- getColor: (NXColor *)clr fromString: (char const *)string
{
	float	r,g,b;
	
	sscanf (string,"%f:%f:%f",&r,&g,&b);
	*clr = NXConvertRGBToColor(r,g,b);
	return self;
}

- getString: (char *)string fromColor: (NXColor *)clr
{
	char		temp[40];
	float	r,g,b;
	
	r = NXRedComponent(*clr);
	g = NXGreenComponent(*clr);
	b = NXBlueComponent(*clr);
	
	sprintf (temp,"%1.2f:%1.2f:%1.2f",r,g,b);
	strcpy (string, temp);
	
	return self;
}

/*
=====================
=
= init
=
=====================
*/

- init
{
	int	i;
	
	prefpanel_i = self;
	window_i = NULL;		// until nib is loaded
	
	for (i=0 ; i<NUMCOLORS ; i++)
		[self getColor: &color[i] fromString: NXGetDefaultValue(APPDEFAULTS, ucolornames[i])];
	
	return self;
}


/*
=====================
=
= appWillTerminate:
=
=====================
*/

- appWillTerminate:sender
{
	int		i;
	char	string[40];
	
	for (i=0 ; i<NUMCOLORS ; i++)
	{
		[self getString: string  fromColor:&color[i]];
		NXWriteDefault(APPDEFAULTS, ucolornames[i], string);
	}
		
	return self;	
}


/*
==============
=
= menuTarget:
=
==============
*/

- menuTarget:sender
{
	int		i;
	
	if (!window_i)
	{
		[NXApp 
			loadNibSection:	"preferences.nib"
			owner:			self
			withNames:		NO
		];
		
		colorwell[0] = backcolor_i;
		colorwell[1] = gridcolor_i;
		colorwell[2] = tilecolor_i;
		colorwell[3] = selectedcolor_i;
		colorwell[4] = pointcolor_i;
		colorwell[5] = onesidedcolor_i;
		colorwell[6] = twosidedcolor_i;
		colorwell[7] = areacolor_i;
		colorwell[8] = thingcolor_i;

		for (i=0 ; i<NUMCOLORS ; i++)
			[colorwell[i] setColor: color[i]];
	}

	[window_i orderFront:self];

	return self;
}

/*
==============
=
= colorChnaged:
=
==============
*/

- colorChanged:sender
{
	int	i;
	id	list, win;
	
// get current colors

	for (i=0 ; i<NUMCOLORS ; i++)
		color[i] = [colorwell[i] color];

// update all windows
	list = [NXApp windowList];
	i = [list count];
	while (--i >= 0)
	{
		win = [list objectAt: i];
		if ([win class] == [MapWindow class])
			[[win mapView] display];
	}
	
	return self;
}

- (NXColor)colorFor: (int)ucolor
{
	return color[ucolor];
}

@end
                                                                                                                                                                                                                                                                                                                                                                                      
#import <appkit/appkit.h>

@interface SectorEditView:View
{
	id	f_height_i;
	id	c_height_i;
}


@end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          #import	"SectorEditor.h"
#import <appkit/appkit.h>

extern	id	sectorPalette_i;

@interface SectorPalette:Object
{
	id	window_i;
	id	sectorScrPalView_i;
	id	sectorPalView_i;
	
	id	cellTitle_i;
	id	cellLight_i;
	id	cellSpecial_i;
	id	cellFheight_i;
	id	cellCheight_i;
	
	int	currentSector;
	id	sectors;
	sector_t	oldsector;
}

- menuTarget:sender;

- updateInfo;
- buildSectors;
- createSector;
- saveSector;
- setCurrentSector:(int) what;
- (int) getCurrentSector;
- (int) getNumSectors;
- (sector_t *) getSector:(int) which;

- computeSectorDocView;

@end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ibsys_s.B.shlib_NXMutableString.o .file_definition_libsys_s.B.shlib_NXConstantString.o .file_definition_libsys_s.B.shlib_NXPropertyList.o __libsys_NXZoneCalloc __libsys_exit .file_definition_libsys_s.B.shlib_memmove.o .file_definition_libsys_s.B.shlib_typedstream.o .file_definition_libsys_s.B.shlib_indir_ops.o .objc_class_name_NXCharacterSet .file_definition_libsys_s.B.shlib_NXCharacterSet.o .objc_class_name_NXConditionLock .objc_class_name_NXRecursiveLock .objc_class_name_NXSpinLock __cond_broadcast __cond_signal __condition_wait __mutex_try_lock __mutex_wait_lock __spin_lock __ur_cthread_self .file_definition_libsys_s.B.shlib_thread.o .file_definition_libsys_s.B.shlib_cthreads_sync.o .file_definition_libsys_s.B.shlib_lock.o .file_definition_libsys_s.B.shlib_cprocs.o __libsys_NXZoneFromPtr __task_self_ __vm_allocate __vm_copy __vm_deallocate __vm_page_size .file_definition_libsys_s.B.shlib_mach_u.o .file_definition_libsys_s.B.shlib_mach_data.o .file_definition_libsys_s.B.shlib_bcopy.o .file_definition_libsys_s.B.shlib_NXData.o .objc_class_name_NXNetNameServer __name_server_port .file_definition_libsys_s.B.shlib_netname_u.o .file_definition_libsys_s.B.shlib_NXPort.o .file_definition_libsys_s.B.shlib_NXNetNameServer.o __msg_receive __port_allocate __port_deallocate __port_set_backlog __task_set_special_port .file_definition_libsys_s.B.shlib_msg.o __mach_error_string __msg_rpc __msg_send .file_definition_libsys_s.B.shlib_memset.o .file_definition_libsys_s.B.shlib_mach_error.o .objc_class_name_NXProtocolChecker .file_definition_libsys_s.B.shlib_NXProtocolChecker.o .objc_class_name_NXReadOnlySubstring __NXStringZone .file_definition_libsys_s.B.shlib_NXReadOnlySubstring.o _NXCompareCharacters _NXFindCharacters _NXHashCharacters _NXRegisterPrintfProc .file_definition_libsys_s.B.shlib_fprintf.o .file_definition_libsys_s.B.shlib_iob.o .file_definition_libsys_s.B.shlib_streams_doprnt.o .objc_class_name_NXUniquedString .file_definition_libsys_s.B.shlib_NXUniquedString.o _object_copy _object_realloc _object_reallocFromZone __dealloc __poseAs __realloc __zoneCopy __zoneRealloc .file_definition_libsys_s.B.shlib_objc-globaldata.o _getmachheaders .file_definition_libsys_s.B.shlib_getsecbyname.o .file_definition_libsys_s.B.shlib_getmachhead.o .file_definition_libsys_s.B.shlib_Storage.o .objc_class_name_StreamTable .file_definition_libsys_s.B.shlib_StreamTable.o .file_definition_libsys_s.B.shlib_errno.o __atexit __cleanup __exit .file_definition_libsys_s.B.shlib__exit.o .file_definition_libsys_s.B.shlib_findiop.o .file_definition_libsys_s.B.shlib_atexit.o .file_definition_libsys_s.B.shlib_exit.o __NXAddRegion __NXCreateChildZone __NXCreateZone __NXDefaultMallocZone __NXMallocCheck __NXMergeZone __NXNameZone __NXRemoveRegion __NXZoneCalloc __NXZoneFromPtr __NXZonePtrInfo __NXMallocDumpFrees __NXMallocDumpZones __malloc_fork_child __malloc_fork_parent __malloc_fork_prepare __malloc_debug __malloc_error __malloc_freezedry __malloc_good_size __malloc_jumpstart __malloc_singlethreaded __malloc_size __mstats __valloc __vfree __write .file_definition_libsys_s.B.shlib_write.o .file_definition_libsys_s.B.shlib_abort.o .file_definition_libsys_s.B.shlib_malloc.o .file_definition_libsys_s.B.shlib_sqrt.o __doprnt .file_definition_libsys_s.B.shlib_doprnt.o cerror .file_definition_libsys_s.B.shlib_cerror.o .file_definition_libsys_s.B.shlib_chdir.o .file_definition_libsys_s.B.shlib_chmod.o __close .file_definition_libsys_s.B.shlib_fchmod.o __fstat __isatty .file_definition_libsys_s.B.shlib_isatty.o .file_definition_libsys_s.B.shlib_fstat.o .file_definition_libsys_s.B.shlib_close.o __findiop __getdtablesize __lseek .file_definition_libsys_s.B.shlib_lseek.o .file_definition_libsys_s.B.shlib_getdtablesize.o .file_definition_libsys_s.B.shlib_fdopen.o .file_definition_libsys_s.B.shlib_flock.o __open .file_definition_libsys_s.B.shlib_open.o __doscan .file_definition_libsys_s.B.shlib_doscan.o .file_definition_libsys_s.B.shlib_scanf.o .file_definition_libsys_s.B.shlib_memcpy.o .file_definition_libsys_s.B.shlib_fwrite.o .file_definition_libsys_s.B.shlib_strcasecmp.o __execl __vfork __wait .file_definition_libsys_s.B.shlib_wait.o .file_definition_libsys_s.B.shlib_fork.o .file_definition_libsys_s.B.shlib_signal.o .file_definition_libsys_s.B.shlib_execl.o .file_definition_libsys_s.B.shlib_system.o .file_definition_libsys_s.B.shlib_unlink.o .file_definition_libsys_s.B.shlib_vsprintf.o _moninitobjc .file_definition_libsys_s.B.shlib_objc-moninit.o _NXStreamDestroy _NXVScanf .file_definition_libsys_s.B.shlib_streams_doscan.o _NXChangeBuffer _getsectbynamefromheaderwithswap _host_info __host_self __map_fd _swap_fat_arch _swap_fat_header _swap_mach_header .file_definition_libsys_s.B.shlib_swap.o .file_definition_libsys_s.B.shlib_mach_traps.o .file_definition_libsys_s.B.shlib_mach_host_u.o .file_definition_libsys_s.B.shlib_ftruncate.o .file_definition_libsys_s.B.shlib_fsync.o .file_definition_libsys_s.B.shlib_floor.o __NXRegisterDefaults __libsys_NXArgc __bzero __gettimeofday _setregid _setreuid .file_definition_libsys_s.B.shlib_syslog.o .file_definition_libsys_s.B.shlib_strtok.o .file_definition_libsys_s.B.shlib_setreuid.o .file_definition_libsys_s.B.shlib_setregid.o .file_definition_libsys_s.B.shlib_mkdir.o .file_definition_libsys_s.B.shlib_getuid.o .file_definition_libsys_s.B.shlib_gettimeofday.o .file_definition_libsys_s.B.shlib_getent_pw.o .file_definition_libsys_s.B.shlib_getgid.o .file_definition_libsys_s.B.shlib_geteuid.o .file_definition_libsys_s.B.shlib_getenv.o .file_definition_libsys_s.B.shlib_getegid.o .file_definition_libsys_s.B.shlib_fputc.o .file_definition_libsys_s.B.shlib_dbLock.o .file_definition_libsys_s.B.shlib_dbExists.o .file_definition_libsys_s.B.shlib_dbInit.o .file_definition_libsys_s.B.shlib_db.o .file_definition_libsys_s.B.shlib_chown.o .file_definition_libsys_s.B.shlib_bzero.o .file_definition_libsys_s.B.shlib_filbuf.o .file_definition_libsys_s.B.shlib_fseek.o _NXFill __getrusage __read _NXDefaultExceptionRaiser _NXGetExceptionRaiser _NXSetExceptionRaiser __libsys__longjmp __libsys_calloc .file_definition_libsys_s.B.shlib_globals.o .file_definition_libsys_s.B.shlib_link.o .file_definition_libsys_s.B.shlib__setjmp.o __sys_errlist __sys_nerr .file_definition_libsys_s.B.shlib_errlst.o .file_definition_libsys_s.B.shlib_strerror.o .file_definition_libsys_s.B.shlib__eprintf.o _moncount .file_definition_libsys_s.B.shlib_gmon.o .file_definition_libsys_s.B.shlib_mcount.o _NXTypedStreamIsSwapped __libsys_NXCreateZone _xdr_bool _xdr_char _xdr_free _xdr_long _xdr_netobj _xdr_opaque _xdr_short _xdr_u_char _xdr_u_long _xdr_u_short _xdr_union _xdr_wrapstring .file_definition_libsys_s.B.shlib_xdr.o _xdr_reference .file_definition_libsys_s.B.shlib_xdr_reference.o _xdr_double .file_definition_libsys_s.B.shlib_xdr_float.o .file_definition_libsys_s.B.shlib_ungetc.o __getpid .file_definition_libsys_s.B.shlib_getpid.o .file_definition_libsys_s.B.shlib_tmpnam.o .file_definition_libsys_s.B.shlib_time.o __task_get_special_port _svcudp_bufcreate _svcudp_enablecache _bindresvport _recvfrom _sendto _xdr_callmsg _xdr_replymsg _xdrmem_create _xprt_register _xprt_unregister .file_definition_libsys_s.B.shlib_svc.o .file_definition_libsys_s.B.shlib_xdr_mem.o .file_definition_libsys_s.B.shlib_rpc_prot.o .file_definition_libsys_s.B.shlib_rpc_callmsg.o .file_definition_libsys_s.B.shlib_socket.o .file_definition_libsys_s.B.shlib_sendto.o .file_definition_libsys_s.B.shlib_recvfrom.o .file_definition_libsys_s.B.shlib_getsockname.o .file_definition_libsys_s.B.shlib_bindresvport.o .file_definition_libsys_s.B.shlib_bind.o .file_definition_libsys_s.B.shlib_svc_udp.o _svc_getreq _svcerr_auth _svcerr_decode _svcerr_noproc _ldexp _svcerr_noprog _svcerr_progvers _svcerr_systemerr _svcerr_weakauth __authenticate __rpc_dtablesize .file_definition_libsys_s.B.shlib_rpc_comdata.o .file_definition_libsys_s.B.shlib_pmap_clnt.o .file_definition_libsys_s.B.shlib_rpc_dtablesz.o .file_definition_libsys_s.B.shlib_svc_auth.o __null_auth _rpc_createerr .file_definition_libsys_s.B.shlib_ldexp.o .file_definition_libsys_s.B.shlib_strtod.o .file_definition_libsys_s.B.shlib_strncat.o .file_definition_libsys_s.B.shlib_strlen// R_mapdef.h
// included by R_local.h in doom and by WorldServer.m in the WorldServer

// in the map file, all pointers are offsets from the start of file

#ifndef __FRAC__
#define __FRAC__
#define	FRACBITS		16
#define	FRACUNIT		(1<<FRACBITS)
// A fixed_t has 16 bits of unit and 16 bits of fraction
typedef int	fixed_t;
#endif

#ifndef __BYTEBOOL__
#define __BYTEBOOL__
typedef unsigned char byte;
typedef enum {false, true} boolean;
#endif

// A mapvertex_t is a global map point
typedef struct
{
	short	x,y;
} mapvertex_t;

// A mapthing_t is a point and some information from the map editor.  These are only processed
// at map loading time, where they spawn visible thing_ts or other game objects
typedef struct
{
	mapvertex_t	origin;
	short	angle;
	short	type;
	short	options;
	short	sector;		// the sector it should be placed in at the start
} mapthing_t;

// mappatch_t orients a patch inside a maptexturedef_t
typedef struct
{
	short	originx;		// block origin (allways UL), which has allready accounted
	short	originy;		// for the patch's internal origin
	short	patch;
	short	stepdir;		// allow flipping of the texture DEBUG: make this a char?
	short	colormap;
} mappatch_t;

// a maptexturedef_t describes a rectangular texture, which is composed of one or
// more mappatch_t structures that arrange graphic patches
typedef struct
{
	boolean	masked;				// if not masked, the patch's post_ts need to be combined
	short	width;
	short	height;
	void		**collumndirectory;		// [width] pointers to collumn_ts to draw the texture
	short	patchcount;
	mappatch_t	patches[1];		// [patchcount] drawn back to front into the cached texture
} maptexture_t;

// A mapends_t defines what to draw on the floor and ceiling of an open area, as well as the
// light level for all sprites and walls in the open area
typedef struct
{
	short		floorheight, ceilingheight;
	short		floortexture, ceilingtexture;
	short		lightlevel;		// base light level
	short		special;			// to allow things to happen on a given floor section
	short		linecount;
	short		lines[1];			// [linecount] size
} mapsector_t;


// The entire world is defined by maplines with various attributes.
typedef struct
{
	short	flags;	
	short	sector;					// on the viewer's side
	short	firstcollumn;				// first collumn for all textures
	short	midtexture;				// -1 = no texture
	short	midheight;				// height of the top of midtexture (increasing upwards)
	short	toptexture;				// texture to fill gaps between ceiling planes
	short	bottomtexture;				// texture to fill gaps between floor planes
} mapside_t;

// if the line is not two sided, the midtexture must cover the entire space

typedef struct
{
	short		p1, p2;				// point numbers
	short		flags;
	short		length;				// texture collumns
	mapside_t	side[2];
} mapline_t;


#define	ML_PLAYERBLOCK		1
#define	ML_MONSTERBLOCK		2
#define	ML_TWOSIDED			4	// backside will not be present at all if not two sided

#define	ML_SPECIALSHIFT		8	// the high 8 bits is the special number
#define	ML_SPECIALMASK		0xff00

                                                             #import	"DoomProject.h"
#import	"SectorEditor.h"
#import	"SectorPalette.h"
#import "SectorEditView.h"

@implementation SectorEditView

- drawSelf:(const NXRect *)rects :(int)rectCount
{
	sector_t	*s;
	flat_t	*f;
	int	cs;
	NXRect	r;
	NXPoint	p;
	
	cs = [sectorPalette_i	getCurrentSector];
	if (cs < 0)
		return self;
	s = [sectorPalette_i		getSector:cs];
		
	PSsetgray(NX_LTGRAY);
	NXSetRect(&r,0,0,128,200);
	NXRectFill(&r);
	//
	// Draw limit lines
	//
	NXSetColor(NXConvertRGBToColor(1,0,0));
	PSmoveto(0,50);
	PSlineto(127,50);
	PSmoveto(0,150);
	PSlineto(127,150);

	//
	// Draw ceiling
	//
	if (!s->w.s.ceilingflat[0])
	{
		NXSetRect(&r,32,s->w.s.ceilingheight/2 + 50,64,64);
		NXRectFill(&r);
	}
	else
	{
		f = [sectorEdit_i	getFlat:s->ceiling_flat];
		p.x = 32;
		p.y = s->w.s.ceilingheight/2 + 50;
		[f->image	composite:NX_COPY	toPoint:&p];
	}
	
	//
	// Draw floor
	//
	if (!s->w.s.floorflat[0])
	{
		NXSetRect(&r,32,s->w.s.floorheight/2 - 14,64,64);
		NXRectFill(&r);
	}
	else
	{
		f = [sectorEdit_i	getFlat:s->floor_flat];
		p.x = 32;
		p.y = s->w.s.floorheight/2 - 14;
		[f->image	composite:NX_COPY	toPoint:&p];
	}

	PSstroke();

	return self;
}

- mouseDown:(NXEvent *)theEvent
{
	NXPoint	loc;
	int	oldwindowmask, cs, ny, yoff;
	sector_t	*s;
	NXEvent	*event;
	NXRect	r;

	oldwindowmask = [window addToEventMask:NX_LMOUSEDRAGGEDMASK];
	loc = theEvent->location;
	[self convertPoint:&loc	fromView:NULL];
	
	cs = [sectorPalette_i	getCurrentSector];
	if (cs < 0)
		return self;
	s = [sectorPalette_i		getSector:cs];
	r.origin.x = 32;
	r.size.height = r.size.width = 64;
	
	//
	// Check ceiling
	//
	r.origin.y = s->w.s.ceilingheight/2 + 50;
	if (NXPointInRect(&loc,&r) == YES)
	{
		[sectorEdit_i	selectCeiling];
		yoff = loc.y - r.origin.y;
		do
		{
			event = [NXApp getNextEvent: 	NX_MOUSEUPMASK |
										NX_MOUSEDRAGGEDMASK];
			loc = event->location;
			[self convertPoint:&loc	fromView:NULL];
			ny = (2 * (loc.y - yoff)) - 100;
			if (ny > 200)
				ny = 200;
			if (ny < 0)
				ny = 0;
			if (ny < s->w.s.floorheight)
				ny = s->w.s.floorheight;
			ny &= -8;
			s->w.s.ceilingheight = ny;
			[self	display];
			[sectorEdit_i	setCeiling:ny];
			
		} while (event->type != NX_MOUSEUP);
	}
	
	r.origin.y = s->w.s.floorheight/2 - 14;
	if (NXPointInRect(&loc,&r) == YES)
	{
		[sectorEdit_i	selectFloor];
		yoff = (r.origin.y + r.size.height) - loc.y;
		do
		{
			event = [NXApp getNextEvent: 	NX_MOUSEUPMASK |
										NX_MOUSEDRAGGEDMASK];
			loc = event->location;
			[self convertPoint:&loc	fromView:NULL];
			ny = (2 * (loc.y + yoff)) - 100;
			if (ny > 200)
				ny = 200;
			if (ny < 0)
				ny = 0;
			if (ny > s->w.s.ceilingheight)
				ny = s->w.s.ceilingheight;
			ny &= -8;
			s->w.s.floorheight = ny;
			[self	display];
			[sectorEdit_i	setFloor:ny];
			
		} while (event->type != NX_MOUSEUP);
	}
	
	[window	setEventMask:oldwindowmask];
	return self;
}

@end
                                                                                                                                                                                              #import	"DoomProject.h"
#import	"idfunctions.h"
#import <appkit/appkit.h>

typedef struct
{
	id	image;
	char		name[9];
	NXRect	r;
} flat_t;

typedef struct
{
	worldends_t	w;
	id	image;
	NXRect	r;
	int	floor_flat,ceiling_flat;
} sector_t;

#define	SPACING	10

extern id	sectorEdit_i;

@interface SectorEditor:Object
{
	id	window_i;
	id	sectorEditView_i;
	id	flatScrPalView_i;
	id	flatPalView_i;
	id	sectorPalette_i;
	
	id	lightLevel_i;
	id	special_i;
	id	floorAndCeiling_i;
	id	ceiling_i;
	id	floor_i;
	id	title_i;
	id	cheightfield_i;
	id	fheightfield_i;
	
	id	flatImages;
	int	currentFlat;
}

- changeSector:(int) which;
- selectFloor;
- selectCeiling;
- setSectorTitle:(char *)string;
- setCeiling:(int) what;
- setFloor:(int) what;
- titleChanged:sender;
- CorFheightChanged:sender;
- (int) getNumFlats;
- (char *)flatName:(int) flat;
- (flat_t *) getFlat:(int) which;
- selectFlat:(int) which;
- (int) getCurrentFlat;
- (int) getLight;
- (int) getSpecial;
- menuTarget:sender;
- (int)loadFlats;
- createSector:sender;
- saveSector:sender;
- computeFlatDocView;
- (int) findFlat:(const char *)name;
- addToPalette:sender;
- error:(const char *)string;

@end

id	flatToImage(byte *rawData,byte const *lbmpalette);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 .o .file_definition_libsys_s.B.shlib_sleep.o _tan .file_definition_libsys_s.B.shlib_trig.o __sigvec .file_definition_libsys_s.B.shlib_sigvec.o .file_definition_libsys_s.B.shlib_select.o .file_definition_libsys_s.B.shlib_remove.o .file_definition_libsys_s.B.shlib_puts.o _clnt_sperror _clntudp_bufcreate _get_myaddress _xdr_pmap .file_definition_libsys_s.B.shlib_pmap_prot.o .file_definition_libsys_s.B.shlib_get_myaddress.o .file_definition_libsys_s.B.shlib_clnt_udp.o .file_definition_libsys_s.B.shlib_clnt_perror.o __writev .file_definition_libsys_s.B.shlib_writev.o .file_definition_libsys_s.B.shlib_perror.o _objc_addModule _objc_getModules __dyld_get_image_header __dyld_get_image_vmaddr_slide __dyld_image_count __dyld_lookup_and_bind __dyld_present _class_removeMethods .file_definition_libsys_s.B.shlib_qsort.o .file_definition_libsys_s.B.shlib_dyld.o .file_definition_libsys_s.B.shlib_ntohs.o _ni_addrtag _ni_connect _ni_create _ni_createname _ni_createprop _ni_destroy _ni_destroyname _ni_destroyprop _ni_listall _ni_listprops _ni_lookup _ni_lookupread _ni_needwrite _ni_new _ni_parent _ni_readname _ni_readprop _ni_renameprop _ni_resync _ni_setabort _ni_setpassword _ni_setreadtimeout _ni_setuser _ni_setwritetimeout _ni_statistics _ni_write _ni_writename _ni_writeprop _authnone_create _authunix_create _clnttcp_create _clntudp_create _inet_addr _inet_ntoa __ioctl _ni_lookupprop _ni_name_dup _ni_name_free _ni_namelist_free _pmap_getport _xdr_ni_name _xdr_ni_rparent_res _xdr_nibind_getregister_res .file_definition_libsys_s.B.shlib_multi_call.o .file_definition_libsys_s.B.shlib_ni_prot_clnt.o .file_definition_libsys_s.B.shlib_nb_prot_xdr.o .file_definition_libsys_s.B.shlib_ni_prot_xdr.o .file_definition_libsys_s.B.shlib_pmap_getport.o .file_definition_libsys_s.B.shlib_ni_util.o .file_definition_libsys_s.B.shlib_ioctl.o .file_definition_libsys_s.B.shlib_inet_ntoa.o .file_definition_libsys_s.B.shlib_inet_addr.o .file_definition_libsys_s.B.shlib_fcntl.o .file_definition_libsys_s.B.shlib_connect.o .file_definition_libsys_s.B.shlib_clnt_tcp.o .file_definition_libsys_s.B.shlib_auth_unix.o .file_definition_libsys_s.B.shlib_auth_none.o .file_definition_libsys_s.B.shlib_ni_glue.o _ni_entrylist_delete _ni_entrylist_insert _ni_idlist_delete _ni_idlist_dup _ni_idlist_insert _ni_name_match _ni_namelist_delete _ni_namelist_dup _ni_namelist_insert _ni_namelist_match _ni_prop_dup _ni_prop_free _ni_proplist_delete _ni_proplist_dup _ni_proplist_insert _ni_proplist_list_free _ni_fancyopen .file_definition_libsys_s.B.shlib_ni_useful.o _netname_version __mig_dealloc_reply_port __mig_get_reply_port .file_definition_libsys_s.B.shlib_mig_support.o _monaddition _monitor __libsys_moninitobjc __libsys_moninitrld _add_profil _creat _profil _moninitrld _moninitshlibs __libsys_moninitshlibs .file_definition_libsys_s.B.shlib_profil.o .file_definition_libsys_s.B.shlib_creat.o .file_definition_libsys_s.B.shlib_add_profil.o .file_definition_libsys_s.B.shlib_modf.o __mach_error .file_definition_libsys_s.B.shlib_log.o .file_definition_libsys_s.B.shlib_j1.o .file_definition_libsys_s.B.shlib_gethostname.o __libsys_environ .file_definition_libsys_s.B.shlib_ftell.o .file_definition_libsys_s.B.shlib_fputs.o .file_definition_libsys_s.B.shlib_exp.o _clnt_perrno _clnt_spcreateerror _clnt_sperrno _clnt_syslog _getprotobyname .file_definition_libsys_s.B.shlib_getent_p.o .file_definition_libsys_s.B.shlib_getent_h.o .file_definition_libsys_s.B.shlib_clnt_generic.o __bootstrap_look_up _getgroups _xdr_authunix_parms _xdr_opaque_auth .file_definition_libsys_s.B.shlib_authunix_prot.o .file_definition_libsys_s.B.shlib_getgroups.o .file_definition_libsys_s.B.shlib_atol.o .file_definition_libsys_s.B.shlib_atan2.o .file_definition_libsys_s.B.shlib_atan.o _setitimer .file_definition_libsys_s.B.shlib_setitimer.o .file_definition_libsys_s.B.shlib_alarm.o _raise __sigblock __sigsetmask .file_definition_libsys_s.B.shlib_sigsetmask.o .file_definition_libsys_s.B.shlib_sigblock.o .file_definition_libsys_s.B.shlib_raise.o .file_definition_libsys_s.B.shlib_read.o _NXCompareHashTables _NXHashInsertIfAbsent _NXIsEqualHashTable .file_definition_libsys_s.B.shlib__fixdfsi.o .file_definition_libsys_s.B.shlib__fixunsdfsi.o _NXAutoDimBrightness _NXAutoDimState _NXAutoDimThreshold _NXAutoDimTime _NXClickTime _NXCurrentVolume _NXEnableMouseButton _NXEvGetParameterChar _NXEvGetParameterInt _NXEvSetParameterChar _NXEvSetParameterInt _NXGetClickSpace _NXGetKeyMapping _NXGetMouseScaling _NXIdleTime _NXKeyMappingLength _NXKeyRepeatInterval _NXKeyRepeatThreshold _NXMouseButtonEnabled _NXResetKeyboard _NXResetMouse _NXScreenBrightness _NXSetAutoDimBrightness _NXSetAutoDimState _NXSetAutoDimThreshold _NXSetClickSpace _NXSetClickTime _NXSetCurrentVolume _NXSetKeyMapping _NXSetKeyRepeatInterval _NXSetKeyRepeatThreshold _NXSetMouseScaling _NXSetScreenBrightness _NXSetWaitCursorFrameInterval _NXSetWaitCursorSustain _NXSetWaitCursorThreshold _NXWaitCursorFrameInterval _NXWaitCursorSustain _NXWaitCursorThreshold __NXPostLLEvent __NXEvGetParameterChar __NXEvGetParameterInt __NXEvSetParameterChar __NXEvSetParameterInt __event_port_by_tag .file_definition_libsys_s.B.shlib__fixunsdfdi.o .file_definition_libsys_s.B.shlib_EventUser.o .file_definition_libsys_s.B.shlib_performsound.o .file_definition_libsys_s.B.shlib_evs_api.o __NXSetAppName .file_definition_libsys_s.B.shlib_strftime.o .file_definition_libsys_s.B.shlib_setlocale.o .file_definition_libsys_s.B.shlib_localeconv.o .file_definition_libsys_s.B.shlib_utimes.o .file_definition_libsys_s.B.shlib_rmdir.o .file_definition_libsys_s.B.shlib_dup2.o .file_definition_libsys_s.B.shlib_symlink.o .file_definition_libsys_s.B.shlib_getppid.o .file_definition_libsys_s.B.shlib_getpgrp.o .file_definition_libsys_s.B.shlib_setpgrp.o .file_definition_libsys_s.B.shlib_setgid.o .file_definition_libsys_s.B.shlib_setegid.o .file_definition_libsys_s.B.shlib_setuid.o .file_definition_libsys_s.B.shlib_seteuid.o _NXCompareMapTables .file_definition_libsys_s.B.shlib_ni_pwdomain.o __class_printMethodCacheStatistics __class_printMethodCaches _class_addClassMethods _class_addMethods _class_createInstance _class_getVersion _class_poseAs _class_setVersion _object_getIndexedIvars __libsys_NXNameZone .file_definition_libsys_s.B.shlib_NXCType.o .file_definition_libsys_s.B.shlib_NXIsSpace.o .file_definition_libsys_s.B.shlib_NXIsXDigit.o .file_definition_libsys_s.B.shlib_NXIsAlpha.o .file_definition_libsys_s.B.shlib_NXToAscii.o .file_definition_libsys_s.B.shlib_NXIsDigit.o .file_definition_libsys_s.B.shlib_NXIsLower.o .file_definition_libsys_s.B.shlib_NXToUpper.o .file_definition_libsys_s.B.shlib_NXIsUpper.o .file_definition_libsys_s.B.shlib_NXToLower.o _sigpause .file_definition_libsys_s.B.shlib_sigpause.o .file_definition_libsys_s.B.shlib_usleep.o .file_definition_libsys_s.B.shlib_fabs.o .file_definition_libsys_s.B.shlib_getdirentries.o _SNDGetCompressionOptions _SNDGetFilter _SNDModifyPriority _SNDSetCompressionOptions _SNDSetFilter _SNDStartPlayingDSP _SNDUpdateDSPParameter __SNDGetActiveDSPCore __snd_atc_thread __snd_atd_thread __snd_init_upsamplecodec_thread __snd_old_compression_thread __snd_old_decompression_thread __snd_upsamplecodec_thread _SNDAcquire _SNDGetDataPointer _SNDRelease _SNDReset _SNDWriteHeader __SNDGetATCEGP __SNDLinear8ToMulaw __kern_timestamp _slot_name _snddriver_dsp_reset _snddriver_dsp_set_flags _snddriver_dspcmd_req_condition _snddriver_dspcmd_req_msg _snddriver_get_device_parms _snddriver_get_sndin_formats _snddriver_get_sndout_formats _snddriver_get_volume _snddriver_set_device_parms _snddriver_set_sndin_format _snddriver_set_sndout_format _snddriver_set_volume _snddriver_stream_nsamples _snddriver_dsp_boot _SNDRead _snddriver_stream_start_writing .file_definition_libsys_s.B.shlib_sounddriver.o .file_definition_libsys_s.B.shlib_slot_name.o .file_definition_libsys_s.B.shlib_pow.o .file_definition_libsys_s.B.shlib_atcsound.o .file_definition_libsys_s.B.shlib_filesound.o .file_definition_libsys_s.B.shlib_convertsound.o .file_definition_libsys_s.B.shlib_editsound.o .file_definition_libsys_s.B.shlib_utilsound.o .file_definition_libsys_s.B.shlib_accesssound.o _snddriver_dsp_dma_read _snddriver_dsp_    .     a  ..      Coordinator.h       Coordinator.m       DoomEd_main.m       DoomProject.h       DoomProject.m       EWDoomSave.m        EWLoadSave.m        EditWorld.h     EditWorld.m     FlatsView.h     FlatsView.m     FloatingPanel.h     FloatingPanel.m     LinePanel.h     LinePanel.m     	MapView.h       	MapView.m       MapViewDraw.h       MapViewDraw.m       MapViewResp.h       MapViewResp.m       MapWindow.h     MapWindow.m     PatchPalView.h      PatchPalView.m      PatchPalette.h      PatchPalette.m      PatchWindow.h       PatchWindow.m       PlanePalView.h      PlanePalView.m      PlanePalette.h      PlanePalette.m      PlaneWindow.h       PlaneWindow.m       PopScrollView.h     PopScrollView.m     PreferencePanel.h       PreferencePanel.m       
R_mapdef.h      SectorEditView.h        SectorEditView.m        Timing.h        SectorEditor.h      SectorEditor.m      SectorPalView.h     SectorPalView.m     SectorPalette.h     SectorPalette.m     SettingsPanel.h     SettingsPanel.m     TextureEdit.h       TextureEdit.m       TexturePalView.h        TexturePalView.m        TexturePalette.h        TexturePalette.m        TexturePatchView.h      TexturePatchView.m      TextureView.h       TextureView.m       TextureWindow.h     TextureWindow.m     ThingPanel.h         ThingPanel.m        Timing.m        ToolPanel.h     ToolPanel.m     	Wadfile.h       	Wadfile.m       
grouping.h      
grouping.m    	  idfunctions.h     
  idfunctions.m       
idglobal.h      lbmfunctions.h      lbmfunctions.m      	pathops.h       	pathops.m       
wadfiles.h      wraps.h                                                                                                                                             #import	"SectorEditor.h"
#import	"SectorPalette.h"
#import "SectorPalView.h"

@implementation SectorPalView

- drawSelf:(const NXRect *)rects :(int)rectCount
{
	int	max, i, cs;
	sector_t	*s;
	NXRect	r;
	
	cs = [sectorPalette_i	getCurrentSector];
	if (cs >= 0)
	{
		s = [sectorPalette_i		getSector:cs];
		r = s->r;
		r.origin.x -= 5;
		r.origin.y -= 5;
		r.size.width += 10;
		r.size.height += 10;
		NXDrawGroove(&r,&r);
	}
	
	max = [sectorPalette_i	getNumSectors];
	for (i = 0; i < max; i++)
	{
		s = [sectorPalette_i		getSector:i];
		[s->image	composite:NX_COPY	toPoint:&s->r.origin];
	}
	
	return self;
}

- mouseDown:(NXEvent *)theEvent
{
	NXPoint	loc;
	int	i,max,oldwindowmask;
	sector_t	*s;

	oldwindowmask = [window addToEventMask:NX_LMOUSEDRAGGEDMASK];
	loc = theEvent->location;
	[self convertPoint:&loc	fromView:NULL];
	
	max = [sectorPalette_i	getNumSectors];
	for (i = 0;i < max; i++)
	{
		s = [sectorPalette_i		getSector:i];
		if (NXPointInRect(&loc,&s->r) == YES)
		{
			[sectorPalette_i	setCurrentSector:i];
			[sectorEdit_i	changeSector:i];
			break;
		}
	}
	
	[window	setEventMask:oldwindowmask];
	return self;
}
@end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  #import "idfunctions.h"
#import <appkit/appkit.h>
#import "EditWorld.h"


#define	SPACING				10

@interface TextureEdit:Object
{
	id	window_i;
	id	textureView_i;
	id	texturePatchWidthField_i;
	id	texturePatchHeightField_i;
	id	texturePatchNameField_i;
	id	textureWidthField_i;
	id	textureHeightField_i;
	id	textureNameField_i;
	id	patchWidthField_i;
	id	patchHeightField_i;
	id	patchNameField_i;
	id	scrollView_i;
	id	outlinePatches_i;
	id	lockedPatch_i;
	id	centerPatch_i;
	id	texturePatchScrollView_i;
	id	texturePatchView_i;
	id	createTexture_i;
	id	createWidth_i;
	id	createHeight_i;
	id	createName_i;
	id	createDone_i;

	id	patchImages;
	
	int	selectedPatch;		// in the Patch Palette
	int	currentPatch;			// in the Texture Editor View
	int	currentTexture;		// being edited
	int	oldx,oldy;
}

typedef struct
{
	int	sel;
} store_t;

// a patch holds one or more collumns
// Some patches will be in native color, while be used with a color remap table
typedef struct
{
	byte		width;			// bounding box size
	byte		height;
	char		leftoffset;			// pixels to the left of origin
	char		bottomoffset;		// pixels below the origin
	short	collumnofs[256];	// only [width] used, the [0] is &collumnofs[width]
} patch_t;

typedef struct
{
	byte		topdelta;			// -1 is the last post in a collumn
	byte		length;
// length data bytes follow
} post_t;

// collumn_t is a list of 0 or more post_t, (byte)-1 terminated
typedef post_t	collumn_t;

//
// structure for loaded patches
//
typedef struct
{
	NXRect	r;
	id		image;
	id		image_x2;
} apatch_t;

typedef	struct
{
	int	patchLocked;
	NXRect	r;
	worldpatch_t	patchInfo;
	apatch_t		*patch;
} texpatch_t;



extern	id	texturePatches;
extern	id	textureEdit_i;

- changedWidth:sender;
- changedHeight:sender;
- changedTitle:sender;
- setOldVars:(int)x :(int)y;
- doLockToggle;
- togglePatchLock:sender;
- deleteCurrentPatch:sender;
- sortUp:sender;
- sortDown:sender;
- setCurrentEditPatch:(int)which;
- (int)getCurrentEditPatch;
- outlineWasSet:sender;
- (apatch_t *)getPatch:(int)which;
- (apatch_t *)getPatchImage:(char *)name;
- finishTexture:sender;
- addPatch:(int)which;
- sizeChanged:sender;
- fillWithPatch:sender;
- menuTarget:sender;
- (int)getCurrentTexture;
- (int)getCurrentPatch;
- makeNewTexture:sender;
- createTextureDone:sender;
- createTextureAbort:sender;
- newSelection:(int)which;
- setSelectedPatch:(int)which;
- (int)getOutlineFlag;
- initPatches;
- menuTarget:sender;
- computePatchDocView: (NXRect *)theframe;

@end

id	patchToImage(patch_t *patchData,byte const *lbmpalette,NXSize *size);
char *strupr(char *string);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      		width 
		pixelsHigh:		height
		bitsPerSample:	4
		samplesPerPixel:	4 
		hasAlpha:		YES
		isPlanar:			NO 
		colorSpace:		NX_RGBColorSpace 
		bytesPerRow:		width*2
		bitsPerPixel: 		16
	];

	if (!image_i)
		return nil;
				
	//
	// translate the picture
	//
	LBMpaletteTo16 (lbmpalette, shortpal);
	dest_p = [(NXBitmapImageRep *)image_i data];
	memset(dest_p,0,width * height * 2);
	
	for (i = 0;i < width; i++)
	{
		data = (byte *)patchData + ShortSwap(patchData->collumnofs[i]);
		while (1)
		{
			topdelta = *data++;
			if (topdelta == (byte)-1)
				break;
			count = *data++;
			index = (topdelta*width+i)*2;
			while (count--)
			{
				*((unsigned short *)(dest_p + index)) = shortpal[*data++];
				index += width * 2;
			}
		}
	}

	fastImage_i = [[NXImage	alloc]
							init];
	[fastImage_i	useRepresentation:(NXImageRep *)image_i];	
	return fastImage_i;
}

char *strupr(char *string)
{
	char *s = string;
	while (*string)
		*string++ = toupper(*string);
	return s;
}

                                                 dma_write _snddriver_dsp_host_cmd _snddriver_dsp_read _snddriver_dsp_read_data _snddriver_dsp_read_messages _snddriver_dspcmd_abortdma _snddriver_dspcmd_req_err _snddriver_new_device_port _snddriver_reset_dsp_owner _snddriver_reset_sndin_owner _snddriver_reset_sndout_owner _snddriver_set_ramp _snddriver_set_sndout_bufcount _snddriver_set_sndout_bufsize _snddriver_set_sndout_owner_port _snddriver_stream_ndma __thread_reply _SNDReadHeader _SNDWrite _SNDSamplesToBytes _SNDReserve _SNDSetHost _SNDUnreserve __bootstrap_port __host_priv_self __port_status .file_definition_libsys_s.B.shlib_bootstrap_u.o _dbDirExtension _dbError _dbErrorNo _dbErrors _dbFlags _dbLeafExtension _dbLeafSize _dbMode .file_definition_libsys_s.B.shlib_dbError.o .file_definition_libsys_s.B.shlib_dbGlobals.o __sel_printHashTable __sel_printStatistics .file_definition_libsys_s.B.shlib_wait4.o .file_definition_libsys_s.B.shlib_wait3.o __vm_protect .file_definition_libsys_s.B.shlib_vfprintf.o .file_definition_libsys_s.B.shlib_umask.o __thread_switch __thread_self _host_kernel_version _host_processor_set_priv _host_processor_sets _host_processors _processor_assign _processor_control _processor_exit _processor_get_assignment _processor_info _processor_set_create _processor_set_default _processor_set_destroy _processor_set_info _processor_set_max_priority _processor_set_policy_disable _processor_set_policy_enable _processor_set_tasks _processor_set_threads _processor_start _task_assign _task_assign_default _task_get_assignment _task_priority _thread_assign _thread_assign_default _thread_get_assignment _thread_max_priority __thread_info __thread_abort __task_notify _closelog _setlogmask _vsyslog .file_definition_libsys_s.B.shlib_ctime.o .file_definition_libsys_s.B.shlib_strstr.o .file_definition_libsys_s.B.shlib_strcspn.o _setpwfile __lu_running __old_endpwent __old_getpwent __old_getpwnam __old_getpwuid __old_setpwent __old_setpwfile .file_definition_libsys_s.B.shlib__lu_types_xdr.o .file_definition_libsys_s.B.shlib_lookupUser.o .file_definition_libsys_s.B.shlib_getpwent.o .file_definition_libsys_s.B.shlib_lu_utils.o _telldir .file_definition_libsys_s.B.shlib_telldir.o .file_definition_libsys_s.B.shlib_seekdir.o .file_definition_libsys_s.B.shlib_scandir.o __old_prdb_end __old_prdb_get __old_prdb_getbyname __old_prdb_set .file_definition_libsys_s.B.shlib_old_printerdb.o .file_definition_libsys_s.B.shlib_getent_prdb.o _copysign _drem _finite _logb _scalb .file_definition_libsys_s.B.shlib_log__L.o .file_definition_libsys_s.B.shlib_exp__E.o .file_definition_libsys_s.B.shlib_support.o __port_type __port_set_status __port_set_remove __port_set_deallocate __port_set_allocate __port_set_add .file_definition_libsys_s.B.shlib_pipe.o .file_definition_libsys_s.B.shlib_popen.o .file_definition_libsys_s.B.shlib_memcmp.o .file_definition_libsys_s.B.shlib_lstat.o .file_definition_libsys_s.B.shlib_log10.o _setjmp __longjmperror __sigstack .file_definition_libsys_s.B.shlib_sigstack.o .file_definition_libsys_s.B.shlib_setjmperr.o .file_definition_libsys_s.B.shlib_setjmp.o _asctime _gmtime _mktime __tzset __tzname __tztab .file_definition_libsys_s.B.shlib_timezone.o .file_definition_libsys_s.B.shlib_ctime_data.o __isnan __isinf __libsys__mh_execute_header _swap_section _swap_segment_command _ttyslot .file_definition_libsys_s.B.shlib_ttyslot.o .file_definition_libsys_s.B.shlib_getlogin.o _endhostent _gethostbyaddr _gethostent _sethostent _sethostfile __old_endhostent __old_gethostbyaddr __old_gethostbyname __old_gethostent __old_sethostent __old_sethostfile _h_errno .file_definition_libsys_s.B.shlib_ni_data.o .file_definition_libsys_s.B.shlib_gethostent.o .file_definition_libsys_s.B.shlib_fread.o __fork __execv _dbLock _dbCompress _dbExpand _dbFind _dbFirst _dbFlush _dbGet _dbNext _dbSetCache _dbSetKey _dbMaxLeafBuf _mkstemp _random .file_definition_libsys_s.B.shlib_random.o .file_definition_libsys_s.B.shlib_mkstemp.o __cthread_set_name __cthread_name __cthread_init .file_definition_libsys_s.B.shlib_bsearch.o .file_definition_libsys_s.B.shlib_abs.o __NXStreamsUnused1 __NXStreamsUnused2 _SNDCompressSound _SNDRunDSP __SNDResampleInC __SNDGetATCSTP _SNDPlaySoundfile _SNDSwapHostToSound _SNDSwapSoundToHost .file_definition_libsys_s.B.shlib_sounderror.o __gfmt __ecvt __fcvt .file_definition_libsys_s.B.shlib_isnan.o .file_definition_libsys_s.B.shlib_isinf.o .file_definition_libsys_s.B.shlib_ecvt.o .file_definition_libsys_s.B.shlib_file_funcs.o __cmpdi2 .file_definition_libsys_s.B.shlib__cmpdi2.o __vm_synchronize __vm_region _backref _cclass _re_comp _re_exec _re_fold _recmp .file_definition_libsys_s.B.shlib_regex.o .file_definition_libsys_s.B.shlib_mmap.o .file_definition_libsys_s.B.shlib_mktemp.o _cthread_abort _cthread_max_priority .file_definition_libsys_s.B.shlib_sched.o __cthread_join .file_definition_libsys_s.B.shlib_bcmp.o .file_definition_libsys_s.B.shlib__NXToUpper.o .file_definition_libsys_s.B.shlib__NXToLower.o .file_definition_libsys_s.B.shlib_NXIsPunct.o .file_definition_libsys_s.B.shlib_NXIsPrint.o .file_definition_libsys_s.B.shlib_NXIsGraph.o .file_definition_libsys_s.B.shlib_NXIsAscii.o .file_definition_libsys_s.B.shlib_NXIsAlNum.o __libsys_NXAddRegion __libsys_NXCreateChildZone __libsys_NXMallocCheck __libsys_NXMergeZone __libsys_NXRemoveRegion __libsys_NXZonePtrInfo __libsys__NXMallocDumpFrees __libsys__NXMallocDumpZones __libsys__dyld_func_lookup __libsys__malloc_fork_child __libsys__malloc_fork_parent __libsys__malloc_fork_prepare __libsys_catch_exception_raise __libsys_dyld_func_lookup __libsys_longjmp __libsys_malloc_debug __libsys_malloc_error __libsys_malloc_freezedry __libsys_malloc_good_size __libsys_malloc_jumpstart __libsys_malloc_singlethreaded __libsys_malloc_size __libsys_mstats __libsys_setjmp __libsys_valloc __libsys_vfree __cthread_body __cthread_count __cthread_limit __cthread_set_limit __lu_fork_child __cproc_create __cproc_init __cthread_set_self __mig_fork_child __mig_init .file_definition_libsys_s.B.shlib_stack.o _objc_registerModule _objc_unloadModules _rld_load _rld_unload .file_definition_libsys_s.B.shlib_librld.o __cthread_errno __cthread_set_errno_self __cthread_yield __alloc_stack __condition_spin_limit __condition_yield_limit __cproc_setup __stack_init __swtch_pri __thread_create __thread_resume .file_definition_libsys_s.B.shlib_threads_data.o __mutex_unlock_try __spin_unlock __mutex_spin_limit __cthread_sp __thread_get_state __thread_set_state __old_mach_init_ports __old_mach_init_ports_count __xxx_PORT_ENABLED __xxx_environment_port __mach_init .file_definition_libsys_s.B.shlib_mach_init.o __netipc_ignore __netipc_listen __port_extract_receive __port_extract_send __port_insert_receive __port_insert_send __port_names __port_rename __port_set_backup __task_by_unix_pid __task_create __task_info __task_resume __task_suspend __task_terminate __task_threads __thread_get_special_port __thread_set_special_port __thread_suspend __thread_terminate __unix_pid __vm_deactivate __vm_inherit __vm_machine_attribute __vm_read __vm_set_policy __vm_statistics __vm_write __xxx_cpu_control __xxx_host_info __xxx_slot_info __msg_receive_trap __msg_rpc_trap __msg_send_trap __mach_errormsg _atexit __f_morefiles __fwalk __f_prealloc __gcvt _atof .file_definition_libsys_s.B.shlib_atof.o .file_definition_libsys_s.B.shlib_execv.o __fork_mach_init __lookupd_port __device_master_self __init_process __mach_host_self __mach_msg_trap __mach_reply_port __mach_swapon __mach_task_self __mach_thread_self __swtch __task_by_pid __task_self _swap_fvmfile_command _swap_fvmlib_command _swap_ident_command _swap_load_command _swap_nlist _swap_ranlib _swap_relocation_info _swap_symseg_command _swap_symtab_command __syscall _swap_thread_command .file_definition_libsys_s.B.shlib_syscall.o .file_definition_libsys_s.B.shlib_getrusage.o .file_definition_libsys_s.B.shlib_errstrings.o __seterr_reply _xdr_accepted_reply _xdr_callhdr _xdr_des_block _xdr_rejected_reply __svcauth_null __svcauth_des __svcauth_short __svcauth_unix .file_definition_libsys_s.B.shlib_svc_auth_unix.o .file_definition_libsys_s.B.shlib_svcauth_des.o __sigtramp __sigcatch .file_definition_libsys_s.B.shlib_sigcatch.o .file_definition_lib#import	"TextureEdit.h"
#import	"Wadfile.h"
#import	"lbmfunctions.h"
#import	"SectorPalette.h"
#import	"SectorEditor.h"

@implementation SectorEditor

id	sectorEdit_i;

- init
{
	window_i = NULL;
	sectorEdit_i = self;
	currentFlat = -1;
	return self;
}

- menuTarget:sender
{
	if (![doomproject_i loaded])
	{
		NXRunAlertPanel("Oops!",
						"There must be a project loaded before you even\n"
						"THINK about editing sectors!",
						"OK",NULL,NULL,NULL);
		return self;
	}
	
	if (!window_i)
	{
		[NXApp 
			loadNibSection:	"SectorEditor.nib"
			owner:			self
			withNames:		NO
		];

		[self	computeFlatDocView];
	}
	
	//
	// make sure patches are loaded before window inits
	//	
	[window_i	setDelegate:self];
	[window_i	makeKeyAndOrderFront:self];
	return self;
}

- selectFloor
{
	[floorAndCeiling_i	selectCellAt:0 :1];
	return self;
}

- selectCeiling
{
	[floorAndCeiling_i	selectCellAt:0 :0];
	return self;
}

- setSectorTitle:(char *)string
{
	[title_i	setStringValue:string];
	return self;
}

- titleChanged:sender
{
	char		string[9];
	sector_t	*s;
	int	cs;
	
	cs = [sectorPalette_i	getCurrentSector];
	if (cs < 0)
	{
		[title_i	setStringValue:""];
		return self;
	}
	s = [sectorPalette_i		getSector:cs];
	
	bzero(string,9);
	strncpy(string,[title_i	stringValue],8);
	strupr(string);
	[title_i	setStringValue:string];
	strncpy(s->w.name,[title_i	stringValue],8);
	return self;
}

- setCeiling:(int) what
{
	[cheightfield_i		setIntValue:what];
	return self;
}

- setFloor:(int) what
{
	[fheightfield_i		setIntValue:what];
	return self;
}

- CorFheightChanged:sender
{
	int	cs, val;
	sector_t	*s;
	
	cs = [sectorPalette_i	getCurrentSector];
	s = [sectorPalette_i		getSector:cs];
	val = [cheightfield_i	intValue];
	if (val < 0)
		val = 0;
	if (val > 200)
		val = 200;
	if (val < [fheightfield_i	intValue])
		val = [fheightfield_i	intValue];
	s->w.s.ceilingheight = val;

	val = [fheightfield_i		intValue];
	if (val < 0)
		val = 0;
	if (val > 200)
		val = 200;
	s->w.s.floorheight = val;
	[sectorEditView_i	display];
	
	return self;
}

- createSector:sender
{
	[sectorPalette_i	createSector];
	[sectorEditView_i	display];
	return self;
}

//
// Save the sector in the palette
// Here is where we check for incomplete data
//
- saveSector:sender
{
	sector_t	*s, *news;
	int	ns, cs, i;
	
	s = [sectorPalette_i		getSector:[sectorPalette_i getCurrentSector]];	
	if (!s->w.name[0])
	{
		NXBeep();
		NXRunAlertPanel("Oops!","You need to name your new sector!","OK",
						NULL,NULL,NULL);
		return self;
	}
	
	if (s->floor_flat < 0 || s->ceiling_flat < 0)
	{
		NXBeep();
		NXRunAlertPanel("Oops!","You need to assign both ceiling & floor flats!","OK",
						NULL,NULL,NULL);
		return self;
	}
	
	cs = [sectorPalette_i	getCurrentSector];
	ns = [sectorPalette_i	getNumSectors];
	for (i = 0;i < ns; i++)
	{
		news = [sectorPalette_i	getSector:i];
		if (!strcmp(s->w.name,news->w.name) && i!=cs)
		{
			NXBeep();
			NXRunAlertPanel("Oops!","The current sector has the same name as another"
							"sector in the palette!","OK",NULL,NULL,NULL);
			return self;
		}
	}
	
	[sectorPalette_i	saveSector];
	return self;
}

- (int) getLight
{
	return	[lightLevel_i	intValue];
}

- (int) getSpecial
{
	return	[special_i		intValue];
}

//
// Change to a different sector
//
- changeSector:(int) which
{
	sector_t	*s;
	
	[sectorPalette_i	setCurrentSector:which];
	s = [sectorPalette_i		getSector:which];
	[lightLevel_i	setIntValue:s->w.s.lightlevel];
	[special_i		setIntValue:s->w.s.special];
	[cheightfield_i	setIntValue:s->w.s.ceilingheight];
	[fheightfield_i	setIntValue:s->w.s.floorheight];
	[title_i		setStringValue:s->w.name];
	[sectorEditView_i	display];
	
	return self;
}

//
// load in all the flats for the palette
// NOTE: called at start of project
//
- (int)loadFlats
{
	int	flatStart, flatEnd, i;
	byte *palLBM;
	byte *flat;
	flat_t	f;

	palLBM = [wadfile_i	loadLumpNamed:"playpal"];
	//
	// get inclusive lump #'s for patches
	//
	flatStart = [wadfile_i	lumpNamed:"f_start"] + 1;
	flatEnd = [wadfile_i	lumpNamed:"f_end"];

	if (flatStart == -1)
		IO_Error("There are NO FLAT PLANES in the current .WAD file!  "
						"You cannot edit/create sectors without them!");
	
	flatImages = [[Storage	alloc]
				initCount:		0
				elementSize:	sizeof(flat_t)
				description:	NULL];
	
	NXSetRect(&f.r,0,0,0,0);
	for (i = flatStart; i < flatEnd; i++)
	{
		//
		// load raw 64*64 flat and convert to an NXImage
		//
		flat = [wadfile_i	loadLump:i];
		f.image = flatToImage(flat,palLBM);
		f.r.size.width = 64;
		f.r.size.height = 64;
		strcpy(f.name,[wadfile_i	lumpname:i]);
		[flatImages	addElement:&f];
		free(flat);
	}
	
	free(palLBM);
	return 0;
}		

//
// set coords for all flats in the flatView
//
- computeFlatDocView
{
	NXRect	dvr;
	int	i,x,y,max;
	flat_t	*f;
	
	[flatScrPalView_i	getDocVisibleRect:&dvr];
	max = [flatImages	count];
	x = y = SPACING;
	
	for (i = 0; i < max; i++)
	{
		f = [flatImages	elementAt:i];
		if (x > dvr.size.width - (f->r.size.width + SPACING))
		{
			x = SPACING;
			y += 64 + SPACING;
		}
		f->r.origin.x = x;
		f->r.origin.y = y;
		x += f->r.size.width + SPACING;
	}
	
	y += 64 + SPACING;
	[flatPalView_i	sizeTo:dvr.size.width	:y];
	return self;
}

- (char *)flatName:(int) flat
{
	flat_t	*f;
	f = [flatImages	elementAt:flat];
	return	f->name;
}

- (int) findFlat:(const char *)name
{
	int	max,i;
	flat_t	*f;
	
	max = [flatImages	count];
	for (i = 0;i < max; i++)
	{
		f = [flatImages	elementAt:i];
		if (!strcmp(f->name,name))
			return i;
	}
	return -1;
}

- selectFlat:(int) which
{
	sector_t	*s;
	flat_t	*f;
	
	if ([sectorPalette_i	getCurrentSector] < 0)
	{
		NXBeep();
		return self;
	}
	
	currentFlat = which;
	f = [flatImages	elementAt:currentFlat];
	s = [sectorPalette_i		getSector:[sectorPalette_i getCurrentSector]];
	
	if ([ceiling_i	intValue])
	{
		s->ceiling_flat = which;
		strncpy(s->w.s.ceilingflat,f->name,9);
	}
	else
	{
		s->floor_flat = which;
		strncpy(s->w.s.floorflat,f->name,9);
	}
	
	[flatScrPalView_i	display];
	[sectorEditView_i	display];
	return self;
}

- (int) getCurrentFlat
{
	return	currentFlat;
}

- (int) getNumFlats
{
	return	[flatImages	count];
}

- (flat_t *) getFlat:(int) which
{
	return	[flatImages	elementAt:which];
}

- addToPalette:sender
{
	return self;
}

- error:(const char *)string
{
	NXRunAlertPanel("Oops!",string,"OK",NULL,NULL,NULL);
	return self;
}

//
// user resized the Sector Editor window.
// change the size of the flats/sector palettes.
//
- windowDidResize:sender
{
	[self		computeFlatDocView];
	[window_i	display];
	return self;
}

@end

//
// convert a raw 64x64 to an NXImage without an alpha channel
//
id	flatToImage(byte *rawData,byte const *lbmpalette)
{
	short		*dest_p;
	NXImageRep *image_i;
	id			fastImage_i;
	unsigned short	shortpal[256];
	unsigned		i;

	//
	// make an NXimage to hold the data
	//
	image_i = [[NXBitmapImageRep alloc]
		initData:			NULL 
		pixelsWide:		64 
		pixelsHigh:		64
		bitsPerSample:	4
		samplesPerPixel:	3 
		hasAlpha:		NO
		isPlanar:			NO 
		colorSpace:		NX_RGBColorSpace 
		bytesPerRow:		128
		bitsPerPixel: 		16
	];

	if (!image_i)
		return nil;
				
	//
	// translate the picture
	//
	LBMpaletteTo16 (lbmpalette, shortpal);
	 (unsigned char *)dest_p =[(NXBitmapImageRep *)image_i data];
	memset(dest_p,0,64 * 64 * sizeof(short));
	
	for (i = 0;i < 64*64; i++)
		*(dest_p++) = shortpal[*(rawData++)];

	fastImage_i = [[NXImage	alloc]
							init];
	[fastImage_i	useRepresentation:(NXImageRep *)image_i];	
	return fastImage_i;
}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              sys_s.B.shlib_sigtramp.o _NSInstallLinkEditErrorHandlers __dyld_bind_objc_module __dyld_get_objc_module_sect_for_module __dyld_register_func_for_add_image __dyld_register_func_for_link_module __dyld_register_func_for_replace_module __dyld_register_func_for_unlink_module _xdrrec_create _xdrrec_endofrecord _xdrrec_skiprecord .file_definition_libsys_s.B.shlib_xdr_rec.o _xdr_ni_binding _xdr_ni_children_res _xdr_ni_children_stuff _xdr_ni_create_args _xdr_ni_create_res _xdr_ni_create_stuff _xdr_ni_createname_args _xdr_ni_createprop_args _xdr_ni_destroy_args _xdr_ni_entry _xdr_ni_entrylist _xdr_ni_id _xdr_ni_id_res _xdr_ni_idlist _xdr_ni_list_res _xdr_ni_list_stuff _xdr_ni_listall_res _xdr_ni_listall_stuff _xdr_ni_lookup_args _xdr_ni_lookup_res _xdr_ni_lookup_stuff _xdr_ni_name_args _xdr_ni_nameindex_args _xdr_ni_namelist _xdr_ni_namelist_res _xdr_ni_namelist_stuff _xdr_ni_object _xdr_ni_object_list _xdr_ni_object_node _xdr_ni_parent_res _xdr_ni_parent_stuff _xdr_ni_prop_args _xdr_ni_property _xdr_ni_proplist _xdr_ni_proplist_list _xdr_ni_proplist_res _xdr_ni_proplist_stuff _xdr_ni_propname_args _xdr_ni_readall_res _xdr_ni_readall_stuff _xdr_ni_readname_res _xdr_ni_readname_stuff _xdr_ni_status _xdr_ni_writename_args _xdr_ni_writeprop_args _xdr_array .file_definition_libsys_s.B.shlib_xdr_array.o _xdr_nibind_addrinfo _xdr_nibind_bind_args _xdr_nibind_clone_args _xdr_nibind_listreg_res _xdr_nibind_registration __udivdi3 __umoddi3 .file_definition_libsys_s.B.shlib__umoddi3.o .file_definition_libsys_s.B.shlib__udivdi3.o _rld_address_func _rld_forget_symbol _rld_load_basefile _rld_load_from_memory _rld_lookup _rld_unload_all _getpagesize _getsegbyname _strtol _strtoul .file_definition_libsys_s.B.shlib_strtol.o .file_definition_libsys_s.B.shlib_getsegbyname.o .file_definition_libsys_s.B.shlib_getpagesize.o .file_definition_libsys_s.B.shlib_monshlibs.o _endprotoent _getprotobynumber _getprotoent _setprotoent __old_endprotoent __old_getprotobyname __old_getprotobynumber __old_getprotoent __old_setprotoent .file_definition_libsys_s.B.shlib_getprotoent.o __bootstrap_check_in __bootstrap_create_service __bootstrap_info __bootstrap_look_up_array __bootstrap_register __bootstrap_status __bootstrap_subset __kill .file_definition_libsys_s.B.shlib_kill.o __NXEvClose __NXEvFrameBufferDevicePort __NXEvMapEventShmem __NXEvOpen __NXEvSetSpecialKeyPort _SNDDropATCSamples _SNDGetATCBandFrequencies _SNDGetATCBandwidths _SNDGetATCEqualizerGains _SNDGetATCGain _SNDGetATCGainNormalization _SNDGetATCQuality _SNDGetATCSquelchThresholds _SNDGetNumberOfATCBands _SNDInsertATCSamples _SNDScaleATCEqualizerGains _SNDSetATCEqualizerGains _SNDSetATCGain _SNDSetATCGainNormalization _SNDSetATCQuality _SNDSetATCSquelchThresholds _SNDUseDefaultATCSquelchThresholds _dbMsgs _dbSizeTable __lu_setport _dbm_close _dbm_fetch _dbm_open _endnetgrent _getnetgrent _innetgr _rewind _setnetgrent _usingypmap _yp_bind _yp_first _yp_match _yp_next .file_definition_libsys_s.B.shlib_yp_match.o .file_definition_libsys_s.B.shlib_yp_enum.o .file_definition_libsys_s.B.shlib_yp_bind.o .file_definition_libsys_s.B.shlib_rew.o .file_definition_libsys_s.B.shlib_getent_netgr.o .file_definition_libsys_s.B.shlib_ndbm.o _index .file_definition_libsys_s.B.shlib_index.o __timezone _endttyent _getttyent _setttyent _ttyname .file_definition_libsys_s.B.shlib_ttyname.o .file_definition_libsys_s.B.shlib_getttyent.o __execve .file_definition_libsys_s.B.shlib_execve.o _initstate _setstate _srandom __cthread_stack_base __cthread_stack_mask __getrlimit __initial_stack_boundary .file_definition_libsys_s.B.shlib_getrlimit.o __cthread_exit_routine __cproc_default_stack_size __malloc_lock __msg_receive_timeout __msg_send_timeout _authdes_getucred _cbc_crypt _ecb_crypt _key_decryptsession _netname2user .file_definition_libsys_s.B.shlib_netname.o .file_definition_libsys_s.B.shlib_key_call.o .file_definition_libsys_s.B.shlib_des_crypt.o __sigreturn .file_definition_libsys_s.B.shlib_sigreturn.o _xdrrec_eof _xdr_vector .file_definition_libsys_s.B.shlib__udivmoddi4.o _dbm_delete _dbm_firstkey _dbm_forder _dbm_nextkey _dbm_store __set_innetgr_handler __old_endnetgrent __old_getnetgrent __old_innetgr __old_setnetgrent .file_definition_libsys_s.B.shlib_innetgr.o .file_definition_libsys_s.B.shlib_getnetgrent.o __yp_dobind _yp_get_default_domain _yp_unbind __ypserv_timeout __ypsleeptime _getdomainname _xdr_ypbind_resp _xdr_ypdomain_wrap_string .file_definition_libsys_s.B.shlib_ypxdr.o .file_definition_libsys_s.B.shlib_getdomainname.o .file_definition_libsys_s.B.shlib_yp_data.o _v1prot_dofirst _v1prot_donext __xdr_yprequest __xdr_ypresponse _xdr_ypreq_key _xdr_ypreq_nokey _xdr_ypresp_key_val _ypprot_err .file_definition_libsys_s.B.shlib_ypprot_err.o .file_definition_libsys_s.B.shlib_ypv1_xdr.o _xdr_ypresp_val __des_crypt .file_definition_libsys_s.B.shlib_des_soft.o _key_encryptsession _key_gendes _key_setsecret __openchild _xdr_cryptkeyarg _xdr_cryptkeyres _xdr_keybuf _xdr_keystatus _xdrstdio_create .file_definition_libsys_s.B.shlib_xdr_stdio.o .file_definition_libsys_s.B.shlib_key_prot.o .file_definition_libsys_s.B.shlib_openchild.o _getnetname _host2netname _netname2host _user2netname _strpbrk .file_definition_libsys_s.B.shlib_strpbrk.o _xdr_datum _xdr_yp_binding _xdr_yp_inaddr _xdr_ypmap_parms _xdr_ypmap_wrap_string _xdr_ypowner_wrap_string __xdr_ypbind_oldsetdom _des_setparity _dup .file_definition_libsys_s.B.shlib_dup.o _xdr_getcredres _xdr_netnamestr _xdr_unixcred     crt0.c int:t1=r1;-2147483648;2147483647; char:t2=r2;0;127; long int:t3=r1;-2147483648;2147483647; unsigned int:t4=r1;0;-1; long unsigned int:t5=r1;0;-1; long long int:t6=r1;01000000000000000000000;0777777777777777777777; long long unsigned int:t7=r1;0000000000000;01777777777777777777777; short int:t8=r1;-32768;32767; short unsigned int:t9=r1;0;65535; signed char:t10=r1;-128;127; unsigned char:t11=r1;0;255; float:t12=r1;4;0; double:t13=r1;8;0; long double:t14=r1;12;0; complex int:t15=s8real:1,0,32;imag:1,32,32;; complex float:t16=r16;4;0; complex double:t17=r17;8;0; complex long double:t18=r18;12;0; void:t19=19 environ:G20=*21=*2 NXArgc:G1 NXArgv:G20 kframe:T22=s12kargc:1,0,32;kargv:23=ar1;0;0;21,32,32;\ kargstr:24=ar1;0;0;2,64,8;kenvstr:25=ar1;0;0;2,72,8;; start:F1 start:F1 start:F1 start:F1 start:F1 start:F1 start:F1 start:F1 start:F1 start:F1 start:F1 start:F1 start:F1 start:F1 start:F1 start:F1 start:F1 start:F1 start:F1 start:F1 kfp:r26=*22 targv:r20 argv:r20  _tmp1__:r1    _dyld_func_lookup:F1 _dyld_func_lookup:F1 _dyld_func_lookup:F1 _dyld_func_lookup:F1 mach_init_routine:G27=*28=f1 _cthread_init_routine:G27  __NXArgc __NXArgv __dyld_func_lookup __fvmlib_init0 __fvmlib_init1 __init_shlibs __environ start __cplus_init __cthread_init_routine __objcInit _errno _exit __mach_init_routine _main  _sectors _blockworld_i _objc_msgSend _pan _NXFreeAlertPanel _editworld_i _lines _NXRunAlertPanel _bmap _selectline _floodline _bwidth _bheight _brow _points _wbounds _sqrt _NXSetRect _blockview _malloc _NXDrawBitmap _NXPing _free _memset _numlines _numsectors _NXGetAlertPanel .objc_class_name_Storage .objc_class_name_Window .objc_class_name_Object .objc_class_name_BlockWorld BlockWorld.m int:t1=r1;-2147483648;2147483647; char:t2=r2;0;127; long int:t3=r1;-2147483648;2147483647; unsigned int:t4=r1;0;-1; long unsigned int:t5=r1;0;-1; long long int:t6=r1;01000000000000000000000;0777777777777777777777; long long unsigned int:t7=r1;0000000000000;01777777777777777777777; short int:t8=r1;-32768;32767; short unsigned int:t9=r1;0;65535; signed char:t10=r1;-128;127; unsigned char:t11=r1;0;255; float:t12=r1;4;0; double:t13=r1;8;0; long double:t14=r1;12;0; complex int:t15=s8real:1,0,32;imag:1,32,32;; complex float:t16=r16;4;0; complex double:t17=r17;8;0; complex long double:t18=r18;12;0; void:t19=19 size_t:t5 va_list:t20=*2 _iobuf:T21=s20_cnt:1,0,32;_ptr:20,32,32;\ _base:20,64,32;_bufsiz:1,96,32;_flag:8,128,16;\ _file:11,144,8;_smallbuf:2,152,8;;  :T22=edps_ascii:0,dps_binObjSeq:1,dps_encodedTokens:2,; DPSProgramEncoding:t22  :T23=edps_indexed:0,dps_strings:1,; DPSNameEncoding:t23  :T24=edps_tBoolean:0,dps_tChar:1,dps_tUChar:2,\ dps_tFloat:3,dps_tDouble:4,dps_tShort:5,\ dps_tUShort:6,dps_tI#import	"SectorEditor.h"
#import	"SectorPalette.h"

@implementation SectorPalette

id	sectorPalette_i;

- init
{
	window_i = NULL;
	sectorPalette_i = self;
	currentSector = -1;
	return self;
}

- menuTarget:sender
{
	if (!window_i)
	{
		[NXApp 
			loadNibSection:	"SectorPalette.nib"
			owner:			self
			withNames:		NO
		];
		
		[self	computeSectorDocView];
	}
	
	[window_i	setDelegate:self];
	[window_i	makeKeyAndOrderFront:NULL];
	
	return self;
}

- createSector
{
	sector_t	s;
	
	NXSetRect(&s.r,0,0,133,64);

	s.image = [[NXImage alloc]
			initSize:	&s.r.size];
	[s.image	 useCacheWithDepth:NX_TwelveBitRGBDepth];

	bzero(s.w.name,9);
	bzero(s.w.s.floorflat,9);
	bzero(s.w.s.ceilingflat,9);
	s.w.s.lightlevel = [sectorEdit_i	getLight];
	s.w.s.special = [sectorEdit_i	getSpecial];
	s.w.s.floorheight = 0;
	s.w.s.ceilingheight = 200;
	strcpy(s.w.s.floorflat,[sectorEdit_i	flatName:0]);
	strcpy(s.w.s.ceilingflat,[sectorEdit_i	flatName:0]);
	s.floor_flat = 0;
	s.ceiling_flat = 0;
	strcpy(s.w.name,"UNTITLED");

	[sectorEdit_i	setSectorTitle:s.w.name];
	[doomproject_i	newEnds:&s.w];	
	[sectors	addElement:&s];
	oldsector = s;
	
	[self		setCurrentSector:[sectors	count] - 1];
	[self		computeSectorDocView];
	[self		saveSector];
	[sectorScrPalView_i	display];
	return self;
}

- updateInfo
{
	sector_t	*s;
	
	s = [sectors	elementAt:currentSector];
	[cellTitle_i	setStringValue:s->w.name];
	[cellLight_i	setIntValue:s->w.s.lightlevel];
	[cellSpecial_i	setIntValue:s->w.s.special];
	[cellCheight_i	setIntValue:s->w.s.ceilingheight];
	[cellFheight_i	setIntValue:s->w.s.floorheight];
	[sectorScrPalView_i	display];
	return self;
}

- setCurrentSector:(int) what
{
	currentSector = what;
	[self	updateInfo];
	return self;
}

- (int) getCurrentSector
{
	return	currentSector;
}

- (int) getNumSectors
{
	return	[sectors	count];
}

- (sector_t *) getSector:(int) which
{
	return	[sectors	elementAt:which];
}

- saveSector
{
	int	cs;
	sector_t	*s;
	flat_t	*f;
	NXPoint	p;
	NXRect	r;

	cs = currentSector;
	if (cs < 0)
	{
		NXBeep();
		return self;
	}

	s = [sectors	elementAt:cs];
	[s->image	lockFocusOn:[s->image lastRepresentation]];
	
	p.x = p.y = 0;
	if (s->floor_flat < 0)
	{
		NXSetColor(NXConvertRGBToColor(1,0,0));
		NXSetRect(&r,p.x,p.y,64,64);
		NXRectFill(&r);
	}
	else
	{
		f = [sectorEdit_i	getFlat:s->floor_flat];
		[f->image		composite:NX_COPY	toPoint:&p];
	}
	
	p.x = 64 + 5;
	if (s->ceiling_flat < 0)
	{
		NXSetColor(NXConvertRGBToColor(1,0,0));
		NXSetRect(&r,p.x,p.y,64,64);
		NXRectFill(&r);
	}
	else
	{
		f = [sectorEdit_i	getFlat:s->ceiling_flat];
		[f->image		composite:NX_COPY	toPoint:&p];
	}
	
	[s->image	unlockFocus];
	s->w.s.lightlevel = [sectorEdit_i	getLight];
	s->w.s.special = [sectorEdit_i		getSpecial];
	[sectors	replaceElementAt:cs	with:s];
	[self		updateInfo];
	[self		computeSectorDocView];
	[sectorScrPalView_i	display];

	ends[cs] = s->w;
	
	return self;
}

//
// build
//
- buildSectors
{
	int	i,cf,ff;
	sector_t	s;
	flat_t	*f;
	NXPoint	p;
	
	sectors = [[ Storage	alloc]
				initCount:		0
				elementSize:	sizeof(sector_t)
				description:	NULL];
				
	for (i = 0; i < numends; i++)
	{
		NXSetRect(&s.r,0,0,133,64);

		s.w = ends[i];
		s.image = [[NXImage alloc]
				initSize:	&s.r.size];
		[s.image	 useCacheWithDepth:NX_TwelveBitRGBDepth];
		[s.image	lockFocusOn:[s.image lastRepresentation]];
		
		cf = [sectorEdit_i	findFlat:ends[i].s.ceilingflat];
		if (cf < 0)
			return [self	error:"Can't find ceilingflat!"];
		ff = [sectorEdit_i	findFlat:ends[i].s.floorflat];
		if (ff < 0)
			return [self	error:"Can't find floorflat!"];
		
		s.floor_flat = ff;
		s.ceiling_flat = cf;
		p.y = p.x = 0;
		f = [sectorEdit_i	getFlat:ff];
		[f->image	composite:NX_COPY	toPoint:&p];
		p.x = 64 + 5;
		f = [sectorEdit_i	getFlat:cf];
		[f->image	composite:NX_COPY	toPoint:&p];
				
		[s.image	unlockFocus];
		[sectors	addElement:&s];
	}
	
	return self;
}

//
// set coords for all sectors in the sectorView
//
- computeSectorDocView
{
	NXRect	dvr;
	int	i,y,max;
	sector_t	*s;
	
	[sectorScrPalView_i	getDocVisibleRect:&dvr];
	max = [self		getNumSectors];
	y = SPACING;
	
	for (i = 0; i < max; i++)
	{
		s = [self	getSector:i];
		s->r.origin.x = SPACING;
		s->r.origin.y = y;
		y += s->r.size.height + SPACING;
	}
	
	[sectorPalView_i	sizeTo:dvr.size.width	:y];
	return self;
}

@end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
#import <appkit/appkit.h>

extern	id	settingspanel_i;

@interface SettingsPanel:Object
{
	int	segmenttype;
}

- menuTarget:sender;
- (int) segmentType;

@end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
#import "SettingsPanel.h"
#import "PreferencePanel.h"

id	settingspanel_i;

@implementation SettingsPanel

- init
{
	settingspanel_i = self;
	segmenttype = ONESIDED_C;
	return self;
}


- menuTarget:sender
{
    return self;
}

- (int) segmentType
{
	return segmenttype;
}

@end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
#import <appkit/appkit.h>

@interface TexturePalView:View
{
}

@end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           nt:7,dps_tUInt:8,\ dps_tLong:9,dps_tULong:10,; DPSDefinedType:t24  :T25=edps_machServer:0,dps_fdServer:1,dps_stream:2,; DPSContextType:t25 DPSResultsRec:t26=s12type:24,0,32;count:1,32,32;\ value:20,64,32;; DPSResults:t27=*26 DPSSpaceRec:t28=s8lastNameIndex:1,0,32;procs:29=*30=xs_t_DPSSpaceProcsRec:,32,32;; DPSSpace:t31=*28 _t_DPSSpaceProcsRec:T30=s4DestroySpace:32=*33=f19,0,32;; DPSSpaceProcsRec:t30 DPSSpaceProcs:t34=*30 _t_DPSContextRec:T35=s48priv:20,0,32;space:31,32,32;\ programEncoding:22,64,32;nameEncoding:23,96,32;\ procs:36=*37=xs_t_DPSProcsRec:,128,32;textProc:38=*39=f19,160,32;\ errorProc:38,192,32;resultTable:27,224,32;resultTableLength:4,256,32;\ chainParent:40=*35,288,32;chainChild:40,320,32;\ type:25,352,32;; DPSContextRec:t35 DPSContext:t40 _t_DPSProcsRec:T37=s56BinObjSeqWrite:41=*42=f19,0,32;\ WriteTypedObjectArray:43=*44=f19,32,32;WriteStringChars:45=*46=f19,64,32;\ WriteData:41,96,32;WritePostScript:41,128,32;FlushContext:47=*48=f19,160,32;\ ResetContext:47,192,32;UpdateNameMap:47,224,32;\ AwaitReturnValues:47,256,32;Interrupt:47,288,32;\ DestroyContext:47,320,32;WaitContext:47,352,32;\ Printf:49=*50=f19,384,32;WriteNumString:51=*52=f19,416,32;; DPSProcsRec:t37 DPSProcs:t53=*37 NXCoord:t12 _NXPoint:T54=s8x:12,0,32;y:12,32,32;; NXPoint:t54 _NXSize:T55=s8width:12,0,32;height:12,32,32;; NXSize:t55 NXEventData:t56=u12mouse:57=s12reserved:8,0,16;\ eventNum:8,16,16;click:1,32,32;pressure:11,64,8;\ reserved1:2,72,8;reserved2:8,80,16;;,0,96;\ key:58=s12reserved:8,0,16;repeat:8,16,16;\ charSet:9,32,16;charCode:9,48,16;keyCode:9,64,16;\ keyData:8,80,16;;,0,96;tracking:59=s12reserved:8,0,16;\ eventNum:8,16,16;trackingNum:1,32,32;userData:1,64,32;;,0,96;\ compound:60=s12reserved:8,0,16;subtype:8,16,16;\ misc:61=u8F:62=ar1;0;1;12,0,64;L:63=ar1;0;1;3,0,64;\ S:64=ar1;0;3;8,0,64;C:65=ar1;0;7;2,0,64;;,32,64;;,0,96;; _NXEvent:T66=s40type:1,0,32;location:54,32,64;\ time:3,96,32;flags:1,128,32;window:4,160,32;\ data:56,192,96;ctxt:40,288,32;; NXEvent:t66 NXEventPtr:t67=*66 integer_t:t1 port_name_t:t1 port_t:t1 kern_return_t:t1 _NXStream:T68=s40magic_number:4,0,32;buf_base:69=*11,32,32;\ buf_ptr:69,64,32;buf_size:1,96,32;buf_left:1,128,32;\ offset:3,160,32;flags:1,192,32;eof:1,224,32;\ functions:70=*71=xsstream_functions:,256,32;info:72=*19,288,32;; NXStream:t68 stream_functions:T71=s28read_bytes:73=*74=f1,0,32;\ write_bytes:75=*76=f1,32,32;flush_buffer:77=*78=f1,64,32;\ fill_buffer:77,96,32;change_buffer:79=*80=f19,128,32;\ seek:81=*82=f19,160,32;destroy:79,192,32;; _NXZone:T83=s16realloc:84=*85=f72,0,32;malloc:86=*87=f72,32,32;\ free:88=*89=f19,64,32;destroy:90=*91=f19,96,32;; NXZone:t83 DPSEventFilterFunc:t92=*93=f1 DPSTimedEntry:t94=*95=xs__DPSTimedEntry: Class:t96=*97=xsobjc_class: objc_object:T98=s4isa:96,0,32;; id:t99=*98 SEL:t100=*101=xsobjc_selector: IMP:t102=*103=f99 BOOL:t2 objc_class:T97=s40isa:96,0,32;super_class:96,32,32;\ name:104=*2,64,32;version:3,96,32;info:3,128,32;\ instance_size:3,160,32;ivars:105=*106=xsobjc_ivar_list:,192,32;\ methods:107=*108=xsobjc_method_list:,224,32;cache:109=*110=xsobjc_cache:,256,32;\ protocols:111=*112=xsobjc_protocol_list:,288,32;; Ivar:t113=*114=xsobjc_ivar: objc_ivar:T114=s12ivar_name:20,0,32;ivar_type:20,32,32;\ ivar_offset:1,64,32;; objc_ivar_list:T106=s16ivar_count:1,0,32;ivar_list:115=ar1;0;0;114,32,96;; Method:t116=*117=xsobjc_method: objc_method:T117=s12method_name:100,0,32;method_types:20,32,32;\ method_imp:102,64,32;; objc_method_list:T108=s20method_next:107,0,32;method_count:1,32,32;\ method_list:118=ar1;0;0;117,64,96;; objc_protocol_list:T112=s12next:111,0,32;count:1,32,32;\ list:119=ar1;0;0;120=*121=xsProtocol:,64,32;; objc_cache:T110=s12mask:4,0,32;occupied:4,32,32;\ buckets:122=ar1;0;0;116,64,32;; Object:T123=s4isa:/196,0,32;; NXHashTablePrototype:Tt124=s16hash:125=*126=f4,0,32;isEqual:127=*128=f1,32,32;\ free:129=*130=f19,64,32;style:1,96,32;; NXHashTable:Tt131=s20prototype:132=*124,0,32;count:4,32,32;\ nbBuckets:4,64,32;buckets:72,96,32;info:133=*19,128,32;; NXAtom:t104 HashTable:T134=s24isa:/196,0,32;count:/14,32,32;\ keyDesc:/1104,64,32;valueDesc:/1104,96,32;_nbBuckets:/14,128,32;\ _buckets:/172,160,32;; List:T135=s16isa:/196,0,32;dataPtr:136=*99,32,32;\ numElements:4,64,32;maxElements:4,96,32;; NXBundle:T137=s20isa:/196,0,32;_directory:/020,32,32;\ _principalClass:/096,64,32;_codeLoaded:/02,96,8;\ _reserved1:/02,104,8;_reserved2:/02,112,8;_reserved3:/02,120,8;\ _bundleVersion:/01,128,32;; NXStringTable:T138=s24isa:/196,0,32;count:/14,32,32;\ keyDesc:/1104,64,32;valueDesc:/1104,96,32;_nbBuckets:/14,128,32;\ _buckets:/172,160,32;; objc_method_description:T139=s8name:100,0,32;types:20,32,32;; objc_method_description_list:T140=s12count:1,0,32;list:141=ar1;0;0;139,32,64;; Protocol:T121=s20isa:/196,0,32;protocol_name:/020,32,32;\ protocol_list:/0111,64,32;instance_methods:/0142=*140,96,32;\ class_methods:/0142,128,32;; Storage:T143=s24isa:/196,0,32;dataPtr:72,32,32;\ description:104,64,32;numElements:4,96,32;maxElements:4,128,32;\ elementSize:4,160,32;; StreamTable:T144=s24isa:/196,0,32;count:/14,32,32;\ keyDesc:/1104,64,32;valueDesc:/1104,96,32;_nbBuckets:/14,128,32;\ _buckets:/172,160,32;; _NXColor:T145=s16colorField:146=ar1;0;5;9,0,96;\ str:104,96,32;; NXColor:Tt145 _NXRect:T147=s16origin:54,0,64;size:55,64,64;; NXRect:Tt147 _NXColorSpace:T148=eNX_CustomColorSpace:-1,NX_OneIsBlackColorSpace:0,\ NX_OneIsWhiteColorSpace:1,NX_RGBColorSpace:2,NX_CMYKColorSpace:5,; NXColorSpace:t148 _cFlags1:T149=s4entryType:4,0,3;scrollable:4,3,1;\ selectable:4,4,1;bezeled:4,5,1;bordered:4,6,1;\ alignment:4,7,2;freeText:4,9,1;type:4,10,2;\ editable:4,12,1;disabled:4,13,1;highlighted:4,14,1;\ state:4,15,1;; _cFlags2:T150=s4dontActOnMouseUp:4,0,1;noWrap:4,1,1;\ _isLoaded:4,2,1;actOnMouseDragged:4,3,1;\ autoRange:4,4,1;floatRight:4,5,4;floatLeft:4,9,4;\ _isLeaf:4,13,1;actOnMouseDown:4,14,1;continuous:4,15,1;; __cFlags3:T151=s4isWhite:4,0,1;useUserKeyEquivalent:4,1,1;\ center:4,2,1;docEditing:4,3,1;docSaved:4,4,1;\ wasSelectable:4,5,1;RESERVED:4,6,10;; Cell:T152=s28isa:/196,0,32;contents:/120,32,32;\ support:/199,64,32;cFlags1:/1149,96,32;cFlags2:/1150,128,32;\ _cFlags3:/1151,160,32;_reservedCshort:/19,192,16;; ActionCell:T153=s44isa:/196,0,32;contents:/120,32,32;\ support:/199,64,32;cFlags1:/1149,96,32;cFlags2:/1150,128,32;\ _cFlags3:/1151,160,32;_reservedCshort:/19,192,16;\ tag:/11,224,32;target:/199,256,32;action:/1100,288,32;\ _view:/199,320,32;; Responder:T154=s12isa:/196,0,32;nextResponder:/199,32,32;\ _reserved:/199,64,32;; _objc_protocol:T155=s20isa:156=*157=xs_objc_class:,0,32;\ protocol_name:20,32,32;protocol_list:158=*159=*155,64,32;\ instance_methods:160=*161=xs_objc__method_prototype_list:,96,32;\ class_methods:160,128,32;; NXData:T162=s16isa:/196,0,32;data:/072,32,32;\ size:/04,64,32;dealloc:/02,96,8;; Pasteboard:T163=s56isa:/196,0,32;owner:/199,32,32;\ _realChangeCount:/11,64,32;_ourChangeCount:/11,96,32;\ _server:/11,128,32;_ownerArray:/1136,160,32;_numTypes:/11,192,32;\ _typesArray:/1164=*104,224,32;_client:/11,256,32;\ _typesProvided:/1165=*2,288,32;_name:/1104,320,32;\ _host:/1104,352,32;_serverVersion:/11,384,32;_reservedPasteboard4:/14,416,32;; time_t:t3 _lmFlags:T166=s4isEdited:4,0,1;doUI:4,1,1;\ showOutlines:4,2,1;registered:4,3,1;linksDirty:4,4,1;\ delegateVerifiesLinks:4,5,1;RESERVED:4,6,10;; NXDataLinkManager:T167=s48isa:/196,0,32;delegate:/099,32,32;\ ref:/099,64,32;srcLinks:/0168=*135,96,32;destLinks:/0168,128,32;\ lmFlags:/0166,160,32;destLinksCounter:/01,192,32;\ lastEditTime:/03,224,32;linkInfo:/0168,256,32;linkInfoPboard:/0169=*163,288,32;\ linkInfoChangeCount:/01,320,32;_reservedLinkManager1:/04,352,32;; NXLinkEnumerationState:Tt170=s8a:72,0,32;b:72,32,32;; NXLock:T171=s8isa:/196,0,32;_priv:/172,32,32;; NXInvalidationNotifier:T172=s20isa:/196,0,32;refcount:/14,32,32;\ isValid:/12,64,8;listGate:/1173=*171,96,32;funeralList:/1168,128,32;; NXConnection:T174=s72isa:/196,0,32;refcount:/14,32,32;\ isValid:/12,64,8;listGate:/1173,96,32;funeralList:/1168,128,32;\ delegate:/199,160,32;inPortal:/099,192,32;inMachPort:/072,224,32;\ outPortal:/099,256,32;outMachPort:/072,288,32;rootObject:/099,320,32;\ msgcount:/04,352,32;localProxies:/072,384,32;remoteProxies:/072,416,32;\ inTime#import	"TextureEdit.h"
#import	"TexturePalette.h"
#import	"DoomProject.h"
#import	"Wadfile.h"
#import	<ctype.h>
#import	"lbmfunctions.h"

id	textureEdit_i;
id	texturePatches;

@implementation TextureEdit

- init
{
	window_i = NULL;
	textureEdit_i = self;
	currentTexture = -1; 
	oldx = oldy = 0;
	return self;
}

//
// user wants to activate the Texture Editor. If it hasn't been used yet,
// init everything, otherwise just pull it back up.
//
- menuTarget:sender
{
	if (![doomproject_i loaded])
	{
		NXRunAlertPanel("Oops!",
						"There must be a project loaded before you even\n"
						"THINK about editing textures!",
						"OK",NULL,NULL,NULL);
		return self;
	}
	
	if (!window_i)
	{
		NXSize	s;
		NXRect	dvf;
		NXPoint	startPoint;
		
		[NXApp 
			loadNibSection:	"TextureEdit.nib"
			owner:			self
			withNames:		NO
		];
		
		[window_i	setDelegate:self];
		[self		computePatchDocView:&dvf];
		[texturePatchView_i	sizeTo:dvf.size.width :dvf.size.height];

		//
		// start patches at top
		//
		[texturePatchScrollView_i	getContentSize:&s];
		startPoint.x = 0;
		startPoint.y = dvf.size.height - s.height;
		[texturePatchView_i		scrollPoint:&startPoint];

		//
		// start texture editor at top
		//
		[textureView_i		getFrame:&dvf];
		[scrollView_i		getContentSize:&s];
		startPoint.y = dvf.size.height - s.height;
		[textureView_i		scrollPoint:&startPoint];
	
		[self	setCurrentEditPatch:-1];
		[self	setSelectedPatch:0];
	}
	
	[self	newSelection:currentTexture];
	[window_i	makeKeyAndOrderFront:NULL];
	return self;
}

//=====================================================
//
//	TEXTURE PATCH STUFF
//
//=====================================================


//
// move a patch up in the patch hierarchy
//
- sortUp:sender
{
	int	newpatch;
	texpatch_t	*t, t1, t2;

	if ((currentPatch < 0) || ([texturePatches	count] - 1 == currentPatch))
	{
		NXBeep();
		return self;
	}
	
	t = [texturePatches	elementAt:currentPatch];
	if (t->patchLocked)
	{
		NXBeep();
		return self;
	}
	
	newpatch = currentPatch;
	do
	{
		newpatch++;
		t = [texturePatches	elementAt:newpatch];
		if (!t)
		{
			NXBeep();
			return self;
		}
	} while (t->patchLocked);

	t2 = *t;
	t = [texturePatches	elementAt:currentPatch];
	t1 = *t;
	[texturePatches	removeElementAt:newpatch];
	[texturePatches	removeElementAt:currentPatch];
	[texturePatches	insertElement:&t2	at:currentPatch];
	[texturePatches	insertElement:&t1	at:newpatch];
	[self	setCurrentEditPatch:newpatch];

	[textureView_i		display];
	return self;
}

//
// move a patch down in the patch hierarchy
//
- sortDown:sender
{
	int	newpatch;
	texpatch_t	*t, t1, t2;

	if (currentPatch < 1)
	{
		NXBeep();
		return self;
	}
	
	t = [texturePatches	elementAt:currentPatch];
	if (t->patchLocked)
	{
		NXBeep();
		return self;
	}
	
	newpatch = currentPatch;
	do
	{
		newpatch--;
		t = [texturePatches	elementAt:newpatch];
		if (!t)
		{
			NXBeep();
			return self;
		}
	} while (t->patchLocked);

	t2 = *t;
	t = [texturePatches	elementAt:currentPatch];
	t1 = *t;
	[texturePatches	removeElementAt:currentPatch];
	[texturePatches	removeElementAt:newpatch];
	[texturePatches	insertElement:&t1	at:newpatch];
	[texturePatches	insertElement:&t2	at:currentPatch];
	[self	setCurrentEditPatch:newpatch];

	[textureView_i		display];
	return self;
}

- deleteCurrentPatch:sender
{
	if (currentPatch < 0)
	{
		NXBeep();
		return self;
	}
	[texturePatches	removeElementAt:currentPatch];
	[self	setCurrentEditPatch:-1];
	[textureView_i		display];
	return self;
}

//
// set which patch is selected in edit view
//
- setCurrentEditPatch:(int)which
{
	texpatch_t	*t;
	
	currentPatch = which;
	if (which >= 0)
	{
		t = [texturePatches	elementAt:which];
		[lockedPatch_i	setEnabled:YES];
		[lockedPatch_i	setIntValue:t->patchLocked];
		[texturePatchWidthField_i	setIntValue:t->r.size.width / 2];
		[texturePatchHeightField_i	setIntValue:t->r.size.height / 2];
		[texturePatchNameField_i	setStringValue:t->patchInfo.patchname];
	}
	else
	{
		[lockedPatch_i	setEnabled:NO];
		[texturePatchWidthField_i	setStringValue:NULL];
		[texturePatchHeightField_i	setStringValue:NULL];
		[texturePatchNameField_i	setStringValue:NULL];
	}
	return self;
}

//
// return which patch is selected in edit view
//
- (int)getCurrentEditPatch
{
	return currentPatch;
}

//
// patch lock switch was modified, so change patch flag
//
- doLockToggle
{
	[lockedPatch_i	setIntValue:1 - [lockedPatch_i intValue]];
	[self	togglePatchLock:NULL];
	return self;
}

- togglePatchLock:sender
{
	int	val;
	texpatch_t	*t;
	
	if (currentPatch < 0)
	{
		NXBeep();
		return self;
	}
	val = [lockedPatch_i	intValue];
	t = [texturePatches	elementAt:currentPatch];
	t->patchLocked = val;
	return self;
}

//
// return current patch in edit window
//
- (int)getCurrentPatch
{
	return	selectedPatch;
}

//
// the "outline patches" switch was modified, so redraw edit view
//
- outlineWasSet:sender
{
	[window_i	display];
	return self;
}

//
// return status of outline switch
//
- (int)getOutlineFlag
{
	return [outlinePatches_i		intValue];
}

//
// return * to patch image object
//
- (apatch_t *)getPatch:(int)which
{
	return	[patchImages	elementAt:which];
}

//=====================================================
//
//	TEXTURE STUFF
//
//=====================================================


//
// user changed the width/height/title of the texture. validate & change.
//
- changedWidth:sender
{
	worldtexture_t		tex;
	texpatch_t		*p;
	int		count;
	NXRect	tr;
	
	//
	// was width reduced?
	//
	if ([textureWidthField_i	intValue] < textures[currentTexture].width - 10)
	{
		NXSetRect(&tr,0,0,textures[currentTexture].width * 2,textures[currentTexture].height * 2);
		count = 0;
		while((p = [texturePatches	elementAt:count++]) != NULL)
			if (NXIntersectsRect(&p->r,&tr) == NO)
			{
				NXBeep();
				NXRunAlertPanel("Oops!",
								"Changing the width like that would leave one or more "
								"patches out in limbo!  Sorry, non-workness!",
								"OK",NULL,NULL);
				return self;
			}
		
	}

	tex = textures[currentTexture];
	tex.width = [textureWidthField_i	intValue];
	[doomproject_i	changeTexture:currentTexture to:&tex];
	[texturePalette_i		storeTexture:currentTexture];
	[self	newSelection:currentTexture];
	return self;
}

- changedHeight:sender
{
	return self;
}

- changedTitle:sender
{
	return self;
}

//
// create a new texture
//
- makeNewTexture:sender
{
	int	textureNum,rcode;
	worldtexture_t		tex;
	
	if (![doomproject_i loaded])
		return self;
		
	//
	// create a default new texture
	//
	rcode = [NXApp	runModalFor:createTexture_i];
	[createTexture_i	close];
	if (rcode == NX_RUNABORTED)
		return self;

	tex.width = [createWidth_i	intValue];
	tex.height = [createHeight_i	intValue];
	memset(tex.name,0,9);
	strncpy(tex.name,[createName_i	stringValue],8);
	tex.patchcount = 0;
	
	//
	// add it to the world and edit it
	//
	textureNum = [doomproject_i	newTexture: &tex];
	[texturePalette_i	storeTexture: textureNum];
	[self	newSelection:textureNum];
	currentTexture = textureNum;
	//
	// load in all the texture patches
	//
	if (texturePatches)
		[texturePatches	free];
	texturePatches = [[	Storage	alloc]
					initCount:		0
					elementSize:	sizeof(texpatch_t)
					description:	NULL];
	[texturePalette_i	selectTexture:currentTexture];
	oldx = oldy = 0;			
	return self;
}

//
// clicked the "create it!" button in the New Texture dialog
//
- createTextureDone:sender
{
	char name[9];
	
	// clip texture name to 8 characters
	bzero(name,9);
	strncpy(name,[createName_i	stringValue],8);
	strupr(name);
	[createName_i	setStringValue:name];

	if (	[doomproject_i	textureNamed:name] >= -1)
	{
		NXBeep();
		NXRunAlertPanel("Oops!",
						"You already have a texture with the same name!",
						"OK",NULL, NULL, NULL);
		return self;
	}
	
	if (	[createWidth_i	intValue] &&
		[createHeight_i	intValue] &&
		strlen([createName_i	stringValue]))
		[NXApp	stopModal];
	else
		NXBeep();

	return self;
}

- createTextureAbort:sender
{
	[NXApp	abortModal];
	return self;
}

//
// done editing texture. add to texture palette
//
- finishTexture:sender
{
	int	count;
	texpatch_t	*t;
	worldtexture_t		tex;
	
	//
	// copy texture info into textures array, then
	// add texture to palette
	//
	count = 0;
	tout:/01,448,32;outTimeout:/01,480,32;zone:/0175=*83,512,32;\ bufferClass:/099,544,32;; __appFlags:T176=s4hidden:4,0,1;autoupdate:4,1,1;\ active:4,2,1;_hasBeenRun:4,3,1;_RESERVED:4,4,7;\ _doingUnhide:4,11,1;_delegateReturnsValidRequestor:4,12,1;\ _deactPending:4,13,1;_invalidState:4,14,1;\ _invalidEvent:4,15,1;; Application:T177=s164isa:/196,0,32;nextResponder:/199,32,32;\ _reserved:/199,64,32;appName:/120,96,32;currentEvent:/166,128,320;\ windowList:/199,448,32;keyWindow:/199,480,32;mainWindow:/199,512,32;\ delegate:/199,544,32;hiddenList:/1178=*1,576,32;\ hiddenCount:/11,608,32;hostName:/1104,640,32;context:/140,672,32;\ contextNum:/11,704,32;appListener:/199,736,32;\ appSpeaker:/199,768,32;replyPort:/11,800,32;screenSize:/155,832,64;\ running:/18,896,16;appFlags:/1176,928,32;_reservedApp4:/199,960,32;\ _focusStack:/199,992,32;_freelist:/199,1024,32;_pboard:/199,1056,32;\ _mainMenu:/199,1088,32;_appIcon:/199,1120,32;_nameTable:/199,1152,32;\ _printInfo:/199,1184,32;_reservedApp1:/14,1216,32;\ _reservedApp2:/14,1248,32;_reservedApp3:/14,1280,32;; __repFlags:T179=s4hasAlpha:4,0,1;numColors:4,1,3;\ bitsPerSample:4,4,6;dataSource:4,10,3;dataLoaded:4,13,1;\ isOpaque:4,14,1;; NXImageRep:T180=s28isa:/196,0,32;_repFlags:/1179,32,32;\ size:/155,64,64;_pixelsWide:/11,128,32;_pixelsHigh:/11,160,32;\ _gsaved:/11,192,32;; __imageFlags:T181=s4unboundedCacheDepth:4,0,1;archiveByName:4,1,1;\ aSynch:4,2,1;subImage:4,3,1;dontFreeName:4,4,1;\ multipleResolutionMatching:4,5,1;colorMatchPreferred:4,6,1;\ useEPSOnResolutionMismatch:4,7,1;needsToExpand:4,8,1;\ builtIn:4,9,1;sizeWasExplicitlySet:4,10,1;\ uniqueWasExplicitlySet:4,11,1;uniqueWindow:4,12,1;\ flipDraw:4,13,1;dataRetained:4,14,1;scalable:4,15,1;; NXImage:T182=s40isa:/196,0,32;name:/120,32,32;\ _size:/155,64,64;_flags:/1181,128,32;_reservedShort:/18,160,16;\ _reps:/172,192,32;_repList:/1168,224,32;_color:/1183=*145,256,32;\ _reservedInt:/11,288,32;; _wFlags:T184=s4oneShot:4,0,1;dontFreeWhenClosed:4,1,1;\ hideOnDeactivate:4,2,1;isPanel:4,3,1;isKeyWindow:4,4,1;\ isMainWindow:4,5,1;visible:4,6,1;buttonMask:4,7,3;\ backing:4,10,2;style:4,12,4;; _wFlags2:T185=s4_floatingPanel:4,0,1;_hiddenOnDeactivate:4,1,1;\ _tempHidden:4,2,1;_windowDying:4,3,1;_repostedFirstMouse:4,4,1;\ _ignoredFirstMouse:4,5,1;_RESERVED:4,6,1;\ _needsFlush:4,7,1;_limitedBecomeKey:4,8,1;\ _worksWhenModal:4,9,1;dynamicDepthLimit:4,10,1;\ docEdited:4,11,1;_validCursorRects:4,12,1;\ _haveFreeCursorRects:4,13,1;_cursorRectsDisabled:4,14,1;\ deferred:4,15,1;; Window:T186=s104isa:/196,0,32;nextResponder:/199,32,32;\ _reserved:/199,64,32;frame:/1147,96,128;contentView:/199,224,32;\ delegate:/199,256,32;firstResponder:/199,288,32;\ lastLeftHit:/199,320,32;lastRightHit:/199,352,32;\ counterpart:/199,384,32;fieldEditor:/199,416,32;\ winEventMask:/11,448,32;windowNum:/11,480,32;\ backgroundGray:/112,512,32;wFlags:/1184,544,32;wFlags2:/1185,576,32;\ _borderView:/199,608,32;_displayDisabled:/18,640,16;\ _flushDisabled:/18,656,16;_cursorRects:/172,672,32;\ _trectTable:/1187=*131,704,32;_invalidCursorView:/199,736,32;\ _miniIcon:/199,768,32;_private:/172,800,32;; __vFlags:T188=s4_hasDirtySubview:4,0,1;_noVerticalAutosizing:4,1,1;\ _RESERVED:4,2,2;newGState:4,4,1;validGState:4,5,1;\ needsDisplay:4,6,1;disableAutodisplay:4,7,1;\ opaque:4,8,1;rotatedOrScaledFromBase:4,9,1;\ rotatedFromBase:4,10,1;needsFlipped:4,11,1;\ alreadyFlipped:4,12,1;drawInSuperview:4,13,1;\ translatedDraw:4,14,1;noClip:4,15,1;; ___vFlags:T189=s4mark:4,0,1;specialClip:4,1,1;\ noDisplayOnScroll:4,2,1;noCopyOnScroll:4,3,1;\ wantsGState:4,4,1;notifyToInitGState:4,5,1;\ needsAncestorNotify:4,6,1;ancestorNotifyWasEnabled:4,7,1;\ notifyWhenFlipped:4,8,1;autoresizeSubviews:4,9,1;\ autosizing:4,10,6;; View:T190=s84isa:/196,0,32;nextResponder:/199,32,32;\ _reserved:/199,64,32;frame:/1147,96,128;bounds:/1147,224,128;\ superview:/199,352,32;subviews:/199,384,32;window:/199,416,32;\ vFlags:/1188,448,32;_vFlags:/1189,480,32;_gState:/11,512,32;\ _frameMatrix:/199,544,32;_drawMatrix:/199,576,32;\ _dragTypes:/1164,608,32;_vPrivate:/172,640,32;; _bFlags:T191=s4_RESERVED:4,0,10;_transparent:4,10,1;\ titlePosition:4,11,3;borderType:4,14,2;; Box:T192=s136isa:/196,0,32;nextResponder:/199,32,32;\ _reserved:/199,64,32;frame:/1147,96,128;bounds:/1147,224,128;\ superview:/199,352,32;subviews:/199,384,32;window:/199,416,32;\ vFlags:/1188,448,32;_vFlags:/1189,480,32;_gState:/11,512,32;\ _frameMatrix:/199,544,32;_drawMatrix:/199,576,32;\ _dragTypes:/1164,608,32;_vPrivate:/172,640,32;cell:/199,672,32;\ contentView:/199,704,32;offsets:/155,736,64;borderRect:/1147,800,128;\ titleRect:/1147,928,128;bFlags:/1191,1056,32;; _conFlags:T193=s4_RESERVED:4,0,11;_drawingAncestor:4,11,1;\ calcSize:4,12,1;ignoreMultiClick:4,13,1;editingValid:4,14,1;\ enabled:4,15,1;; Control:T194=s100isa:/196,0,32;nextResponder:/199,32,32;\ _reserved:/199,64,32;frame:/1147,96,128;bounds:/1147,224,128;\ superview:/199,352,32;subviews:/199,384,32;window:/199,416,32;\ vFlags:/1188,448,32;_vFlags:/1189,480,32;_gState:/11,512,32;\ _frameMatrix:/199,544,32;_drawMatrix:/199,576,32;\ _dragTypes:/1164,608,32;_vPrivate:/172,640,32;tag:/11,672,32;\ cell:/199,704,32;conFlags:/1193,736,32;_reservedCshort1:/19,768,16;; Button:T195=s100isa:/196,0,32;nextResponder:/199,32,32;\ _reserved:/199,64,32;frame:/1147,96,128;bounds:/1147,224,128;\ superview:/199,352,32;subviews:/199,384,32;window:/199,416,32;\ vFlags:/1188,448,32;_vFlags:/1189,480,32;_gState:/11,512,32;\ _frameMatrix:/199,544,32;_drawMatrix:/199,576,32;\ _dragTypes:/1164,608,32;_vPrivate:/172,640,32;tag:/11,672,32;\ cell:/199,704,32;conFlags:/1193,736,32;_reservedCshort1:/19,768,16;; _bmap:T196=s8normal:99,0,32;alternate:99,32,32;; _ke:T197=s8font:99,0,32;descent:12,32,32;; _icon:T198=u8bmap:196,0,64;ke:197,0,64;; _bcFlags1:T199=s4iconIsKeyEquivalent:4,0,1;iconSizeDiff:4,1,1;\ lastState:4,2,1;iconAndText:4,3,1;bottomOrLeft:4,4,1;\ horizontal:4,5,1;iconOverlaps:4,6,1;bordered:4,7,1;\ hasAlpha:4,8,1;lightByGray:4,9,1;lightByBackground:4,10,1;\ lightByContents:4,11,1;changeGray:4,12,1;\ changeBackground:4,13,1;changeContents:4,14,1;\ pushIn:4,15,1;; _bcFlags2:T200=s4_momentarySound:4,0,1;_inset:4,1,2;\ _RESERVED:4,3,4;transparent:4,7,1;keyEquivalent:4,8,8;; ButtonCell:T201=s72isa:/196,0,32;contents:/120,32,32;\ support:/199,64,32;cFlags1:/1149,96,32;cFlags2:/1150,128,32;\ _cFlags3:/1151,160,32;_reservedCshort:/19,192,16;\ tag:/11,224,32;target:/199,256,32;action:/1100,288,32;\ _view:/199,320,32;altContents:/120,352,32;icon:/1198,384,64;\ sound:/199,448,32;bcFlags1:/1199,480,32;bcFlags2:/1200,512,32;\ periodicDelay:/19,544,16;periodicInterval:/19,560,16;; Panel:T202=s104isa:/196,0,32;nextResponder:/199,32,32;\ _reserved:/199,64,32;frame:/1147,96,128;contentView:/199,224,32;\ delegate:/199,256,32;firstResponder:/199,288,32;\ lastLeftHit:/199,320,32;lastRightHit:/199,352,32;\ counterpart:/199,384,32;fieldEditor:/199,416,32;\ winEventMask:/11,448,32;windowNum:/11,480,32;\ backgroundGray:/112,512,32;wFlags:/1184,544,32;wFlags2:/1185,576,32;\ _borderView:/199,608,32;_displayDisabled:/18,640,16;\ _flushDisabled:/18,656,16;_cursorRects:/172,672,32;\ _trectTable:/1187,704,32;_invalidCursorView:/199,736,32;\ _miniIcon:/199,768,32;_private:/172,800,32;; ChoosePrinter:T203=s160isa:/196,0,32;nextResponder:/199,32,32;\ _reserved:/199,64,32;frame:/1147,96,128;contentView:/199,224,32;\ delegate:/199,256,32;firstResponder:/199,288,32;\ lastLeftHit:/199,320,32;lastRightHit:/199,352,32;\ counterpart:/199,384,32;fieldEditor:/199,416,32;\ winEventMask:/11,448,32;windowNum:/11,480,32;\ backgroundGray:/112,512,32;wFlags:/1184,544,32;wFlags2:/1185,576,32;\ _borderView:/199,608,32;_displayDisabled:/18,640,16;\ _flushDisabled:/18,656,16;_cursorRects:/172,672,32;\ _trectTable:/1187,704,32;_invalidCursorView:/199,736,32;\ _miniIcon:/199,768,32;_private:/172,800,32;appIcon:/199,832,32;\ ok:/199,864,32;cancel:/199,896,32;border:/199,928,32;\ exitTag:/11,960,32;name:/199,992,32;type:/199,1024,32;\ note:/199,1056,32;_lastValues:/1204=*104,1088,32;accessoryView:/199,1120,32;\ _reservedChoosePrinter1:/14,1152,32;_reservedChoosePrinter2:/14,1184,32;\ _reservedChoosePrinter3:/14,1216,32;_reservedChoosePrinter4:/14,1248,32;; __clFlagex.patchcount = [texturePatches count];
	tex.width = textures[currentTexture].width;
	tex.height = textures[currentTexture].height;
	strcpy(tex.name,textures[currentTexture].name);
	while ([texturePatches	elementAt:count] != NULL)
	{
		t = [texturePatches elementAt:count];
		tex.patches[count] = t->patchInfo;
		count++;
	}
	[doomproject_i	changeTexture:currentTexture to:&tex];
	[texturePalette_i		storeTexture:currentTexture];
	
	return self;
}

//
// change to a new texture
//
- newSelection:(int)which
{
	texpatch_t	t;
	int	count,i;

	currentTexture = which;
	if (texturePatches)
		[texturePatches	free];
	
	texturePatches = [[	Storage	alloc]
					initCount:		0
					elementSize:	sizeof(texpatch_t)
					description:	NULL];
	
	//
	// copy textures from textures array to texturePatches
	//
	count = textures[which].patchcount;
	for (i = 0;i < count; i++)
	{
		t.patchLocked = 0;
		t.patchInfo = textures[which].patches[i];
		t.patch = [self	getPatchImage:t.patchInfo.patchname];
		t.r.origin.x = t.patchInfo.originx * 2;
		t.r.origin.y = (textures[which].height * 2) - 
					(t.patch->r.size.height * 2) - 
					(t.patchInfo.originy * 2);
		t.r.size.width = t.patch->r.size.width * 2;
		t.r.size.height = t.patch->r.size.height * 2;
		[texturePatches	addElement:&t];
	}	
	
	currentPatch = -1;
	[textureView_i		sizeTo:textures[currentTexture].width * 2
					:textures[currentTexture].height * 2];
	[textureView_i		display];
	
	[textureWidthField_i	setIntValue:textures[currentTexture].width];
	[textureHeightField_i	setIntValue:textures[currentTexture].height];
	[textureNameField_i	setStringValue:textures[currentTexture].name];
	
	return self;
}

//
// return which texture we're working on
//
- (int)getCurrentTexture
{
	return currentTexture;
}

- setOldVars:(int)x :(int)y
{
	oldx = x;
	oldy = y;
	return self;
}

//
// user double-clicked on patch in patch palette.
// add that patch to the texture definition.
//
- addPatch:(int)which
{
	int	start;
	NXRect	dvr;
	texpatch_t	p;
	
	[scrollView_i	getDocVisibleRect:&dvr];
	
	if (currentTexture < 0)
	{
		NXBeep();
		return self;
	}
	
	if ([texturePatches	count] == MAXPATCHES)
	{
		NXRunAlertPanel(	"Um!",
						"A maximum of 100 patches is in force!",
						"OK",NULL,NULL);
		return self;
	}
	
	memset(&p,0,sizeof(p));
	p.patchLocked = 0;
	p.patch = [patchImages	elementAt:which];

	if ([centerPatch_i intValue])
	{
		p.patchInfo.originx = dvr.origin.x/2 + dvr.size.width/4;
		p.patchInfo.originy = dvr.origin.y/2 + dvr.size.height/4;
	}
	else
	{
		if (oldx > textures[currentTexture].width)
		{
			NXBeep();
			[centerPatch_i	setIntValue:1];
			p.patchInfo.originx = dvr.origin.x/2 + dvr.size.width/4;
			p.patchInfo.originy = dvr.origin.y/2 + dvr.size.height/4;
		}
		else
		{
			p.patchInfo.originx = oldx;
			p.patchInfo.originy = oldy;
		}
	}
	oldx += p.patch->r.size.width;
	
	start = [wadfile_i	lumpNamed:"p_start"] + 1;
	memset(p.patchInfo.patchname,0,9);
	strcpy(p.patchInfo.patchname,[wadfile_i	lumpname:which + start]);
	p.patchInfo.stepdir = 1;
	p.patchInfo.colormap = 0;

	p.r.origin.x = p.patchInfo.originx * 2;
	p.r.origin.y = (textures[currentTexture].height * 2) - 
				(p.patch->r.size.height * 2) - 
				(p.patchInfo.originy * 2);
	p.r.size.width = p.patch->r.size.width * 2;
	p.r.size.height = p.patch->r.size.height * 2;
	
	[texturePatches	addElement:&p];
	currentPatch = [texturePatches	count] - 1; 
	[textureView_i		scrollRectToVisible:&p.r];
	[textureView_i		display];
	return self;
}

- fillWithPatch:sender
{
	return self;
}

- sizeChanged:sender
{
	return self;
}

//=====================================================
//
//	PATCH PALETTE STUFF
//
//=====================================================

- (apatch_t *)getPatchImage:(char *)name
{
	int	start;
	start = [wadfile_i	lumpNamed:"p_start"] + 1;
	return [patchImages		elementAt:[wadfile_i  lumpNamed:name] - start];
}

//
// set patch selected in Patch Palette
//
- setSelectedPatch:(int)which
{
	apatch_t	*t;
	int	start;
	
	start = [wadfile_i	lumpNamed:"p_start"] + 1;
	selectedPatch = which;
	t = [patchImages	elementAt:which];
	[patchWidthField_i		setIntValue:t->r.size.width];
	[patchHeightField_i	setIntValue:t->r.size.height];
	[patchNameField_i		setStringValue:[wadfile_i  lumpname:which + start]];
	return self;
}

//
// load in all the patches and init storage array
//
- initPatches
{
	int	patchStart, patchEnd, i;
	patch_t *patch;
	byte *palLBM;
	apatch_t	p;
	NXSize	s;

	palLBM = [wadfile_i	loadLumpNamed:"playpal"];
	
	//
	// get inclusive lump #'s for patches
	//
	patchStart = [wadfile_i	lumpNamed:"p_start"] + 1;
	patchEnd = [wadfile_i	lumpNamed:"p_end"];

	if (patchStart == -1)
	{
		NXRunAlertPanel(	"OOPS!",
						"There are NO PATCHES in the current .WAD file!",
						"Abort Patch Palette",NULL,NULL,NULL);
		free(palLBM);
		return self;
	}
	
	patchImages = [[Storage	alloc]
						initCount:		0
						elementSize:	sizeof(apatch_t)
						description:	NULL];
	
	NXSetRect(&p.r,0,0,0,0);
	for (i = patchStart; i < patchEnd; i++)
	{
		NXSize	theSize;
		//
		// load vertically compressed patch and convert to an NXImage
		//
		patch = [wadfile_i	loadLump:i];
		p.image = patchToImage(patch,palLBM,&s);
		//
		// make a copy that's 2 times the size
		//
		p.image_x2 = [p.image	copyFromZone:NXDefaultMallocZone()];
		theSize = s;
		theSize.width *= 2;
		theSize.height *= 2;
		[p.image_x2	setScalable:YES];
		[p.image_x2	setSize:&theSize];
		
		p.r.size = s;
		[patchImages	addElement:&p];
		free(patch);
	}
	
	free(palLBM);
	return self;
}

//
// user resized the Texture Edit window.
// change the size of the patch palette.
//
- windowDidResize:sender
{
	NXRect	r;
	
	[self		computePatchDocView:&r];
	[texturePatchView_i	sizeTo:r.size.width :r.size.height];
	[window_i	display];
	return self;
}

//
// compute the size of the docView and set the origin of all the patches
// within the docView.
//
- computePatchDocView: (NXRect *)theframe
{
	NXRect	curWindowRect;
	int	x, y, patchnum, maxheight;
	apatch_t		*patch;
	
	[texturePatchScrollView_i		getDocVisibleRect:&curWindowRect];
	x = y =  SPACING;
	maxheight = patchnum = 0;
	while ((patch = [patchImages	elementAt:patchnum++]) != NULL)
	{
		if (x + patch->r.size.width > curWindowRect.size.width && x != SPACING)
		{
			x = SPACING;
			y += maxheight + SPACING;
			maxheight = 0;
		}
		
		patch->r.origin.x = x;
		patch->r.origin.y = y;
		
		if (patch->r.size.height > maxheight)
			maxheight = patch->r.size.height;

		if (x + patch->r.size.width > curWindowRect.size.width && x == SPACING)
		{
			y += maxheight + SPACING;
			maxheight = 0;
		}			
		else
			x += patch->r.size.width + SPACING;
	}
	y += maxheight + SPACING;
	NXSetRect(theframe,0,0,curWindowRect.size.width + SPACING,y);
	
	//
	// now go through all the patches and reassign the coords so they
	// stack from top to bottom...
	//
	maxheight = patchnum = 0;
	x = theframe->origin.x + SPACING;
	y = theframe->origin.y + theframe->size.height - SPACING;
	while ((patch = [patchImages	elementAt:patchnum++]) != NULL)
	{
		if (x + patch->r.size.width > curWindowRect.size.width && x != SPACING)
		{
			x = SPACING;
			y -= maxheight + SPACING;
			maxheight = 0;
		}
		
		patch->r.origin.x = x;
		patch->r.origin.y = y - patch->r.size.height;

		if (patch->r.size.height > maxheight)
			maxheight = patch->r.size.height;

		if (x + patch->r.size.width > curWindowRect.size.width && x == SPACING)
		{
			y -= maxheight + SPACING;
			maxheight = 0;
		}			
		else
			x += patch->r.size.width + SPACING;
	}	

	return self;
}


@end

//---------------------------------------------------------------
//
// C ROUTINES
//
//---------------------------------------------------------------



//
// convert a compressed patch to an NXImage with an alpha channel
//
id	patchToImage(patch_t *patchData,byte const *lbmpalette,NXSize *size)
{
	byte			*dest_p;
	NXImageRep *image_i;
	id			fastImage_i;
	unsigned short	shortpal[256];
	int			width,height,count,topdelta;
	byte const	*data;
	int			i,index;

	width = patchData->width;
	height = patchData->height;
	size->width = width;
	size->height = height;
	//
	// make an NXimage to hold the data
	//
	image_i = [[NXBitmapImageRep alloc]
		initData:			NULL 
		pixelsWide:s:T205=s4_scrollClipTo:4,0,1;_usedByCell:4,1,1;\ _reflectScroll:4,2,1;_onlyUncovered:4,3,1;\ _RESERVED:4,4,11;isGraySet:4,15,1;; ClipView:T206=s120isa:/196,0,32;nextResponder:/199,32,32;\ _reserved:/199,64,32;frame:/1147,96,128;bounds:/1147,224,128;\ superview:/199,352,32;subviews:/199,384,32;window:/199,416,32;\ vFlags:/1188,448,32;_vFlags:/1189,480,32;_gState:/11,512,32;\ _frameMatrix:/199,544,32;_drawMatrix:/199,576,32;\ _dragTypes:/1164,608,32;_vPrivate:/172,640,32;backgroundGray:/112,672,32;\ docView:/199,704,32;_docRect:/1147,736,128;cursor:/199,864,32;\ _private:/172,896,32;_clFlags:/1205,928,32;; NXCharMetrics:Tt207=s32charCode:8,0,16;numKernPairs:11,16,8;\ reserved:11,24,8;xWidth:12,32,32;name:1,64,32;\ bbox:208=ar1;0;3;12,96,128;kernPairIndex:1,224,32;; NXLigature:Tt209=s12firstCharIndex:1,0,32;secondCharIndex:1,32,32;\ ligatureIndex:1,64,32;; NXEncodedLigature:Tt210=s4firstChar:11,0,8;secondChar:11,8,8;\ ligatureChar:11,16,8;reserved:11,24,8;; NXKernPair:Tt211=s12secondCharIndex:1,0,32;dx:12,32,32;\ dy:12,64,32;; NXKernXPair:Tt212=s8secondCharIndex:1,0,32;dx:12,32,32;; NXTrackKern:Tt213=s20degree:1,0,32;minPointSize:12,32,32;\ minKernAmount:12,64,32;maxPointSize:12,96,32;\ maxKernAmount:12,128,32;; NXCompositeChar:Tt214=s12compCharIndex:1,0,32;numParts:1,32,32;\ firstPartIndex:1,64,32;; NXCompositeCharPart:Tt215=s12partIndex:1,0,32;dx:12,32,32;\ dy:12,64,32;; _NXFontMetrics:T216=s164formatVersion:20,0,32;name:20,32,32;\ fullName:20,64,32;familyName:20,96,32;weight:20,128,32;\ italicAngle:12,160,32;isFixedPitch:2,192,8;isScreenFont:2,200,8;\ screenFontSize:8,208,16;fontBBox:208,224,128;underlinePosition:12,352,32;\ underlineThickness:12,384,32;version:20,416,32;\ notice:20,448,32;encodingScheme:20,480,32;capHeight:12,512,32;\ xHeight:12,544,32;ascender:12,576,32;descender:12,608,32;\ widths:217=*12,640,32;widthsLength:4,672,32;strings:20,704,32;\ stringsLength:4,736,32;hasYWidths:8,768,16;hasXYKerns:2,784,8;\ reserved:2,792,8;encoding:218=*8,800,32;yWidths:217,832,32;\ charMetrics:219=*207,864,32;numCharMetrics:1,896,32;\ ligatures:220=*209,928,32;numLigatures:1,960,32;\ encLigatures:221=*210,992,32;numEncLigatures:1,1024,32;\ kerns:222=u4kernPairs:223=*211,0,32;kernXPairs:224=*212,0,32;;,1056,32;\ numKernPairs:1,1088,32;trackKerns:225=*213,1120,32;\ numTrackKerns:1,1152,32;compositeChars:226=*214,1184,32;\ numCompositeChars:1,1216,32;compositeCharParts:227=*215,1248,32;\ numCompositeCharParts:1,1280,32;; NXFontMetrics:Tt216 _fontFlags:T228=s4usedInDoc:4,0,1;usedInPage:4,1,1;\ usedInSheet:4,2,1;_PADDING:4,3,13;; _NXFaceInfo:T229=s16fontMetrics:230=*216,0,32;flags:1,32,32;\ fontFlags:228,64,32;nextFInfo:231=*229,96,32;; NXFaceInfo:Tt229 _fFlags:T232=s4_hasStyle:4,0,1;_matrixIsFlipped:4,1,1;\ _matrixIsIdentity:4,2,1;_RESERVED:4,3,6;\ _systemFontType:4,9,4;isScreenFont:4,13,1;\ usedByPrinter:4,14,1;usedByWS:4,15,1;; Font:T233=s44isa:/196,0,32;name:/1104,32,32;\ size:/112,64,32;style:/11,96,32;matrix:/1217,128,32;\ fontNum:/11,160,32;faceInfo:/1234=*229,192,32;otherFont:/199,224,32;\ fFlags:/1232,256,32;_reservedFont2:/19,288,16;_reservedFont3:/14,320,32;; NXFontTraitMask:t4 _fmFlags:T235=s4multipleFont:4,0,1;disabled:4,1,1;\ _RESERVED:4,2,14;; FontManager:T236=s52isa:/196,0,32;panel:/199,32,32;\ menu:/199,64,32;action:/1100,96,32;whatToDo:/11,128,32;\ traitToChange:/14,160,32;selFont:/199,192,32;fmFlags:/1235,224,32;\ _lastPos:/19,256,16;delegate:/199,288,32;_reservedFMint2:/14,320,32;\ _reservedFMint3:/14,352,32;_reservedFMint4:/14,384,32;; _fpFlags:T237=s4multipleFont:4,0,1;dirty:4,1,1;\ _RESERVED:4,2,11;_amPreviewing:4,13,1;_alwaysPreview:4,14,1;\ _dontPreview:4,15,1;; FontPanel:T238=s192isa:/196,0,32;nextResponder:/199,32,32;\ _reserved:/199,64,32;frame:/1147,96,128;contentView:/199,224,32;\ delegate:/199,256,32;firstResponder:/199,288,32;\ lastLeftHit:/199,320,32;lastRightHit:/199,352,32;\ counterpart:/199,384,32;fieldEditor:/199,416,32;\ winEventMask:/11,448,32;windowNum:/11,480,32;\ backgroundGray:/112,512,32;wFlags:/1184,544,32;wFlags2:/1185,576,32;\ _borderView:/199,608,32;_displayDisabled:/18,640,16;\ _flushDisabled:/18,656,16;_cursorRects:/172,672,32;\ _trectTable:/1187,704,32;_invalidCursorView:/199,736,32;\ _miniIcon:/199,768,32;_private:/172,800,32;faces:/199,832,32;\ families:/199,864,32;preview:/199,896,32;current:/199,928,32;\ size:/199,960,32;sizes:/199,992,32;manager:/199,1024,32;\ selFont:/199,1056,32;selMetrics:/1230,1088,32;curTag:/11,1120,32;\ accessoryView:/199,1152,32;_keyBuffer:/120,1184,32;\ setButton:/199,1216,32;separator:/199,1248,32;sizeTitle:/199,1280,32;\ lastPreview:/120,1312,32;fpFlags:/1237,1344,32;_reservedFPshort1:/19,1376,16;\ _lastKeyTime:/13,1408,32;_chooser:/199,1440,32;_titles:/199,1472,32;\ _previewBox:/199,1504,32;; _mFlags:T239=s4_drawingAncestor:4,0,1;_autosizeCells:4,1,1;\ _RESERVED:4,2,7;selectionByRect:4,9,1;reaction:4,10,1;\ autoscroll:4,11,1;allowEmptySel:4,12,1;listMode:4,13,1;\ radioMode:4,14,1;highlightMode:4,15,1;; Matrix:T240=s204isa:/196,0,32;nextResponder:/199,32,32;\ _reserved:/199,64,32;frame:/1147,96,128;bounds:/1147,224,128;\ superview:/199,352,32;subviews:/199,384,32;window:/199,416,32;\ vFlags:/1188,448,32;_vFlags:/1189,480,32;_gState:/11,512,32;\ _frameMatrix:/199,544,32;_drawMatrix:/199,576,32;\ _dragTypes:/1164,608,32;_vPrivate:/172,640,32;tag:/11,672,32;\ cell:/199,704,32;conFlags:/1193,736,32;_reservedCshort1:/19,768,16;\ cellList:/199,800,32;target:/199,832,32;action:/1100,864,32;\ selectedCell:/199,896,32;selectedRow:/11,928,32;\ selectedCol:/11,960,32;numRows:/11,992,32;numCols:/11,1024,32;\ cellSize:/155,1056,64;intercell:/155,1120,64;backgroundGray:/112,1184,32;\ cellBackgroundGray:/112,1216,32;font:/199,1248,32;\ protoCell:/199,1280,32;cellClass:/199,1312,32;nextText:/199,1344,32;\ previousText:/199,1376,32;doubleAction:/1100,1408,32;\ errorAction:/1100,1440,32;textDelegate:/199,1472,32;\ mFlags:/1239,1504,32;_reservedMshort1:/19,1536,16;\ _reservedMint1:/14,1568,32;_private:/172,1600,32;; FormCell:T241=s60isa:/196,0,32;contents:/120,32,32;\ support:/199,64,32;cFlags1:/1149,96,32;cFlags2:/1150,128,32;\ _cFlags3:/1151,160,32;_reservedCshort:/19,192,16;\ tag:/11,224,32;target:/199,256,32;action:/1100,288,32;\ _view:/199,320,32;titleWidth:/112,352,32;titleCell:/199,384,32;\ titleEndPoint:/112,416,32;_reservedFCint1:/14,448,32;; Listener:T242=s40isa:/196,0,32;portName:/120,32,32;\ listenPort:/11,64,32;signaturePort:/11,96,32;\ delegate:/199,128,32;timeout:/11,160,32;priority:/11,192,32;\ _delegate2:/199,224,32;_requestDelegate:/199,256,32;\ _reservedListener2:/11,288,32;; _menuFlags:T243=s4_changeTitle:4,0,1;_isServicesMenu:4,1,1;\ _templateType:4,2,2;_RESERVED:4,4,6;wasTornOff:4,10,1;\ wasAttached:4,11,1;tornOff:4,12,1;attached:4,13,1;\ autoupdate:4,14,1;sizeFitted:4,15,1;; Menu:T244=s132isa:/196,0,32;nextResponder:/199,32,32;\ _reserved:/199,64,32;frame:/1147,96,128;contentView:/199,224,32;\ delegate:/199,256,32;firstResponder:/199,288,32;\ lastLeftHit:/199,320,32;lastRightHit:/199,352,32;\ counterpart:/199,384,32;fieldEditor:/199,416,32;\ winEventMask:/11,448,32;windowNum:/11,480,32;\ backgroundGray:/112,512,32;wFlags:/1184,544,32;wFlags2:/1185,576,32;\ _borderView:/199,608,32;_displayDisabled:/18,640,16;\ _flushDisabled:/18,656,16;_cursorRects:/172,672,32;\ _trectTable:/1187,704,32;_invalidCursorView:/199,736,32;\ _miniIcon:/199,768,32;_private:/172,800,32;supermenu:/199,832,32;\ matrix:/199,864,32;attachedMenu:/199,896,32;lastLocation:/154,928,64;\ reserved:/199,992,32;menuFlags:/1243,1024,32;; MenuCell:T245=s76isa:/196,0,32;contents:/120,32,32;\ support:/199,64,32;cFlags1:/1149,96,32;cFlags2:/1150,128,32;\ _cFlags3:/1151,160,32;_reservedCshort:/19,192,16;\ tag:/11,224,32;target:/199,256,32;action:/1100,288,32;\ _view:/199,320,32;altContents:/120,352,32;icon:/1198,384,64;\ sound:/199,448,32;bcFlags1:/1199,480,32;bcFlags2:/1200,512,32;\ periodicDelay:/19,544,16;periodicInterval:/19,560,16;\ updateAction:/1100,576,32;; __bitmapRepFlags:T246=s4_RESERVED:4,0,2;memory:4,2,2;\ isUnpacked:4,4,1;unpackedOK:4,5,1;bitsPerPixel:4,6,8;\ explicitPlanes:4,14,1;isPlanar:4,15,1;; NXBitmapImageRep:T247=s64isa:/196,0,32;_repFlags:/1179,32,32;\ size:/155,64,64;_pixelsWide:#import	"TexturePalette.h"
#import	"TextureEdit.h"
#import "TexturePalView.h"

@implementation TexturePalView

- drawSelf:(const NXRect *)rects :(int)rectCount
{
	int	count;
	texpal_t	*t;
	NXRect	r;
	
	//
	// draw selected texture outline
	//
	if ([texturePalette_i	currentSelection] >= 0)
	{
		t = [texturePalette_i		getTexture:[texturePalette_i currentSelection]];
		r = t->r;
		r.origin.x -= SPACING/2;
		r.origin.y -= SPACING/2;
		r.size.width += SPACING;
		r.size.height += SPACING;
		NXDrawGroove(&r,&r);
	}
	
	//
	// draw textures
	//
	count = 0;
	while ((t = [texturePalette_i	getTexture:count]) != NULL)
	{
		[t->image	composite:NX_COPY	toPoint:&t->r.origin];
		count++;
	}
	
	return self;
}

- mouseDown:(NXEvent *)theEvent
{
	NXPoint	loc;
	int	i,texcount,oldwindowmask;
	texpal_t	*t;

	oldwindowmask = [window addToEventMask:NX_LMOUSEDRAGGEDMASK];
	loc = theEvent->location;
	[self convertPoint:&loc	fromView:NULL];
	
	texcount = [texturePalette_i	getNumTextures];
	for (i = texcount - 1;i >= 0;i--)
	{
		t = [texturePalette_i		getTexture:i];
		if (NXPointInRect(&loc,&t->r) == YES)
		{
			[texturePalette_i	selectTexture:i];
			if (theEvent->data.mouse.click == 2)
			{
				[textureEdit_i	menuTarget:NULL];
				[textureEdit_i	newSelection:i];
				break;
			}
		}
	}
	return self;
}

@end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
#import <appkit/appkit.h>

extern id	texturePalette_i;

typedef struct
{
	id	image;
	char	 name[9];
	NXRect	r;
} texpal_t;

@interface TexturePalette:Object
{
	id	window_i;
	id	texturePalView_i;
	id	texturePalScrView_i;
	id	titleField_i;
	id	widthField_i;
	id	heightField_i;
	
	id	texturePatches;
	id	allTextures;
	int	selectedTexture;
}

- initTextures;
- deleteTexture:sender;
- (int) getNumTextures;
- createAllTextureImages;
- (texpal_t) createTextureImage:(int)which;
- computePalViewSize;
- (texpal_t *)getTexture:(int)which;
- storeTexture:(int)which;
- (int) currentSelection;
- selectTexture:(int)val;
- menuTarget:sender;

@end
                                                                                                                                                                                                                                                                                                                                                                                                 #import	"DoomProject.h"
#import	"wadfiles.h"
#import	"TextureEdit.h"
#import	"TexturePalette.h"

id	texturePalette_i;

@implementation TexturePalette

- init
{
	window_i = NULL;
	texturePalette_i = self;
	selectedTexture = -1;

	allTextures = [[	Storage	alloc]
				initCount:		0
				elementSize:	sizeof(texpal_t)
				description:	NULL];
	
	return self;
}

- initTextures
{
	[self	createAllTextureImages];
	if ([allTextures	count])
		[self	selectTexture:0];
	return self;
}

- menuTarget:sender
{
	if (![doomproject_i loaded])
	{
		NXRunAlertPanel("Oops!",
						"There must be a project loaded before you even\n"
						"THINK about choosing textures!",
						"OK",NULL,NULL,NULL);
		return self;
	}
		
	if (!window_i)
	{
		NXPoint	p;
		NXRect	dvr,vf;
	
		[NXApp 
			loadNibSection:	"TexturePalette.nib"
			owner:			self
			withNames:		NO
		];

		[self	computePalViewSize];
		//
		// start textures at top
		//
		[texturePalScrView_i	getDocVisibleRect:&dvr];
		[texturePalView_i	getFrame:&vf];
		p.x = 0;
		p.y = dvr.size.height;// - vf.size.height;
		[texturePalScrView_i		scrollPoint:&p];
	}

	[window_i	makeKeyAndOrderFront:NULL];
	return self;
}

//
// create all the texture images for the palette
// NOTE: allTextures must have been created
//
- createAllTextureImages
{
	int	j;
	texpal_t	t;
	
	for (j = 0; j < numtextures; j++)
	{
		t = [self	createTextureImage:j];
		[allTextures	addElement:&t];
	}
	return self;
}

//
// create a texture image from all its patches for the palette
// NOTE: allTextures must have been created
//
- (texpal_t) createTextureImage:(int)which
{
	int	i;
	texpal_t	t;
	NXSize	s;

	s.width = textures[which].width;
	s.height = textures[which].height;
	NXSetRect(&t.r,0,0,0,0);
	t.r.size = s;
	strcpy(t.name,textures[which].name);
	t.image = [[NXImage alloc]
			initSize:	&s];
	[t.image	 useCacheWithDepth:NX_TwelveBitRGBDepth];
	[t.image	lockFocusOn:[t.image lastRepresentation]];
	
	NXSetColor(NXConvertRGBAToColor(1,0,0,1));
	NXRectFill(&t.r);

	for (i = 0; i < textures[which].patchcount; i++)
	{
		texpatch_t	p;
		
		p.patchInfo = textures[which].patches[i];
		p.patch = [textureEdit_i	getPatchImage:p.patchInfo.patchname];
		p.r.origin.x = p.patchInfo.originx;
		p.r.origin.y = (textures[which].height) - 
					(p.patch->r.size.height) - 
					(p.patchInfo.originy);
		p.r.size.width = p.patch->r.size.width;
		p.r.size.height = p.patch->r.size.height;
		[p.patch->image	composite:NX_SOVER toPoint:&p.r.origin];
	}
	[t.image	unlockFocus];
	return t;
}

//
// add/replace a texture image in palette
//
- storeTexture:(int)which
{
	texpal_t	*t,tex;
	
	if ((![allTextures	count]) ||
		(which > [allTextures	count] - 1))
			[allTextures	addElement:&tex];
	else
	{
		t = [allTextures	elementAt:which];
		[t->image	free];
	}
	
	tex = [self	createTextureImage:which];
	[allTextures	replaceElementAt:which with:&tex];

	[self	computePalViewSize];
	[texturePalScrView_i	display];
	return self;
}

//
// compute size of texture palette view from amount of texture images in allTextures
//
- computePalViewSize
{
	texpal_t	*t;
	int	count,maxwidth,x,y;
	NXSize	s,imagesize;
	
	maxwidth = 0;
	x = y = SPACING;
	count = [allTextures count] - 1;
	while (count >= 0)
	{
		t = [allTextures	elementAt:count];
		t->r.origin.x = x;
		t->r.origin.y = y;
		[t->image	getSize:&imagesize];
		if (imagesize.width > maxwidth)
			maxwidth = imagesize.width;
		y += imagesize.height + SPACING;
		count--;
	}
	
	s.width = maxwidth + SPACING*2;
	s.height = y;
	[texturePalView_i	sizeTo:s.width :s.height];
	return self;
}

//
// return * to texture image[which]
//
- (texpal_t *)getTexture:(int)which
{
	return [allTextures	elementAt:which];
}

- selectTexture:(int)val
{
	texpal_t *t;
	
	selectedTexture = val;
	t = [self	getTexture:val];
	[titleField_i	setStringValue:t->name];
	[widthField_i	setIntValue:t->r.size.width];
	[heightField_i	setIntValue:t->r.size.height];
	[texturePalScrView_i	display];
	return self;
}

- (int) currentSelection
{
	return selectedTexture;
}

- (int) getNumTextures
{
	return [allTextures	count];
}

- deleteTexture:sender
{
	return self;
}

@end
        
#import <appkit/appkit.h>

@interface TexturePatchView:View
{
}


@end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        /11,128,32;_pixelsHigh:/11,160,32;\ _gsaved:/11,192,32;_bytesPerRow:/14,224,32;_imageNumber:/19,256,16;\ _colorSpace:/18,272,16;_moreRepFlags:/1246,288,32;\ _reservedB1:/19,320,16;_fileName:/120,352,32;_reservedB2:/11,384,32;\ _data:/169,416,32;_otherName:/120,448,32;_compression:/19,480,16;\ _factor:/19,496,16;; NXBrowser:T248=s164isa:/196,0,32;nextResponder:/199,32,32;\ _reserved:/199,64,32;frame:/1147,96,128;bounds:/1147,224,128;\ superview:/199,352,32;subviews:/199,384,32;window:/199,416,32;\ vFlags:/1188,448,32;_vFlags:/1189,480,32;_gState:/11,512,32;\ _frameMatrix:/199,544,32;_drawMatrix:/199,576,32;\ _dragTypes:/1164,608,32;_vPrivate:/172,640,32;tag:/11,672,32;\ cell:/199,704,32;conFlags:/1193,736,32;_reservedCshort1:/19,768,16;\ target:/199,800,32;delegate:/199,832,32;_reserved1:/1249=ar1;0;2;99,864,96;\ action:/1100,960,32;doubleAction:/1100,992,32;matrixClass:/199,1024,32;\ cellPrototype:/199,1056,32;_reserved2:/155,1088,64;\ _reserved4:/164,1152,64;pathSeparator:/19,1216,16;\ _reserved3:/1250=ar1;0;5;2,1232,48;_private:/172,1280,32;; NXBrowserCell:T251=s28isa:/196,0,32;contents:/120,32,32;\ support:/199,64,32;cFlags1:/1149,96,32;cFlags2:/1150,128,32;\ _cFlags3:/1151,160,32;_reservedCshort:/19,192,16;; NXCachedImageRep:T252=s52isa:/196,0,32;_repFlags:/1179,32,32;\ size:/155,64,64;_pixelsWide:/11,128,32;_pixelsHigh:/11,160,32;\ _gsaved:/11,192,32;_origin:/154,224,64;_reservedInt1:/11,288,32;\ _window:/1253=*186,320,32;_cache:/172,352,32;_reservedInt2:/11,384,32;; _colorListFlags:T254=s4colorsLoaded:4,0,1;editable:4,1,1;\ hasDeviceSpecificLists:4,2,1;generatesNamedColors:4,3,1;\ dirty:4,4,1;hasFrozen:4,5,1;; NXColorList:T255=s52isa:/196,0,32;_name:/020,32,32;\ _printerType:/020,64,32;_fileName:/020,96,32;\ _hashTable:/099,128,32;_colors:/099,160,32;_delegate:/099,192,32;\ _editor:/099,224,32;_flags:/0254,256,32;_localNames:/099,288,32;\ _reserved:/0256=ar1;0;2;4,320,96;; NXColorPanel:T257=s168isa:/196,0,32;nextResponder:/199,32,32;\ _reserved:/199,64,32;frame:/1147,96,128;contentView:/199,224,32;\ delegate:/199,256,32;firstResponder:/199,288,32;\ lastLeftHit:/199,320,32;lastRightHit:/199,352,32;\ counterpart:/199,384,32;fieldEditor:/199,416,32;\ winEventMask:/11,448,32;windowNum:/11,480,32;\ backgroundGray:/112,512,32;wFlags:/1184,544,32;wFlags2:/1185,576,32;\ _borderView:/199,608,32;_displayDisabled:/18,640,16;\ _flushDisabled:/18,656,16;_cursorRects:/172,672,32;\ _trectTable:/1187,704,32;_invalidCursorView:/199,736,32;\ _miniIcon:/199,768,32;_private:/172,800,32;_cpPrivate:/172,832,32;\ _reservedCPint:/1258=ar1;0;14;1,864,480;; _csrFlags:T259=s4_RESERVED:4,0,14;onMouseEntered:4,14,1;\ onMouseExited:4,15,1;; NXCursor:T260=s24isa:/196,0,32;hotSpot:/154,32,64;\ cFlags:/1259,96,32;image:/199,128,32;_reservedInt:/14,160,32;; NXDataLinkPanel:T261=s156isa:/196,0,32;nextResponder:/199,32,32;\ _reserved:/199,64,32;frame:/1147,96,128;contentView:/199,224,32;\ delegate:/199,256,32;firstResponder:/199,288,32;\ lastLeftHit:/199,320,32;lastRightHit:/199,352,32;\ counterpart:/199,384,32;fieldEditor:/199,416,32;\ winEventMask:/11,448,32;windowNum:/11,480,32;\ backgroundGray:/112,512,32;wFlags:/1184,544,32;wFlags2:/1185,576,32;\ _borderView:/199,608,32;_displayDisabled:/18,640,16;\ _flushDisabled:/18,656,16;_cursorRects:/172,672,32;\ _trectTable:/1187,704,32;_invalidCursorView:/199,736,32;\ _miniIcon:/199,768,32;_private:/172,800,32;breakLink:/099,832,32;\ openSource:/099,864,32;updateDestination:/099,896,32;\ updateMode:/099,928,32;breakAllLinks:/099,960,32;\ showOutlines:/099,992,32;bannerMsg:/099,1024,32;\ sourceTitle:/099,1056,32;sourceValue:/099,1088,32;\ lastUpdateTitle:/099,1120,32;lastUpdateValue:/099,1152,32;\ accessoryView:/099,1184,32;needsUpdate:/02,1216,8;\ reserved1:/02,1224,8;reserved2:/08,1232,16;; NXEPSImageRep:T262=s60isa:/196,0,32;_repFlags:/1179,32,32;\ size:/155,64,64;_pixelsWide:/11,128,32;_pixelsHigh:/11,160,32;\ _gsaved:/11,192,32;_fileName:/120,224,32;_bBoxOrigin:/154,256,64;\ _memory:/120,320,32;_epsLen:/11,352,32;_epsOffset:/18,384,16;\ _reservedShort:/18,400,16;_otherName:/120,416,32;\ _reservedInt:/11,448,32;; NXHelpPanel:T263=s108isa:/196,0,32;nextResponder:/199,32,32;\ _reserved:/199,64,32;frame:/1147,96,128;contentView:/199,224,32;\ delegate:/199,256,32;firstResponder:/199,288,32;\ lastLeftHit:/199,320,32;lastRightHit:/199,352,32;\ counterpart:/199,384,32;fieldEditor:/199,416,32;\ winEventMask:/11,448,32;windowNum:/11,480,32;\ backgroundGray:/112,512,32;wFlags:/1184,544,32;wFlags2:/1185,576,32;\ _borderView:/199,608,32;_displayDisabled:/18,640,16;\ _flushDisabled:/18,656,16;_cursorRects:/172,672,32;\ _trectTable:/1187,704,32;_invalidCursorView:/199,736,32;\ _miniIcon:/199,768,32;_private:/172,800,32;private:/172,832,32;; SNDSoundStruct:Tt264=s28magic:1,0,32;dataLocation:1,32,32;\ dataSize:1,64,32;dataFormat:1,96,32;samplingRate:1,128,32;\ channelCount:1,160,32;info:265=ar1;0;3;2,192,32;; NXJournalHeader:Tt266=s20version:1,0,32;offsetToAppNames:4,32,32;\ lastEventTime:4,64,32;reserved1:4,96,32;reserved2:4,128,32;; NXJournaler:T267=s140isa:/196,0,32;_startTime:/13,32,32;\ _soundStatus:/11,64,32;_appsData:/199,96,32;\ _sndBuffer:/1268=*264,128,32;_soundfile:/120,160,32;\ _recordDevice:/11,192,32;_nextEvent:/166,224,320;\ _eventStream:/1269=*68,544,32;_teNum:/194,576,32;\ _journalHeader:/1266,608,160;_mouseDownWindow:/199,768,32;\ _mouseDownWindowNum:/11,800,32;_applicationNum:/11,832,32;\ _dragWindowNum:/11,864,32;_oldEventMask:/14,896,32;\ _oldEventFilter:/192,928,32;_pendingStop:/12,960,8;\ _listener:/199,992,32;_speaker:/199,1024,32;_delegate:/199,1056,32;\ _eventStatus:/11,1088,32;; timeval:T270=s8tv_sec:3,0,32;tv_usec:3,32,32;; NXPrinter:T271=s88isa:/196,0,32;printerName:/1104,32,32;\ hostName:/1104,64,32;domainName:/1104,96,32;printerType:/1104,128,32;\ _ignore:/12,160,8;_valid:/12,168,8;_creationNum:/11,192,32;\ _nodes:/172,224,32;_previousValid:/1270,256,64;_niInstance:/13,320,32;\ _priv:/172,352,32;reserved:/1272=ar1;0;9;72,384,320;; _spFlags:T273=s4opening:4,0,1;exitOk:4,1,1;\ allowMultiple:4,2,1;dirty:4,3,1;invalidateMatrices:4,4,1;\ filtered:4,5,1;_chooseFolders:4,6,1;_ignoreFilePackages:4,7,1;\ _largeFS:4,8,1;_delegateValidatesNew:4,9,1;\ _delegateValidatesOld:4,10,1;_checkCase:4,11,1;\ _cancd:4,12,1;_UnixExpert:4,13,1;_backwards:4,14,1;\ _forwards:4,15,1;; SavePanel:T274=s180isa:/196,0,32;nextResponder:/199,32,32;\ _reserved:/199,64,32;frame:/1147,96,128;contentView:/199,224,32;\ delegate:/199,256,32;firstResponder:/199,288,32;\ lastLeftHit:/199,320,32;lastRightHit:/199,352,32;\ counterpart:/199,384,32;fieldEditor:/199,416,32;\ winEventMask:/11,448,32;windowNum:/11,480,32;\ backgroundGray:/112,512,32;wFlags:/1184,544,32;wFlags2:/1185,576,32;\ _borderView:/199,608,32;_displayDisabled:/18,640,16;\ _flushDisabled:/18,656,16;_cursorRects:/172,672,32;\ _trectTable:/1187,704,32;_invalidCursorView:/199,736,32;\ _miniIcon:/199,768,32;_private:/172,800,32;form:/199,832,32;\ browser:/199,864,32;okButton:/199,896,32;accessoryView:/199,928,32;\ separator:/199,960,32;filename:/120,992,32;directory:/120,1024,32;\ filenames:/1204,1056,32;requiredType:/120,1088,32;\ _columns:/172,1120,32;_typeTable:/1187,1152,32;spFlags:/1273,1184,32;\ directorySize:/19,1216,16;_cdcolumn:/11,1248,32;\ _filterMethod:/1102,1280,32;_homeButton:/199,1312,32;\ _scroller:/199,1344,32;_fncmp:/1102,1376,32;_removableDeviceButton:/199,1408,32;; OpenPanel:T275=s196isa:/196,0,32;nextResponder:/199,32,32;\ _reserved:/199,64,32;frame:/1147,96,128;contentView:/199,224,32;\ delegate:/199,256,32;firstResponder:/199,288,32;\ lastLeftHit:/199,320,32;lastRightHit:/199,352,32;\ counterpart:/199,384,32;fieldEditor:/199,416,32;\ winEventMask:/11,448,32;windowNum:/11,480,32;\ backgroundGray:/112,512,32;wFlags:/1184,544,32;wFlags2:/1185,576,32;\ _borderView:/199,608,32;_displayDisabled:/18,640,16;\ _flushDisabled:/18,656,16;_cursorRects:/172,672,32;\ _trectTable:/1187,704,32;_invalidCursorView:/199,736,32;\ _miniIcon:/199,768,32;_private:/172,800,32;form:/199,832,32;\ browser:/199,864,32;okButton:/199,896,32;accessoryView:/199,928,32;\ separator:/199,960,32;filename:/120,992,32;directory:/120,1024,32;\ filenames:/1204,1056,32;requiredType:/120,1088,32;\ _co//
// docview of Patch Palette in TextureEdit
//
#import	"Coordinator.h"
#import 	"TexturePatchView.h"
#import	"TextureEdit.h"
@implementation TexturePatchView

- drawSelf:(const NXRect *)rects :(int)rectCount
{
	int patchnum,selectedPatch;
	apatch_t *patch;

	selectedPatch = [textureEdit_i	getCurrentPatch];
	patchnum = 0;
	while ((patch = [textureEdit_i	getPatch:patchnum++]) != NULL)
		if (NXIntersectsRect(&patch->r,&rects[0]))
			[patch->image		composite:NX_COPY toPoint:&patch->r.origin];
	
	if (selectedPatch >= 0)
	{
		NXRect	clipview,r;

		[self	getFrame:&clipview];
		patch = [textureEdit_i	getPatch:selectedPatch];
		r = patch->r;
		r.origin.x -= 5;
		r.origin.y -= 5;
		r.size.width += 10;
		r.size.height += 10;
		NXDrawGroove(&r,&clipview);
		[patch->image		composite:NX_COPY toPoint:&patch->r.origin];
	}
	
	return self;
}

- mouseDown:(NXEvent *)theEvent
{
	NXPoint	loc;
	int		patchnum,selectedPatch;
	apatch_t *patch;
	
	loc = theEvent->location;
	[self convertPoint:&loc	fromView:NULL];
	
	selectedPatch = [textureEdit_i	getCurrentPatch];
	patchnum = 0;
	while ((patch = [textureEdit_i	getPatch:patchnum++]) != NULL)
		if ([self	mouse:&loc	inRect:&patch->r] == YES)
		{
			if (selectedPatch == patchnum -1)
				[coordinator_i	playPop];
			else
			{
				selectedPatch = patchnum - 1;
				[coordinator_i	playDrip];
			}
			
			if (theEvent->data.mouse.click == 2)
				[textureEdit_i	addPatch:selectedPatch];
				
			[textureEdit_i	setSelectedPatch:patchnum - 1];
			[superview	display];
			break;
		}

	return self;
}

@end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
#import <appkit/appkit.h>

@interface TextureView:View
{
	id	patchSelections;
}


@end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        //
// This belongs to TextureEdit (docView of TextureEdit's ScrollView)
//
#import "TextureEdit.h"
#import "EditWorld.h"
#import "TextureView.h"
#import "wadfiles.h"


@implementation TextureView

- (BOOL) acceptsFirstResponder
{
	return YES;
}

- initFrame:(const NXRect *)frameRect
{
	[super initFrame:frameRect];
	patchSelections = [[ Storage	alloc ]
					initCount:0
					elementSize:sizeof(store_t)
					description:NULL];

	return self;
}

- keyDown:(NXEvent *)theEvent
{
	switch(theEvent->data.key.charCode)
	{
		case 0x7f:	// delete patch
			[textureEdit_i	deleteCurrentPatch:NULL];
			break;
		case 0x6c:	// toggle lock
			[textureEdit_i	doLockToggle];
			break;
		case 0xac:
		case 0xaf:	// sort down
			[textureEdit_i	sortDown:NULL];
			break;
		case 0xad:
		case 0xae:	// sort up
			[textureEdit_i	sortUp:NULL];
			break;
		case 0xd:
			[textureEdit_i	finishTexture:NULL];
			break;
		#if 0
		default:
			printf("charCode:%x\n",theEvent->data.key.charCode);
			break;
		#endif
	}
	return self;
}

- drawSelf:(const NXRect *)rects :(int)rectCount
{
	int		ct,i,outlineflag;
	int		patchCount,cp;
	texpatch_t	*tpatch;
	
	ct = [textureEdit_i	getCurrentTexture];
	NXSetColor(NXConvertRGBAToColor(1,0,0,1));
	NXRectFill(&rects[0]);
	
	outlineflag = [textureEdit_i	getOutlineFlag];
	PSsetgray(NX_DKGRAY);
	patchCount = [texturePatches	count];
	for (i = 0;i < patchCount; i++)
	{
		tpatch = [texturePatches	elementAt:i];
//		if (NXIntersectsRect(&tpatch->r,&rects[0]))
			[tpatch->patch->image_x2	composite:NX_SOVER toPoint:&tpatch->r.origin];
	}

	if (outlineflag)
		for (i = patchCount - 1;i >= 0;i--)
		{
			tpatch = [texturePatches	elementAt:i];
//			if (NXIntersectsRect(&tpatch->r,&rects[0]))
				NXFrameRectWithWidth(&tpatch->r,5);
		}

	cp = [textureEdit_i	getCurrentEditPatch];
	if (cp >= 0)
	{
		tpatch = [texturePatches	elementAt:cp];
		PSsetgray(NX_WHITE);
		NXFrameRectWithWidth(&tpatch->r,5);
	}
	
	//
	// if multiple selections, draw their outlines
	//
	if ([patchSelections		count])
	{
		int	max;
		
		max = [patchSelections	count];
		for (i = 0;i<max;i++)
		{
			tpatch = [texturePatches	elementAt:((store_t *)[patchSelections elementAt:i])->sel];
			PSsetgray(NX_WHITE);
			NXFrameRectWithWidth(&tpatch->r,5);
		}
	}
	
	return self;
}

- mouseDown:(NXEvent *)theEvent
{
	NXPoint	loc;
	int	i,patchcount,oldwindowmask,xoff,yoff,ct;
	texpatch_t	*patch;

	oldwindowmask = [window addToEventMask:NX_LMOUSEDRAGGEDMASK];
	loc = theEvent->location;
	[self convertPoint:&loc	fromView:NULL];
	ct = [textureEdit_i	getCurrentTexture];

	patchcount = [texturePatches	count];
	for (i = patchcount - 1;i >= 0;i--)
	{
		patch = [texturePatches	elementAt:i];
		if (NXPointInRect(&loc,&patch->r) == YES)
		{
			NXEvent	*event;
			
			//
			// shift-click adds the patch to the select list
			//
			if (theEvent->flags & NX_SHIFTMASK)
			{
				int	max,indx;
				texpatch_t	*p;
				
				if (([textureEdit_i	getCurrentEditPatch] != -1) &&
					([textureEdit_i	getCurrentEditPatch] != i))
				{
					max = [patchSelections	count];
					for (indx = 0;indx < max;indx++)
					{
						p = [texturePatches elementAt:
								((store_t *)[patchSelections elementAt:indx])->sel];
						if (NXPointInRect(&loc,&p->r) == YES)
						{
							NXBeep();
							printf("Clicking on patch already selected!\n");
							return self;
						}
					}
					[patchSelections	addElement:&i];
					[self		display];
					return self;
				}
			}
	
			[textureEdit_i	setCurrentEditPatch:i];
			xoff = loc.x - patch->r.origin.x;
			yoff = loc.y - patch->r.origin.y;
			do
			{
				event = [NXApp getNextEvent: NX_MOUSEUPMASK |										NX_MOUSEDRAGGEDMASK];
				loc = event->location;
				[self convertPoint:&loc	fromView:NULL];
				loc.x = ((int)loc.x - xoff) & -2;
				loc.y = ((int)loc.y - yoff) & -2;
				patch->r.origin = loc;
				patch->patchInfo.originx = loc.x / 2;
				patch->patchInfo.originy = textures[ct].height - 
									((loc.y / 2) + (patch->r.size.height / 2));
				[ self		display];
			} while (event->type != NX_MOUSEUP);

			[textureEdit_i	setOldVars:patch->patchInfo.originx + patch->r.size.width/2
						:patch->patchInfo.originy];
			break;
		}
	}
	return self;
}

@end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       lumns:/172,1120,32;_typeTable:/1187,1152,32;spFlags:/1273,1184,32;\ directorySize:/19,1216,16;_cdcolumn:/11,1248,32;\ _filterMethod:/1102,1280,32;_homeButton:/199,1312,32;\ _scroller:/199,1344,32;_fncmp:/1102,1376,32;_removableDeviceButton:/199,1408,32;\ _reservedPtr0:/172,1440,32;filterTypes:/1276=*20,1472,32;\ _reservedOPint1:/14,1504,32;_reservedOPint2:/14,1536,32;; PageLayout:T277=s180isa:/196,0,32;nextResponder:/199,32,32;\ _reserved:/199,64,32;frame:/1147,96,128;contentView:/199,224,32;\ delegate:/199,256,32;firstResponder:/199,288,32;\ lastLeftHit:/199,320,32;lastRightHit:/199,352,32;\ counterpart:/199,384,32;fieldEditor:/199,416,32;\ winEventMask:/11,448,32;windowNum:/11,480,32;\ backgroundGray:/112,512,32;wFlags:/1184,544,32;wFlags2:/1185,576,32;\ _borderView:/199,608,32;_displayDisabled:/18,640,16;\ _flushDisabled:/18,656,16;_cursorRects:/172,672,32;\ _trectTable:/1187,704,32;_invalidCursorView:/199,736,32;\ _miniIcon:/199,768,32;_private:/172,800,32;appIcon:/199,832,32;\ height:/199,864,32;width:/199,896,32;ok:/199,928,32;\ cancel:/199,960,32;orientation:/199,992,32;scale:/199,1024,32;\ paperSizeList:/199,1056,32;layoutList:/199,1088,32;\ unitsList:/199,1120,32;exitTag:/11,1152,32;paperView:/199,1184,32;\ _paperViewShadow:/199,1216,32;accessoryView:/199,1248,32;\ _currUnits:/12,1280,8;_otherPaper:/12,1288,8;\ _reservedPageLayout1:/19,1296,16;_reservedPageLayout2:/14,1312,32;\ _reservedPageLayout3:/14,1344,32;_reservedPageLayout4:/14,1376,32;\ _reservedPageLayout5:/14,1408,32;; PopUpList:T278=s132isa:/196,0,32;nextResponder:/199,32,32;\ _reserved:/199,64,32;frame:/1147,96,128;contentView:/199,224,32;\ delegate:/199,256,32;firstResponder:/199,288,32;\ lastLeftHit:/199,320,32;lastRightHit:/199,352,32;\ counterpart:/199,384,32;fieldEditor:/199,416,32;\ winEventMask:/11,448,32;windowNum:/11,480,32;\ backgroundGray:/112,512,32;wFlags:/1184,544,32;wFlags2:/1185,576,32;\ _borderView:/199,608,32;_displayDisabled:/18,640,16;\ _flushDisabled:/18,656,16;_cursorRects:/172,672,32;\ _trectTable:/1187,704,32;_invalidCursorView:/199,736,32;\ _miniIcon:/199,768,32;_private:/172,800,32;supermenu:/199,832,32;\ matrix:/199,864,32;attachedMenu:/199,896,32;lastLocation:/154,928,64;\ reserved:/199,992,32;menuFlags:/1243,1024,32;; NXPrivatePrintInfo:t279=*280=xs_PrivatePrintInfo: _pInfoFlags:T281=s4_RESERVEDB:4,0,2;reversePageOrder:4,2,1;\ printerIsOld:4,3,1;vertPagination:4,4,2;\ horizPagination:4,6,2;_RESERVEDC:4,8,1;\ allPages:4,9,1;manualFeed:4,10,1;_RESERVEDA:4,11,2;\ vertCentered:4,13,1;horizCentered:4,14,1;\ orientation:4,15,1;; PrintInfo:T282=s116isa:/196,0,32;paperType:/120,32,32;\ paperRect:/1147,64,128;leftPageMargin:/112,192,32;\ rightPageMargin:/112,224,32;topPageMargin:/112,256,32;\ bottomPageMargin:/112,288,32;scalingFactor:/112,320,32;\ pageOrder:/12,352,8;pInfoFlags:/1281,384,32;firstPage:/11,416,32;\ lastPage:/11,448,32;currentPage:/11,480,32;copies:/11,512,32;\ outputFile:/120,544,32;context:/140,576,32;_privateData:/1279,608,32;\ printerName:/120,640,32;printerType:/120,672,32;\ printerHost:/120,704,32;resolution:/11,736,32;\ pagesPerSheet:/18,768,16;_reservedPrintInfo1:/19,784,16;\ printerObject:/1283=*271,800,32;jobFeaturesTable:/199,832,32;\ paperFeed:/1104,864,32;_reservedPrintInfo5:/14,896,32;; PrintPanel:T284=s192isa:/196,0,32;nextResponder:/199,32,32;\ _reserved:/199,64,32;frame:/1147,96,128;contentView:/199,224,32;\ delegate:/199,256,32;firstResponder:/199,288,32;\ lastLeftHit:/199,320,32;lastRightHit:/199,352,32;\ counterpart:/199,384,32;fieldEditor:/199,416,32;\ winEventMask:/11,448,32;windowNum:/11,480,32;\ backgroundGray:/112,512,32;wFlags:/1184,544,32;wFlags2:/1185,576,32;\ _borderView:/199,608,32;_displayDisabled:/18,640,16;\ _flushDisabled:/18,656,16;_cursorRects:/172,672,32;\ _trectTable:/1187,704,32;_invalidCursorView:/199,736,32;\ _miniIcon:/199,768,32;_private:/172,800,32;appIcon:/199,832,32;\ pageMode:/199,864,32;firstPage:/199,896,32;lastPage:/199,928,32;\ copies:/199,960,32;ok:/199,992,32;cancel:/199,1024,32;\ preview:/199,1056,32;save:/199,1088,32;printers:/199,1120,32;\ feed:/199,1152,32;resolutionList:/199,1184,32;name:/199,1216,32;\ note:/199,1248,32;status:/199,1280,32;exitTag:/11,1312,32;\ accessoryView:/199,1344,32;_ppdTextView:/199,1376,32;\ buttons:/199,1408,32;_ppdGroupView:/199,1440,32;optionsButton:/199,1472,32;\ _priv:/172,1504,32;; SelectionCell:T285=s28isa:/196,0,32;contents:/120,32,32;\ support:/199,64,32;cFlags1:/1149,96,32;cFlags2:/1150,128,32;\ _cFlags3:/1151,160,32;_reservedCshort:/19,192,16;; SliderCell:T286=s96isa:/196,0,32;contents:/120,32,32;\ support:/199,64,32;cFlags1:/1149,96,32;cFlags2:/1150,128,32;\ _cFlags3:/1151,160,32;_reservedCshort:/19,192,16;\ tag:/11,224,32;target:/199,256,32;action:/1100,288,32;\ _view:/199,320,32;_scPrivate:/172,352,32;_scPrivate1:/11,384,32;\ _scPrivate2:/11,416,32;value:/113,448,64;maxValue:/113,512,64;\ minValue:/113,576,64;trackRect:/1147,640,128;; Speaker:T287=s32isa:/196,0,32;sendPort:/11,32,32;\ replyPort:/11,64,32;sendTimeout:/11,96,32;replyTimeout:/11,128,32;\ delegate:/199,160,32;_reservedSpeaker1:/11,192,32;\ _reservedSpeaker2:/11,224,32;; _NXChunk:T288=s12growby:8,0,16;allocated:1,32,32;\ used:1,64,32;; NXChunk:Tt288 wchar:t11 _tbFlags:T289=s4malloced:4,0,1;PAD:4,1,15;; _NXTextBlock:T290=s20next:291=*290,0,32;prior:291,32,32;\ tbFlags:289,64,32;chars:8,96,16;text:292=*11,128,32;; NXTextBlock:Tt290 NXRunFlags:Tt293=s4underline:4,0,1;dummy:4,1,1;\ subclassWantsRTF:4,2,1;graphic:4,3,1;forcedSymbol:4,4,1;\ RESERVED:4,5,11;; _NXRun:T294=s32font:99,0,32;chars:1,32,32;\ paraStyle:72,64,32;textGray:12,96,32;textRGBColor:1,128,32;\ superscript:11,160,8;subscript:11,168,8;info:99,192,32;\ rFlags:293,224,32;; NXRun:Tt294 _NXRunArray:T295=s44chunk:288,0,96;runs:296=ar1;0;0;294,96,256;; NXRunArray:Tt295 NXLineDesc:t1 _NXBreakArray:T297=s16chunk:288,0,96;breaks:298=ar1;0;0;1,96,32;; NXBreakArray:Tt297 NXLayFlags:Tt299=s4mustMove:4,0,1;isMoveChar:4,1,1;\ RESERVED:4,2,14;; _NXLay:T300=s28x:12,0,32;y:12,32,32;\ offset:8,64,16;chars:8,80,16;font:99,96,32;\ paraStyle:72,128,32;run:301=*294,160,32;lFlags:299,192,32;; NXLay:Tt300 _NXLayArray:T302=s40chunk:288,0,96;lays:303=ar1;0;0;300,96,224;; NXLayArray:Tt302 _NXWidthArray:T304=s16chunk:288,0,96;widths:305=ar1;0;0;12,96,32;; NXWidthArray:Tt304 _NXCharArray:T306=s16chunk:288,0,96;text:307=ar1;0;0;11,96,8;; NXCharArray:Tt306 _NXFSM:T308=s8next:309=*308,0,32;delta:8,32,16;\ token:8,48,16;; NXFSM:Tt308 _NXSelPt:T310=s24cp:1,0,32;line:1,32,32;\ x:12,64,32;y:12,96,32;c1st:1,128,32;\ ht:12,160,32;; NXSelPt:Tt310 _NXTextCache:T311=s20curPos:1,0,32;curRun:301,32,32;\ runFirstPos:1,64,32;curBlock:312=*290,96,32;blockFirstPos:1,128,32;; NXTextCache:Tt311 _lFlags:T313=s4horizCanGrow:4,0,1;vertCanGrow:4,1,1;\ erase:4,2,1;ping:4,3,1;endsParagraph:4,4,1;\ resetCache:4,5,1;RESERVED:4,6,10;; _NXLayInfo:T314=s76rect:147,0,128;descent:12,128,32;\ width:12,160,32;left:12,192,32;right:12,224,32;\ rightIndent:12,256,32;lays:315=*302,288,32;widths:316=*304,320,32;\ chars:317=*306,352,32;cache:311,384,160;textClipRect:318=*147,544,32;\ lFlags:313,576,32;; NXLayInfo:Tt314 NXTextFunc:t319=*320=f1 NXCharFilterFunc:t321=*322=f9 NXTextFilterFunc:t323=*324=f20 _tFlags:T325=s4inClipView:4,0,1;disableFontPanel:4,1,1;\ monoFont:4,2,1;overstrikeDiacriticals:4,3,1;\ vertResizable:4,4,1;horizResizable:4,5,1;\ anchorIs0:4,6,1;haveDown:4,7,1;charWrap:4,8,1;\ changeState:4,9,1;_caretState:4,10,2;_selectMode:4,12,2;\ _editMode:4,14,2;; Text:T326=s372isa:/196,0,32;nextResponder:/199,32,32;\ _reserved:/199,64,32;frame:/1147,96,128;bounds:/1147,224,128;\ superview:/199,352,32;subviews:/199,384,32;window:/199,416,32;\ vFlags:/1188,448,32;_vFlags:/1189,480,32;_gState:/11,512,32;\ _frameMatrix:/199,544,32;_drawMatrix:/199,576,32;\ _dragTypes:/1164,608,32;_vPrivate:/172,640,32;breakTable:/1309,672,32;\ clickTable:/1309,704,32;preSelSmartTable:/1327=*11,736,32;\ postSelSmartTable:/1327,768,32;charCategoryTable:/1327,800,32;\ delegateMethods:/12,832,8;charFilterFunc:/1321,864,32;\ textFilterFunc:/1323,896,32;_compilerErrorSpacer:/120,928,32;\ scanFunc:/1319,960,32;drawFunc:/1319,992,32;delegate:/199,1024,32;\ tag:/11,1056,32;cursorTE:/194,1088,32;firstTextBlock