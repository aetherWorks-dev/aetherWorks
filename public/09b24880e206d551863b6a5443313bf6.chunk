***********************************************)PROCEDURE CEditText.Activate;	BEGIN		INHERITED Activate;		Prepare;		TEActivate(macTE);		gEditText := SELF;	END;(******************************************************************************}{ Deactivate [OVERRIDE]}{}{		Deactivate EditText by unhiliting the selection or hiding the}{		text insertion caret. Also disable the appropriate menu commands.}{ ******************************************************************************)PROCEDURE CEditText.Deactivate;	BEGIN		INHERITED Deactivate;		Prepare;		IF (macTE <> NIL) THEN			TEDeactivate(macTE);		gEditText := NIL;	END;(******************************************************************************}{ SetSelection}{}{ 	Sets the selected text to the range corresponding to character positions}{ 	selStart through selEnd.}{******************************************************************************)PROCEDURE CEditText.SetSelection (selStart: Longint;								selEnd: Longint;								fRedraw: Boolean);	BEGIN		IF (NOT fRedraw) THEN			BEGIN				macTE^^.selStart := Integer(selStart);				macTE^^.selEnd := Integer(selEnd);			END		ELSE			BEGIN				Prepare;				TESetSelect(selStart, selEnd, macTE);			END;	END;(******************************************************************************}{ AboutToPrint [OVERRIDE]}{}{		The specified range of pages is about to be printed.}{ ******************************************************************************)PROCEDURE CEditText.AboutToPrint (VAR firstPage, lastPage: Integer);	BEGIN		IF (active) THEN			BEGIN					(* Must make sure that the			*)					(*   current selection is not		*)					(*   hilited on the print out		*)				Prepare;				HidePen;				TEDeactivate(macTE);				ShowPen;			END;		INHERITED AboutToPrint(firstPage, lastPage);	END;(******************************************************************************}{ DonePrinting [OVERRIDE]}{}{		Print loop has been completed. Re-hilite the active selection.}{ ******************************************************************************)PROCEDURE CEditText.DonePrinting;	BEGIN		INHERITED DonePrinting;				(* TCL 1.1: call CalcTERects rather than setting *)				(* the viewRect directly *)		CalcTERects;		IF (active) THEN			BEGIN				Prepare;				HidePen;			(* Restore active state				*)				TEActivate(macTE);				ShowPen;			END;	END;(******************************************************************************}{ Dawdle [OVERRIDE]}{}{		The user isn't doing anything, so flash the text insertion cursor}{ ******************************************************************************)PROCEDURE CEditText.Dawdle (VAR maxSleep: Longint);	BEGIN		IF editable THEN	{ TCL 1.1.1 DLP 9/27/91 }			BEGIN				Prepare;				TEIdle(macTE);				maxSleep := GetCaretTime;			END;	END;(*=============================================================================}{ TEClickLoop}{}{		Function for auto-scrolling text}{ =============================================================================*)FUNCTION TEClickLoop: Boolean;	VAR		mouseLoc: Point;		longMouse: LongPt;		ignore: Boolean;	BEGIN		IF (gEditText <> NIL) THEN			BEGIN				GetMouse(mouseLoc);				QDToLongPt(mouseLoc, longMouse);				ignore := gEditText.AutoScroll(longMouse);			END;		TEClickLoop := TRUE;	END;(******************************************************************************}{ MakeMacTE}{ }{ 	Creates the TextEdit record}{******************************************************************************)PROCEDURE CEditText.MakeMacTE;	VAR		longInterior: LongRect;		tFrame: Rect;		savedAlloc: Boolean;	BEGIN		GetInterior(longInterior);		LongToQDRect(longInterior, tFrame);		savedAlloc := SetAllocation(kAllocCanFail);		macTE := TENew(tFrame, tFrame);		savedAlloc := SetAllocation(savedAlloc);		FailNIL(macTE);	END;(******************************************************************************}{ Free [OVERRIDE]}{}{		Dispose of a EditText by throwing out the Toolbox TextEdit record}{ ******************************************************************************)PROCEDURE CEditText.Free;	BEGIN				(* Get rid of TextEdit record		*)		TEDispose(macTE);		macTE := NIL;				(* Pass message on to superclass	*)		INHERITED Free;	END;(**** D I S P L A Y   M E T H O D S ****)(******************************************************************************}{ Draw [OVERRIDE]}{}{		Draw the EditText}{ ******************************************************************************)PROCEDURE CEditText.Draw (VAR area: Rect);	BEGIN		macTE^^.inPort := thePort;		TEUpdate(area, macTE);		macTE^^.inPort := macPort;	END;(******************************************************************************}{ Scroll [OVERRIDE]}{}{		Scroll the text within the pane}{ ******************************************************************************)PROCEDURE CEditText.Scroll (hDelta: Longint;								vDelta: Longint;								redraw: Boolean);	VAR		hPixels: Integer;		vPixels: Integer;	BEGIN		hPixels := hDelta * hScale;		vPixels := vDelta * vScale;		OffsetRect(macTE^^.viewRect, hPixels, vPixels);		INHERITED Scroll(hDelta, vDelta, redraw);	END;(**** P R I N T I N G   M E T H O D S ****)(******************************************************************************}{ PrintPage [OVERRIDE]}{}{		Print the specified page.}{ ******************************************************************************)PROCEDURE CEditText.PrintPage (pageNum: Integer;								pageWidth: Integer;								pageHeight: Integer;								aPrinter: CPrinter);	BEGIN							(* Must change the port in the TE	*)							(*   record to the current port,	*)							(*   which will be a printer port	*)							(*   page. It will be restored by	*)							(*   the DonePrinting() method.		*)		macTE^^.inPort := thePort;		IF (printClip = clipPAGE) THEN			BEGIN				macTE^^.viewRect.right := macTE^^.viewRect.left + pageWidth;				IF (wholeLines) THEN					BEGIN						macTE^^.viewRect.bottom := macTE^^.viewRect.top + vScale * (pageHeight DIV vScale);					END				ELSE					BEGIN						macTE^^.viewRect.bottom := macTE^^.viewRect.top + pageHeight;					END;			END;		INHERITED PrintPage(pageNum, pageWidth, pageHeight, aPrinter);		macTE^^.inPort := macPort;	END;(**** T E X T   S P E C I F I C A T I O N   M E T H O D S ****)(******************************************************************************}{ SetTextPtr}{}{		Pass a Pointer and a character count for text to be used in}{		a EditText. Note that TextEdit makes a copy of the text.}{ ******************************************************************************)PROCEDURE CEditText.SetTextPtr (textPtr: Ptr;								numChars: Longint);	BEGIN				(* Stuff the text in the Mac TE record	*)		TESetText(textPtr, numChars, macTE);		AdjustBounds;				(* Draw the new text					*)		Refresh;	END;(******************************************************************************}{ GetTextHandle}{}{		Retrieve a handle to the text in a EditText Pane}{ ******************************************************************************)FUNCTION CEditText.GetTextHandle: Handle;	BEGIN		GetTextHandle := Handle(TEGetText(macTE));	END;(**** T E X T   C H A R A C T E R I S T I C S   M E T H O D S ****)(******************************************************************************}{ SetFontNumber}{}{		Specify the font for text by font number}{ ******************************************************************************)PROCEDURE CEditText.SetFontNumber (aFontNumber: Integer);	VAR		macFontInfo: FontInfo; (* Info about size of font			*)	BEGIN		macTE^^.txFont := aFontNumber;		TECalText(macTE);		SetSpacingCmd(spacingCmd);		GetTEFontInfo(macFontInfo);		SetScales(macFontInfo.widMax, macTE^^.lineHeight);		AdjustBounds;		Refresh;		SetWholeLines(wholeLines);		Refresh;	END;(******************************************************************************}{ SetFontStyle}{}{		Specify the style, such as bold or italic, for text}{ ******************************************************************************)PROCEDURE CEditText.SetFontStyle (aStyle: Style);	VAR		macTEP: TEPtr;	BEGIN		IF (aStyle = []) THEN			BEGIN				macTE^^.txFace := [];			END		ELSE			(* Toggle style characteristic		*)			BEGIN				macTEP := macTE^;				IF aStyle <= macTEP^.txFace THEN					macTEP^.txFace := macTEP^.txFace - aStyle				ELSE					macTEP^.txFace := macTEP^.txFace + aStyle;			END;		Refresh;		SetWholeLines(wholeLines);		Refresh;	END;(******************************************************************************}{ SetFontSize}{}{		Specify the point size of text}{ ******************************************************************************)PROCEDURE CEditText.SetFontSize (aSize: Integer);	BEGIN		macTE^^.txSize := aSize;		TECalText(macTE);		SetSpacingCmd(spacingCmd);	END;(******************************************************************************}{ SetTextMode}{}{		Specify the transfer mode used for drawing text}{ ******************************************************************************)PROCEDURE CEditText.SetTextMode (aMode: Integer);	BEGIN		macTE^^.txMode := aMode;		Refresh;	END;(******************************************************************************}{ SetAlignment}{}{		Specify the alignment for text}{ ******************************************************************************)PROCEDURE CEditText.SetAlignment (anAlignment: Integer);	BEGIN		TESetJust(anAlignment, macTE);		Refresh;	END;(******************************************************************************}{ SetAlignCmd}{}{		Specify the alignment for text}{ ******************************************************************************)PROCEDURE CEditText.SetAlignCmd (anAlignCmd: Longint);	VAR		teAlign: Integer;	BEGIN		alignCmd := anAlignCmd;		CASE alignCmd OF			cmdAlignLeft: 				teAlign := teFlushDefault;			cmdAlignCenter: 				teAlign := teCenter;			cmdAlignRight: 				teAlign := teFlushRight;			OTHERWISE				teAlign := teFlushDefault;		END;		SetAlignment(teAlign);	END;(******************************************************************************}{ SetSpacingCmd}{}{		Specify the vertical spacing between lines of text}{ ******************************************************************************)PROCEDURE CEditText.SetSpacingCmd (aSpacingCmd: Longint);	VAR		macFontInfo: FontInfo; (* Info about size of font			*)		extra: Integer;		(* Extra space between lines		*)	BEGIN		spacingCmd := aSpacingCmd;		GetTEFontInfo(macFontInfo);		macTE^^.lineHeight := macFontInfo.ascent + macFontInfo.descent + macFontInfo.leading;		macTE^^.fontAscent := macFontInfo.ascent;		CASE aSpacingCmd OF			cmdSingleSpace: 				extra := 0;			cmd1HalfSpace: 				extra := macTE^^.lineHeight DIV 2;			cmdDoubleSpace: 				extra := macTE^^.lineHeight;		END;		macTE^^.lineHeight := macTE^^.lineHeight + extra;		macTE^^.fontAscent := macTE^^.fontAscent + extra;		Refresh;		SetScales(macFontInfo.widMax, macTE^^.lineHeight);		SetWholeLines(wholeLines);		CalcAperture;		AdjustBounds;		Refresh;	END;FUNCTION CEditText.GetSpacingCmd: Longint;	BEGIN		GetSpacingCmd := spacingCmd;	END;FUNCTION CEditText.GetAlignCmd: Longint;	BEGIN		GetAlignCmd := alignCmd;	END;(******************************************************************************}{ GetTEFontInfo}{}{		Return a QuickDraw FontInfo record for the font used by the TE record}{		associated with a EditText Pane. This method changes the font}{		family, style, and size of the Pane's port to that used by the}{		TextEdit record so the Toolbox trap GetFontInfo can be used.}{ ******************************************************************************)PROCEDURE CEditText.GetTEFontInfo (VAR macFontInfo: FontInfo);	BEGIN		SetPort(macPort);		ForceNextPrepare;		TextFont(macTE^^.txFont);		TextFace(macTE^^.txFace);		TextSize(macTE^^.txSize);								(* Get info about font				*)		GetFontInfo(macFontInfo);	END;(**** C A L I B R A T I N G   M E T H O D S ****)(******************************************************************************}{ CalcTERects}{}{		Determine the destination and view rectangles used by TextEdit}{		from the values of the EditText's frame and lineWidth}{		instance variables.}{}{ ******************************************************************************)PROCEDURE CEditText.CalcTERects;	VAR		interior: LongRect;		hDelta: Integer;		vDelta: Integer;	BEGIN		GetInterior(interior);		hDelta := position.h * hScale - interior.left + macTE^^.destRect.left;		vDelta := position.v * vScale - interior.top + macTE^^.destRect.top;		frame.left := frame.left + hDelta;		frame.right := frame.right + hDelta;		frame.top := frame.top + vDelta;		hOrigin := hOrigin + hDelta;		vOrigin := vOrigin + vDelta;		IF lineWidth > 0 THEN			macTE^^.destRect.right := macTE^^.destRect.left + lineWidth		ELSE			macTE^^.destRect.right := interior.right;		LongToQDRect(interior, macTE^^.viewRect);		TECalText(macTE);	END;(******************************************************************************}{ ResizeFrame [OVERRIDE]}{}{		Adjust a EditText's frame when the size of the pane changes. The}{		delta rectangle parameter specifies the change in location of each}{		side of the Pane. Positive values mean a move to the right or down;}{		negative values mean a move to the left or up.}{}{		After using the inherited method, we have to adjust the frame so}{		that there's no fractional line showing at the bottom of the frame,}{		and also adjust the bounds since the text could be set to wrap}{		to the frame.}{ ******************************************************************************)PROCEDURE CEditText.ResizeFrame (delta: Rect);	BEGIN		INHERITED ResizeFrame(delta);		macTE^^.destRect.left := macTE^^.destRect.left + delta.left;		macTE^^.destRect.top := macTE^^.destRect.top + delta.top;		CalcTERects;		AdjustBounds;	END;(******************************************************************************}{ AdjustBounds}{}{		Adjust the bounds of a EditText to match the associated TextEdit}{		record. Send this message whenever something happens which can}{		affect the number of lines of text or the line width.}{ ******************************************************************************)PROCEDURE CEditText.AdjustBounds;	VAR		t: TEPtr;		lastCharAddr: longint;	BEGIN		t := macTE^;		bounds.left := 0;		bounds.top := 0;		bounds.bottom := GetNumLines;		IF lineWidth > 0 THEN			bounds.right := lineWidth		ELSE			bounds.right := t^.viewRect.right - t^.viewRect.left;		bounds.right := (bounds.right - 1) DIV hScale + 1;		IF itsScrollPane <> NIL THEN			itsScrollPane.AdjustScrollMax;	END;(******************************************************************************}{ FindLine}{}{		Return the line number containing the specified character position.}{		Both lines and character positions are numbered starting from zero.}{		If the character position is before the start of the text (i.e., a}{		negative number), a value of zero is returned; if it is beyond the}{		end of the text, the number of the last line is returned.}{ ******************************************************************************)FUNCTION CEditText.FindLine (charPos: Longint): Longint;	VAR		t: TEPtr;		lineNum: integer;	BEGIN		t := macTE^;										{ Check if it's in line zero		}		IF (t^.nLines = 0) OR (charPos < t^.lineStarts[1]) THEN			BEGIN				FindLine := 0;				Exit(FindLine);			END;										{ Check if it's in the last line	}		IF charPos >= t^.lineStarts[t^.nLines - 1] THEN			IF charPos = t^.teLength THEN				BEGIN	{ Special case for the last char	}					FindLine := bounds.bottom - 1;					Exit(FindLine);				END			ELSE				BEGIN					FindLine := t^.nLines - 1;					Exit(FindLine);				END;										{ Linear search thru lineStarts		}		lineNum := 1;		WHILE (charPos >= t^.lineStarts[lineNum + 1]) DO			lineNum := lineNum + 1;		FindLine := lineNum;	END;(******************************************************************************}{ GetLength}{ }{ 	Return the length in bytes of the TERecord's buffer}{******************************************************************************)FUNCTION CEditText.GetLength: Longint;	BEGIN		GetLength := macTE^^.teLength;	END;(******************************************************************************}{ GetTextStyle}{ }{ 	Returns information about the current style. This is the global style}{ 	information for standard text edit, and is the style of the selection}{ 	for styled text.}{******************************************************************************)PROCEDURE CEditText.GetTextStyle (VAR whichAttributes: Integer;								VAR aStyle: TextStyle);	VAR		ignore: Boolean;	BEGIN		ignore := TEContinuousStyle(whichAttributes, aStyle, macTE);	END;(******************************************************************************}{ GetCharStyle}{}{	Return style information about the charactor at charOffset	}{******************************************************************************)PROCEDURE CEditText.GetCharStyle (charOffset: Longint;								VAR theStyle: TextStyle);	VAR		ignoreLineHeight: Integer;		ignoreAscent: Integer;	BEGIN		TEGetStyle(charOffset, theStyle, ignoreLineHeight, ignoreAscent, macTE);	END;(******************************************************************************}{ GetSelection}{}{ 	Return the start and end of the currently selected text.}{******************************************************************************)PROCEDURE CEditText.GetSelection (VAR selStart, selEnd: Longint);	BEGIN		selStart := macTE^^.selStart;		selEnd := macTE^^.selEnd;	END;(* TE line count is not correct if	*)(*   last char is a carriage return	*)(******************************************************************************}{ GetNumLines}{}{ 	Return the number of lines of text.}{******************************************************************************)FUNCTION CEditText.GetNumLines: Longint;	VAR		numLines, teLen: Longint;		textH: CharsHandle;	BEGIN		numLines := macTE^^.nLines;		teLen := macTE^^.teLength;		textH := CharsHandle(macTE^^.hText);		IF (teLen > 0) & (textH^^[macTE^^.teLength - 1] = CARRIAGE_RETURN) THEN			numLines := numLines + 1;		GetNumLines := numLines;	END;(******************************************************************************}{ GetHeight}{}{ 	Return the height in pixels of the indicated lines of text.}{******************************************************************************)FUNCTION CEditText.GetHeight (startLine, endLine: Longint): Longint;	BEGIN		GetHeight := TEGetHeight(endLine, startLine, macTE);	END;(******************************************************************************}{ GetCharOffset}{}{ 	Return the offset into the text buffer of the character corresponding}{ 	to the given point in Frame coordinates.}{******************************************************************************)FUNCTION CEditText.GetCharOffset (aPt: LongPt): Longint;	VAR		qdPt: Point;	BEGIN		Prepare;		FrameToQD(aPt, qdPt);		GetCharOffset := TEGetOffset(qdPt, macTE);	END;(******************************************************************************}{ GetCharPoint}{}{ 	Return the Frame coordinates of the character at the}{ 	given offset in the text buffer.}{******************************************************************************)PROCEDURE CEditText.GetCharPoint (theOffset: Longint;								VAR aPt: LongPt);	VAR		qdPt: Point;	BEGIN		ASSERT(theOffset <= MAXINT);		Prepare;		qdPt := TEGetPoint(Integer(theOffset), macTE);		QDToFrame(qdPt, aPt);	END;(******************************************************************************}{ CopyTextRange}{}{ 	Return a copy of the currently selected text.}{******************************************************************************)FUNCTION CEditText.CopyTextRange (startPos, endPos: Longint): Handle;	VAR		h: Handle;		len: Longint;		textH: CharsHandle;	BEGIN		endPos := Min(endPos, macTE^^.teLength);		len := Max(endPos - startPos, 0);		h := NewHandleCanFail(len);		FailNIL(h);		textH := CharsHandle(macTE^^.hText);		IF (len > 0) THEN			BlockMove(@textH^^[startPos], h^, len);		CopyTextRange := h;	END;(******************************************************************************}{ PerformEditCommand}{}{ 	Performs the standard cut, copy, paste, and clear operations. Generally}{ 	called by a CTextEditTask to provide for undo.}{}{******************************************************************************)PROCEDURE CEditText.PerformEditCommand (theCommand: Longint);	VAR		ignore: Longint;	BEGIN		Prepare;		CASE theCommand OF			cmdCut: 				BEGIN					TECut(macTE);					ignore := ZeroScrap;					ignore := TEToScrap;					gClipboard.UpdateDisplay;				END;			cmdCopy: 				BEGIN					TECopy(macTE);					ignore := ZeroScrap;					ignore := TEToScrap;					gClipboard.UpdateDisplay;				END;			cmdPaste: 				BEGIN					CheckInsertion(gClipboard.DataSize('TEXT'), TRUE);					ignore := TEFromScrap;					TEPaste(macTE);				END;			cmdClear: 				TEDelete(macTE);		END;		AdjustBounds;		ScrollToSelection;	END;(******************************************************************************}{ InsertTextPtr}{}{ 	Insert the given text just before the selection.}{******************************************************************************)PROCEDURE CEditText.InsertTextPtr (text: Ptr;								length: Longint;								fRedraw: Boolean);	BEGIN		CheckInsertion(length, FALSE);		Prepare;		TEInsert(text, length, macTE);		AdjustBounds;		IF (fRedraw) THEN			Refresh;	END;END.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      2oc       
P2CStrProc   ‡     CEditText.p   TEXTPJMM@         TEXTPJMM@                       §X∂ç      L     LDoDraw  „b    *          LDelRow  ‰   ∂    Z       LAddRow  m  y   ƒ         PPCRead  ÊkRange       Ä   1.1.2	TCL 1.1.2           2 iíú¸    2  vers   
 ˇˇ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {****************************************************}{ 		CEnvironment.p}{}{		The Environment Class}{}{	    	Maintains information about the drawing environment for a Pane so that }{	    	it can be restored whenever the Pane needs to be drawn. This class }{	    	merely restores the normal pen characteristics. Subclasses should be }{	    	created if a program uses Panes which require particular settings, }{	    	such as text characteristics or color settings. }{}{		SUPERCLASS = CObject}{}{		Copyright © 1989, Symantec Corporation.  All rights reserved.			}{}{****************************************************}unit CEnvironment;interface	uses		TCL;implementation{****************************************************}{ Restore}{}{		Restore the state of the Environment. The port must be properly}{		set before calling this method.}{}{****************************************************}	procedure CEnvironment.Restore;	begin		PenNormal;						{ Set default pen state			}	end;end.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               {****************************************************}{ 		CError.p}{}{		The Error Class}{}{		Error handling class for reporting errors.}{}{		SUPERCLASS = CObject}{}{		Copyright © 1989, Symantec Corporation.  All rights reserved.			}{}{****************************************************}UNIT CError;INTERFACEUSES	Script, TCL;IMPLEMENTATION{****************************************************}{	 SevereMacError }{}{	        Report a Macintosh Operating System Error by posting an Alert }{	        Box which gives the user the choice of continuing at his/her own }{	        risk or aborting the program. }{}{****************************************************}PROCEDURE CError.SevereMacError (macErr: OSErr);	VAR		errMsg: StringHandle;		{ Text of error message }		errNum: Str255;			{ Error number as a string }		errorString: Str255;	BEGIN		errMsg := StringHandle(GetResource(ErrMsg_Res, macErr));		IF errMsg = NIL THEN			errMsg := GetString(STRosError);		IF errMsg = NIL THEN			IF macErr = resNotFound THEN				MissingResources			ELSE				BEGIN					errorString := 'Mac OS Error encountered';					errMsg := StringHandle(NewHandle(length(errorString) + 1));					errMsg^^ := errorString;				END;		NumToString(macErr, errNum);		HLock(Handle(errMsg));		ParamText(errMsg^^, errNum, '', '');		HUnlock(Handle(errMsg));		PositionDialog('ALRT', ALRTsevereErr);		InitCursor;		IF StopAlert(ALRTsevereErr, NIL) = Cancel THEN			BEGIN				gApplication.ExitApp;				ExitToShell;			END		ELSE			BEGIN				HiliteMenu(NOTHING);				gApplication.JumpToEventLoop;			END;	END;{****************************************************}{	 CheckOSError }{}{	        Check for a Macintosh Operating System Error and post an Alert }{	        if necessary. Return TRUE if everything is OK; Return FALSE }{	        if an error occurred. }{}{	        Method looks for text for an error message in an ErrMsg_Res resource }{	        with the same ID number as the error number. If it doesn't find }{	        one, it uses the default error message which is stored in an }{	        'STR ' resource with the same ID as that used for the Alert Box. }{}{****************************************************}FUNCTION CError.CheckOSError (macErr: OSErr): Boolean;	VAR		errMsg: StringHandle;		errNum: Str255;		temp: integer;	BEGIN		IF macErr = noErr THEN			CheckOSError := TRUE		ELSE			BEGIN				errMsg := StringHandle(GetResource(ErrMsg_Res, macErr));				IF errMsg = NIL THEN					errMsg := GetString(STRosError);				NumToString(macErr, errNum);				HLock(Handle(errMsg));				ParamText(errMsg^^, errNum, '', '');				HUnlock(Handle(errMsg));				PositionDialog('ALRT', ALRTosError);				InitCursor;				temp := StopAlert(ALRTosError, NIL);				CheckOSError := FALSE;			END;	END;{****************************************************}{ PostAlert}{}{		Post a standard Mac Alert box with a text string specified by}{		a string list resource ID (STR#) and index number}{}{****************************************************}PROCEDURE CError.PostAlert (STRid, index: integer);	VAR		message: Str255;		temp: integer;	BEGIN		GetIndString(message, STRid, index);		ParamText(message, '', '', '');		PositionDialog('ALRT', ALRTgeneral);		InitCursor;		temp := Alert(ALRTgeneral, NIL);	END;{****************************************************}{ MissingResources }{}{		We tried to load two non-existent resources.  The user probably forgot to }{		specify a resource file in Pascal's Run Options dialog. }{}{		Post an alert and terminate the application. }{}{****************************************************}PROCEDURE CError.MissingResources;	TYPE										{ Template for a DITL consisting of one 	}		textItem = RECORD					{ static text item.							}				numItems: integer;				itemHandle: Handle;				itemRect: Rect;				itemTypeAndLength: integer;		{ Type in high byte, length in low byte.	}				itemContent: Str255;				{ Actually, this needs to be pure text	}												{ (no length byte).  Also, the number of	}												{ chars must be even.						}			END;		textItemP = ^textItem;		textItemH = ^textItemP;	CONST										{ Constants used in setting up the DITL.	}		theText = 'ome resources were not found.  Did you specify a resource file in the Run Options dialog?';												{ We'll stuff the length byte with an 'S' 	}												{ later.										}		theTextLength = length(theText) + 1;		textItemType = (statText + itemDisable) * $0100;		TextTopLeft = 20;		DialogRight = 255;		DialogBottom = 105;	VAR		theDialogTextP: textItemP;		theDialogText: textItemH;		theDialog: DialogPtr;		theDialogRect: Rect;		eventReceived: Boolean;		macEvent: EventRecord;	BEGIN		new(theDialogTextP);		theDialogText := @theDialogTextP;		HLock(Handle(theDialogText));		WITH theDialogTextP^ DO			BEGIN				numItems := 0;									{ To indicate one item.	}				itemHandle := NIL;								{ Just a placeholder.	}				SetRect(itemRect, TextTopLeft, TextTopLeft, DialogRight, DialogBottom);				itemTypeAndLength := textItemType + theTextLength;				itemContent := theText;{$PUSH}{$R-}				itemContent[0] := 'S';			{ Replace length byte with 'S'.		}{$POP}				itemContent[30] := CARRIAGE_RETURN;		{ Replace these spaces 	}				itemContent[31] := CARRIAGE_RETURN;		{ with CRs				}				itemContent[63] := CARRIAGE_RETURN;			END;		SetRect(theDialogRect, 0, 0, DialogRight, DialogBottom);		WITH theDialogRect DO			{ Center the dialog in the upper portion 	}										{ of the screen.								}			BEGIN				left := (screenBits.bounds.right - (right - left)) DIV 2;				top := (screenBits.bounds.bottom - (bottom - top)) DIV 3;				IF top < GetMBarHeight + 7 THEN					top := GetMBarHeight + 7;				right := right + left;			{ left and top were both 0	}				bottom := bottom + top;			END;		theDialog := NewDialog(NIL, theDialogRect, nullStr, TRUE, dBoxProc, Pointer(-1), FALSE, 0, Handle(theDialogText));		SysBeep(1);		DrawDialog(theDialog);{	Dismiss dialog on keyDown or mouseDown.	}		REPEAT			SystemTask;			eventReceived := GetOSEvent(mDownMask + keyDownMask, macEvent);		UNTIL eventReceived;		DisposDialog(theDialog);		gApplication.ExitApp;				{ Terminate program.	}		ExitToShell;	END;END.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   (******************************************************************************}{ CFile.p}{}{							The File Class}{		}{	Class for a disk-based file. Information can be read from or written to}{	a File.}{	}{	SUPERCLASS = CObject}{	}{	Copyright © 1989 Symantec Corporation. All rights reserved.}{	}{	TCL 1.1 CHANGES}{	[}{		- changed implementation to use exceptions. If you need or prefer the}{			old version, use the compatibility class BFile.}{		- implemented ExistsOnDisk, GetMacFileInfo, SpecifyFSSpec, GetFSSpec,}{		  and ResolveFileAlias methods}{	]}{}{ ******************************************************************************)UNIT CFile;INTERFACE	USES		TCL, Aliases;IMPLEMENTATION(**** C O N S T R U C T I O N / D E S T R U C T I O N   M E T H O D S ****)(******************************************************************************}{ IFile}{}{		Initialize a File object}{ ******************************************************************************)	PROCEDURE CFile.IFile;	BEGIN	(* Clear instance variables			*)		name := '';		volNum := 0;		dirID := 0;	END;(* Close Mac File					*)(******************************************************************************}{ Dispose {OVERRIDE}		{Dispose of aFile OBJECT}(******************************************************************************}	PROCEDURE CFile.Free;	BEGIN		Close;		INHERITED Free;		(* Pass message on to superclass	*)	END;(******************************************************************************}{ Open}{}{		Open a File. Subclasses must override this method.}{ ******************************************************************************)	PROCEDURE CFile.Open (permission: SignedByte);	BEGIN	(* Null Method						*)	END;(**** S P E C I F Y I N G   M E T H O D S ****)(******************************************************************************}{ Close}{}{		Close a File. Subclasses must override this method.}{ ******************************************************************************)	PROCEDURE CFile.Close;	BEGIN(* Null Method						*)	END;(******************************************************************************}{ Specify}{}{		Specify the name and volume number of a File}{ ******************************************************************************)	PROCEDURE CFile.Specify (aName: Str255;									aVolNum: Integer);	BEGIN		name := aName;		volNum := aVolNum;		dirID := 0;		IF (ExistsOnDisk) THEN			ResolveFileAlias;	END;(******************************************************************************}{ SpecifyFSSpec}{}{		Specify the File using a File Mgr FSSpec record}{ ******************************************************************************)	PROCEDURE CFile.SpecifyFSSpec (aFileSpec: FSSpec);	BEGIN		name := aFileSpec.name;		volNum := aFileSpec.vRefNum;		dirID := aFileSpec.parID;		IF (ExistsOnDisk) THEN			ResolveFileAlias;	END;(******************************************************************************}{ SpecifyHFS}{}{		Specify the name, volume number, and directory ID of a File}{ ******************************************************************************)	PROCEDURE CFile.SpecifyHFS (aName: Str255;									aVolNum: Integer;									aDirID: Longint);		VAR			fileSpec: FSSpec;	BEGIN		fileSpec.name := aName;		fileSpec.vRefNum := aVolNum;		fileSpec.parID := aDirID;		SpecifyFSSpec(fileSpec);	END;(******************************************************************************}{ SFSpecify}{}{		Specify file parameters from a Standard File reply record}{ ******************************************************************************)	PROCEDURE CFile.SFSpecify (macSFReply: SFReply);		VAR			aVolNum: Integer;			aDirID: Longint;			aProcID: Longint;	BEGIN		FailOSErr(GetWDInfo(macSFReply.vRefNum, aVolNum, aDirID, aProcID));		SpecifyHFS(macSFReply.fName, aVolNum, aDirID);	END;(******************************************************************************}{ ResolveFileAlias}{}{	Resolve the current File specification in case it is an alias. The}{	Finder and Standard File resolve aliases for you, but this may}{	be necessary if you open a file directly. The Specify methods}{	call ResolveAliasFile for you.}{ ******************************************************************************)	PROCEDURE CFile.ResolveFileAlias;		VAR			fileSpec: FSSpec;			isFolder: Boolean;			wasAliased: Boolean;	BEGIN		IF (NOT gSystem.hasAliasMgr) THEN			EXIT(ResolveFileAlias);		fileSpec.name := name;		fileSpec.parID := dirID;		fileSpec.vRefNum := volNum;		FailOSErr(ResolveAliasFile(fileSpec, TRUE, isFolder, wasAliased));		IF (wasAliased) THEN			BEGIN			(* copy back specification*)				name := fileSpec.name;				dirID := fileSpec.parID;				volNum := fileSpec.vRefNum;			END;		IF (isFolder) THEN		(* raise exception if this is a directory, we only handle files*)			Failure(paramErr, 0);	END;(**** A C C E S S I N G   M E T H O D S ****)(******************************************************************************}{ GetName}{}{		Retrieve the name of a File}{ ******************************************************************************)	PROCEDURE CFile.GetName (VAR theName: Str255);	BEGIN		theName := name;	END;(******************************************************************************}{ GetFSSpec}{}{	Fill in a FSSpec record for this File}{ ******************************************************************************)	PROCEDURE CFile.GetFSSpec (VAR aFileSpec: FSSpec);		VAR			s: Str255;	BEGIN		GetName(s);		aFileSpec.name := s;		aFileSpec.parID := dirID;		aFileSpec.vRefNum := volNum;	END;(**** F I L I N G   M E T H O D S ****)(******************************************************************************}{ CreateNew}{}{		Create a new file}{ ******************************************************************************)	PROCEDURE CFile.CreateNew (creator: OSType;			(* Creator signature				*)									fType: OSType);	(* File type					*)	BEGIN		FailOSErr(HCreate(volNum, dirID, name, creator, fType));	END;(******************************************************************************}{ ThrowOut}{}{		Remove a file from disk, i.e., throw it in the trash.}{ ******************************************************************************)	PROCEDURE CFile.ThrowOut;	BEGIN				(* Must close file before we can	*)				(*   throw it out					*)		Close;		FailOSErr(HDelete(volNum, dirID, name));	END;(******************************************************************************}{ ChangeName}{}{		Rename a file. File may or may not be open.}{ ******************************************************************************)	PROCEDURE CFile.ChangeName (newName: Str255);	BEGIN		FailOSErr(HRename(volNum, dirID, name, newName));		name := newName;	END;(******************************************************************************}{ ExistsOnDisk}{}{		Returns TRUE if file exists on disk matching the current specification}{ ******************************************************************************)	FUNCTION CFile.ExistsOnDisk: Boolean;		VAR			fileInfo: FInfo;			err: Integer;	BEGIN		err := HGetFInfo(volNum, dirID, name, fileInfo);		ExistsOnDisk := err = noErr;	END;(******************************************************************************}{ GetMacFileInfo}{}{		Return a File Manager FInfo structure for a file.}{ ******************************************************************************)	PROCEDURE CFile.GetMacFileInfo (VAR fileInfo: FInfo);	BEGIN		FailOSErr(HGetFInfo(volNum, dirID, name, fileInfo));	END;END.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   (******************************************************************************}{ CList.p}{}{							The List Class}{	}{	A linear list of objects.}{	}{	SUPERCLASS = CCluster}{	}{	Copyright © 1989 Symantec Corporation. All rights reserved.}{}{	TCL 1.1 CHANGES}{	[}{		- because CList is now a subclass of CArray the implementations}{		  of Prepend, InsertAfter, InsertAt, MoveUp, MoveDown, SendBack,}{		  MoveToIndex now bottleneck through InsertAtIndex and }{		  MoveItemToIndex.}{		- removed the Remove method.}{	]}{ ******************************************************************************)UNIT CList;INTERFACEUSES	TCL;IMPLEMENTATION(**** C O N S T R U C T I O N / D E S T R U C T I O N   M E T H O D S ****)(******************************************************************************}{ IList}{}{		Initialize a List object}{ ******************************************************************************)PROCEDURE CList.IList;	BEGIN						(* Initialize superclass			*)		ICluster;	END;(******************************************************************************}{ Append}{}{		Add an item to the end of a list}{ ******************************************************************************)PROCEDURE CList.Append (theObject: CObject);	BEGIN		Add(theObject);	END;(******************************************************************************}{ Prepend}{}{		Add an item to the beginning of a list}{ ******************************************************************************)PROCEDURE CList.Prepend (theObject: CObject);	BEGIN		InsertAtIndex(@theObject, 1);	END;(******************************************************************************}{ InsertAfter}{}{		Add an item to a list at the position after a specified item}{ ******************************************************************************)PROCEDURE CList.InsertAfter (theObject: CObject; (* Object to insert in the list		*)								afterObject: CObject); (* Object to insert it after		*)	VAR		afterOffset: Longint;	BEGIN			(* Find location of afterObject		*)		afterOffset := Offset(afterObject);		IF (afterOffset = BAD_INDEX) THEN			afterOffset := 0;		InsertAtIndex(@theObject, afterOffset + 2);	END;(******************************************************************************}{ InsertAt}{}{		Add an item to a list at the specified position}{ ******************************************************************************)PROCEDURE CList.InsertAt (theObject: CObject;								index: Longint);	BEGIN		InsertAtIndex(@theObject, index);	END;(******************************************************************************}{ BringFront}{}{		Bring an item to the front of a list. Item must already be in the list.}{ ******************************************************************************)PROCEDURE CList.BringFront (theObject: CObject);	VAR		i: Longint;		(* Index into list					*)	BEGIN						(* Find location of the object		*)		i := Offset(theObject);						(* If it's not already in front ...	*)		IF (i > 0) THEN			BEGIN				MoveItemToIndex(i + 1, 1);			END;	END;(******************************************************************************}{ SendBack}{}{		Send an item to the back of a list. Item must already be in the list.}{ ******************************************************************************)PROCEDURE CList.SendBack (theObject: CObject); (* Object to move to the back		*)	VAR		i: Longint;			(* Index into list					*)	BEGIN							(* Find location of the object		*)		i := Offset(theObject);							(* If it's not already in back ...	*)		IF (i >= 0) & (i < numItems - 1) THEN			BEGIN				MoveItemToIndex(i + 1, numItems);			END;	END;(******************************************************************************}{ MoveUp}{}{		Move an item up (closer to the front) one position in the list.}{ ******************************************************************************)PROCEDURE CList.MoveUp (theObject: CObject); (* Object to move up in list		*)	VAR		i: Longint;	(* Index into list					*)	BEGIN							(* Find location of object			*)		i := Offset(theObject);							(* If it's not at the front ...		*)		IF (i > 0) THEN			BEGIN				MoveItemToIndex(i + 1, i);			END;	END;(******************************************************************************}{ MoveDown}{}{		Move an item down (closer to the back) one position in the list.}{ ******************************************************************************)PROCEDURE CList.MoveDown (theObject: CObject); (* Object to move down				*)	VAR		i: Longint;		(* Index into list					*)	BEGIN						(* Find locaton of object			*)		i := Offset(theObject);						(* If it's not at the back ...      *)		IF (i >= 0) & (i < numItems - 1) THEN			BEGIN				MoveItemToIndex(i + 1, i + 2);			END;	END;(******************************************************************************}{ MoveToIndex}{}{		Move an item to a specified position in the list, shifting}{		other items in the list appropriately.}{ ******************************************************************************)PROCEDURE CList.MoveToIndex (theObject: CObject; (* Object to move within the list	*)								index: Longint);							(* Index at which to move object	*)	VAR		i: Longint;	(* Index into the list				*)	BEGIN					(* Find location of the object		*)		i := Offset(theObject);		IF (i <> BAD_INDEX) THEN			BEGIN				MoveItemToIndex(i + 1, index);			END;	END;(******************************************************************************}{ FirstItem}{}{		Return the first item in the list}{ ******************************************************************************)FUNCTION CList.FirstItem: CObject;	BEGIN		FirstItem := NthItem(1);	END;(******************************************************************************}{ LastItem}{}{		Return the last item in the list}{ ******************************************************************************)FUNCTION CList.LastItem: CObject;	BEGIN		LastItem := NthItem(numItems);	END;(******************************************************************************}{ NthItem}{}{		Return the Nth item in the list}{ ******************************************************************************)FUNCTION CList.NthItem (n: Longint): CObject;	BEGIN							(* If index is out of range			*)							(*   pass back NIL					*)		IF (n < 1) | (n > numItems) THEN			NthItem := NIL		ELSE							(* Do direct indexing into list		*)			NthItem := items^^[n - 1];	END;(******************************************************************************}{ FindIndex}{}{		Return the index number in the list of a specified object. Index}{		ranges from 1 to numItems.}{ ******************************************************************************)FUNCTION CList.FindIndex (theObject: CObject): Longint;	BEGIN						(* Index is one greater than the	*)						(*   offset, which is zero-based	*)		FindIndex := Offset(theObject) + 1;	END;(******************************************************************************}{ FirstSuccess}{}{		Find the first item in the list which successfully passes (returns}{		TRUE) the test function. Return NULL if no item passes the test.}{ ******************************************************************************)FUNCTION CList.FirstSuccess (FUNCTION testFunc (theObject: CObject): Boolean): CObject;	BEGIN		FirstSuccess := INHERITED FindItem(testFunc);	END;(******************************************************************************}{ FirstSuccess1}{}{		Find the first item in the list which successfully passes (returns}{		TRUE) the test function. Return NULL if no item passes the test.}{ ******************************************************************************)FUNCTION CList.FirstSuccess1 (FUNCTION testFunc (theObject: CObject;																theParam: UNIV Ptr): Boolean;								param: UNIV Ptr): CObject;	BEGIN		FirstSuccess1 := INHERITED FindItem1(testFunc, param);	END;(******************************************************************************}{ LastSuccess}{}{		Find the last item in the list which successfully passes (returns}{		TRUE) the test function. Return NULL if no item passes the test.}{ ******************************************************************************)FUNCTION CList.LastSuccess (FUNCTION testFunc (theObject: CObject): Boolean): CObject;	VAR		i: Longint;		wasLocked: Boolean;		item: CObject;		fi: FailInfo;	PROCEDURE HandleFailure (error: Integer;									message: Longint);		BEGIN			wasLocked := SetLockChanges(wasLocked);		END;	BEGIN		CatchFailures(fi, HandleFailure);		wasLocked := SetLockChanges(TRUE);		LastSuccess := NIL;		FOR i := numItems - 1 DOWNTO 0 DO			IF testFunc(items^^[i]) THEN				BEGIN					LastSuccess := items^^[i];					LEAVE;				END;		wasLocked := SetLockChanges(wasLocked);		Success;	END;(******************************************************************************}{ LastSuccess1}{}{		Find the last item in the list which successfully passes (returns}{		TRUE) the test function. Return NULL if no item passes the test.}{ ******************************************************************************)FUNCTION CList.LastSuccess1 (FUNCTION testFunc (theObject: CObject;																theParam: UNIV Ptr): Boolean;								param: UNIV Ptr): CObject;	VAR		i: Longint;		wasLocked: Boolean;		item: CObject;		fi: FailInfo;	PROCEDURE HandleFailure (error: Integer;									message: Longint);		BEGIN			wasLocked := SetLockChanges(wasLocked);		END;	BEGIN		CatchFailures(fi, HandleFailure);		wasLocked := SetLockChanges(TRUE);		LastSuccess1 := NIL;		FOR i := numItems - 1 DOWNTO 0 DO			IF testFunc(items^^[i], param) THEN				BEGIN					LastSuccess1 := items^^[i];					LEAVE;				END;		wasLocked := SetLockChanges(wasLocked);		Success;	END;END.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {****************************************************}{ 		CMBarChore.p}{}{		The MBarChore Class}{}{		Redraw the menu bar. This chore gets executed once for all menu}{		changes requiring a redraw of the menu bar which are conducted during}{		one pass of the event loop. This prevents unsightly flashing.}{}{		SUPERCLASS = CChore}{}{		Copyright © 1989, Symantec Corporation.  All rights reserved.			}{}{****************************************************}UNIT CMBarChore;INTERFACE	USES		TCL;IMPLEMENTATION{****************************************************}{ Perform (OVERRIDE)}{}{		Redraw the menu bar}{}{****************************************************}	PROCEDURE CMBarChore.Perform (VAR maxSleep: longint);	BEGIN		HiliteMenu(NOTHING);			{ Menu bar may not be redrawn		}										{   properly if a menu item is		}										{   hilited when DrawMenuBar is	}										{   called								}		gBartender.UpdateMenuBar;  		(* Redraw to reflect changes 			*)		gBartender.choreAssigned := FALSE;	(* Clear chore from gBartender		*)	END;END.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     (****************************************************************************** CMouseTask.p							The MouseTask Class			SUPERCLASS = CTask		Copyright © 1989 Symantec Corporation. All rights reserved. ******************************************************************************)  unit CMouseTask;  interface  uses TCL;  implementation (**** C O N S T R U C T I O N / D E S T R U C T I O N   M E T H O D S ****)(****************************************************************************** IMouseTask		Initialize a MouseTask object ******************************************************************************)PROCEDURE CMouseTask.IMouseTask( aNameIndex : Integer);BEGIN	ITask(aNameIndex);	END;(**** M O U S E   T R A C K I N G   M E T H O D S ****)(****************************************************************************** BeginTracking		Mouse down tracking is about to begin at the specified starting		point. Subclasses should override this method if they wish to		perform preparations before tracking or to alter the startPt		(startPt could be altered to implement "snap to grid" for a		drawing program). ******************************************************************************)PROCEDURE CMouseTask.BeginTracking(var startPt : LongPt);BEGIN			(* Null Method						*)END;(****************************************************************************** KeepTracking		Continuous mouse tracking while the mouse button is down. The		current, previous, and starting mouse locations are passed by		reference so the method may change their values. For example,		the values may be changed to implement constrained drawing. ******************************************************************************)PROCEDURE CMouseTask.KeepTracking(var currPt, prevPt, startPt : LongPt);BEGIN		(* Null Method						*)END;(****************************************************************************** EndTracking		Mouse down tracking has ended because the user has released the		mouse button. ******************************************************************************)PROCEDURE CMouseTask.EndTracking(VAR	currPt, prevPt, startPt : LongPt);BEGIN		(* Null Method						*)END;end.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        (******************************************************************************}{ CObject.p}{}{							The root-level Object Class}{	}{		Abstract class which is at the root of the class hierarchy. CObject}{		is the only class which does not have a superclass.	}{}{	SUPERCLASS = None}{	}{	Copyright © 1989 Symantec Corporation. All rights reserved.}{	}{	TCL 1.1 CHANGES}{	[}{		- implement Lock method.}{		- Add failure handling}{	]}{}{ ******************************************************************************)UNIT CObject;INTERFACEUSES	TCL;IMPLEMENTATION(******************************************************************************}{ Free}{}{		Dispose of an object by freeing the block of memory it occupies}{ ******************************************************************************)PROCEDURE CObject.Free;	BEGIN		DisposHandle(Handle(SELF));	END;(******************************************************************************}{ Clone}{}{		Make a copy of an object}{ ******************************************************************************)FUNCTION CObject.Clone: CObject;	{ TCL 1.1.1 DLP 9/25/91 }	VAR		copyOfObject: Handle;		err: Integer;		savedAlloc: Boolean;	BEGIN		savedAlloc := SetAllocation(kAllocCanFail);			(* Objects are just handles			*)		copyOfObject := Handle(SELF);		err := HandToHand(copyOfObject);		savedAlloc := SetAllocation(savedAlloc);		FailOSErr(err);		Clone := (CObject(copyOfObject));	{ TCL 1.1.1 DLP 9/25/91 }	END;(******************************************************************************}{ Lock}{ }{ 	When fLocks is TRUE, makes an object non-relocatable, when FALSE}{ 	makes it relocatable, returns TRUE if previously locked.}{******************************************************************************)FUNCTION CObject.Lock (fLock: Boolean): Boolean;	CONST		kLockMask = $80;	(* bit 7 of handle state is set when locked *)	VAR		state: SignedByte;		locked: Boolean;	BEGIN			(* test lock bit of handle state *)		locked := BAND(HGetState(Handle(SELF)), kLockMask) <> 0;		IF (locked <> fLock) THEN			BEGIN				IF (fLock) THEN					HLock(Handle(SELF))				ELSE					HUnlock(Handle(SELF));			END;		Lock := locked;	END;PROCEDURE CObject.GetClassName (VAR className: Str255);	BEGIN	END;(******************************************************************************}{ SubclassResponsibility}{ }{ ******************************************************************************)PROCEDURE CObject.SubclassResponsibility;	BEGIN{$IFC TCL_DEBUG}		DebugStr('SubclassResponsibility');{$ENDC}	END;END.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   2 6      †      Ï            	CObject.p   TEXTPJMM@           TEXTPJMM@                       §UŸ      L  :      D      N      \      f      p      z      Ñ      é      ò      ¶      ∞      ∫      ƒ      ƒ      Œ         Ä   1.1.2	TCL 1.1.2           2 iíú¸    2  vers   
 ˇˇ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            (******************************************************************************}{ CPane.p}{}{							The Pane Class}{	}{	Abstract class for objects which may be displayed within windows. Panes}{	can also respond to the mouse, keyboard, and commands. Subclasses must}{	be created to display different kinds of informations and implement}{	different ways of responding to user actions.}{		}{	SUPERCLASS = CView}{	}{	Copyright © 1989 Symantec Corporation. All rights reserved.}{}{	TCL 1.1 CHANGES}{	[}{		- implemented GetWindow, GetBorder, SetResBorder, SetBorder methods}{		- modified DrawAll to include borders}{		- Moved TrackMouse from CView to CPane.}{		- for 32-bit support, changed interface for SetFrameOrigin, }{		  GetFrame, GetAperture, Place, Offset, EnclosureScrolled, }{		  WindToFrame, WindToFrameR, FrameToWind, FrameToWindR, EnclToFrame, }{		  EnclToFrameR, FrameToEncl, FrameToEnclR, and FrameToGlobalR methods }{		  to use long coordinates.}{		- implemented new methods RefreshLongRect, QDToFrame, QDToFrameR, }{		  FrameToQD, FrameToQDR, and SectAperture.}{		  }{		- see comments for Prepare, Draw, and DrawAll for some important}{		  changes.}{	]}{	}{ ******************************************************************************)UNIT CPane;INTERFACEUSES	TCL;PROCEDURE Pane_AdjustToEnclosure (thePane: CPane;							delta: RectPtr);PROCEDURE Pane_Draw (thePane: CPane;							area: RectPtr);IMPLEMENTATIONCONST	kOriginConstraint = 8192;(**** C O N S T R U C T I O N / D E S T R U C T I O N   M E T H O D S ****)(******************************************************************************}{ IPane}{}{		Initialize a Pane object}{ ******************************************************************************)PROCEDURE CPane.IPane (anEnclosure: CView;								aSupervisor: CBureaucrat;								aWidth: Integer;								aHeight: Integer;								aHEncl: Integer;								aVEncl: Integer;								aHSizing: SizingOption;								aVSizing: SizingOption);	BEGIN		(* Initialize superclass			*)		IView(anEnclosure, aSupervisor);		(* Set instance variables			*)		visible := TRUE;		active := TRUE;		width := aWidth;		height := aHeight;		hEncl := aHEncl;		vEncl := aVEncl;		hSizing := aHSizing;		vSizing := aVSizing;		autoRefresh := TRUE;		printClip := clipFRAME;		(* Extra initialization				*)		IPaneX;	END;(******************************************************************************}{ IViewTemp {OVERRIDE}{Initialize a Pane using a template}(******************************************************************************}PROCEDURE CPane.IViewTemp (anEnclosure: CView; 						(* Enclosing view					*)								aSupervisor: CBureaucrat;			(* Boss in chain of command			*)								viewData: Ptr);					(* Template with View data			*)	VAR		p: PaneTempP;	BEGIN		p := PaneTempP(viewData);	(* Initialize superclass			*)		INHERITED IViewTemp(anEnclosure, aSupervisor, @p^.sViewTemp);								(* Set instance vars from template	*)		width := p^.width;		height := p^.height;		hEncl := p^.hEncl;		vEncl := p^.vEncl;		hSizing := SizingOption(p^.hSizing);		vSizing := SizingOption(p^.vSizing);		autoRefresh := p^.autoRefresh <> 0;		printClip := ClipOption(p^.printClip);								(* Extra initialization				*)		IPaneX;	END;(******************************************************************************}{ IPaneX {OVERRIDE}{Extra initialization for a Pane}(******************************************************************************}PROCEDURE CPane.IPaneX;	BEGIN		itsBorder := NIL;		itsLastTask := NIL;									(* This is a subview of enclosure	*)		itsEnclosure.AddSubview(SELF);		printing := FALSE;		macPort := itsEnclosure.GetMacPort;									(* Set up Frame coordinates			*)		CalcFrame;									(* Determine visible portion		*)		CalcAperture;		itsEnvironment := NIL;	END;(******************************************************************************}{ Free {OVERRIDE}{Dispose of a Pane }(******************************************************************************}PROCEDURE CPane.Free;	BEGIN									(* Throw out drawing environment	*)		ForgetObject(itsEnvironment);									(* Throw out pane border			*)		ForgetObject(itsBorder);		(* makes sure that the last undo task is disposed. Since the 	*)		(* undo tasks usually have references back to this pane, 		*)		(* it would be bad if this pane was disposed and the task was 	*)		(* not informed.												*)		IF itsLastTask <> NIL THEN			BEGIN				Notify(NIL);					(* the document disposes of the task 	*)									{ removed ASSERT - TCL 1.1.1 DLP 10/28/91 }			END;									(* Pass message on to superclass	*)		INHERITED Free;	END;(**** A C C E S S I N G   M E T H O D S ****)(******************************************************************************}{ SetFrameOrigin}{}{		Set the coordinates of the top left corner of a Pane's frame. The}{		bottom right corner is adjusted to according to the width and}{		height. The frame determines the local QuickDraw coordinates system}{		(called Frame coordinates) used for drawing the pane.}{ ******************************************************************************)PROCEDURE CPane.SetFrameOrigin (fLeft, fTop: Longint);	BEGIN									(* Set top left coordinates			*)		frame.left := fLeft;		frame.top := fTop;									(* Set right and bottom using the	*)									(*   current width and height		*)		frame.right := frame.left + width;		frame.bottom := frame.top + height;		ForceNextPrepare;	END;(******************************************************************************){ GetFrame}{}{		Return the frame of the pane}{ ******************************************************************************)PROCEDURE CPane.GetFrame (VAR theFrame: LongRect);	BEGIN								(* Return copy of instance variable	*)		theFrame := frame;	END;(******************************************************************************}{ GetLengths}{}{		Return the width and height of a Pane}{ ******************************************************************************)PROCEDURE CPane.GetLengths (VAR theWidth, theHeight: Integer);	BEGIN								(* Return instance variables		*)		theWidth := width;		theHeight := height;	END;(******************************************************************************}{ GetOrigin}{}{		Return the origin of a Pane. Origin is the location of the}{		top left corner of the Pane's window, expressed in the Pane's}{		Frame coordinates.}{ ******************************************************************************)PROCEDURE CPane.GetOrigin (VAR theHOrigin, theVOrigin: Longint);	BEGIN								(* Return instance variables		*)		theHOrigin := hOrigin;		theVOrigin := vOrigin;	END;(******************************************************************************}{ GetAperture {OVERRIDE}{Return the portion of the pane where drawing may occur . }{Aperture is in the pane 's Frame coordinates.}(******************************************************************************}PROCEDURE CPane.GetAperture (VAR theAperture: LongRect);	BEGIN								(* Return copy of instance variable	*)		theAperture := aperture;	END;(******************************************************************************}{ GetWindow}{ }{ 	Return the CWindow that the pane is enclosed within.}{******************************************************************************)FUNCTION CPane.GetWindow: CWindow;	BEGIN		GetWindow := CWindow(GetWRefCon(macPort));	END;(******************************************************************************}{ Contains {OVERRIDE}{Check whether a point , specified in Window coordinates , is contained within the aperture of a Pane}(******************************************************************************}FUNCTION CPane.Contains (thePoint: Point): Boolean;	VAR		framePt: LongPt;	BEGIN								(* Convert to Frame coordinates		*)		WindToFrame(thePoint, framePt);								(* Is point inside aperture?		*)		Contains := (PtInLongRect(framePt, aperture));	END;(******************************************************************************}{ ReallyVisible {OVERRIDE}{Check whether a Pane and all its enclosures are visible . Also make sure that the origin does not place the pane outside valid QuickDraw coordinates .}(******************************************************************************}FUNCTION CPane.ReallyVisible: Boolean;	BEGIN		IF (visible & ((frame.left - hOrigin) >= MININT) & ((frame.right - hOrigin) <= MAXINT) & ((frame.top - vOrigin) >= MININT) & ((frame.bottom - vOrigin) <= MAXINT)) THEN			BEGIN				ReallyVisible := (itsEnclosure.ReallyVisible);			END		ELSE			ReallyVisible := FALSE;	END;(******************************************************************************}{ GetPixelExtent}{}{		Retrieve the dimensions of a Pane in pixels, which is the same as}{		the width and height of its frame}{ ******************************************************************************)PROCEDURE CPane.GetPixelExtent (VAR hExtent, vExtent: Longint);	BEGIN		hExtent := width;		vExtent := height;	END;(******************************************************************************}{ SetPrintClip}{}{		Specify the clipping option used when printing}{ ******************************************************************************)PROCEDURE CPane.SetPrintClip (aPrintClip: ClipOption);	BEGIN		printClip := aPrintClip;	END;(******************************************************************************}{ SetBorder}{ }{  Set the border for this pane.}{******************************************************************************)PROCEDURE CPane.SetBorder (aBorder: CPaneBorder);	VAR		paneFrame: Rect;		borderRect: Rect;		paneAperture: Rect;		hadPendingUpdate: Boolean;	BEGIN		FrameToGlobalR(aperture, paneAperture);		hadPendingUpdate := RectInRgn(paneAperture, WindowPeek(macPort)^.updateRgn);		FrameToWindR(frame, paneFrame);		GetWindow.Prepare;		IF (itsBorder <> NIL) THEN			BEGIN											(* clear old border			*)				borderRect := paneFrame;				itsBorder.CalcBorderRect(borderRect);				(* Can't assume that the pane's enclosure is a CPane	*)				(* so RefreshRect is not safe	here.					*)				InvalRect(borderRect);				itsBorder.Free;			END;		itsBorder := aBorder;		IF (itsBorder <> NIL) THEN			BEGIN											(* draw new border			*)				borderRect := paneFrame;				itsBorder.CalcBorderRect(borderRect);				InvalRect(borderRect);			END;		IF (NOT hadPendingUpdate) THEN			BEGIN				FrameToWindR(aperture, paneAperture);										(* the pane itself is not invalid *)				ValidRect(paneAperture);			END;	END;(******************************************************************************}{ SetResBorder}{ }{ 	Create a border for this pane from a 'PBrd' resource}{******************************************************************************)PROCEDURE CPane.SetResBorder (resID: Integer);	VAR		border: CPaneBorder;	BEGIN		ForgetObject(itsBorder);		new(border);		itsBorder := border;		itsBorder.IResPaneBorder(resID);	END;(******************************************************************************}{ GetBorder}{******************************************************************************)FUNCTION CPane.GetBorder: CPaneBorder;	BEGIN		GetBorder := itsBorder;	END;(**** D I S P L A Y   M E T H O D S ****)(******************************************************************************}{ Show {OVERRIDE}{Make a Pane visible}(******************************************************************************}PROCEDURE CPane.Show;	BEGIN		IF (NOT visible) THEN			BEGIN				INHERITED Show;				Refresh;				RefreshBorder;			END;	END;(******************************************************************************}{ Hide {OVERRIDE}{    Make a Pane invisible}(******************************************************************************)PROCEDURE CPane.Hide;	BEGIN		IF (visible) THEN			BEGIN				Refresh;				RefreshBorder;				INHERITED Hide;			END;	END;(**** S I Z E   A N D   L O C A T I O N   M E T H O D S ****)(******************************************************************************}{CPane.Place}	{Place the top left corner of a Pane at a location specified in the coordinates of its enclosure}(******************************************************************************}PROCEDURE CPane.Place (aHEncl: Longint;								aVEncl: Longint;								redraw: Boolean);	VAR		hOffset: Longint;		vOffset: Longint;	BEGIN		hEncl := aHEncl;		vEncl := aVEncl;									(* Determine location of pane in	*)									(*   Window coords					*)		itsEnclosure.SubpaneLocation(hEncl, vEncl, aHEncl, aVEncl);		hOffset := hOrigin - frame.left + aHEncl;		vOffset := vOrigin - frame.top + aVEncl;		Offset(hOffset, vOffset, redraw);	END;(******************************************************************************}{ Offset}{}{		Translate the location of the Pane within its enclosure}{ ******************************************************************************)PROCEDURE CPane.Offset (hOffset: Longint; (* Pixels to offset vertically		*)								vOffset: Longint;								redraw: Boolean); 						(* Redraw Pane or not?				*)	VAR		enclhOrig: Longint;		enclvOrig: Longint;		(*}{		 * Tell a Pane that its enclosure has moved. Send Offset message}{		 * with redraw set to FALSE, since enclosure will have already}{		 * taken care of adding the appropriate areas to the update region.}{		 *)	PROCEDURE Pane_EnclosureMoved (thePane: CPane);		BEGIN			thePane.Offset(hOffset, vOffset, FALSE);		END;	BEGIN		IF (redraw) THEN			BEGIN	(* Force redraw of area covered by	*)							(*   current location of pane		*)				Refresh;				RefreshBorder;			END;						(* Change location of the pane		*)		hOrigin := hOrigin - hOffset;		vOrigin := vOrigin - vOffset;		itsEnclosure.GetOrigin(enclhOrig, enclvOrig);						(* Keep hEncl, and vEncl up to date when pane is moved.		*)						(* Thanks to Eric Olson for the fix.						*)		hEncl := enclhOrig - hOrigin;		vEncl := enclvOrig - vOrigin;						(* Visible portion of pane could	*)						(*   change as a result of a shift	*)						(*   in its location				*)		CalcAperture;		IF (redraw) THEN			BEGIN						(* Redraw pane at its new location	*)				Refresh;				RefreshBorder;			END;		IF (itsSubviews <> NIL) THEN			BEGIN						(* Inform subviews of the move		*)						(*   so they can adjust their		*)						(*   locations						*)				itsSubviews.DoForEach(Pane_EnclosureMoved);			END;	END;(******************************************************************************}{ ChangeSize}{}{		Change the size of a Pane. The delta rectangle parameter specifies}{		how each side of the pane should change. Positive values mean a}{		move to the right or down, negative values to the left or up.}{ ******************************************************************************)PROCEDURE CPane.ChangeSize (delta: Rect;								redraw: Boolean);	(* Redraw Pane or not?		*)	VAR		oldAperture: LongRect;			(* Save old aperture                *)		oldFrame: LongRect;		tmp: Rect;		oldBorder, newBorder: Rect;		(*}{		 *	Adjust subviews when the size of enclosure changes}{		 *)	BEGIN		oldAperture := aperture;		oldFrame := frame;		IF (redraw) THEN			BEGIN							(* Force redraw of area currently	*)							(*   occupied by the pane			*)							(*  and redraw border if there is one *)				Refresh;				RefreshBorder;			END;							(* Change dimensions of pane		*)		ResizeFrame(delta);							(* Determine new aperture           *)		CalcAperture;		IF (redraw) THEN			BEGIN							(* Force draw of pane at new size	*)				Refresh;				RefreshBorder;	{ TCL 1.1.1 DLP 10/1/91 }							(* If autoRefresh is FALSE (and		*)							(*   other safety checks), we do	*)							(*   not want to redraw the area	*)							(*   which is common to the old and	*)							(*   new pane size. Note that the	*)							(*   Refresh method will have set	*)							(*   the port for us already.		*)				IF (NOT autoRefresh & ReallyVisible) THEN					BEGIN						IF (SectLongRect(aperture, oldAperture, oldAperture)) THEN							BEGIN								FrameToQDR(oldAperture, tmp);								ValidRect(tmp);							END;						IF (itsBorder <> NIL) THEN							BEGIN								FrameToWindR(oldFrame, oldBorder);								itsBorder.CalcBorderRect(oldBorder);								FrameToWindR(frame, newBorder);								itsBorder.CalcBorderRect(newBorder);								IF (SectRect(oldBorder, newBorder, tmp)) THEN									BEGIN										GetWindow.Prepare;										ValidRect(tmp);										Prepare;									END;							END;					END;			END;		IF (itsSubviews <> NIL) THEN			itsSubviews.DoForEach1(Pane_AdjustToEnclosure, @delta);	END;(******************************************************************************}{ AdjustToEnclosure}{}{		Adjust size and/or location of a Pane after its enclosure's size}{		has changed. The deltaEncl rectangle parameter specifies how each}{		side of the enclosure has changed. Positive values mean a move to}{		the right or down, negative values to the left or up.}{ ******************************************************************************)PROCEDURE CPane.AdjustToEnclosure (deltaEncl: Rect); (* Change in enclosure's frame		*)	VAR		delta: Rect;		(* Change in this pane's frame		*)		hOffset: Integer;	(* Horizontal offset in location	*)		vOffset: Integer;	(* Vertical offset in location		*)		moved: Boolean;	(* Do we need to move the pane?		*)		sized: Boolean;	(* Do we need to size the pane?		*)	BEGIN		hOffset := 0;		vOffset := 0;		moved := FALSE;		sized := FALSE;		SetRect(delta, 0, 0, 0, 0);		AdjustHoriz(deltaEncl, delta, hOffset, moved, sized);		AdjustVert(deltaEncl, delta, vOffset, moved, sized);		IF (moved) THEN			BEGIN				IF (sized) THEN			(* Pane must be moved and sized		*)					BEGIN						Offset(hOffset, vOffset, TRUE);						ChangeSize(delta, TRUE);					END				ELSE					BEGIN						Offset(hOffset, vOffset, TRUE);	(* Move pane by offsetting location	*)					END;			END		ELSE IF (sized) THEN			(* Change size of Pane				*)			BEGIN				ChangeSize(delta, TRUE);			END		ELSE			BEGIN				(* Pane stays the same, but change	*)				(*   in enclosure may change its	*)				(*   aperture						*)				CalcAperture;			END;	END;(******************************************************************************}{ AdjustHoriz}{}{		Adjust the horizontal size and/or location of a Pane}{ ******************************************************************************)PROCEDURE CPane.AdjustHoriz (deltaEncl: Rect;								VAR delta: Rect;								VAR theOffset: Integer;								VAR moved: Boolean;								VAR sized: Boolean);	BEGIN		CASE hSizing OF			sizFIXEDLEFT: 				BEGIN					theOffset := deltaEncl.left;					IF (theOffset <> 0) THEN						moved := TRUE;				END;			sizFIXEDRIGHT: 				BEGIN					theOffset := deltaEncl.right;					IF (theOffset = deltaEncl.right) THEN						moved := TRUE;				END;			sizELASTIC: 				BEGIN					delta.left := deltaEncl.left;					delta.right := deltaEncl.right;					IF ((delta.left <> 0) | (delta.right <> 0)) THEN						sized := TRUE;				END;		END;	END;(******************************************************************************}{ AdjustVert}{}{		Adjust the vertical size and/or location of a Pane}{ ******************************************************************************)PROCEDURE CPane.AdjustVert (deltaEncl: Rect;								VAR delta: Rect;								VAR theOffset: Integer;								VAR moved: Boolean;								VAR sized: Boolean);	BEGIN		CASE vSizing OF			sizFIXEDTOP: 				BEGIN					theOffset := deltaEncl.top;					IF (theOffset <> 0) THEN						moved := TRUE;				END;			sizFIXEDBOTTOM: 				BEGIN					theOffset := deltaEncl.bottom;					IF (theOffset <> 0) THEN						moved := TRUE;				END;			sizELASTIC: 				BEGIN					delta.top := deltaEncl.top;					delta.bottom := deltaEncl.bottom;					IF ((delta.top <> 0) | (delta.bottom <> 0)) THEN						sized := TRUE;				END;		END;	END;(******************************************************************************}{ EnclosureScrolled}{}{		Adjust location of a Pane after its enclosure has scrolled. This}{		only matters if the Pane is sticky in the direction of movement.}{ ******************************************************************************)PROCEDURE CPane.EnclosureScrolled (hOffset: Longint;								vOffset: Longint);	BEGIN		IF (hSizing <> sizFIXEDSTICKY) THEN			hOffset := 0;		IF (vSizing <> sizFIXEDSTICKY) THEN			vOffset := 0;		IF (hOffset <> 0) | (vOffset <> 0) THEN			BEGIN				Offset(-hOffset, -vOffset, FALSE);			END;	END;(**** A D A P T I N G   M E T H O D S ****)(******************************************************************************}{ FitToEnclosure}{}{		Make the frame of a Pane "fit" to the interior of its enclosure in}{		the horizontal and/or vertical directions. For a horizontal fit,}{		the Pane's width and left edge are changed to coincide with}{		those of its enclosure's interior. Similarly for a vertical fit.}{		Pane is NOT automatically redrawn.}{ ******************************************************************************)PROCEDURE CPane.FitToEnclosure (horizFit: Boolean;								vertFit: Boolean);	VAR		interior: LongRect;		hOffset: Integer;		vOffset: Integer;		delta: Rect;	BEGIN		hOffset := 0;		vOffset := 0;		itsEnclosure.GetInterior(interior);		EnclToFrameR(interior);		SetRect(delta, 0, 0, 0, 0);		IF (horizFit) THEN			BEGIN				hOffset := interior.left - frame.left;				delta.right := (interior.right - interior.left) - width;			END;		IF (vertFit) THEN			BEGIN				vOffset := interior.top - frame.top;				delta.bottom := (interior.bottom - interior.top) - height;			END;		Offset(hOffset, vOffset, FALSE);		ChangeSize(delta, FALSE);	END;(******************************************************************************}{ FitToEnclFrame}{}{		Make the frame of a Pane "fit" to the frame of its enclosure in}{		the horizontal and/or vertical directions. For a horizontal fit,}{		the Pane's width and left edge are changed to coincide with}{		those of its enclosure's frame. Similarly for a vertical fit.}{		Pane is NOT automatically redrawn.}{ ******************************************************************************)PROCEDURE CPane.FitToEnclFrame (horizFit: Boolean;								vertFit: Boolean);	VAR		enclFrame: LongRect;		hOffset: Integer;		vOffset: Integer;		delta: Rect;	BEGIN		hOffset := 0;		vOffset := 0;		itsEnclosure.GetFrame(enclFrame);		EnclToFrameR(enclFrame);		SetRect(delta, 0, 0, 0, 0);		IF (horizFit) THEN			BEGIN				hOffset := enclFrame.left - frame.left;				delta.right := (enclFrame.right - enclFrame.left) - width;			END;		IF (vertFit) THEN			BEGIN				vOffset := enclFrame.top - frame.top;				delta.bottom := (enclFrame.bottom - enclFrame.top) - height;			END;		Offset(hOffset, vOffset, FALSE);		ChangeSize(delta, FALSE);	END;(******************************************************************************}{ CenterWithinEnclosure}{}{		Center a Pane's frame within the interior of its enclosure's frame}{		either horizontally and/or vertically. Only the location of the}{		Pane is changed; its size is not altered. Pane is NOT automatically}{		redrawn.}{ ******************************************************************************)PROCEDURE CPane.CenterWithinEnclosure (horizCenter: Boolean;								vertCenter: Boolean);	VAR		interior: LongRect;		hOffset: Integer;		vOffset: Integer;	BEGIN		hOffset := 0;		vOffset := 0;		itsEnclosure.GetInterior(interior);		EnclToFrameR(interior);		IF (horizCenter) THEN			BEGIN				hOffset := interior.left - frame.left + (interior.right - interior.left - width) DIV 2;			END;		IF (vertCenter) THEN			BEGIN				vOffset := interior.top - frame.top + (interior.bottom - interior.top - height) DIV 2;			END;		Offset(hOffset, vOffset, FALSE);	END;(**** D R A W I N G   M E T H O D S ****)(******************************************************************************}{ Draw}{}{		Draw the contents of the Pane. The area parameter, specified in}{		the pane's Frame coordinates, indicates the portion of the Pane}{		which needs to be drawn. Subclasses of CPane which display}{		data (rather than just manage subviews) must override this method.}{		}{		TCL 1.1}{			- When usingLongCoord is FALSE, area is in Frame coordinates,}{			  and panes may draw directly in Frame coordinates.}{			  }{			- When usingLongCoord is TRUE, area is in QuickDraw coordinates,}{			  and drawing must be done in QuickDraw coordinates.}{			  Use QDToFrame/QDToFrameR to convert from QuickDraw to}{			  Frame coordinates, and use FrameToQD/FrameToQDR to convert}{			  from Frame to QuickDraw coordinates. These utilities may}{			  also be used when usingLongCoord is FALSE, and they still}{			  do the right thing.}{		}{ ******************************************************************************)PROCEDURE CPane.Draw (VAR area: Rect);	BEGIN		(* Null Method						*)	END;(******************************************************************************}{ DrawAll}{}{		Draw a Pane and all of its subviews. The port must be prepared}{		ahead of time.}{		}{		TCL 1.1}{			- DrawAll now draws pane borders (within Pane_Draw)}{			- DrawAll always expects area to be in Window coordinates.}{			- When calling Draw, DrawAll passes a rectangle in Frame}{			  coordinates when usingLongCoord is FALSE, and QD coordinates}{			  when it is TRUE.}{ ******************************************************************************)PROCEDURE CPane.DrawAll (VAR area: Rect);	VAR		tmpArea: Rect;		ignore: Boolean;	BEGIN		tmpArea := area;		Prepare;			(* area is in Window coordinates, put it into Frame or QD coordinates	*)		IF (usingLongCoord) THEN			OffsetRect(tmpArea, thePort^.portRect.left, thePort^.portRect.top)		ELSE			OffsetRect(tmpArea, hOrigin, vOrigin);		IF (NOT printing) THEN			ClipRect(tmpArea);		Draw(tmpArea);		IF (itsSubviews <> NIL) THEN			BEGIN				IF (NOT printing) THEN					BEGIN				(* clip area to aperture of this view before drawing subviews*)						FrameToWindR(aperture, tmpArea);						ignore := SectRect(tmpArea, area, tmpArea);					END				ELSE					tmpArea := area;					(* no need to SectRect here, already done in Pane_Draw *)				itsSubviews.DoForEach1(Pane_Draw, @tmpArea);			END;	END;(******************************************************************************}{ Refresh}{}{		Force a redraw of an entire Pane}{ ******************************************************************************)PROCEDURE CPane.Refresh;	VAR		pFrame: LongRect;	BEGIN			(* Refresh frame of Pane			*)		pFrame := frame;		RefreshLongRect(pFrame);	END;(******************************************************************************}{ RefreshLongRect}{}{		Force a redraw of an area by adding it to the update region}{		of its window. Drawing will not actually take place until the next}{		update event is processed. Only the portion of the area that}{		intersects the pane's aperture is invalidated.}{ ******************************************************************************)PROCEDURE CPane.RefreshLongRect (area: LongRect);	VAR		visArea: Rect;	BEGIN		IF ReallyVisible & SectAperture(area, visArea) THEN			InvalRect(visArea);	END;(******************************************************************************}{ RefreshRect}{}{		Force a redraw of an area by adding it to the update region}{		of its window. Drawing will not actually take place until the next}{		update event is processed. We must be sure to include only the}{		truly visible portion of the area -- the part which shows thru}{		the aperture of its enclosure.}{ ******************************************************************************)PROCEDURE CPane.RefreshRect (area: Rect); (* Area in Frame coordinates		*)	VAR		tmp: LongRect;	BEGIN		QDToLongRect(area, tmp);		RefreshLongRect(tmp);	END;(******************************************************************************}{ RefreshBorder}{}{	Force a redraw of a Pane's border}{ ******************************************************************************)PROCEDURE CPane.RefreshBorder;	VAR		borderRect: Rect;	BEGIN		IF (itsBorder <> NIL) THEN			BEGIN				FrameToWindR(frame, borderRect);				itsBorder.CalcBorderRect(borderRect);				GetWindow.Prepare;				InvalRect(borderRect);			END;	END;(**** P R I N T I N G   M E T H O D S ****)(******************************************************************************}{ Paginate}{}{		Specify the pagination of a Pane. By default, Panes only print one}{		page.}{ ******************************************************************************)PROCEDURE CPane.Paginate (aPrinter: CPrinter;								pageWidth, pageHeight: Integer);	BEGIN			(* Tell the printer we have only one page, and let it use the	*)			(* printable page area for the strip sizes						*)		aPrinter.SetStrips(1, 1);	END;(* so they will be passed a local copy of the range		*)(******************************************************************************}{ AboutToPrint}{}{		The specified range of pages is about to be printed.}{ ******************************************************************************)PROCEDURE CPane.AboutToPrint (VAR firstPage, lastPage: Integer);	VAR		first, last: Integer;	PROCEDURE Pane_AboutToPrint (aPane: CPane);		BEGIN			aPane.AboutToPrint(first, last);		END;	BEGIN		printing := TRUE;		ForceNextPrepare;		IF (itsSubviews <> NIL) THEN			BEGIN			(* subviews should not be able to modify the page range	*)				first := firstPage;				last := lastPage;				itsSubviews.DoForEach(Pane_AboutToPrint);			END;	END;(* Number of the page to print		*)(* Width of printed page in pixels	*)(* Height of page in pixels			*)(* setup class variable cPageArea with portion of page to be printed *)(* but is the same size as the page.								*)(******************************************************************************}{ PrintPage}{}{		Print the specified page. This method ignores the page number and}{		simply draws the entire pane. Subclasses which support multi-page}{		panes must override this method.}{ ******************************************************************************)PROCEDURE CPane.PrintPage (pageNum: Integer;								pageWidth, pageHeight: Integer;								aPrinter: CPrinter);	VAR		area: LongRect;		qdArea: Rect;	BEGIN		aPrinter.GetPageArea(pageNum, area);		FrameToWindR(area, cPageArea);		ForceNextPrepare;			(* pass a rectangle to DrawAll that is based on the frame top left	*)		area.left := frame.left;		area.top := frame.top;		area.right := area.left + pageWidth;		area.bottom := area.top + pageHeight;		FrameToWindR(area, qdArea);		DrawAll(qdArea);		SetRect(cPageArea, 0, 0, 0, 0);	END;(******************************************************************************}{ DonePrinting}{}{		Print loop has been completed. Perform any necessary clean-up.}{ ******************************************************************************)PROCEDURE CPane.DonePrinting;	PROCEDURE Pane_DonePrinting (aPane: CPane);		BEGIN			aPane.DonePrinting;		END;	BEGIN		printing := FALSE;		ForceNextPrepare;		IF (itsSubviews <> NIL) THEN			itsSubviews.DoForEach(Pane_DonePrinting);	END;(******************************************************************************}{ PrepareToPrint}{}{		Set up coordinate system and clipping region for printing. This}{		method prepares the port so that only the portion of the pane}{		which is visible on the screen is printed.}{ ******************************************************************************)PROCEDURE CPane.PrepareToPrint;	VAR		clipR: Rect;		lr: LongRect;	BEGIN		IF (usingLongCoord) THEN			SetOrigin(hOrigin MOD kOriginConstraint, vOrigin MOD kOriginConstraint)		ELSE			SetOrigin(Integer(hOrigin), Integer(vOrigin));		CASE printClip OF			clipAPERTURE: 				FrameToQDR(aperture, clipR);			clipFRAME: 				FrameToQDR(frame, clipR);			clipPAGE: 				BEGIN					clipR := cPageArea; (* cPageArea is area in Window coordinates *)					IF usingLongCoord THEN						OffsetRect(clipR, thePort^.portRect.left, thePort^.portRect.top)					ELSE						BEGIN							WindToFrameR(clipR, lr);							LongToQDRect(lr, clipR);						END;				END;		END;		ClipRect(clipR);	END;(**** C A L I B R A T I N G   M E T H O D S ****)(******************************************************************************}{ Prepare}{}{		Prepare for drawing the Pane by setting the port, establishing}{		the correct coordinate system, clipping the the proper area, and}{		restoring its drawing environment.}{		}{		TCL 1.1}{			- Now has an optimization to reduce the cost of making }{			  redundant calls to Prepare. The class variable cPreparedView}{			  is kept in synch with the currently prepared view. Prepare}{			  can now check if the pane has already been prepared. For}{			  this to work correctly, it is important that ForceNextPrepare}{			  is called whenever the port, origin, or clipping region are}{			  altered outside the Prepare mechanism. ForceNextPrepare}{			  is called automatically after each event has been handled.}{			  }{			- Prepare sets up the port differently depending on the state}{			  of the usingLongCoord flag. When it is FALSE, the origin is}{			  set up as before, taking it directly from hOrigin and vOrigin.}{			  This sets up the port so the pane can draw directly in}{			  Frame coordinates.}{			  }{			  When usingLongCoord is TRUE, Frame coordinates, hOrigin, and vOrigin}{			  are potentially beyond the 16 bit QuickDraw limits. Panes}{			  must call FrameToQD and FrameToQDR to convert Frame coordinates}{			  to QuickDraw coordinates before drawing. It would be possible}{			  to simply set the origin to 0,0 in this case, except that}{			  patterns and pixpats would not draw correctly. QuickDraw uses}{			  the origin to align patterns. To accomodate this, we move the}{			  origin within an area constrained by kOriginConstraint. }{			  }{ ******************************************************************************)PROCEDURE CPane.Prepare;	VAR		tempRect: Rect;	BEGIN		IF (cPreparedView = SELF) THEN			EXIT(Prepare);		INHERITED Prepare;		IF (printing) THEN			BEGIN				PrepareToPrint;			END		ELSE			BEGIN				(* Use the Port of this Pane		*)				(* Set to Frame coordinates			*)				SetPort(macPort);				(* Setup the origin for the Pane and clip drawing			*)				(* to the visible portion.									*)				IF (usingLongCoord) THEN					BEGIN						SetOrigin(hOrigin MOD kOriginConstraint, vOrigin MOD kOriginConstraint);						FrameToQDR(aperture, tempRect);					END				ELSE					BEGIN						SetOrigin(Integer(hOrigin), Integer(vOrigin));						LongToQDRect(aperture, tempRect);					END;				ClipRect(tempRect);			END;		RestoreEnvironment;	END;(******************************************************************************}{ RestoreEnvironment}{}{		Restore the drawing environment of a Pane}{ ******************************************************************************)PROCEDURE CPane.RestoreEnvironment;	BEGIN		IF (itsEnvironment <> NIL) THEN			itsEnvironment.Restore;	END;(******************************************************************************}{ CalcFrame}{}{		Determine the coordinates of the Pane's frame and origin based on}{		the width, height, hEncl, vEncl. These instance variables must be}{		set before invoking this method.}{		}{		The frame is set to have its top left corner at (0, 0). The defines}{		the Frame coordinates of the Pane. Subclasses must override this}{		method if they use a different Frame coordinate system.}{ ******************************************************************************)PROCEDURE CPane.CalcFrame;	VAR		hLocation: Longint;		vLocation: Longint;	BEGIN		frame.left := 0;				(* Frame defines pane coords		*)		frame.top := 0;				(* Top left of frame is at (0, 0)	*)		frame.right := width;		frame.bottom := height;									(* Determine location of pane in	*)									(*   Window coords					*)		itsEnclosure.SubpaneLocation(hEncl, vEncl, hLocation, vLocation);									(* Origin maps between Frame and	*)									(*   Window coords. Origin is the	*)									(*   top left corner of the window	*)									(*   expressed in Frame coords		*)		hOrigin := frame.left - hLocation;		vOrigin := frame.top - vLocation;		ForceNextPrepare;	END;(******************************************************************************}{ ResizeFrame}{}{		Adjust a Pane's frame when the size of the pane changes. The delta}{		rectangle parameter specifies the change in location of each side}{		of the Pane. Positive values mean a move to the right or down;}{		negative values mean a move to the left or up.}{}{		This method always adjusts the width and height to the new size}{		and puts the top left of the frame at (0, 0). This will cause a}{		shift in the origin if the left or top sides of the pane move.}{ ******************************************************************************)PROCEDURE CPane.ResizeFrame (delta: Rect);	BEGIN					(* Adjust dimensions of the pane	*)		width := width + delta.right - delta.left;		height := height + delta.bottom - delta.top;					(* Origin moves with the top left	*)					(*   corner of the pane				*)					(* Put top left of frame at (0, 0)	*)		frame.top := 0;		frame.left := 0;		frame.right := width;		frame.bottom := height;		hOrigin := hOrigin - delta.left;		vOrigin := vOrigin - delta.top;		ForceNextPrepare;	END;(******************************************************************************}{ CalcAperture {OVERRIDE}	{Determine the area of the pane where drawing may occur . This is the area within the frame that is}	{ not obscured by the bounds of enclosing views . The aperature is in Frame coordinates .}(******************************************************************************}PROCEDURE CPane.CalcAperture;	VAR		enclAperture: LongRect;		prevAperture: LongRect;		ignore: Boolean;		(*}{         *  Calculate aperture of subviews when aperture of enclosure changes.}{         *)	PROCEDURE Pane_CalcAperture (thePane: CPane);		BEGIN			thePane.CalcAperture;		END;	BEGIN			(* TCL 1.1 Save the previous aperture before recalculating.*)			(* Since a pane's aperture is the intersection of its frame*)			(* and its enclosure's aperture, we know that if this*)			(* pane's aperture didn't change, then none if its*)			(* subpane's apertures will change either. *)			(* So we recalc the aperture, and if it doesn't change,*)			(* there's no need to pass the message to the subpanes*)			(* Thanks to Doug Wyatt for the tip.*)			(* Get enclosure's aperture			*)		prevAperture := aperture;									(* Aperture is the frame restricted	*)									(*   by the enclosure's aperture	*)		itsEnclosure.GetAperture(enclAperture);									(* Convert it to Frame coords		*)		EnclToFrameR(enclAperture);		ignore := SectLongRect(frame, enclAperture, aperture);		ForceNextPrepare;		IF (NOT EqualLongRect(prevAperture, aperture)) & (itsSubviews <> NIL) THEN									(* Pass it on to subviews   *)			itsSubviews.DoForEach(Pane_CalcAperture);	END;(**** C O O R D I N A T E  T R A N S F O R M   M E T H O D S ****)(******************************************************************************}{ WindToFrame}{}{		Convert a point from Window coords to the Frame coords of a Pane}{ ******************************************************************************)PROCEDURE CPane.WindToFrame (qdPt: Point;								VAR framePt: LongPt);	BEGIN		framePt.h := Longint(qdPt.h) + hOrigin;		framePt.v := Longint(qdPt.v) + vOrigin;	END;(******************************************************************************}{ WindToFrameR}{}{		Convert a rectangle from Window coords to the Frame coords of a Pane}{ ******************************************************************************)PROCEDURE CPane.WindToFrameR (qdRect: Rect;								VAR frameRect: LongRect);	BEGIN		QDToLongRect(qdRect, frameRect);		OffsetLongRect(frameRect, hOrigin, vOrigin);	END;(******************************************************************************}{ FrameToWind}{}{		Convert a point from the Frame coords of a Pane to Window coords}{ ******************************************************************************)PROCEDURE CPane.FrameToWind (framePt: LongPt;								VAR qdPt: Point);	BEGIN		qdPt.h := Longint(framePt.h) - hOrigin;		qdPt.v := Longint(framePt.v) - vOrigin;	END;(******************************************************************************}{ FrameToWindR}{}{		Convert a rectangle from the Frame coords of a Pane to Window coords}{ ******************************************************************************)PROCEDURE CPane.FrameToWindR (frameRect: LongRect;								VAR qdRect: Rect);	BEGIN		OffsetLongRect(frameRect, -hOrigin, -vOrigin);		LongToQDRect(frameRect, qdRect);	END;(******************************************************************************}{ EnclToFrame}{}{		Convert a point from the Frame coords of the enclosure to the}{		Frame coords of the Pane}{ ******************************************************************************)PROCEDURE CPane.EnclToFrame (VAR thePoint: LongPt);	VAR		enclHOrigin: Longint;		enclVOrigin: Longint;	BEGIN		itsEnclosure.GetOrigin(enclHOrigin, enclVOrigin);		thePoint.h := thePoint.h + hOrigin - enclHOrigin;		thePoint.v := thePoint.v + vOrigin - enclVOrigin;	END;(******************************************************************************}{ EnclToFrameR}{}{		Convert a rectangle from the Frame coords of the enclosure to the}{		Frame coords of the Pane}{ ******************************************************************************)PROCEDURE CPane.EnclToFrameR (VAR theRect: LongRect);	VAR		enclHOrigin: Longint;		enclVOrigin: Longint;	BEGIN		itsEnclosure.GetOrigin(enclHOrigin, enclVOrigin);		OffsetLongRect(theRect, hOrigin - enclHOrigin, vOrigin - enclVOrigin);	END;(******************************************************************************}{ FrameToEncl}{}{		Convert a point from the Frame coords of a Pane to the}{		Frame coords of its enclosure}{ ******************************************************************************)PROCEDURE CPane.FrameToEncl (VAR thePoint: LongPt);	VAR		enclHOrigin: Longint;		enclVOrigin: Longint;	BEGIN		itsEnclosure.GetOrigin(enclHOrigin, enclVOrigin);		thePoint.h := thePoint.h + enclHOrigin - hOrigin;		thePoint.v := thePoint.v + enclVOrigin - vOrigin;	END;(******************************************************************************}{ FrameToEnclR}{}{		Convert a rectangle from the Frame coords of a Pane to the}{		Frame coords of its enclosure}{ ******************************************************************************)PROCEDURE CPane.FrameToEnclR (VAR theRect: LongRect);	VAR		enclHOrigin: Longint;		enclVOrigin: Longint;	BEGIN		itsEnclosure.GetOrigin(enclHOrigin, enclVOrigin);		OffsetLongRect(theRect, enclHOrigin - hOrigin, enclVOrigin - vOrigin);	END;(******************************************************************************}{ FrameToGlobalR {OVERRIDE}	{Convert a rectangle from Frame to Global coordinates}(******************************************************************************}PROCEDURE CPane.FrameToGlobalR (frameRect: LongRect;								VAR globalRect: Rect);	VAR		theOffset: Point;	BEGIN		LongToQDRect(frameRect, globalRect);		theOffset := WindowPeek(macPort)^.contRgn^^.rgnBBox.topLeft;		OffsetRect(globalRect, theOffset.h - hOrigin, theOffset.v - vOrigin);	END;(******************************************************************************}{ TrackMouse }{}{		Follow the mouse while it is being held down and repeatedly inform}{		a specified Task of the mouse location}{ ******************************************************************************)PROCEDURE CPane.TrackMouse (theTask: CMouseTask;								startPt: LongPt;								VAR pinRect: LongRect);	VAR		currPt: LongPt;		prevPt: LongPt;		macEvent: EventRecord;		qdPt: Point;	BEGIN		Prepare;		theTask.BeginTracking(startPt);		prevPt := startPt;		currPt := startPt;					(* ??? We could call WaitNextEvent	*)					(*   here to give background apps	*)					(*   some CPU time. However, this	*)					(*   makes mouse tracking a little	*)					(*   bit sluggish.					*)		WHILE StillDown DO	(* Track while button is pressed	*)			BEGIN				Prepare;				GetMouse(qdPt);				QDToFrame(qdPt, currPt);				PinInRect(pinRect, currPt);				theTask.KeepTracking(currPt, prevPt, startPt);				prevPt := currPt;			END;		Prepare;		IF (OSEventAvail(mUpMask, macEvent)) THEN			BEGIN				qdPt := macEvent.where;				GlobalToLocal(qdPt);				QDToFrame(qdPt, currPt);			END;		PinInRect(pinRect, currPt);		theTask.EndTracking(currPt, prevPt, startPt);	END;(******************************************************************************}{ QDToFrame}{}{		Convert a point from QuickDraw coords to the Frame coords of a Pane.}{		The qdPt parameter is assumed to be in whatever QuickDraw's idea}{		of the Pane's local coordinate system is. Without long coordinates,}{		this matches Frame coordinates. With long coordinates, we have to}{		account for both the frame's origin and the partial offsetting}{		we apply to QuickDraw's origin.}{ ******************************************************************************)PROCEDURE CPane.QDToFrame (qdPt: Point;								VAR framePt: LongPt);	BEGIN		Prepare;		IF (usingLongCoord) THEN			BEGIN				WindToFrame(qdPt, framePt);				framePt.h := framePt.h - thePort^.portRect.left;				framePt.v := framePt.v - thePort^.portRect.top;			END		ELSE			QDToLongPt(qdPt, framePt);	END;(******************************************************************************}{ QDToFrameR}{}{		Convert a rectangle from QuickDraw coords to the Frame coords of a Pane}{ ******************************************************************************)PROCEDURE CPane.QDToFrameR (qdRect: Rect;								VAR frameRect: LongRect);	BEGIN		Prepare;		IF (usingLongCoord) THEN			BEGIN				WindToFrameR(qdRect, frameRect);				OffsetLongRect(frameRect, -thePort^.portRect.left, -thePort^.portRect.top);			END		ELSE			QDToLongRect(qdRect, frameRect);	END;(******************************************************************************}{ FrameToQD}{}{		Convert a point from the Frame coords of a Pane to QuickDraw coords}{ ******************************************************************************)PROCEDURE CPane.FrameToQD (framePt: LongPt;								VAR qdPt: Point);	BEGIN		Prepare;		IF (usingLongCoord) THEN			BEGIN				FrameToWind(framePt, qdPt);				qdPt.h := qdPt.h + thePort^.portRect.left;				qdPt.v := qdPt.v + thePort^.portRect.top;			END		ELSE			LongToQDPt(framePt, qdPt);	END;(******************************************************************************}{ FrameToQDR}{}{		Convert a rectangle from the Frame coords of a Pane to QuickDraw coords}{ ******************************************************************************)PROCEDURE CPane.FrameToQDR (frameRect: LongRect;								VAR qdRect: Rect);	BEGIN		Prepare;		IF (usingLongCoord) THEN			BEGIN				FrameToWindR(frameRect, qdRect);				OffsetRect(qdRect, thePort^.portRect.left, thePort^.portRect.top);			END		ELSE			LongToQDRect(frameRect, qdRect);	END;(******************************************************************************}{ SectAperture}{}{	Clip the LongRect to the pixels visible thru the aperture, and return}{	the result in a QD rect. Returns TRUE if resulting rect is non-empty.}{ ******************************************************************************)FUNCTION CPane.SectAperture (srcRect: LongRect;								VAR destRect: Rect): Boolean;	BEGIN		Prepare;		IF (SectLongRect(aperture, srcRect, srcRect)) THEN			BEGIN				FrameToQDR(srcRect, destRect);				SectAperture := NOT EmptyRect(destRect);			END		ELSE			BEGIN				SetRect(destRect, 0, 0, 0, 0);				SectAperture := FALSE;			END;	END;(******************************************************************************}{ GetHelpResID}{}{	Return the resource ID of the 'hrct' resource that has the }{	help balloon info for this pane. This method passes the message to the}{	pane's enclosing window, which return the ID to be used for all panes}{	in the window.}{	}{ ******************************************************************************)FUNCTION CPane.GetHelpResID: Integer;	BEGIN		GetHelpResID := GetWindow.GetHelpResID;	END;{****************************************************}{	 Pane_Contains 	}{}{	        Check whether a Pane contains a specified point }{}{****************************************************}FUNCTION Pane_Contains (thePane: CPane;								thePoint: Ptr): Boolean;	BEGIN		Pane_Contains := thePane.Contains(PointPtr(thePoint)^);	END;{****************************************************}{	 Pane_AdjustToEnclosure 	}{}{	   Tell a pane to adjust to change in the size of its enclosure }{}{****************************************************}PROCEDURE Pane_AdjustToEnclosure (thePane: CPane;								delta: RectPtr);	BEGIN		thePane.AdjustToEnclosure(delta^);	END;{****************************************************}{	 Pane_Draw 	}{}{	   Prepare and Draw a Pane }{}{****************************************************}PROCEDURE Pane_Draw (thePane: CPane;								area: RectPtr);	VAR		paneArea: Rect;		(* Area in Pane's Frame coords		*)		paneAperture: Rect;		border: CPaneBorder;		paneFrame, borderRect: Rect;	BEGIN							(* Only draw if pane is visible		*)		IF (thePane.ReallyVisible) THEN			BEGIN				border := thePane.GetBorder;				IF (border <> NIL) THEN					BEGIN				(* Get the pane's frame in window coordinates		*)				(* then ask the border for the border rect.			*)				(* If that rect intersects the area to draw, then	*)				(* go ahead and draw the border						*)						thePane.FrameToWindR(thePane.frame, paneFrame);						borderRect := paneFrame;						border.CalcBorderRect(borderRect);						IF (SectRect(borderRect, area^, borderRect)) THEN							BEGIN								IF (thePane.printing) THEN									SetOrigin(0, 0)								ELSE									thePane.GetWindow.Prepare;								ClipRect(borderRect);								ForceNextPrepare;								border.DrawBorder(paneFrame);							END;					END;				IF (NOT thePane.printing) THEN					BEGIN					(* DrawAll always receives the area in Window 			*)					(* coordinates. If we're not printing, clip the			*)					(* area to the aperture.								*)						thePane.FrameToWindR(thePane.aperture, paneAperture);				(* See if area intersects the		*)				(*   aperture of the Pane			*)				(*   be drawn.						*)						IF (SectRect(paneAperture, area^, paneArea)) THEN							BEGIN					(* Some portion of this Pane must	*)					(* be drawn							*)								thePane.DrawAll(paneArea);							END;					END				ELSE				(* printing, don't clip the area		*)					BEGIN						paneArea := area^;						thePane.DrawAll(paneArea);					END;			END;	END;END.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          2æ             ⁄      ˛      CPane.p   TEXTPJMM@         Z  TEXTPJMM@                       §Wc      L  	÷      	Ë      	˙      
      
      
0      
B      
T      
f      
x      
ä      
ú      
Æ      
¿      
“      
‰         Ä   1.1.2	TCL 1.1.2           2 iíú¸    2  vers   
 ˇˇ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            (******************************************************************************}{ CPaneBorder.p}{}{		CPaneBorder is a helper class for CPane. It draws a border}{		outside the frame of a client frame when requested. It also}{		can calculate the rectangle that encompasses the pane and its}{		border. CPaneBorder makes no assumptions about which coordinate}{		system to use: it always calculates and draws relative to }{		a rectangle that is passed to it.}{		CPaneBorder can draw rectangular, shadowed rectangular,}{		rounded rectangular, or oval borders. It may be subclassed}{		to provide additional borders.}{		}{	SUPERCLASS = CObject}{}{	Copyright © 1991 Symantec Corporation. All rights reserved.}{}{}{ ******************************************************************************)UNIT CPaneBorder;INTERFACEUSES	TCL;IMPLEMENTATION(******************************************************************************}{ IPaneBorder}{}{ 	Initialize a PaneBorder. The borderFlags are taken from the}{ 	argument, and the other border attributes are initialized}{ 	with defaults. All the defaults may be changed via methods.}{******************************************************************************)PROCEDURE CPaneBorder.IPaneBorder (aBorderFlags: Longint);	BEGIN		borderPen.h := 1;		borderPen.v := 1;		shadowOffset.h := 2;		shadowOffset.v := 2;		shadowPen.h := 2;		shadowPen.v := 2;		roundDiameter.h := 16;		roundDiameter.v := 16;		doShadow := FALSE;		SetRect(margin, 0, 0, 0, 0);		SetBorderFlags(aBorderFlags);		SetPattern(black);	END;(******************************************************************************}{ IResPaneBorder}{}{ 	Initialize a pane border from a 'PBrd' resource.}{}{******************************************************************************)FUNCTION GetPat (patID: Integer): PatHandle;	BEGIN		GetPat := GetPattern(patID);	END;PROCEDURE CPaneBorder.IResPaneBorder (resID: Integer);	VAR		savedAlloc: Boolean;		template: PaneBorderTempHndl;		t: PaneBorderTempPtr;		patID: Integer;		pat: PatHandle;		fi: FailInfo;	PROCEDURE HandleFailure (error: Integer;									message: Longint);		BEGIN			ForgetResource(template);			ForgetResource(pat);		END;	BEGIN		pat := NIL;		patID := 0;		template := NIL;		CatchFailures(fi, HandleFailure);		doShadow := FALSE;		savedAlloc := SetAllocation(kAllocCanFail);		template := PaneBorderTempHndl(GetResource(kPaneBorderRes, resID));		IF (template <> NIL) & (template^^.patID <> 0) THEN			BEGIN				patID := template^^.patID;				pat := GetPat(patID);			END;		savedAlloc := SetAllocation(savedAlloc);		FailNILRes(template);		IF (patID > 0) THEN			FailNILRes(pat);		IF (pat <> NIL) THEN			BEGIN				SetPattern(pat^^);				HPurge(Handle(pat));			END		ELSE			SetPattern(black);		t := template^;		SetBorderFlags(t^.borderFlags);		SetPenSize(t^.borderPen.h, t^.borderPen.v);		IF ((t^.shadowPen.h > 0) & (t^.shadowPen.v > 0)) THEN			BEGIN				SetShadow(t^.shadowOffset.h, t^.shadowOffset.v, t^.shadowPen.h, t^.shadowPen.v);			END;		IF (BAND(borderFlags, kBorderRoundRect) <> 0) THEN			BEGIN				SetRounding(t^.roundDiameter.h, t^.roundDiameter.v);			END;		SetMargin(t^.margin);		Success;	END;(******************************************************************************}{ SetPattern}{}{ 	Set the pattern used for drawing all border parts.}{******************************************************************************)PROCEDURE CPaneBorder.SetPattern (aPattern: Pattern);	BEGIN		penPattern := aPattern;	END;(******************************************************************************}{ GetPattern}{}{ 	Return the current pattern.}{******************************************************************************)PROCEDURE CPaneBorder.GetPattern (VAR aPattern: Pattern);	BEGIN		aPattern := penPattern;	END;(******************************************************************************}{ SetBorderFlags}{}{ 	Set the border flags. The currently defined flags are:}{ 		}{		kBorderNone			0x00		no border}{		kBorderLeft			0x01		line on left side}{		kBorderTop			0x02		line on top side}{		kBorderRight		0x04		line on right side}{		kBorderBottom		0x08		line on bottom}{		kBorderOval			0x10		oval border}{		kBorderRoundRect	0x20		rounded rectangle border}{		kBorderRsrv1		0x40		reserved}{		kBorderRsrv2		0x80		reserved}{		}{	For convenience the constant kBorderFrame is defined to provide a}{	rectangular border. It is equivalent to specifying}{	kBorderLeft+kBorderTop+kBorderRight+kBorderBottom.}{}{******************************************************************************)PROCEDURE CPaneBorder.SetBorderFlags (aBorderFlags: Longint);	BEGIN		borderFlags := aBorderFlags;		(* Shadowing only applies to the kBorderFrame setting *)		IF (borderFlags <> kBorderFrame) THEN			doShadow := FALSE;	END;(******************************************************************************}{ GetBorderFlags}{}{ 	Return the current border flags}{******************************************************************************)FUNCTION CPaneBorder.GetBorderFlags: Longint;	BEGIN		GetBorderFlags := borderFlags;	END;(******************************************************************************}{ SetPenSize}{}{ 	Sert the pen size used to draw the border.}{******************************************************************************)PROCEDURE CPaneBorder.SetPenSize (penWidth: Integer;								penHeight: Integer);	BEGIN		SetPt(borderPen, penWidth, penHeight);	END;(******************************************************************************}{ GetPenSize}{}{ 	Return the pen size used to draw the border.}{******************************************************************************)PROCEDURE CPaneBorder.GetPenSize (VAR penWidth, penHeight: Integer);	BEGIN		penWidth := borderPen.h;		penHeight := borderPen.v;	END;(******************************************************************************}{ SetShadow}{}{ 	Set the shadow attributes. hOffset and vOffset specify the offset of the}{ 	shadow, i.e. how many pixels the shadow rectangle appears to be}{ 	offset from the pane frame. Width and height specify the pen size}{ 	used to draw the shadow.}{******************************************************************************)PROCEDURE CPaneBorder.SetShadow (hOffset: Integer;								vOffset: Integer;								width: Integer;								height: Integer);	BEGIN		SetBorderFlags(kBorderFrame);		doShadow := TRUE;		SetPt(shadowOffset, hOffset, vOffset);		SetPt(shadowPen, width, height);	END;(**********